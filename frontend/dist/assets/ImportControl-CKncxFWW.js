import{o as $e,w as me,a as l,c as r,b as e,f as xe,g as Re,h as Ae,d as $,t as c,F as w,r as _,e as m,A as le,v as Ne,n as re,m as p}from"./index-Bb3aArA6.js";import{S as R}from"./sweetalert2.esm.all-AlKuj1Cq.js";const Be={class:"w-full h-screen flex flex-col p-1"},Le={class:"w-full flex-1 min-h-0 bg-white rounded-2xl shadow-xl px-4 py-3 border border-slate-200 flex flex-col"},Me={class:"flex justify-between items-center mb-4 gap-4"},De={class:"flex items-center gap-4 flex-1 min-w-0"},je={class:"flex items-center gap-2 flex-1 max-w-2xl bg-gray-50 px-3 py-1.5 rounded-lg border border-gray-200"},Oe={class:"flex gap-2 shrink-0"},Fe=["disabled"],He={key:0,class:"animate-spin"},Ve={key:1},Ue=["disabled"],Ge=["disabled"],qe={class:"grid grid-cols-1 md:grid-cols-5 gap-2 mb-4"},Qe={class:"bg-gray-50 px-3 py-2 rounded-lg shadow-sm border border-gray-200 flex items-center justify-between"},We={class:"text-lg font-bold text-gray-800"},Je={class:"bg-gray-50 px-3 py-2 rounded-lg shadow-sm border border-gray-200 flex items-center justify-between"},Ke={class:"text-lg font-bold text-green-600"},Xe={class:"bg-gray-50 px-3 py-2 rounded-lg shadow-sm border border-gray-200 flex items-center justify-between"},Ye={class:"text-lg font-bold text-yellow-600"},Ze={class:"bg-gray-50 px-3 py-2 rounded-lg shadow-sm border border-gray-200 flex items-center justify-between"},et={class:"text-lg font-bold text-red-600"},tt={class:"bg-gray-50 px-3 py-2 rounded-lg shadow-sm border border-gray-200 flex items-center justify-between"},st={class:"text-lg font-bold text-purple-600"},ot={key:0,class:"mb-4 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg"},at={class:"flex items-start"},lt={class:"ml-3 flex-1"},rt={class:"mt-2 text-sm text-yellow-700"},nt={class:"space-y-3 max-h-48 overflow-y-auto"},it={class:"flex items-center justify-between mb-2"},dt={class:"font-semibold text-gray-900"},ct={class:"text-xs text-gray-500"},ut={key:0,class:"mb-2"},pt={class:"mt-1 flex flex-wrap gap-1"},mt={key:1},xt={class:"mt-1 flex flex-wrap gap-1"},gt={class:"mt-3 flex gap-2"},vt={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ft={class:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col"},bt={class:"flex-1 overflow-y-auto px-6 py-4"},yt={key:0,class:"space-y-4"},ht={class:"space-y-3"},wt={class:"space-y-2"},_t={class:"flex items-center justify-between mb-3"},Ct={class:"font-bold text-gray-900"},kt={class:"text-xs text-gray-500"},Tt={class:"flex flex-wrap gap-2"},St={class:"space-y-3 pt-4 border-t border-gray-200"},Et={class:"flex items-start gap-3 cursor-pointer"},It={key:0,class:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg"},Pt={key:1,class:"flex flex-col items-center justify-center py-12"},zt={class:"text-lg font-medium text-gray-900"},$t={key:2,class:"space-y-4"},Rt={key:0,class:"bg-green-50 border-l-4 border-green-400 p-4 rounded-r-lg"},At={class:"flex items-start"},Nt={class:"ml-3"},Bt={class:"text-sm text-green-700 mt-1"},Lt={key:1,class:"bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg"},Mt={class:"flex items-start"},Dt={class:"ml-3"},jt={class:"text-sm text-red-700 mt-1"},Ot={key:2,class:"border border-gray-200 rounded-lg p-4"},Ft={class:"flex flex-wrap gap-2"},Ht={key:3,class:"border border-gray-200 rounded-lg p-4"},Vt={key:0,class:"flex items-center gap-2 text-green-700"},Ut={key:1,class:"flex items-center gap-2 text-red-700"},Gt={key:4,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},qt={class:"text-sm text-blue-800 space-y-1 list-disc list-inside"},Qt={key:0},Wt={class:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end gap-3"},Jt={class:"flex-1 min-h-0 overflow-y-auto bg-white rounded-lg shadow-sm border border-gray-200"},Kt={class:"min-w-full divide-y divide-gray-200 table-fixed"},Xt={class:"bg-white divide-y divide-gray-200"},Yt={key:0},Zt={key:1},es={class:"px-3 py-2 whitespace-nowrap"},ts={class:"text-sm font-medium text-gray-900"},ss={class:"px-3 py-2 whitespace-nowrap"},os=["title"],as={class:"text-xs text-gray-400"},ls={class:"px-3 py-2 whitespace-nowrap"},rs={key:0,class:"space-y-2"},ns={key:1,class:"space-y-2"},is={class:"px-3 py-2 whitespace-nowrap text-sm text-gray-500"},ds={class:"px-3 py-2 whitespace-nowrap text-sm text-gray-500"},cs={key:0},us={key:1,class:"text-gray-400"},ps={class:"px-3 py-2 whitespace-nowrap text-sm text-gray-500"},ms={class:"px-3 py-2 whitespace-nowrap text-sm"},xs=["onClick","disabled"],gs={key:0,class:"animate-spin"},vs={key:1},fs={key:2,class:"mt-4 bg-gray-900 rounded-lg shadow-lg overflow-hidden"},bs={class:"px-4 py-2 bg-gray-800 border-b border-gray-700 flex justify-between items-center"},ys={class:"p-4 text-xs font-mono text-green-400 overflow-auto max-h-96 whitespace-pre-wrap"},hs={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ws={class:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col"},_s={class:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-purple-500 to-purple-600"},Cs={class:"flex items-center justify-between"},ks={class:"flex border-b border-gray-200 bg-gray-50"},Ts={class:"flex-1 overflow-y-auto px-6 py-4"},Ss={key:0,class:"space-y-3"},Es={key:0,class:"text-center py-8 text-gray-500"},Is={key:1,class:"text-center py-8 text-gray-500"},Ps={key:2,class:"space-y-2"},zs={class:"flex items-center justify-between mb-3"},$s={class:"font-bold text-gray-900"},Rs={class:"text-xs text-gray-500"},As={class:"grid grid-cols-2 gap-4"},Ns={key:0},Bs={class:"mt-1 flex flex-wrap gap-1"},Ls={key:1},Ms={class:"mt-1 flex flex-wrap gap-1"},Ds={key:1,class:"space-y-3"},js={key:0,class:"text-center py-8 text-gray-500"},Os={key:1,class:"text-center py-8 text-gray-500"},Fs={key:2,class:"space-y-2"},Hs={class:"flex items-center justify-between mb-3"},Vs={class:"font-bold text-gray-900"},Us={class:"ml-2 text-xs text-gray-500"},Gs={class:"text-xs text-gray-500"},qs={class:"space-y-2"},Qs={class:"bg-gray-50 rounded p-2"},Ws={class:"mt-1 flex flex-wrap gap-1"},Js={key:0,class:"text-xs text-blue-600 flex items-center gap-1"},Ks={class:"px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center"},Xs={class:"text-sm text-gray-600"},Ys={key:0},Zs={key:1},lo={__name:"ImportControl",setup(eo){const b=p([]),Y=p(null),S=p(!1),x=p(!1),A=p(null),y=p(null),j=p(!1),N=p({}),C=p(new Set),E=p(new Set);let Q=null;const T=`${"".replace(/\/$/,"")}/api/produccion`,W=R.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:4e3,timerProgressBar:!0}),I=R.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0,icon:"error"}),ge=o=>{const t=String(o||"").trim();return t?/^[A-Za-z]:[\\/]/.test(t)?t.replace(/\//g,"\\"):t:""};localStorage.getItem("csvFolder");const h=p(""),B=p([]),Z=p(!0),ee=p(!1),P=p(!1),te=p(""),g=p(null),L=p({reimport:!0}),f=p([]);let M=null;const D=p(!1),z=p("warnings"),U=p([]),G=p([]),O=p(!1);async function ve(){try{const o=await fetch(`${T}/system/pick-folder`,{method:"POST"});if(!o.ok)throw new Error("Error al abrir di√°logo");const t=await o.json();t.path&&(h.value=t.path,se())}catch(o){console.error(o),W.fire({icon:"info",title:"Escribe la ruta de la carpeta manualmente"})}}const se=()=>{h.value=ge(h.value),h.value?(localStorage.setItem("csvFolder",h.value),W.fire({icon:"success",title:"Carpeta guardada"})):(localStorage.removeItem("csvFolder"),W.fire({icon:"success",title:"Usando carpeta por defecto"})),k(),F()};$e(()=>{k(),F()});async function F(){try{const o=h.value?`?csvFolder=${encodeURIComponent(h.value)}`:"",t=await fetch(`${T}/import/column-warnings${o}`);if(!t.ok)return;const s=await t.json();if(s.warnings&&s.warnings.length>0){const n=new Date(Date.now()-864e5);B.value=s.warnings.filter(a=>new Date(a.timestamp)>n&&a.hasDifferences),Z.value=!0}else B.value=[]}catch(o){console.error("Error al obtener warnings de columnas:",o)}}function fe(){Z.value=!1,B.value=[]}function be(){ee.value=!0,g.value=null,P.value=!1,L.value.reimport=!0}function oe(o){return String(o??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function H(){if(f.value.length===0)return;const o=M?((performance.now()-M)/1e3).toFixed(2):"0",t=f.value.reduce((a,i)=>a+(i.rows||0),0);f.value.filter(a=>a.success).length;const s=f.value.filter(a=>!a.success).length;let n="";f.value.forEach(a=>{const i=a.success?"‚úÖ":"‚ùå",u=a.success?"text-green-600":"text-red-600",d=a.time?`${a.time}s`:"-",v=a.rows?a.rows.toLocaleString():"-",ae=oe(a.mode||"-"),K=oe(a.modeReason||""),X=K?`<span class="text-xs text-gray-500 ml-2">${K}</span>`:"";n+=`
      <tr class="border-b hover:bg-gray-50">
        <td class="px-4 py-2 text-center ${u}">${i}</td>
        <td class="px-4 py-2 font-mono text-sm whitespace-nowrap">${oe(a.table)}</td>
        <td class="px-4 py-2 text-right font-semibold whitespace-nowrap">${v}</td>
        <td class="px-4 py-2 text-left whitespace-nowrap">
          <span class="font-mono text-xs">${ae}</span>${X}
        </td>
        <td class="px-4 py-2 text-right text-gray-600 whitespace-nowrap">${d}</td>
      </tr>
    `}),R.fire({html:`
      <div class="text-left">
        <div class="flex items-center gap-3 mb-3 whitespace-nowrap">
          <div class="w-8 h-8 rounded-full flex items-center justify-center ${s>0?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}" aria-hidden="true">
            ${s>0?"‚ö†Ô∏è":"‚úÖ"}
          </div>
          <div class="text-lg font-semibold text-gray-700">üìä Resumen de Importaciones</div>

          <div class="ml-auto flex items-center gap-5 text-sm">
            <div class="flex items-baseline gap-2">
              <span class="text-xs text-gray-600">Total Tablas</span>
              <span class="font-bold text-blue-600">${f.value.length}</span>
            </div>
            <div class="flex items-baseline gap-2">
              <span class="text-xs text-gray-600">Total Registros</span>
              <span class="font-bold text-green-600">${t.toLocaleString()}</span>
            </div>
            <div class="flex items-baseline gap-2">
              <span class="text-xs text-gray-600">Tiempo Total</span>
              <span class="font-bold text-purple-600">${o}s</span>
            </div>
          </div>
        </div>
        
        ${s>0?`
          <div class="bg-red-50 border-l-4 border-red-500 p-3 mb-3 rounded">
            <p class="text-sm text-red-700">‚ö†Ô∏è ${s} tabla(s) con errores</p>
          </div>
        `:""}
        
        <div id="import-summary-table-wrap" class="overflow-auto" style="overflow-x: auto;">
          <table class="w-full text-sm border-collapse" style="white-space: nowrap;">
            <thead class="bg-gray-100 sticky top-0">
              <tr>
                <th class="px-4 py-2 text-center">Estado</th>
                <th class="px-4 py-2 text-left">Tabla</th>
                <th class="px-4 py-2 text-right">Registros</th>
                <th class="px-4 py-2 text-left">Modo</th>
                <th class="px-4 py-2 text-right">Tiempo</th>
              </tr>
            </thead>
            <tbody>
              ${n}
            </tbody>
          </table>
        </div>
      </div>
    `,confirmButtonText:"Cerrar",width:"95vw",heightAuto:!1,customClass:{htmlContainer:"text-left"},didOpen:()=>{const a=R.getPopup();if(!a)return;a.style.maxHeight="92vh",a.style.overflow="hidden",Number.parseFloat(getComputedStyle(a).paddingBottom||"0")<16&&(a.style.paddingBottom="16px");const u=a.querySelector(".swal2-actions");u&&(u.style.marginTop="12px",u.style.paddingBottom="8px");const d=a.querySelector("#import-summary-table-wrap");d&&requestAnimationFrame(()=>{const v=Math.floor(window.innerHeight*.92),ae=a.getBoundingClientRect(),K=d.getBoundingClientRect(),X=a.querySelector(".swal2-actions"),Ee=X?X.getBoundingClientRect().height:0,Ie=Number.parseFloat(getComputedStyle(a).paddingBottom||"0"),Pe=K.top-ae.top,ze=Math.max(160,v-Pe-Ee-Ie-8);d.style.maxHeight=`${ze}px`,d.style.overflowY="auto"})}}),f.value=[],M=null}function ne(){ee.value=!1,g.value=null,P.value=!1}async function ye(){ne(),await k(),await F()}async function he(){P.value=!0,te.value="Sincronizando columnas...";try{const o=[];for(const a of B.value){te.value=`Sincronizando ${a.table}...`;const i=await fetch(`${T}/schema/sync-columns`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:a.table,csvPath:a.csvPath,reimport:L.value.reimport})});if(!i.ok)throw new Error(`Error en ${a.table}: ${i.statusText}`);const u=await i.json();o.push({table:a.table,...u})}const t=o.reduce((a,i)=>a+(i.columnsAdded||0),0),s=o.flatMap(a=>a.addedColumns||[]),n=o.some(a=>a.errors&&a.errors.length>0);g.value={success:!n&&t>0,message:t>0?`Se agregaron ${t} columna(s) en ${o.length} tabla(s)`:"No se agregaron columnas nuevas",columnsAdded:t,addedColumns:s,reimportResult:L.value.reimport?{success:o.every(a=>!a.reimportResult||a.reimportResult.success)}:null}}catch(o){g.value={success:!1,error:o.message||"Error desconocido en la sincronizaci√≥n"},console.error("Error en sincronizaci√≥n:",o)}finally{P.value=!1}}async function k(){S.value=!0;try{const o=h.value?`?csvFolder=${encodeURIComponent(h.value)}`:"",[t,s]=await Promise.all([fetch(`${T}/import-status${o}`),fetch(`${T}/status`)]);if(!t.ok)throw new Error("Error al obtener estado de importaci√≥n");const n=await t.json();if(j.value){const a=C.value,i=y.value,u=E.value;b.value=n.map(d=>(d.table===i?d.status="IMPORTING":!a.has(d.table)&&u.has(d.table)&&(d.status="PENDING"),d))}else b.value=n;s.ok&&(Y.value=await s.json()),x.value&&pe()}catch(o){console.error(o),I.fire({title:"No se pudo conectar con el servidor de API"})}finally{S.value=!1}}async function we(){const o=b.value.filter(s=>s.status==="OUTDATED"||s.status==="NOT_IMPORTED"||s.status==="MISSING_FILE");if(o.length===0){R.fire({icon:"info",title:"Sin cambios",text:"Todas las tablas est√°n actualizadas",confirmButtonColor:"#3085d6"});return}if((await R.fire({title:"¬øIniciar actualizaci√≥n?",html:`Se importar√°n <strong>${o.length} tabla(s) desactualizada(s)</strong>:<br><br>${o.map(s=>`‚Ä¢ ${s.table}`).join("<br>")}`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S√≠, actualizar"})).isConfirmed){x.value=!0,A.value=null,M=performance.now(),f.value=[];const s=o.map(a=>a.table);E.value=new Set(s),C.value=new Set;const n={};o.forEach(a=>{n[a.table]={last:a.last_import_date,rows:a.rows_imported}}),N.value=n,b.value.forEach(a=>{s.includes(a.table)&&(a.status="IMPORTING")}),y.value=s[0]||null,ue();try{const a=new AbortController,i=setTimeout(()=>a.abort(),6e5),u=await fetch(`${T}/import/update-outdated`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tables:s,csvFolder:h.value}),signal:a.signal});if(clearTimeout(i),!u.ok)throw new Error(`HTTP ${u.status}: ${u.statusText}`);const d=await u.json();if(V(),x.value=!1,E.value=new Set,C.value=new Set,y.value=null,N.value={},d.success||d.results&&d.results.length>0)d.results&&Array.isArray(d.results)&&d.results.forEach(v=>{f.value.push({table:v.table,rows:v.rows||0,time:v.time||"-",success:v.success,mode:v.mode||"-",modeReason:v.modeReason||""})}),await k(),await F(),H();else throw new Error(d.error||"Error en la importaci√≥n")}catch(a){V(),x.value=!1,E.value=new Set,C.value=new Set,y.value=null,N.value={},a.name==="AbortError"?I.fire({title:"Timeout",text:"La actualizaci√≥n tom√≥ m√°s de 10 minutos. Verifica el estado de las tablas."}):(console.error(a),I.fire({title:a.message||"Fall√≥ la actualizaci√≥n"})),await k()}}}function ie(o){return o?o.split("\\").pop().split("/").pop():"-"}function J(o){return b.value.filter(t=>t.status===o).length}function _e(o){switch(o){case"UP_TO_DATE":return"bg-green-100 text-green-800";case"OUTDATED":return"bg-yellow-100 text-yellow-800";case"NOT_IMPORTED":return"bg-blue-100 text-blue-800";case"MISSING_FILE":return"bg-red-100 text-red-800";case"PENDING":return"bg-orange-100 text-orange-800";case"IMPORTING":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}}function Ce(o){switch(o){case"UP_TO_DATE":return"Actualizado";case"OUTDATED":return"Desactualizado";case"NOT_IMPORTED":return"Pendiente";case"MISSING_FILE":return"Archivo No Encontrado";case"ERROR_READING_FILE":return"Error Lectura";case"PENDING":return"Pendiente";case"IMPORTING":return"Importando...";default:return o}}function ke(o){return C.value.has(o)}async function Te(){if((await R.fire({title:"¬øForzar importaci√≥n completa?",html:"Se re-importar√°n <strong>todas las tablas</strong>, incluso las marcadas como actualizadas.<br><br><em>Esto puede tomar varios minutos.</em>",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ea580c",cancelButtonColor:"#6b7280",confirmButtonText:"S√≠, forzar todas",cancelButtonText:"Cancelar"})).isConfirmed){x.value=!0,A.value=null,x.value=!0,A.value=null,j.value=!0,M=performance.now(),f.value=[];const t=b.value.map(n=>n.table);E.value=new Set(t),C.value=new Set;const s={};b.value.forEach(n=>{s[n.table]={last:n.last_import_date,rows:n.rows_imported}}),N.value=s,b.value.forEach(n=>{n.status="IMPORTING"}),y.value=t[0]||null,ue();try{const n=new AbortController,a=setTimeout(()=>n.abort(),9e5),i=await fetch(`${T}/import/force-all`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({csvFolder:h.value}),signal:n.signal});if(clearTimeout(a),!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const u=await i.json();if(V(),x.value=!1,j.value=!1,E.value=new Set,C.value=new Set,y.value=null,N.value={},u.success||u.results&&u.results.length>0)u.results&&Array.isArray(u.results)&&u.results.forEach(d=>{f.value.push({table:d.table,rows:d.rows||0,time:d.time||"-",success:d.success,mode:d.mode||"-",modeReason:d.modeReason||""})}),await k(),await F(),H();else throw new Error(u.error||"Error en la importaci√≥n")}catch(n){V(),x.value=!1,j.value=!1,E.value=new Set,C.value=new Set,y.value=null,N.value={},n.name==="AbortError"?I.fire({title:"Timeout",text:"La importaci√≥n tom√≥ m√°s de 15 minutos. Verifica el estado manualmente."}):(console.error(n),I.fire({title:n.message||"Fall√≥ la importaci√≥n"})),await k()}}}async function Se(o){if((await R.fire({title:`¬øForzar ${o.table}?`,html:`
      Se re-importar√° la tabla <strong>${o.table}</strong> desde:<br>
      <code>${ie(o.csv_file)}</code><br><br>
      <small class="text-gray-500">‚è±Ô∏è Esto puede tomar varios minutos para tablas grandes.</small>
    `,icon:"question",showCancelButton:!0,confirmButtonColor:"#ea580c",cancelButtonColor:"#6b7280",confirmButtonText:"S√≠, forzar",cancelButtonText:"Cancelar"})).isConfirmed){x.value=!0,A.value=null,y.value=o.table,j.value=!1,M||(M=performance.now(),f.value=[]),o.status="IMPORTING";const s=performance.now(),n=o.last_import_date??null;try{const a=new AbortController,i=setTimeout(()=>a.abort(),3e5),u=await fetch(`${T}/import/force-table`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table:o.table,csvFolder:h.value}),signal:a.signal});if(clearTimeout(i),!u.ok)throw new Error(`HTTP ${u.status}: ${u.statusText}`);const d=await u.json();if(d.success){y.value=null,x.value=!1,await k(),await F();const v=(performance.now()-s)/1e3;f.value.push({table:o.table,rows:d.rows||0,time:v.toFixed(2),success:!0,mode:d.mode||"-",modeReason:d.modeReason||""}),H()}else throw new Error(d.error||"Error desconocido")}catch(a){if(y.value=null,x.value=!1,a.name==="AbortError"){console.log("‚è±Ô∏è Timeout despu√©s de 5 minutos - Verificando si complet√≥..."),await new Promise(v=>setTimeout(v,2e3)),await k();const i=b.value.find(v=>v.table===o.table);console.log("Estado anterior:",{table:o.table,timestamp:n}),console.log("Estado actualizado:",{table:i==null?void 0:i.table,timestamp:i==null?void 0:i.last_import_date,rows:i==null?void 0:i.rows_imported,status:i==null?void 0:i.status});const u=(i==null?void 0:i.last_import_date)&&i.last_import_date!==n,d=(i==null?void 0:i.status)==="UP_TO_DATE";if(u||d){console.log("‚úÖ Importaci√≥n completada detectada");const v=(performance.now()-s)/1e3;f.value.push({table:o.table,rows:i.rows_imported||0,time:v.toFixed(2),success:!0}),H(),Object.assign(o,i)}else console.log("‚ö†Ô∏è No se detect√≥ cambio - puede estar ejecut√°ndose a√∫n"),f.value.push({table:o.table,rows:0,time:"-",success:!1}),H(),W.fire({icon:"warning",title:"Timeout de respuesta",text:'La importaci√≥n puede seguir ejecut√°ndose. Usa "Refrescar" para verificar.'})}else console.error("Error en importaci√≥n:",a),f.value.push({table:o.table,rows:0,time:"-",success:!1}),H(),I.fire({title:a.message||"Fall√≥ la importaci√≥n"})}}}function q(o){return o?new Date(o).toLocaleString():"-"}async function de(){O.value=!0;try{const o=await fetch(`${T}/import/warnings-history?limit=100`);if(!o.ok)throw new Error("Error al cargar historial de diferencias");const t=await o.json();U.value=t.history||[]}catch(o){console.error("Error al cargar historial de warnings:",o),I.fire({title:"No se pudo cargar el historial de diferencias"}),U.value=[]}finally{O.value=!1}}async function ce(){O.value=!0;try{const o=await fetch(`${T}/schema/changes-log?limit=100`);if(!o.ok)throw new Error("Error al cargar historial de sincronizaciones");const t=await o.json();G.value=t.changes||[]}catch(o){console.error("Error al cargar historial de cambios:",o),I.fire({title:"No se pudo cargar el historial de sincronizaciones"}),G.value=[]}finally{O.value=!1}}me(D,o=>{o&&(de(),ce())}),me(z,o=>{D.value&&(o==="warnings"?de():o==="changes"&&ce())});function ue(){V(),Q=setInterval(async()=>{if(!x.value){V();return}await k(),pe()},2e3)}function V(){Q&&(clearInterval(Q),Q=null)}function pe(){if(!x.value)return;const o=new Set(C.value);b.value.forEach(n=>{const a=N.value[n.table];if(!a)return;(a.last!==n.last_import_date||a.rows!==n.rows_imported)&&o.add(n.table)}),C.value=o;const s=Array.from(E.value).find(n=>!C.value.has(n));y.value=s||null}return(o,t)=>(l(),r("div",Be,[e("main",Le,[e("div",Me,[e("div",De,[t[10]||(t[10]=e("h1",{class:"text-2xl font-bold text-gray-800 whitespace-nowrap"},"Control de Importaciones",-1)),e("div",je,[t[9]||(t[9]=e("label",{class:"text-xs font-bold text-gray-500 whitespace-nowrap uppercase tracking-wide"},"Carpeta CSV:",-1)),xe(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),type:"text",class:"flex-1 bg-transparent border-none text-sm focus:ring-0 p-0 text-gray-700 placeholder-gray-400",placeholder:"Seleccione carpeta...",onChange:se,onKeyup:Ae(se,["enter"])},null,544),[[Re,h.value]]),e("button",{onClick:ve,class:"p-1 hover:bg-gray-200 rounded text-gray-600 transition-colors",title:"Examinar carpeta..."}," üìÇ ")])]),e("div",Oe,[e("button",{onClick:k,class:"px-3 py-1.5 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center gap-1.5 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed",disabled:S.value||x.value},[S.value?(l(),r("span",He,"‚Üª")):(l(),r("span",Ve,"‚Üª")),t[11]||(t[11]=$(" Refrescar ",-1))],8,Fe),e("button",{onClick:t[1]||(t[1]=s=>D.value=!0),class:"px-3 py-1.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 flex items-center gap-1.5 transition-colors text-sm shadow-sm",title:"Ver historial de cambios y sincronizaciones"},[...t[12]||(t[12]=[e("span",null,"üìã",-1),$(" Historial ",-1)])]),e("button",{onClick:Te,class:"px-3 py-1.5 bg-orange-600 text-white rounded-lg hover:bg-orange-700 flex items-center gap-1.5 transition-colors text-sm shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",disabled:x.value||S.value},[...t[13]||(t[13]=[e("span",null,"‚ö°",-1),$(" Forzar Todo ",-1)])],8,Ue),e("button",{onClick:we,class:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-1.5 transition-colors text-sm shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",disabled:x.value||S.value},[...t[14]||(t[14]=[e("span",null,"üöÄ",-1),$(" Actualizar ",-1)])],8,Ge)])]),e("div",qe,[e("div",Qe,[t[15]||(t[15]=e("div",{class:"text-sm text-gray-600"},"Total Archivos:",-1)),e("div",We,c(b.value.length),1)]),e("div",Je,[t[16]||(t[16]=e("div",{class:"text-sm text-gray-600"},"Actualizados:",-1)),e("div",Ke,c(J("UP_TO_DATE")),1)]),e("div",Xe,[t[17]||(t[17]=e("div",{class:"text-sm text-gray-600"},"Desactualizados:",-1)),e("div",Ye,c(J("OUTDATED")),1)]),e("div",Ze,[t[18]||(t[18]=e("div",{class:"text-sm text-gray-600"},"Faltantes / Error:",-1)),e("div",et,c(J("MISSING_FILE")+J("NOT_IMPORTED")),1)]),e("div",tt,[t[19]||(t[19]=e("div",{class:"text-sm text-gray-600"},"Tama√±o DB:",-1)),e("div",st,c(Y.value?Y.value.sizeMB+" MB":"-"),1)])]),Z.value&&B.value.length>0?(l(),r("div",ot,[e("div",at,[t[26]||(t[26]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),e("div",lt,[t[25]||(t[25]=e("h3",{class:"text-sm font-medium text-yellow-800"}," Columnas pendientes de sincronizaci√≥n ",-1)),e("div",rt,[t[24]||(t[24]=e("p",{class:"mb-3"},'Se detectaron columnas nuevas en el CSV que a√∫n no est√°n en la base de datos. Usa el bot√≥n "Sincronizar Columnas" para agregarlas.',-1)),e("div",nt,[(l(!0),r(w,null,_(B.value,s=>(l(),r("div",{key:s.id,class:"bg-white p-3 rounded border border-yellow-200"},[e("div",it,[e("span",dt,c(s.table),1),e("span",ct,c(q(s.timestamp)),1)]),s.extraColumns.length>0?(l(),r("div",ut,[t[20]||(t[20]=e("span",{class:"text-xs font-medium text-orange-700"},"‚ö†Ô∏è Columnas nuevas en CSV (pendientes):",-1)),e("div",pt,[(l(!0),r(w,null,_(s.extraColumns,n=>(l(),r("span",{key:n,class:"inline-block bg-orange-100 text-orange-800 text-xs px-2 py-0.5 rounded"},c(n),1))),128))]),t[21]||(t[21]=e("p",{class:"text-xs text-gray-600 mt-1 italic"},"Estas columnas se ignoran hasta que las sincronices. Usa el bot√≥n debajo para agregarlas a PostgreSQL.",-1))])):m("",!0),s.missingColumns.length>0?(l(),r("div",mt,[t[22]||(t[22]=e("span",{class:"text-xs font-medium text-blue-700"},"‚ÑπÔ∏è Columnas en PostgreSQL no presentes en CSV:",-1)),e("div",xt,[(l(!0),r(w,null,_(s.missingColumns,n=>(l(),r("span",{key:n,class:"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded"},c(n),1))),128))]),t[23]||(t[23]=e("p",{class:"text-xs text-gray-600 mt-1 italic"},"Normal: PostgreSQL las rellena con NULL autom√°ticamente. No requiere acci√≥n.",-1))])):m("",!0)]))),128))])]),e("div",gt,[e("button",{onClick:fe,class:"text-sm font-medium text-yellow-800 hover:text-yellow-900 underline"}," Ocultar "),e("button",{onClick:be,class:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium transition-colors shadow-sm"}," üîÑ Sincronizar Columnas "),e("button",{onClick:t[2]||(t[2]=s=>D.value=!0),class:"text-sm font-medium text-yellow-800 hover:text-yellow-900 underline"}," Ver historial completo ")])])])])):m("",!0),ee.value?(l(),r("div",vt,[e("div",ft,[t[44]||(t[44]=e("div",{class:"px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-blue-500 to-blue-600"},[e("h3",{class:"text-xl font-bold text-white flex items-center gap-2"},[e("span",null,"üîÑ"),$(" Sincronizar Columnas de CSV a PostgreSQL ")])],-1)),e("div",bt,[!P.value&&!g.value?(l(),r("div",yt,[t[30]||(t[30]=le('<div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg"><div class="flex items-start"><svg class="h-5 w-5 text-blue-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg><div class="ml-3 text-sm text-blue-700"><p class="font-medium mb-1">Se agregar√°n columnas nuevas del CSV a la base de datos PostgreSQL</p><p>Las columnas se crear√°n como tipo TEXT y los registros existentes tendr√°n valores NULL.</p></div></div></div>',1)),e("div",ht,[t[27]||(t[27]=e("h4",{class:"font-semibold text-gray-900"},"Tablas con columnas extra:",-1)),e("div",wt,[(l(!0),r(w,null,_(B.value,s=>(l(),r("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors"},[e("div",_t,[e("span",Ct,c(s.table),1),e("span",kt,c(s.extraColumns.length)+" columna(s) nueva(s)",1)]),e("div",Tt,[(l(!0),r(w,null,_(s.extraColumns,n=>(l(),r("span",{key:n,class:"inline-block bg-green-100 text-green-800 text-xs px-3 py-1 rounded-full font-medium"}," + "+c(n),1))),128))])]))),128))])]),e("div",St,[e("label",Et,[xe(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=s=>L.value.reimport=s),class:"mt-1 w-4 h-4 text-blue-600 rounded focus:ring-blue-500"},null,512),[[Ne,L.value.reimport]]),t[28]||(t[28]=e("div",null,[e("span",{class:"font-medium text-gray-900"},"Re-importar datos despu√©s de sincronizar"),e("p",{class:"text-sm text-gray-600 mt-1"},[$(" Esto volver√° a importar los datos desde el CSV para capturar los valores de las columnas nuevas en registros hist√≥ricos. "),e("strong",{class:"text-yellow-700"},"Recomendado si necesitas los datos hist√≥ricos.")])],-1))])]),L.value.reimport?m("",!0):(l(),r("div",It,[...t[29]||(t[29]=[le('<div class="flex items-start"><svg class="h-5 w-5 text-yellow-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg><div class="ml-3 text-sm text-yellow-700"><p class="font-medium">Las columnas nuevas tendr√°n NULL en registros existentes</p><p class="mt-1">Podr√°s re-importar manualmente m√°s tarde si necesitas capturar datos hist√≥ricos.</p></div></div>',1)])]))])):m("",!0),P.value?(l(),r("div",Pt,[t[31]||(t[31]=e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mb-4"},null,-1)),e("p",zt,c(te.value),1),t[32]||(t[32]=e("p",{class:"text-sm text-gray-600 mt-2"},"Esto puede tomar unos momentos...",-1))])):m("",!0),g.value?(l(),r("div",$t,[g.value.success?(l(),r("div",Rt,[e("div",At,[t[34]||(t[34]=e("svg",{class:"h-6 w-6 text-green-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),e("div",Nt,[t[33]||(t[33]=e("p",{class:"text-lg font-bold text-green-800"},"¬°Sincronizaci√≥n completada!",-1)),e("p",Bt,c(g.value.message),1)])])])):(l(),r("div",Lt,[e("div",Mt,[t[36]||(t[36]=e("svg",{class:"h-6 w-6 text-red-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),e("div",Dt,[t[35]||(t[35]=e("p",{class:"text-lg font-bold text-red-800"},"Error en la sincronizaci√≥n",-1)),e("p",jt,c(g.value.error||"Error desconocido"),1)])])])),g.value.success&&g.value.addedColumns?(l(),r("div",Ot,[t[37]||(t[37]=e("h5",{class:"font-semibold text-gray-900 mb-3"},"Columnas agregadas:",-1)),e("div",Ft,[(l(!0),r(w,null,_(g.value.addedColumns,s=>(l(),r("span",{key:s,class:"inline-block bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full"},c(s),1))),128))])])):m("",!0),g.value.reimportResult?(l(),r("div",Ht,[g.value.reimportResult.success?(l(),r("div",Vt,[...t[38]||(t[38]=[e("svg",{class:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1),e("span",{class:"font-semibold"},"Datos re-importados correctamente",-1)])])):(l(),r("div",Ut,[...t[39]||(t[39]=[e("svg",{class:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1),e("span",{class:"font-semibold"},"Error en la re-importaci√≥n",-1)])]))])):m("",!0),g.value.success?(l(),r("div",Gt,[t[43]||(t[43]=e("h5",{class:"font-semibold text-blue-900 mb-2"},"üìã Pr√≥ximos pasos:",-1)),e("ul",qt,[L.value.reimport?m("",!0):(l(),r("li",Qt,"Re-importa manualmente si necesitas datos hist√≥ricos de las columnas nuevas")),t[40]||(t[40]=e("li",null,"Las pr√≥ximas importaciones capturar√°n autom√°ticamente los valores de las nuevas columnas",-1)),t[41]||(t[41]=e("li",null,"Los warnings desaparecer√°n en la pr√≥xima importaci√≥n",-1)),t[42]||(t[42]=e("li",null,"Puedes ver el historial de cambios en el log de auditor√≠a",-1))])])):m("",!0)])):m("",!0)]),e("div",Wt,[!P.value&&!g.value?(l(),r("button",{key:0,onClick:ne,class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 font-medium transition-colors"}," Cancelar ")):m("",!0),!P.value&&!g.value?(l(),r("button",{key:1,onClick:he,class:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors shadow-sm"}," Aplicar Sincronizaci√≥n ")):m("",!0),g.value?(l(),r("button",{key:2,onClick:ye,class:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors shadow-sm"}," Cerrar y Refrescar ")):m("",!0)])])])):m("",!0),e("div",Jt,[e("table",Kt,[t[49]||(t[49]=e("colgroup",null,[e("col",{style:{width:"12%"}}),e("col",{style:{width:"14%"}}),e("col",{style:{width:"11%"}}),e("col",{style:{width:"13%"}}),e("col",{style:{width:"13%"}}),e("col",{style:{width:"8%"}}),e("col",{style:{width:"14%"}})],-1)),t[50]||(t[50]=e("thead",{class:"bg-gray-50 sticky top-0 z-10"},[e("tr",null,[e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tabla Destino"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Archivo Origen"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"√öltima Modif."),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"√öltima Import."),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Filas"),e("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Acciones")])],-1)),e("tbody",Xt,[S.value&&b.value.length===0?(l(),r("tr",Yt,[...t[45]||(t[45]=[e("td",{colspan:"7",class:"px-6 py-10 text-center text-gray-500"},"Cargando estado...",-1)])])):b.value.length===0?(l(),r("tr",Zt,[...t[46]||(t[46]=[e("td",{colspan:"7",class:"px-6 py-10 text-center text-gray-500"},"No hay configuraciones de importaci√≥n disponibles.",-1)])])):m("",!0),(l(!0),r(w,null,_(b.value,s=>(l(),r("tr",{key:s.table,class:"hover:bg-gray-50 transition-colors"},[e("td",es,[e("div",ts,c(s.table),1)]),e("td",ss,[e("div",{class:"text-sm text-gray-500",title:s.csv_file},c(ie(s.csv_file)),9,os),e("div",as,"Hoja: "+c(s.xlsx_sheet||"-"),1)]),e("td",ls,[x.value&&y.value===s.table?(l(),r("div",rs,[...t[47]||(t[47]=[le('<div class="flex items-center gap-2"><span class="animate-spin">‚öôÔ∏è</span><span class="text-sm font-medium text-blue-600">Importando...</span></div><div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden"><div class="bg-blue-400 h-2 rounded-full animate-pulse" style="width:100%;"></div></div>',2)])])):x.value&&j.value&&ke(s.table)?(l(),r("div",ns,[...t[48]||(t[48]=[e("div",{class:"flex items-center gap-2"},[e("span",null,"‚úì"),e("span",{class:"text-sm font-medium text-green-600"},"Completado")],-1),e("div",{class:"w-full bg-gray-200 rounded-full h-2 overflow-hidden"},[e("div",{class:"bg-green-500 h-2 rounded-full",style:{width:"100%"}})],-1)])])):(l(),r("span",{key:2,class:re([_e(s.status),"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full"])},c(Ce(s.status)),3))]),e("td",is,c(q(s.csv_modified)),1),e("td",ds,[s.last_import_date?(l(),r("div",cs,c(q(s.last_import_date)),1)):(l(),r("div",us,"-"))]),e("td",ps,c(s.rows_imported!==null?s.rows_imported.toLocaleString():"-"),1),e("td",ms,[e("button",{onClick:n=>Se(s),class:"px-3 py-1 bg-orange-100 text-orange-700 hover:bg-orange-200 rounded-md text-xs font-medium transition-colors flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",disabled:x.value||S.value},[x.value&&y.value===s.table?(l(),r("span",gs,"‚öôÔ∏è")):(l(),r("span",vs,"‚ö°")),$(" "+c(x.value&&y.value===s.table?"Procesando...":"Forzar"),1)],8,xs)])]))),128))])])]),A.value?(l(),r("div",fs,[e("div",bs,[t[51]||(t[51]=e("h3",{class:"text-sm font-mono text-gray-300"},"Log de Ejecuci√≥n",-1)),e("button",{onClick:t[4]||(t[4]=s=>A.value=null),class:"text-gray-400 hover:text-white"},"‚úï")]),e("pre",ys,c(A.value),1)])):m("",!0),D.value?(l(),r("div",hs,[e("div",ws,[e("div",_s,[e("div",Cs,[t[52]||(t[52]=e("h3",{class:"text-xl font-bold text-white flex items-center gap-2"},[e("span",null,"üìã"),$(" Historial de Cambios y Sincronizaciones ")],-1)),e("button",{onClick:t[5]||(t[5]=s=>D.value=!1),class:"text-white hover:text-gray-200 text-2xl"}," ‚úï ")])]),e("div",ks,[e("button",{onClick:t[6]||(t[6]=s=>z.value="warnings"),class:re([z.value==="warnings"?"border-b-2 border-purple-500 text-purple-600 bg-white":"text-gray-600 hover:text-gray-900","px-6 py-3 font-medium text-sm transition-colors"])}," ‚ö†Ô∏è Diferencias Detectadas ",2),e("button",{onClick:t[7]||(t[7]=s=>z.value="changes"),class:re([z.value==="changes"?"border-b-2 border-purple-500 text-purple-600 bg-white":"text-gray-600 hover:text-gray-900","px-6 py-3 font-medium text-sm transition-colors"])}," üîÑ Sincronizaciones Aplicadas ",2)]),e("div",Ts,[z.value==="warnings"?(l(),r("div",Ss,[O.value?(l(),r("div",Es,[...t[53]||(t[53]=[e("span",{class:"animate-spin text-2xl"},"‚Üª",-1),e("p",{class:"mt-2"},"Cargando historial...",-1)])])):U.value.length===0?(l(),r("div",Is,[...t[54]||(t[54]=[e("span",{class:"text-4xl"},"‚úì",-1),e("p",{class:"mt-2"},"No hay diferencias registradas",-1)])])):(l(),r("div",Ps,[(l(!0),r(w,null,_(U.value,s=>(l(),r("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition-colors"},[e("div",zs,[e("span",$s,c(s.table_name),1),e("span",Rs,c(q(s.detected_at)),1)]),e("div",As,[s.extra_columns&&s.extra_columns.length>0?(l(),r("div",Ns,[t[55]||(t[55]=e("span",{class:"text-xs font-medium text-orange-700"},"‚ö†Ô∏è Columnas EXTRA en CSV:",-1)),e("div",Bs,[(l(!0),r(w,null,_(s.extra_columns,n=>(l(),r("span",{key:n,class:"inline-block bg-orange-100 text-orange-800 text-xs px-2 py-0.5 rounded"},c(n),1))),128))])])):m("",!0),s.missing_columns&&s.missing_columns.length>0?(l(),r("div",Ls,[t[56]||(t[56]=e("span",{class:"text-xs font-medium text-red-700"},"‚ö†Ô∏è Columnas FALTANTES en CSV:",-1)),e("div",Ms,[(l(!0),r(w,null,_(s.missing_columns,n=>(l(),r("span",{key:n,class:"inline-block bg-red-100 text-red-800 text-xs px-2 py-0.5 rounded"},c(n),1))),128))])])):m("",!0)])]))),128))]))])):m("",!0),z.value==="changes"?(l(),r("div",Ds,[O.value?(l(),r("div",js,[...t[57]||(t[57]=[e("span",{class:"animate-spin text-2xl"},"‚Üª",-1),e("p",{class:"mt-2"},"Cargando historial...",-1)])])):G.value.length===0?(l(),r("div",Os,[...t[58]||(t[58]=[e("span",{class:"text-4xl"},"üìù",-1),e("p",{class:"mt-2"},"No hay sincronizaciones registradas",-1)])])):(l(),r("div",Fs,[(l(!0),r(w,null,_(G.value,s=>(l(),r("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4 hover:border-purple-300 transition-colors"},[e("div",Hs,[e("div",null,[e("span",Vs,c(s.table_name),1),e("span",Us,c(s.change_type),1)]),e("span",Gs,c(q(s.applied_at)),1)]),e("div",qs,[e("div",Qs,[t[59]||(t[59]=e("span",{class:"text-xs font-medium text-gray-700"},"Columnas agregadas:",-1)),e("div",Ws,[(l(!0),r(w,null,_(s.columns_added,n=>(l(),r("span",{key:n,class:"inline-block bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded font-medium"}," + "+c(n),1))),128))])]),s.reimported?(l(),r("div",Js,[...t[60]||(t[60]=[e("span",null,"üîÑ",-1),e("span",null,"Datos re-importados despu√©s de sincronizar",-1)])])):m("",!0)])]))),128))]))])):m("",!0)]),e("div",Ks,[e("div",Xs,[z.value==="warnings"?(l(),r("span",Ys,"Total: "+c(U.value.length)+" registro(s)",1)):(l(),r("span",Zs,"Total: "+c(G.value.length)+" sincronizaci√≥n(es)",1))]),e("button",{onClick:t[8]||(t[8]=s=>D.value=!1),class:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors"}," Cerrar ")])])])):m("",!0)])]))}};export{lo as default};
