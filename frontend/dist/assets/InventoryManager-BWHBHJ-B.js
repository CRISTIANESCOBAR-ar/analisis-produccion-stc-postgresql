import{_ as Js,m as j,P as Ze,o as Xs,w as ze,y as ea,a as n,c as i,b as a,d as he,t as m,e as R,f as _e,g as Rt,n as k,i as ta,A as ts,F as C,r as N,q as sa,p as B,v as Lt}from"./index-Bya99iyG.js";import{E as aa}from"./exceljs.min-DtXTVuKQ.js";class ra{constructor(ue={}){const L=K=>{if(K==null||K==="")return 0;if(typeof K=="number")return K;let Q=K.toString().trim();Q.includes(".")&&Q.includes(",")?Q=Q.replace(/\./g,"").replace(",","."):Q.includes(",")&&(Q=Q.replace(",","."));const ke=parseFloat(Q);return isNaN(ke)?0:ke},w=K=>{for(const Q of K)if(ue[Q]!==void 0)return ue[Q]};this.PRODUTOR=w(["PRODUTOR","productor"])||"",this.DESTINO=w(["DESTINO","destino"])||"",this.LOTE=w(["LOTE","lote"])||"",this.TP=w(["TP","tp"])||"",this.CLASSIF=w(["CLASSIF","classif"])||"",this.COR=w(["COR","cor"])||"",this.QTDE_ESTOQUE=L(w(["QTDE ESTOQUE","QTDE_ESTOQUE","qtde_estoque"])),this.SCI=L(w(["SCI","sci"])),this.MST=L(w(["MST","mst"])),this.MIC=L(w(["MIC","mic"])),this.MAT=L(w(["MAT","mat"])),this.UHML=L(w(["UHML","uhml"])),this.UI=L(w(["UI","ui"])),this.SF=L(w(["SF","sf"])),this.STR=L(w(["STR","str"])),this.ELG=L(w(["ELG","elg"])),this.RD=L(w(["RD","rd"])),this.PLUS_B=L(w(["+b","PLUS_B","plus_b"])),this.TIPO=w(["TIPO","tipo"])||"",this.TrCNT=L(w(["TrCNT","trcnt"])),this.TrAR=L(w(["TrAR","trar"])),this.TRID=L(w(["TRID","trid"])),this.PESO=L(w(["PESO","peso"])),this.PESO_MEDIO=L(w(["PESO_MEDIO","PESO MEDIO","peso_medio"])),this.CORTEZA=L(w(["CORTEZA","corteza"]))}}const oa={class:"p-6 bg-gray-50 min-h-screen"},la={class:"flex items-center justify-between mb-6"},na={key:0,class:"shrink-0"},ia={class:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-bold bg-green-100 text-green-800 border border-green-200 shadow-sm"},da={class:"bg-white p-4 rounded-lg shadow mb-6"},ua={class:"flex flex-col xl:flex-row xl:items-center justify-between gap-4"},ca={class:"flex flex-col md:flex-row md:items-center gap-4 flex-1"},ma={class:"flex items-center space-x-3 flex-1 max-w-2xl"},pa={class:"relative flex-1"},ga={class:"flex items-center space-x-2 shrink-0"},xa={class:"relative flex shrink-0 ml-2"},ba={class:"flex flex-col items-center gap-1.5"},ya={class:"inline-flex rounded-lg border border-gray-200 bg-gray-100 p-0.5 shadow-inner"},fa={key:0,class:"absolute top-full left-1/2 z-40 mt-2 w-96 -translate-x-1/2 rounded-xl border border-slate-200 bg-white p-3 shadow-2xl"},va={class:"mb-2 flex items-center justify-between border-b border-slate-200 pb-2"},ha={class:"text-sm font-bold text-slate-800"},ka={class:"text-xs text-slate-700 leading-relaxed"},Ma={class:"mt-2 rounded-md bg-slate-50 p-2.5 border border-slate-200"},Ca={class:"mt-1 text-[11px] text-slate-600 leading-relaxed"},Sa={key:0,class:"absolute top-full right-0 mt-2 z-40 w-90 rounded-xl border border-slate-200 bg-white p-3 shadow-2xl"},Na={class:"flex items-center space-x-6 shrink-0 border-t pt-4 xl:border-t-0 xl:pt-0"},_a={key:0,class:"mt-4 bg-gray-50 p-3 rounded border"},Ta={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Fa={class:"font-bold text-gray-700 text-sm mb-1 border-b pb-1 flex justify-between items-center"},Ea={class:"flex items-center space-x-2"},Ra=["checked","onChange"],La={key:0,class:"text-[10px] bg-green-100 text-green-800 px-1 rounded flex items-center",title:"Regla encontrada"},wa={key:1,class:"text-[10px] bg-gray-100 text-gray-400 px-1 rounded",title:"Sin regla definida"},Ba={class:"space-y-1"},Aa={class:"flex items-center justify-between space-x-2 text-xs cursor-pointer group"},Pa={class:"flex items-center"},Oa=["onUpdate:modelValue"],Ia={key:0,class:"text-gray-400 font-mono text-[10px]"},$a={class:"flex items-center justify-between space-x-2 text-xs cursor-pointer group"},za={class:"flex items-center"},Da=["onUpdate:modelValue"],Ua={key:0,class:"text-gray-400 font-mono text-[10px]"},ja={class:"flex items-center justify-between space-x-2 text-xs cursor-pointer group"},Va={class:"flex items-center"},Ga=["onUpdate:modelValue"],qa={key:0,class:"text-gray-400 font-mono text-[10px]"},Ha={key:1,class:"mt-3 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2 bg-gray-50 p-3 rounded border"},Qa=["value","checked","disabled","onChange"],Wa={class:"bg-white rounded-lg shadow overflow-hidden overflow-x-auto"},Ka={key:0,class:"p-4"},Za={class:"flex justify-between items-center mb-4"},Ya={class:"flex items-center gap-2"},Ja={class:"font-semibold"},Xa={class:"mt-1"},er={key:0,class:"mt-2 list-disc pl-5 space-y-0.5"},tr={key:1,class:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg"},sr={class:"mb-2 flex flex-col md:flex-row md:items-start md:justify-between gap-1.5 md:gap-3"},ar={class:"text-xs text-blue-900 md:text-right"},rr={key:0},or={key:0},lr={class:"ml-1"},nr={key:1,class:"mx-2"},ir={key:2},dr={class:"ml-1"},ur={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2"},cr={class:"text-gray-700"},mr={class:"font-semibold text-blue-900"},pr={class:"ml-1"},gr={key:2,class:"text-center py-8 text-blue-600 font-bold"},xr={key:3},br={class:"overflow-x-auto mb-8 border rounded-lg"},yr={class:"min-w-full divide-y divide-gray-200 compact-plan-table"},fr={class:"bg-gray-100"},vr={class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},hr={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},kr={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},Mr={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},Cr={class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Sr={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},Nr={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},_r={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},Tr={class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},Fr={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},Er={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},Rr={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},Lr={class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},wr={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},Br={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},Ar={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},Pr={class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"},Or={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},Ir={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},$r={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},zr={class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Dr={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},Ur={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},jr={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},Vr={class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Gr={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},qr={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},Hr={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},Qr={class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Wr={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},Kr={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},Zr={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},Yr={class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},Jr={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},Xr={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},eo={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},to={class:"px-4 py-3 text-center text-xs font-bold text-indigo-600 uppercase tracking-wider border-l border-gray-300 bg-indigo-50"},so=["onClick"],ao={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},ro={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},oo={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},lo={class:"bg-white divide-y divide-gray-200"},no={class:"px-4 py-2 text-sm text-gray-900 font-medium"},io={class:"px-4 py-2 text-sm text-gray-600"},uo={class:"px-4 py-2 text-sm"},co={class:"px-4 py-2 text-sm text-center font-semibold text-slate-700"},mo={class:"px-4 py-2 text-sm text-center font-semibold text-blue-700"},po={class:"px-4 py-2 text-sm text-center font-semibold text-amber-700"},go={class:"px-4 py-2 text-sm text-gray-700"},xo={key:0,class:"font-semibold text-emerald-700"},bo={key:1,class:"font-medium text-amber-700"},yo={key:2,class:"font-medium text-slate-700"},fo={class:"px-4 py-2 text-sm text-center font-semibold text-teal-700 border-l border-gray-200 bg-teal-50/30"},vo={class:"bg-gray-50 border-t-2 border-gray-300 compact-summary-footer"},ho={class:"summary-matrix-row summary-matrix-group-start"},ko={class:"px-4 py-2 text-sm text-center font-bold text-slate-800 border-b border-gray-300"},Mo={class:"px-4 py-2 text-sm text-center font-bold text-blue-700 border-b border-gray-300"},Co={class:"px-4 py-2 text-sm text-center font-bold text-amber-700 border-b border-gray-300"},So={class:"summary-matrix-row"},No={colspan:"7",rowspan:"18",class:"px-4 py-2 align-top border-r border-gray-300"},_o={key:0,class:"h-full border border-slate-300 rounded-md overflow-hidden bg-white"},To={class:"w-full compact-remanentes-table"},Fo={class:"bg-gray-50"},Eo={class:"border-b border-gray-300"},Ro={class:"bg-white divide-y divide-gray-100"},Lo={class:"px-3 py-2 text-sm font-semibold text-gray-700"},wo={class:"summary-matrix-row summary-matrix-section-break"},Bo={class:"summary-matrix-row summary-matrix-group-end"},Ao={class:"summary-matrix-row summary-matrix-group-start"},Po={class:"summary-matrix-row"},Oo={class:"summary-matrix-row"},Io={class:"summary-matrix-row summary-matrix-section-break"},$o={class:"summary-matrix-row summary-matrix-group-end"},zo={class:"summary-matrix-row summary-matrix-group-start"},Do={class:"summary-matrix-row"},Uo={class:"summary-matrix-row"},jo={class:"summary-matrix-row summary-matrix-section-break"},Vo={class:"summary-matrix-row summary-matrix-group-end"},Go={class:"summary-matrix-row summary-matrix-group-start"},qo={class:"summary-matrix-row"},Ho={class:"summary-matrix-row"},Qo={class:"summary-matrix-row summary-matrix-section-break"},Wo={class:"summary-matrix-row summary-matrix-group-end"},Ko={class:"text-lg font-bold text-gray-800 mb-3 mt-8 border-t pt-6"},Zo={class:"overflow-x-auto border rounded-lg"},Yo={class:"min-w-full divide-y divide-gray-200"},Jo={class:"bg-red-50"},Xo={key:0,class:"px-4 py-3 text-left text-xs font-medium text-red-800 uppercase tracking-wider"},el={key:1,class:"px-4 py-3 text-left text-xs font-medium text-red-800 uppercase tracking-wider"},tl={class:"px-4 py-3 text-left text-xs font-medium text-red-800 uppercase tracking-wider"},sl={class:"bg-white divide-y divide-gray-200"},al={key:0},rl=["colspan"],ol={class:"px-4 py-2 text-sm text-gray-900 font-medium"},ll={class:"px-4 py-2 text-sm text-gray-600"},nl={class:"px-4 py-2 text-sm font-bold text-gray-800"},il={key:0,class:"px-4 py-2 text-sm font-semibold text-gray-800"},dl={key:1,class:"px-4 py-2 text-sm text-gray-700"},ul={class:"px-4 py-2 text-sm text-red-600 font-medium"},cl={key:0,class:"bg-gray-50 border-t-2 border-gray-300"},ml={class:"px-4 py-2 text-sm font-bold text-gray-800"},pl={key:0,class:"px-4 py-2 text-sm font-bold text-gray-800"},gl={key:1,class:"px-4 py-2 text-sm font-bold text-gray-800"},xl={class:"px-4 py-2 text-sm font-bold text-gray-800"},bl={class:"px-4 py-2 text-sm font-bold text-gray-800"},yl={class:"px-4 py-2 text-sm font-bold text-gray-800"},fl={class:"border rounded-lg bg-emerald-50/40 border-emerald-200 p-4"},vl={class:"grid grid-cols-1 lg:grid-cols-6 gap-3 mb-4"},hl={key:0,class:"mt-1 text-[11px] text-amber-700 font-medium"},kl={class:"bg-white rounded-md border border-emerald-100 px-3 py-2"},Ml={class:"text-lg font-bold text-emerald-700"},Cl={key:0,class:"bg-white rounded-md border border-emerald-100 px-3 py-2"},Sl={class:"text-lg font-bold text-emerald-700"},Nl={class:"bg-white rounded-md border border-emerald-100 px-3 py-2"},_l={class:"text-lg font-bold text-emerald-700"},Tl={class:"bg-white rounded-md border border-emerald-100 px-3 py-2"},Fl={class:"text-lg font-bold text-emerald-700"},El={key:0,class:"mb-3 rounded border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700"},Rl={key:1,class:"mt-4 overflow-x-auto border rounded-lg bg-white"},Ll={class:"min-w-full divide-y divide-gray-200"},wl={class:"divide-y divide-gray-200"},Bl={class:"px-3 py-2 text-sm font-semibold text-gray-800"},Al={class:"px-3 py-2 text-sm text-right text-gray-700"},Pl={class:"px-3 py-2 text-sm text-right text-gray-700"},Ol={class:"px-3 py-2 text-sm text-right text-gray-700"},Il={class:"px-3 py-2 text-sm text-right text-gray-700"},$l={class:"px-3 py-2 text-sm text-right text-gray-700"},zl={class:"px-3 py-2 text-sm text-right text-gray-700"},Dl={class:"px-3 py-2 text-sm text-right text-gray-700"},Ul={class:"px-3 py-2 text-sm text-right text-gray-700"},jl={class:"px-3 py-2 text-sm text-right text-gray-700"},Vl={key:0},Gl={key:1},ql={class:"px-3 py-2 text-sm text-right font-semibold text-indigo-800"},Hl={key:0},Ql={key:1},Wl={class:"px-3 py-2 text-sm text-right font-semibold text-emerald-800"},Kl={class:"px-3 py-2 text-sm text-right font-bold text-emerald-800"},Zl={key:2,class:"mt-4 rounded border border-gray-200 bg-white px-4 py-3 text-sm text-gray-500 italic"},Yl={class:"mt-3 text-xs text-emerald-900 bg-emerald-100/60 border border-emerald-200 rounded px-3 py-2"},Jl={key:0,class:"mt-1.5 space-y-0.5"},Xl={class:"font-semibold"},en={key:1},tn={class:"min-w-full divide-y divide-gray-200 stock-table"},sn={class:"bg-gray-100"},an=["onClick"],rn={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},on={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},ln={key:2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4M16 15l-4 4-4-4"},nn={key:1},dn={class:"bg-white divide-y divide-gray-200"},un={key:0},cn=["colspan"],mn={key:1},pn=["colspan"],gn={key:0,class:"bg-gray-100 font-bold border-t-2 border-gray-300"},xn={key:0},bn={key:1},yn={key:2},fn={key:3},vn={class:"mt-4 text-sm text-gray-500 text-right"},ss="inventoryManagerUserPrefs_v1",hn={__name:"InventoryManager",setup(as){const ue=[{key:"PRODUTOR",label:"Productor",locked:!0,default:!0},{key:"LOTE",label:"Lote",locked:!0,default:!0},{key:"DESTINO",label:"Destino",default:!0},{key:"TP",label:"Tipo",default:!1},{key:"CLASSIF",label:"Clasif.",default:!0},{key:"COR",label:"Color",default:!0},{key:"QTDE_ESTOQUE",label:"Stock",default:!0},{key:"SCI",label:"SCI",default:!1},{key:"MST",label:"MST",default:!1},{key:"MIC",label:"MIC",default:!0},{key:"MAT",label:"MAT",default:!1},{key:"UHML",label:"UHML (Len)",default:!0},{key:"UI",label:"UI",default:!1},{key:"SF",label:"SF",default:!1},{key:"STR",label:"STR",default:!0},{key:"ELG",label:"ELG",default:!1},{key:"RD",label:"RD",default:!1},{key:"PLUS_B",label:"+b",default:!1},{key:"TIPO",label:"Tipo Material",default:!1},{key:"TrCNT",label:"TrCNT",default:!1},{key:"TrAR",label:"TrAR",default:!1},{key:"TRID",label:"TRID",default:!1},{key:"PESO",label:"Peso",default:!0},{key:"PESO_MEDIO",label:"Peso Medio",default:!1},{key:"CORTEZA",label:"Corteza",default:!1}],L=j(new Set(ue.filter(s=>s.default||s.locked).map(s=>s.key))),w=j(!1),K=j(!1),Q=j(""),ke=j([]),Te=j(!1),x=j(null),De=j(!1),te=j(null),Fe=j([]),ge=j(""),xe=j(""),T=Ze({targetMixes:20,source:"stock",minMixesForBlock:20}),be=[{key:"MIC",label:"MIC"},{key:"UHML",label:"LEN (UHML)"},{key:"STR",label:"STR"},{key:"ELG",label:"ELG"},{key:"RD",label:"RD"},{key:"PLUS_B",label:"+b"},{key:"SCI",label:"SCI"}],Ye=j([]),O=Ze({searchText:"",fardos:null}),Je=Ze({key:"PRODUTOR",direction:"asc"}),Ue=Ze({key:"PRODUTOR",direction:"asc"}),rs=new Set(["PRODUTOR","LOTE","TP","CLASSIF","COR","QTDE_ESTOQUE","MIC","UHML","STR","PESO"]),os=new Set(["PRODUTOR","LOTE","Stock","Usados","Sobrante","MotivoLogistico","MIC","STR","LEN","PESO"]),Z=j("stability"),je=j(!1),ut=j(!1),ct=j(null),ls={standard:{title:"Estándar (Round Robin)",badge:"Secuencial",badgeClass:"bg-slate-100 text-slate-700",description:"Arma la mezcla en rondas entre lotes disponibles para completar rápido la receta y mantener consumo equilibrado.",example:"Si pides 20 fardos y tienes 4 lotes compatibles, reparte en turnos (1-1-1-1...) hasta completar 20."},stability:{title:"Golden Batch",badge:"Máx. N",badgeClass:"bg-blue-100 text-blue-700",description:"Prioriza repetir la misma receta por más corridas (N alto) para estabilizar proceso y reducir variación entre mezclas consecutivas.",example:"Si la mejor receta permite 12 corridas iguales, genera ese bloque primero y luego recalcula con el stock remanente."},"stability-strict":{title:"GB + Norma",badge:"Norma activa",badgeClass:"bg-indigo-100 text-indigo-700",description:"Mantiene la lógica Golden Batch pero obliga el cumplimiento de cupo de tolerancia de calidad en cada receta.",example:"Si la receta ideal supera el % permitido de lotes en tolerancia, recorta ese cupo y reduce N para cumplir norma."}},Ee=B(()=>ct.value&&ls[ct.value]||null),ce=s=>{ct.value=s,ut.value=!0},Re=()=>{ut.value=!1},Le=()=>{try{const s={fardos:O.fardos,blendAlgorithm:Z.value,purchaseProjectionTargetMixes:T.targetMixes,purchaseProjectionSource:T.source,selectedColumns:Array.from(L.value),supervisionSettings:be.reduce((e,o)=>{const t=A[o.key]||{};return e[o.key]={target:!!t.target,hardCap:!!t.hardCap,tolerance:!!t.tolerance},e},{})};localStorage.setItem(ss,JSON.stringify(s))}catch(s){console.warn("No se pudo guardar preferencias de InventoryManager:",s)}},ns=()=>{try{const s=localStorage.getItem(ss);if(!s)return;const e=JSON.parse(s);if(!e||typeof e!="object")return;if(e.fardos===null||e.fardos===""||e.fardos===void 0)O.fardos=null;else{const r=Number(e.fardos);!Number.isNaN(r)&&r>0&&(O.fardos=r)}["standard","stability","stability-strict"].includes(e.blendAlgorithm)&&(Z.value=e.blendAlgorithm);const t=Number(e.purchaseProjectionTargetMixes);if(!Number.isNaN(t)&&t>0&&(T.targetMixes=Math.floor(t)),(e.purchaseProjectionSource==="stock"||e.purchaseProjectionSource==="remanente")&&(T.source=e.purchaseProjectionSource),Array.isArray(e.selectedColumns)){const r=new Set(ue.map(u=>u.key)),l=ue.filter(u=>u.locked).map(u=>u.key),p=e.selectedColumns.filter(u=>r.has(u));l.forEach(u=>{p.includes(u)||p.push(u)}),L.value=new Set(p)}e.supervisionSettings&&typeof e.supervisionSettings=="object"&&be.forEach(({key:r})=>{const l=e.supervisionSettings[r];!l||typeof l!="object"||(A[r].target=!!l.target,A[r].hardCap=!!l.hardCap,A[r].tolerance=!!l.tolerance)})}catch(s){console.warn("No se pudo cargar preferencias de InventoryManager:",s)}},A=Ze(be.reduce((s,e)=>(s[e.key]={target:!1,hardCap:!1,tolerance:!1},s),{})),mt=j(!1),is=async()=>{try{const s=await fetch("http://localhost:3001/api/config/standards");if(s.ok){const e=await s.json();e.success&&(Q.value=e.version_actual,ke.value=e.tolerancias||[])}}catch(s){console.error("Error loading standards",s)}},ds=s=>{const e=A[s];return e.target&&e.hardCap&&e.tolerance},us=(s,e)=>{A[s].target=e,A[s].hardCap=e,A[s].tolerance=e},Y=s=>{let e=s;return s==="UHML"&&(e="LEN"),s==="PLUS_B"&&(e="+b"),ke.value.find(o=>o.parametro===e)},ye=(s,e)=>{if(!s)return"";const o=t=>t!=null&&t!==""?Number(t):null;if(e==="hardCap"){const t=o(s.limite_min_absoluto),r=o(s.limite_max_absoluto);if(t!==null&&r!==null)return`${t}-${r}`;if(t!==null)return`>= ${t}`;if(r!==null)return`<= ${r}`}if(e==="target"){const t=o(s.valor_ideal_min),r=o(s.promedio_objetivo_max);if(t!==null&&r!==null)return`${t}-${r}`;if(t!==null)return`>= ${t}`;if(r!==null)return`<= ${r}`}if(e==="tolerance"){const t=o(s.rango_tol_min),r=o(s.rango_tol_max);if(t!==null&&r!==null)return`${t}-${r}`}return""},q=(s,e,o="value")=>{const t=A[e];if(!t)return"text-gray-600";const r=Y(e);if(!r)return"text-gray-600";const l=Number(s);if(Number.isNaN(l))return"text-gray-600";if(o==="pctIdeal"){if(t.target){const p=Number(r.porcentaje_min_ideal);return!Number.isNaN(p)&&l>=p?"text-green-700 font-semibold":"text-red-700 font-semibold"}return"text-gray-600"}if(o==="pctTolerancia"){if(t.tolerance){const p=Number(r.porcentaje_min_ideal);if(!Number.isNaN(p)){const u=100-p;return l<=u?"text-yellow-700 font-semibold":"text-red-700 font-semibold"}return"text-yellow-700 font-semibold"}return"text-gray-600"}if(t.hardCap){const p=Number(r.limite_min_absoluto),u=Number(r.limite_max_absoluto);if(!Number.isNaN(p)&&l<p||!Number.isNaN(u)&&l>u)return"text-red-700 font-semibold"}if(t.target){const p=Number(r.valor_ideal_min),u=Number(r.promedio_objetivo_max);if(e==="PLUS_B"){if(!Number.isNaN(u)&&l<=u)return"text-green-700 font-semibold"}else if(e==="MIC"){if(!Number.isNaN(p)&&l>=p)return"text-green-700 font-semibold"}else if(!Number.isNaN(p)&&l>=p)return"text-green-700 font-semibold"}if(t.tolerance){const p=Number(r.rango_tol_min),u=Number(r.rango_tol_max);if(!Number.isNaN(p)&&!Number.isNaN(u)&&l>=p&&l<=u)return"text-yellow-700 font-semibold"}return"text-gray-600"},se=(s,e)=>{let o=e;e==="UHML"&&(o="LEN"),e==="PLUS_B"&&(o="+b");const t=A[e];if(!t||!(t.hardCap||t.target||t.tolerance))return"";const l=ke.value.find(y=>y.parametro===o);if(!l)return"";const p=s[e]??(e==="UHML"?s.LEN:void 0),u=Number(p);if(typeof u!="number"||isNaN(u))return"";if(t.hardCap){const y=parseFloat(l.limite_max_absoluto),f=parseFloat(l.limite_min_absoluto);if(!isNaN(y)&&u>y||!isNaN(f)&&u<f)return"bg-red-100 text-red-800 font-bold ring-1 ring-inset ring-red-300"}if(t.target){const y=parseFloat(l.valor_ideal_min),f=parseFloat(l.promedio_objetivo_max);let M=!1;if(o==="+b"?!isNaN(f)&&u<=f&&(M=!0):!isNaN(y)&&u>=y&&(M=!0),M)return"bg-green-100 text-green-800 font-medium ring-1 ring-inset ring-green-300"}if(t.tolerance){const y=parseFloat(l.rango_tol_min),f=parseFloat(l.rango_tol_max);if(!isNaN(y)&&!isNaN(f)&&u>=y&&u<=f)return"bg-yellow-50 text-yellow-700 font-medium ring-1 ring-inset ring-yellow-300"}return""},cs=async()=>{mt.value=!0;try{const s=await fetch("http://localhost:3001/api/inventory/cotton-bales");if(!s.ok)throw new Error("Error al cargar datos");const e=await s.json();Ye.value=e.map(o=>new ra(o))}catch(s){console.error(s),alert("No se pudieron cargar los datos del inventario. Verifica que el servidor esté corriendo.")}finally{mt.value=!1}};Xs(()=>{ns(),is().then(()=>{cs()})});let we=null;const Xe=()=>{Te.value&&(we&&clearTimeout(we),we=setTimeout(()=>{!Te.value||De.value||qt({silent:!0})},300))};ze(()=>O.fardos,()=>{Le(),Xe()}),ze(Z,()=>{Le(),Xe()}),ze(L,()=>{Le(),Xe()},{deep:!0}),ze(A,()=>{Le(),Xe()},{deep:!0}),ze(()=>T.targetMixes,s=>{const e=Number(s);if(Number.isNaN(e)||e<=0)return;const o=Math.floor(e);if(o!==T.targetMixes){T.targetMixes=o;return}Le()}),ze(()=>T.source,()=>{Le()}),ea(()=>{we&&(clearTimeout(we),we=null)});const ms=s=>L.value.has(s),ps=s=>{const e=ue.find(o=>o.key===s);e&&e.locked||(L.value.has(s)?L.value.delete(s):L.value.add(s),L.value=new Set(L.value))},Ve=B(()=>ue.filter(s=>L.value.has(s.key))),gs=s=>s==="UHML"?"LEN":s==="PLUS_B"?"+b":s,xs=s=>s==="UHML"?"UHML":s==="PLUS_B"?"PLUS_B":s,Be=s=>s?s.MotivoLogistico?s.MotivoLogistico:Number(s.Sobrante)===0?"Usado en plan (se usó todo)":s.Estado==="TOLER."?"Usado en plan (tolerancia permitida)":s.Estado==="NO USO"?"No usado en ninguna mezcla":s.Estado==="RECH."?"Rechazado por límites absolutos":"Usado en plan (consumo parcial)":"",me=s=>(s??"").toString().trim(),wt=(s,e)=>{var o;if(!s||!e)return"";if(typeof e=="string"&&e.startsWith("MEZCLA::")){const t=e.replace("MEZCLA::","");return Number((o=s==null?void 0:s.mezclas)==null?void 0:o[t])||0}return e==="MotivoLogistico"?Be(s):e==="UHML"?s.UHML??s.LEN??"":e==="LEN"?s.LEN??s.UHML??"":s[e]??""},bs=new Set(["QTDE_ESTOQUE","Stock","Usados","Sobrante","MIC","UHML","LEN","STR","PESO"]),ys=(s,e,o)=>{const t=wt(s,o),r=wt(e,o);if(bs.has(o)){const l=Number(t),p=Number(r),u=!Number.isNaN(l),y=!Number.isNaN(p);if(u&&y&&l!==p)return l-p;if(u!==y)return u?-1:1}return me(t).localeCompare(me(r),"es",{sensitivity:"base",numeric:!0})},fs=(s,e)=>{const o=me(s==null?void 0:s.PRODUTOR),t=me(e==null?void 0:e.PRODUTOR),r=o.localeCompare(t,"es",{sensitivity:"base",numeric:!0});if(r!==0)return r;const l=me(s==null?void 0:s.LOTE),p=me(e==null?void 0:e.LOTE);return l.localeCompare(p,"es",{sensitivity:"base",numeric:!0})},Bt=(s,e)=>{if(s.key!==e){s.key=e,s.direction="asc";return}if(s.direction==="asc"){s.direction="desc";return}if(s.direction==="desc"){s.key=null,s.direction=null;return}s.key=e,s.direction="asc"},At=s=>rs.has(s),vs=s=>os.has(s)||typeof s=="string"&&s.startsWith("MEZCLA::"),hs=s=>{At(s)&&Bt(Je,s)},ae=s=>{vs(s)&&Bt(Ue,s)},pt=s=>Je.key===s?Je.direction:null,F=s=>Ue.key===s?Ue.direction:null,gt=(s,e)=>{if(!e.key||!e.direction)return[...s];const o=e.direction==="desc"?-1:1;return[...s].sort((t,r)=>{const l=ys(t,r,e.key);if(l!==0)return l*o;const p=fs(t,r);return p!==0?p*o:0})},ks=s=>{if(!s||typeof s!="string"||s.match(/^M(\d+)$/))return 1;const o=s.match(/^M(\d+)-M(\d+)$/);if(!o)return 1;const t=Number(o[1]),r=Number(o[2]);return Number.isNaN(t)||Number.isNaN(r)||r<t?1:r-t+1},Ge=s=>{var o,t,r;const e=Number((r=(t=(o=x.value)==null?void 0:o.estadisticas)==null?void 0:t[s])==null?void 0:r.mezclasBloque);return!Number.isNaN(e)&&e>0?e:ks(s)},xt=s=>{var o,t;const e=((t=(o=x.value)==null?void 0:o.estadisticas)==null?void 0:t[s])||{};return e.pesoPorMezcla??e.pesoTotal??0},Pt=s=>{var o,t;const e=((t=(o=x.value)==null?void 0:o.estadisticas)==null?void 0:t[s])||{};return e.pesoTotalBloque!==void 0&&e.pesoTotalBloque!==null?e.pesoTotalBloque:xt(s)*Ge(s)},bt=(s,e)=>{var l,p;const o=((l=x.value)==null?void 0:l.columnasMezcla)||[];if(!Array.isArray(o)||o.length===0)return"-";const t=Number(s==null?void 0:s.Stock);if(Number.isNaN(t))return"-";let r=t;for(let u=0;u<=e&&u<o.length;u+=1){const y=o[u],f=Number((p=s==null?void 0:s.mezclas)==null?void 0:p[y])||0,M=Ge(y);r-=f*M}return W(r)},Ot=B(()=>be.filter(({key:s})=>{const e=A[s];return e&&(e.target||e.hardCap||e.tolerance)}).map(({key:s,label:e})=>({uiKey:s,ruleParam:gs(s),label:e,formatKey:xs(s)}))),yt=B(()=>{var e;return(((e=x.value)==null?void 0:e.plan)||[]).reduce((o,t)=>(o.stock+=Number(t.Stock)||0,o.usados+=Number(t.Usados)||0,o.sobrante+=Number(t.Sobrante)||0,o),{stock:0,usados:0,sobrante:0})}),It=B(()=>{var e;const s=((e=x.value)==null?void 0:e.plan)||[];return gt(s,Ue)}),Ms=B(()=>{var e;const s=((e=x.value)==null?void 0:e.remanentes)||[];return gt(s,Ue)}),Me=B(()=>T.source==="stock"),Cs=B(()=>Me.value?9:7),et=B(()=>{const s=ht();return T.source==="stock"?It.value.map(e=>{const o=Number(e.Stock)||0,t=kt(e),r=t!==null&&t>0?t:o*s,l=o>0?r/o:0;return{PRODUTOR:e.PRODUTOR,LOTE:e.LOTE,Fardos:o,Kilogramos:r,PesoMedio:l,MIC:e.MIC,STR:e.STR,LEN:e.LEN,Motivo:Be(e)}}):Ms.value.map(e=>({PRODUTOR:e.PRODUTOR,LOTE:e.LOTE,Fardos:Number(e.Fardos)||0,MIC:e.MIC,STR:e.STR,LEN:e.LEN,Motivo:e.Motivo}))}),Ae=B(()=>{const s=et.value.reduce((e,o)=>{const t=Number(o==null?void 0:o.Fardos)||0,r=Pe(o==null?void 0:o.Kilogramos)||0,l=Pe(o==null?void 0:o.MIC),p=Pe(o==null?void 0:o.STR),u=Pe(o==null?void 0:o.LEN);return e.fardos+=t,e.kilogramos+=r,t>0&&l!==null&&(e.micWeighted+=l*t,e.micWeight+=t),t>0&&p!==null&&(e.strWeighted+=p*t,e.strWeight+=t),t>0&&u!==null&&(e.lenWeighted+=u*t,e.lenWeight+=t),e},{fardos:0,kilogramos:0,micWeighted:0,micWeight:0,strWeighted:0,strWeight:0,lenWeighted:0,lenWeight:0});return{fardos:s.fardos,kilogramos:s.kilogramos,pesoMedio:s.fardos>0?s.kilogramos/s.fardos:0,mic:s.micWeight>0?s.micWeighted/s.micWeight:0,str:s.strWeight>0?s.strWeighted/s.strWeight:0,len:s.lenWeight>0?s.lenWeighted/s.lenWeight:0}}),Ss=B(()=>T.source==="stock"?"Lotes de Stock Actual (Referencia Proyección)":"Lotes No Usados / Remanentes"),Ns=B(()=>T.source==="stock"?"Motivo / Estado":"Motivo Sobrante"),_s=B(()=>T.source==="stock"?"No hay lotes de stock disponibles para mostrar.":"No hay lotes remanentes. Se usó todo el stock."),tt=s=>{const e=(s==null?void 0:s.CLASSIF)??(s==null?void 0:s.TIPO)??(s==null?void 0:s.COR)??"SIN CALIDAD";return me(e)||"SIN CALIDAD"},st=B(()=>{var e;const s=(e=x.value)==null?void 0:e.columnasMezcla;return!Array.isArray(s)||s.length===0?0:s.reduce((o,t)=>o+Ge(t),0)}),Ts=B(()=>{var t;const s=(t=x.value)==null?void 0:t.plan;if(!Array.isArray(s)||s.length===0)return[];const e=st.value;if(!e||e<=0)return[];const o=new Map;return s.forEach(r=>{const l=tt(r),p=Number(r==null?void 0:r.Usados)||0;o.has(l)||o.set(l,{calidad:l,usados:0});const u=o.get(l);u.usados+=p}),Array.from(o.values()).map(r=>({...r,recetaPorMezcla:r.usados/e})).filter(r=>r.recetaPorMezcla>0).sort((r,l)=>l.recetaPorMezcla-r.recetaPorMezcla)}),Fs=B(()=>{var o,t;const s=T.source==="remanente"?((o=x.value)==null?void 0:o.remanentes)||[]:((t=x.value)==null?void 0:t.plan)||[],e=new Map;return s.forEach(r=>{const l=tt(r),p=T.source==="remanente"?Number(r==null?void 0:r.Fardos)||0:Number(r==null?void 0:r.Stock)||0;e.set(l,(e.get(l)||0)+p)}),e}),ft=()=>{var s,e;return T.source==="remanente"?((s=x.value)==null?void 0:s.remanentes)||[]:((e=x.value)==null?void 0:e.plan)||[]},vt=s=>T.source==="remanente"?Number(s==null?void 0:s.Fardos)||0:Number(s==null?void 0:s.Stock)||0,Pe=s=>{if(s==null||s==="")return null;if(typeof s=="number")return Number.isNaN(s)?null:s;const e=String(s).trim();if(!e)return null;const o=e.replace(/\./g,"").replace(",","."),t=Number(o);if(!Number.isNaN(t))return t;const r=Number(e);return Number.isNaN(r)?null:r},$t=(s,e)=>{const o=me(s).toUpperCase(),t=me(e).toUpperCase();return`${o}::${t}`},Es=B(()=>{const s=new Map;return(Ye.value||[]).forEach(e=>{const o=$t(e==null?void 0:e.PRODUTOR,e==null?void 0:e.LOTE),t=Pe(e==null?void 0:e.PESO);!o||t===null||t<=0||s.set(o,t)}),s}),ht=()=>{var o,t;const s=Number((o=Oe.value)==null?void 0:o.QTDE_ESTOQUE)||0,e=Number((t=Oe.value)==null?void 0:t.PESO)||0;return s>0&&e>0?e/s:0},kt=s=>{const e=Pe(s==null?void 0:s.PESO);if(e!==null&&e>0)return e;const o=$t(s==null?void 0:s.PRODUTOR,s==null?void 0:s.LOTE),t=Es.value.get(o);return t!==void 0&&t>0?t:null},Rs=(s,e)=>{if(!s||!e)return null;if(e==="UHML"){const t=Number((s==null?void 0:s.LEN)??(s==null?void 0:s.UHML));return Number.isNaN(t)?null:t}if(e==="PLUS_B"){const t=Number(s==null?void 0:s.PLUS_B);return Number.isNaN(t)?null:t}const o=Number(s==null?void 0:s[e]);return Number.isNaN(o)?null:o},zt=s=>{const e=o=>{if(o==null||o==="")return null;const t=Number(o);return Number.isNaN(t)?null:t};return{targetMin:e(s==null?void 0:s.valor_ideal_min),targetMax:e(s==null?void 0:s.promedio_objetivo_max),toleranceMin:e(s==null?void 0:s.rango_tol_min),toleranceMax:e(s==null?void 0:s.rango_tol_max),hardMin:e(s==null?void 0:s.limite_min_absoluto),hardMax:e(s==null?void 0:s.limite_max_absoluto)}},J=({targetValue:s,existingQty:e,existingAverage:o,purchaseQty:t})=>{const r=Number(s),l=Number(e),p=Number(o),u=Number(t);return[r,l,p,u].some(y=>Number.isNaN(y))||u<=0?null:(r*(l+u)-p*l)/u},Dt=B(()=>be.filter(({key:s})=>{const e=A[s];return e&&(e.target||e.hardCap||e.tolerance)})),Ut=B(()=>{const s=ft(),e={};return be.forEach(({key:o})=>{const t=new Map;let r=0,l=0;s.forEach(u=>{const y=tt(u),f=vt(u),M=Rs(u,o);if(f<=0||M===null)return;const v=t.get(y)||{qty:0,weighted:0};v.qty+=f,v.weighted+=M*f,t.set(y,v),r+=f,l+=M*f});const p=new Map;t.forEach((u,y)=>{p.set(y,u.qty>0?u.weighted/u.qty:0)}),e[o]={byQuality:p,global:r>0?l/r:0}}),e}),Mt=B(()=>{const s=ft(),e=new Map;let o=0,t=0;const r=ht();s.forEach(u=>{const y=tt(u),f=vt(u),M=kt(u),v=M!==null&&M>0?M:f*r;if(f<=0||v<=0)return;const P=e.get(y)||{weight:0,bales:0};P.weight+=v,P.bales+=f,e.set(y,P),o+=v,t+=f});const l=new Map;e.forEach((u,y)=>{l.set(y,u.bales>0?u.weight/u.bales:0)});const p=t>0?o/t:0;return{byQuality:l,global:p}}),qe=B(()=>{if(!x.value||!Array.isArray(x.value.plan)||x.value.plan.length===0)return"Genera primero un plan de mezclas para poder calcular la compra por calidad.";const s=Number(T.targetMixes);return Number.isNaN(s)||s<=0?"Ingresa una cantidad de mezclas objetivo válida (mayor que 0).":!O.fardos||Number(O.fardos)<=0?"Define los fardos por mezcla antes de proyectar la compra.":st.value<=0?"No hay bloques válidos en el plan para obtener receta base por calidad.":""}),jt=B(()=>{if(qe.value)return[];const s=Number(T.targetMixes),e=Fs.value,o=Mt.value,t=Dt.value,r=Ut.value;return Ts.value.map(l=>{const p=l.recetaPorMezcla*s,u=e.get(l.calidad)||0,y=Math.max(0,p-u),f=Math.ceil(y),M=o.byQuality.get(l.calidad),v=M&&M>0?M:o.global,P=f*(v||0),pe=t.map(({key:fe,label:Ce})=>{const ee=A[fe]||{},Ie=Y(fe),V=zt(Ie),ve=r[fe]||{byQuality:new Map,global:0},$e=ve.byQuality.get(l.calidad),oe=$e&&$e>0?$e:ve.global,le=ee.target&&V.targetMin!==null?J({targetValue:V.targetMin,existingQty:u,existingAverage:oe,purchaseQty:f}):null,ne=ee.target&&V.targetMax!==null?J({targetValue:V.targetMax,existingQty:u,existingAverage:oe,purchaseQty:f}):null,He=ee.tolerance&&V.toleranceMin!==null?J({targetValue:V.toleranceMin,existingQty:u,existingAverage:oe,purchaseQty:f}):null,lt=ee.tolerance&&V.toleranceMax!==null?J({targetValue:V.toleranceMax,existingQty:u,existingAverage:oe,purchaseQty:f}):null,St=ee.hardCap&&V.hardMin!==null?J({targetValue:V.hardMin,existingQty:u,existingAverage:oe,purchaseQty:f}):null,H=ee.hardCap&&V.hardMax!==null?J({targetValue:V.hardMax,existingQty:u,existingAverage:oe,purchaseQty:f}):null;return{uiKey:fe,label:Ce,avgAvailable:oe,targetMinBuy:le,targetMaxBuy:ne,toleranceMinBuy:He,toleranceMaxBuy:lt,hardMinBuy:St,hardMaxBuy:H,hasRecommendation:f>0}});return{calidad:l.calidad,recetaPorMezcla:l.recetaPorMezcla,requerido:p,disponible:u,faltante:y,compraSugeridaFardos:f,compraSugeridaPeso:P,hviGuidance:pe}})}),re=B(()=>jt.value.reduce((s,e)=>(s.requerido+=e.requerido,s.disponible+=e.disponible,s.faltante+=e.faltante,s.compraSugeridaFardos+=e.compraSugeridaFardos,s.compraSugeridaPeso+=e.compraSugeridaPeso,s),{requerido:0,disponible:0,faltante:0,compraSugeridaFardos:0,compraSugeridaPeso:0})),at=B(()=>{var o;const s=ft(),e=Number((o=Mt.value)==null?void 0:o.global)||ht();return s.reduce((t,r)=>{const l=vt(r),p=kt(r);return t.stockFardos+=l,t.stockPeso+=p!==null&&p>0?p:l*e,t},{stockFardos:0,stockPeso:0})}),Ct=B(()=>{var r,l,p;const s=Number((r=re.value)==null?void 0:r.disponible)||0,e=Number((l=re.value)==null?void 0:l.compraSugeridaFardos)||0,o=Number((p=re.value)==null?void 0:p.compraSugeridaPeso)||0,t=Ut.value;return Dt.value.map(({key:u,label:y})=>{var ve;const f=A[u]||{},M=Y(u),v=zt(M),P=Number((ve=t==null?void 0:t[u])==null?void 0:ve.global)||0,pe=f.target&&v.targetMin!==null?J({targetValue:v.targetMin,existingQty:s,existingAverage:P,purchaseQty:e}):null,fe=f.target&&v.targetMax!==null?J({targetValue:v.targetMax,existingQty:s,existingAverage:P,purchaseQty:e}):null,Ce=f.tolerance&&v.toleranceMin!==null?J({targetValue:v.toleranceMin,existingQty:s,existingAverage:P,purchaseQty:e}):null,ee=f.tolerance&&v.toleranceMax!==null?J({targetValue:v.toleranceMax,existingQty:s,existingAverage:P,purchaseQty:e}):null,Ie=f.hardCap&&v.hardMin!==null?J({targetValue:v.hardMin,existingQty:s,existingAverage:P,purchaseQty:e}):null,V=f.hardCap&&v.hardMax!==null?J({targetValue:v.hardMax,existingQty:s,existingAverage:P,purchaseQty:e}):null;return{uiKey:u,label:y,sourceAverage:P,totalToBuy:e,totalAvailable:s,totalKgToBuy:o,thresholds:v,targetMinBuy:pe,targetMaxBuy:fe,toleranceMinBuy:Ce,toleranceMaxBuy:ee,hardMinBuy:Ie,hardMaxBuy:V}})}),Ls=(s,e)=>{const o=Number(s);return Number.isNaN(o)?null:e===">="||e==="<="?Math.max(0,o):o},ws=({currentAverage:s,availableQty:e,buyQty:o,buyValue:t})=>{const r=Number(s),l=Number(e),p=Number(o),u=Number(t);return[r,l,p,u].some(y=>Number.isNaN(y))||l+p<=0?null:(r*l+u*p)/(l+p)},Bs=s=>{const e=(s==null?void 0:s.thresholds)||{};if((s==null?void 0:s.uiKey)==="PLUS_B"){if(e.targetMax!==null&&e.targetMax!==void 0)return{comparator:"<=",objectiveValue:e.targetMax,recommendedValue:s.targetMaxBuy};if(e.toleranceMax!==null&&e.toleranceMax!==void 0)return{comparator:"<=",objectiveValue:e.toleranceMax,recommendedValue:s.toleranceMaxBuy}}else{if(e.targetMin!==null&&e.targetMin!==void 0)return{comparator:">=",objectiveValue:e.targetMin,recommendedValue:s.targetMinBuy};if(e.toleranceMin!==null&&e.toleranceMin!==void 0)return{comparator:">=",objectiveValue:e.toleranceMin,recommendedValue:s.toleranceMinBuy}}return{comparator:null,objectiveValue:null,recommendedValue:null}},rt=B(()=>{var u,y,f;const s=Number((u=re.value)==null?void 0:u.disponible)||0,e=Number((y=re.value)==null?void 0:y.compraSugeridaFardos)||0,o=s+e,t=Number((f=Mt.value)==null?void 0:f.global)||0,r=o*t,l=Number(O.fardos)||0,p=Number(T.targetMixes)||0;return Ct.value.map(M=>{const v=Bs(M),P=Ls(v.recommendedValue,v.comparator),pe=P!==null?ws({currentAverage:M.sourceAverage,availableQty:s,buyQty:e,buyValue:P}):null;return{...M,disponibleFardos:s,faltanteFardos:e,totalFardos:o,pesoMedioFardo:t,pesoTotalKg:r,fardosPorMezcla:l,tamanoBloque:p,promedioActual:M.sourceAverage,objetivoComparador:v.comparator,objetivoValor:v.objectiveValue,comprarComparador:v.comparator,comprarValor:P,promedioFinal:pe,recomendacion:Gt(M)}})}),Vt=B(()=>Ye.value.filter(s=>{const e=O.searchText.toLowerCase();return!O.searchText||s.PRODUTOR.toLowerCase().includes(e)||s.LOTE.toLowerCase().includes(e)||s.DESTINO.toLowerCase().includes(e)})),ot=B(()=>gt(Vt.value,Je)),Oe=B(()=>{const s=Vt.value;if(!s||s.length===0)return null;const e=s.reduce((u,y)=>u+(Number(y.PESO)||0),0),o=s.reduce((u,y)=>u+(Number(y.QTDE_ESTOQUE)||0),0),t=s.length,r=["MIC","STR","UHML","SCI","MST","MAT","UI","SF","ELG","RD","PLUS_B","TrCNT","TrAR","TRID","PESO_MEDIO","CORTEZA"],l={};r.forEach(u=>l[u]=0),s.forEach(u=>{const y=Number(u.PESO)>0?Number(u.PESO):0;r.forEach(f=>{const M=Number(u[f])||0;l[f]+=M*y})});const p={};return r.forEach(u=>{if(e>0)p[u]=l[u]/e;else{const y=s.reduce((f,M)=>f+(Number(M[u])||0),0);p[u]=t>0?y/t:0}}),{PRODUTOR:"TOTALES / PROMEDIOS",QTDE_ESTOQUE:o,PESO:e,...p}}),I=(s,e)=>{if(s==null)return"-";const o=Number(s);return isNaN(o)?s:e==="PESO"?Math.round(o).toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):["MIC","STR","UHML","SCI","MST"].includes(e)?o.toFixed(2):o},W=s=>{if(s==null||s==="")return"-";let e=s;typeof e=="string"&&(e=e.replace(/\./g,"").replace(",",".").trim());const o=Number(e);return Number.isNaN(o)?s:new Intl.NumberFormat("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.round(o))},U=(s,e=2)=>{const o=Number(s);return Number.isNaN(o)?"-":new Intl.NumberFormat("es-ES",{minimumFractionDigits:e,maximumFractionDigits:e}).format(o)},X=s=>{if(s==null)return null;const e=Number(s);return Number.isNaN(e)?null:U(e,2)},As=(s,e)=>{if(!s)return"Sin guía.";if(!e||e<=0||!s.hasRecommendation)return"Sin compra requerida para esta calidad.";const o=[],t=X(s.targetMinBuy),r=X(s.targetMaxBuy);(t!==null||r!==null)&&(t!==null&&r!==null?o.push(`Target compra: ${t} - ${r}`):t!==null?o.push(`Target compra: >= ${t}`):o.push(`Target compra: <= ${r}`));const l=X(s.toleranceMinBuy),p=X(s.toleranceMaxBuy);(l!==null||p!==null)&&(l!==null&&p!==null?o.push(`Tolerancia compra: ${l} - ${p}`):l!==null?o.push(`Tolerancia compra: >= ${l}`):o.push(`Tolerancia compra: <= ${p}`));const u=X(s.hardMinBuy),y=X(s.hardMaxBuy);return(u!==null||y!==null)&&(u!==null&&y!==null?o.push(`Límite abs compra: ${u} - ${y}`):u!==null?o.push(`Límite abs compra: >= ${u}`):o.push(`Límite abs compra: <= ${y}`)),o.join(" | ")||"Sin umbrales de regla para esta variable."},Gt=s=>{if(!s)return"Sin guía";if(!s.totalToBuy||s.totalToBuy<=0)return"Sin compra total requerida.";const e=[],o=X(s.targetMinBuy),t=X(s.targetMaxBuy);(o!==null||t!==null)&&(o!==null&&t!==null?e.push(`Target compra ${o} - ${t}`):o!==null?e.push(`Target compra >= ${o}`):e.push(`Target compra <= ${t}`));const r=X(s.toleranceMinBuy),l=X(s.toleranceMaxBuy);(r!==null||l!==null)&&(r!==null&&l!==null?e.push(`Tolerancia compra ${r} - ${l}`):r!==null?e.push(`Tolerancia compra >= ${r}`):e.push(`Tolerancia compra <= ${l}`));const p=X(s.hardMinBuy),u=X(s.hardMaxBuy);return(p!==null||u!==null)&&(p!==null&&u!==null?e.push(`Límite abs compra ${p} - ${u}`):p!==null?e.push(`Límite abs compra >= ${p}`):e.push(`Límite abs compra <= ${u}`)),e.join(" | ")||"Sin umbrales de regla para esta variable."},Ps=()=>{const s=[];return be.forEach(({key:e,label:o})=>{const t=A[e];if(!t||!(t.target||t.hardCap||t.tolerance))return;const l=Y(e),p=[];if(t.target){const u=ye(l,"target");p.push(`Target${u?`: ${u}`:""}`)}if(t.hardCap){const u=ye(l,"hardCap");p.push(`Hard Cap${u?`: ${u}`:""}`)}if(t.tolerance){const u=ye(l,"tolerance");p.push(`Tolerancia${u?`: ${u}`:""}`)}s.push({parametro:o,detalle:p.join(" | ")||"Sin detalle de regla"})}),s},Os=()=>Object.keys(A).filter(s=>{const e=A[s];return e.target||e.hardCap||e.tolerance}),Is=s=>{if(!s||typeof s!="string"||s.match(/^M(\d+)$/))return 1;const o=s.match(/^M(\d+)-M(\d+)$/);if(!o)return 1;const t=Number(o[1]),r=Number(o[2]);return Number.isNaN(t)||Number.isNaN(r)||r<t?1:r-t+1},$s=s=>{const e=Array.isArray(s==null?void 0:s.plan)?s.plan:[],o=Array.isArray(s==null?void 0:s.columnasMezcla)?s.columnasMezcla:[];if(!e.length||!o.length)return;const t=[];if(e.forEach(r=>{var u,y,f;const l=Number(r==null?void 0:r.Stock);if(Number.isNaN(l))return;let p=l;for(const M of o){const v=Number((u=r==null?void 0:r.mezclas)==null?void 0:u[M])||0,P=Number((f=(y=s==null?void 0:s.estadisticas)==null?void 0:y[M])==null?void 0:f.mezclasBloque),pe=!Number.isNaN(P)&&P>0?P:Is(M);if(p-=v*pe,p<0){t.push(`${r.PRODUTOR}/${r.LOTE} en ${M} (S.Act=${p})`);break}}}),t.length>0)throw new Error(`Plan no realizable detectado en validación UI: ${t.slice(0,3).join(" | ")}`)},qt=async({silent:s=!1}={})=>{if(De.value)return;if(te.value=null,!O.fardos||O.fardos<=0){s||alert("Por favor, especifica la cantidad de fardos para la mezcla.");return}if(Os().length===0){s||alert('Por favor, selecciona al menos una variable en "Reglas de Mezclas" para optimizar.');return}De.value=!0,Fe.value=Ps(),ge.value=Z.value==="stability"?"Golden Batch (máx N, tolerancia informativa)":Z.value==="stability-strict"?"Golden Batch Estricto (norma respetada)":"Estándar (Round Robin)",xe.value=new Date().toLocaleString("es-ES");try{const o=await fetch("http://localhost:3001/api/inventory/blendomat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stock:ot.value,rules:ke.value,supervisionSettings:A,blendSize:O.fardos,algorithm:Z.value})});if(!o.ok){const r=await o.json();throw new Error(r.error||"Error al calcular mezclas")}const t=await o.json();if(t.success){if(!Array.isArray(t.plan)||t.plan.length===0){const r=t.diagnostics||{},l=r.message||"No se pudo armar ningún bloque de mezcla con la configuración actual.",p=Array.isArray(r.details)?r.details:[];te.value={kind:"info",title:"No fue posible generar bloques",message:l,details:p},x.value=t,Te.value=!0;return}$s(t),te.value=null,x.value=t,Te.value=!0}else throw new Error("El cálculo no fue exitoso.")}catch(o){console.error(o),te.value={kind:"error",title:"Error al calcular mezclas",message:o.message||"No se pudo calcular el plan de mezclas.",details:[]},s||alert(`Error: ${o.message}`)}finally{De.value=!1}},zs=async()=>{var Kt,Zt,Yt,Jt,Xt,es;if(!x.value||!x.value.plan){alert("No hay plan de mezclas para exportar.");return}const s=x.value.plan||[],e=x.value.estadisticas||{},o=x.value.columnasMezcla||[],t=new aa.Workbook,r="FF1F4E78",l={color:"FFFFFFFF",bold:!0,size:11},p={bold:!0,size:14,color:"FF000000"},u={bold:!0,size:11,color:"FF1F4E78"},y={horizontal:"center",vertical:"center",wrapText:!0},f=(d,c)=>{if(!(!c||typeof c!="string")){if(c.includes("bg-red-100")){d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFEE2E2"}},d.font={...d.font||{},color:{argb:"FF991B1B"},bold:!0};return}if(c.includes("bg-green-100")){d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFDCFCE7"}},d.font={...d.font||{},color:{argb:"FF166534"}};return}c.includes("bg-yellow-50")&&(d.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFEFCE8"}},d.font={...d.font||{},color:{argb:"FFA16207"}})}},M=d=>{d.eachRow({includeEmpty:!0},c=>{c.eachCell({includeEmpty:!0},g=>{g.alignment={...g.alignment||{},vertical:"middle"}})})},v=t.addWorksheet("Plan de Mezclas"),P="FF9DC3E6",pe=ge.value||"N/A",fe=xe.value||new Date().toLocaleString("es-ES"),Ce=d=>{const c=Y(d);if(!c)return{target:"N/A",tolerance:"N/A"};const g=ye(c,"target")||"N/A",b=ye(c,"tolerance")||"N/A";return{target:g,tolerance:b}},ee=10+o.length*2;v.mergeCells(`A1:${String.fromCharCode(64+ee)}1`);const Ie=v.getCell("A1");Ie.value={richText:[{font:{bold:!0,size:14,color:{argb:"FF000000"}},text:"PLAN DE MEZCLAS GENERADO"},{font:{bold:!1,size:12,color:{argb:"FF000000"}},text:` | Algoritmo usado:${pe} | Ejecutado:${fe}`}]},Ie.alignment={horizontal:"left",vertical:"middle",wrapText:!0,indent:1},v.getRow(1).height=25,v.mergeCells(`A2:${String.fromCharCode(64+ee)}2`);const V=v.getCell("A2"),ve=Ce("MIC"),$e=Ce("UHML"),oe=Ce("STR"),le={size:10,color:{argb:"FF1F4E78"}};V.value={richText:[{font:{...le,bold:!0},text:"Reglas aplicadas en este cálculo"},{font:le,text:`
`},{font:{...le,bold:!0},text:"MIC"},{font:le,text:`: Target: ${ve.target} | Hard Cap | Tolerancia: ${ve.tolerance}  |  `},{font:{...le,bold:!0},text:"LEN (UHML)"},{font:le,text:`: Target: ${$e.target} | Hard Cap | Tolerancia: ${$e.tolerance}  |  `},{font:{...le,bold:!0},text:"STR"},{font:le,text:`: Target: ${oe.target} | Hard Cap | Tolerancia: ${oe.tolerance}`}]},V.alignment={horizontal:"left",vertical:"middle",wrapText:!0},v.getRow(2).height=36;const ne=["Productor","Lote","Estado","Stock","Usados","Sobrante","Motivo Sobrante","MIC","STR","LEN"];o.forEach(d=>{ne.push(d),ne.push("Saldo")});const He=v.addRow(ne);He.font=l,He.alignment=y;for(let d=1;d<=ne.length;d+=1){const c=He.getCell(d);c.fill={type:"pattern",pattern:"solid",fgColor:{argb:P}}}v.getRow(3).height=20;const lt=[16,7,9,9,9,9,33,7,7,7],St=ne.map((d,c)=>c<lt.length?lt[c]:9);v.columns=St.map(d=>({width:d})),s.forEach(d=>{const c=[d.PRODUTOR||"",d.LOTE||"",d.Estado||"",d.Stock!==void 0?d.Stock:"",d.Usados!==void 0?d.Usados:"",d.Sobrante!==void 0?d.Sobrante:"",Be(d),d.MIC||"",d.STR||"",d.LEN||""];o.forEach((z,de)=>{c.push(d.mezclas&&d.mezclas[z]?d.mezclas[z]:"");const dt=Number(bt(d,de));c.push(Number.isNaN(dt)?"":dt)});const g=v.addRow(c);g.alignment={horizontal:"center",vertical:"center"};const b=g.getCell(3);d.Estado==="NO USO"||d.Estado==="RECH."?b.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFFCCCC"}}:d.Estado==="USO"&&(b.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFCCFFCC"}});const h=g.getCell(8),G=g.getCell(9),_=g.getCell(10);f(h,se(d,"MIC")),f(G,se(d,"STR")),f(_,se(d,"UHML"))});const H={stock:0,usados:0,sobrante:0,mezclas:{},saldos:{}};s.forEach(d=>{H.stock+=Number(d.Stock)||0,H.usados+=Number(d.Usados)||0,H.sobrante+=Number(d.Sobrante)||0,o.forEach((c,g)=>{H.mezclas[c]||(H.mezclas[c]=0),H.saldos[c]||(H.saldos[c]=0);const b=d.mezclas&&d.mezclas[c]?Number(d.mezclas[c]):0;H.mezclas[c]+=b||0;const h=Number(bt(d,g));H.saldos[c]+=Number.isNaN(h)?0:h})});const Nt=["","","SUBTOTALES",H.stock,H.usados,H.sobrante,"","","",""];o.forEach(d=>{Nt.push(H.mezclas[d]||0),Nt.push(H.saldos[d]||0)});const Se=v.addRow(Nt);Se.font={bold:!0,size:11},Se.alignment={horizontal:"center",vertical:"center"};for(let d=1;d<=ne.length;d+=1){const c=Se.getCell(d);c.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE8F4F8"}}}Se.eachCell({includeEmpty:!1},d=>{d.border={top:{style:"medium",color:{argb:"FF1F4E78"}}},typeof d.value=="number"&&(d.numFmt="#,##0")});for(let d=3;d<=Se.number;d+=1){const c=v.getRow(d);for(let g=1;g<=ne.length;g+=1){const b=c.getCell(g),h=d===Se.number;b.border={top:h?{style:"medium",color:{argb:"FF1F4E78"}}:{style:"thin",color:{argb:"FFD1D5DB"}},left:{style:"thin",color:{argb:"FFD1D5DB"}},bottom:{style:"thin",color:{argb:"FFD1D5DB"}},right:{style:"thin",color:{argb:"FFD1D5DB"}}}}}const Qe=8,_t=Qe,We=Qe+1,Ht=Qe+2,Ds=11,Us=ne.length,D=(d,c=0)=>{const g=Number(d);return Number.isNaN(g)?c:g},js=d=>Ds+d*2,Vs=[{label:"Mezcla",rows:[{type:"Cantidad",metric:"Fardos",valueGetter:d=>{var c;return D((c=e==null?void 0:e[d])==null?void 0:c.totalFardos,0)},numFmt:"#,##0"},{type:"",metric:"Bloques",valueGetter:d=>D(Ge(d),0),numFmt:"#,##0"},{type:"Peso",metric:"Por Mezcla",valueGetter:d=>D(xt(d),0),numFmt:"#,##0"},{type:"",metric:"Por Bloque",valueGetter:d=>D(Pt(d),0),numFmt:"#,##0"}]},{label:"MIC",rows:[{type:"Promedio",metric:"Bloque",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.MIC)==null?void 0:b.promedioGeneral,0)},numFmt:"0.00"},{type:"",metric:"90%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.MIC)==null?void 0:b.promedioIdeal,0)},numFmt:"0.00"},{type:"",metric:"10%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.MIC)==null?void 0:b.promedioTolerancia,0)},numFmt:"0.00"},{type:"Porcentual",metric:"90%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.MIC)==null?void 0:b.pctIdeal,0)/100},numFmt:"0.0%"},{type:"",metric:"10%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.MIC)==null?void 0:b.pctTolerancia,0)/100},numFmt:"0.0%"}]},{label:"STR",rows:[{type:"Promedio",metric:"Bloque",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.STR)==null?void 0:b.promedioGeneral,0)},numFmt:"0.00"},{type:"",metric:"80%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.STR)==null?void 0:b.promedioIdeal,0)},numFmt:"0.00"},{type:"",metric:"20%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.STR)==null?void 0:b.promedioTolerancia,0)},numFmt:"0.00"},{type:"Porcentual",metric:"80%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.STR)==null?void 0:b.pctIdeal,0)/100},numFmt:"0.0%"},{type:"",metric:"20%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.STR)==null?void 0:b.pctTolerancia,0)/100},numFmt:"0.0%"}]},{label:"LEN",rows:[{type:"Promedio",metric:"Bloque",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.LEN)==null?void 0:b.promedioGeneral,0)},numFmt:"0.00"},{type:"",metric:"80%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.LEN)==null?void 0:b.promedioIdeal,0)},numFmt:"0.00"},{type:"",metric:"20%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.LEN)==null?void 0:b.promedioTolerancia,0)},numFmt:"0.00"},{type:"Porcentual",metric:"80%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.LEN)==null?void 0:b.pctIdeal,0)/100},numFmt:"0.0%"},{type:"",metric:"20%",valueGetter:d=>{var c,g,b;return D((b=(g=(c=e==null?void 0:e[d])==null?void 0:c.variables)==null?void 0:g.LEN)==null?void 0:b.pctTolerancia,0)/100},numFmt:"0.0%"}]}];let nt=Se.number+1;Vs.forEach(d=>{const c=nt;d.rows.forEach((g,b)=>{const h=v.getRow(nt);b===0&&(h.getCell(_t).value=d.label),h.getCell(We).value=g.type||"",h.getCell(Ht).value=g.metric||"",o.forEach((G,_)=>{const z=js(_),de=h.getCell(z);de.value=g.valueGetter(G),de.numFmt=g.numFmt});for(let G=Qe;G<=Us;G+=1){const _=h.getCell(G),z=b===0,de=b===d.rows.length-1;_.border={top:z?{style:"medium",color:{argb:"FF4B5563"}}:{style:"thin",color:{argb:"FFD1D5DB"}},left:{style:"thin",color:{argb:"FFD1D5DB"}},bottom:de?{style:"medium",color:{argb:"FF4B5563"}}:{style:"thin",color:{argb:"FFD1D5DB"}},right:{style:"thin",color:{argb:"FFD1D5DB"}}},G>=Qe&&G<=Ht?(_.font={..._.font||{},bold:!0,color:{argb:"FF111827"}},_.alignment={horizontal:"center",vertical:"middle",wrapText:!0}):(_.alignment={horizontal:"center",vertical:"middle"},_.value!==null&&_.value!==void 0&&_.value!==""&&(_.font={..._.font||{},bold:!0,color:{argb:"FF0F172A"}}))}nt+=1}),d.rows.length>1&&v.mergeCells(c,_t,nt-1,_t),["MIC","STR","LEN"].includes(d.label)&&(v.mergeCells(c,We,c+2,We),v.mergeCells(c+3,We,c+4,We))}),M(v);const E=t.addWorksheet("Estadísticas");E.mergeCells("A1:B1");const Tt=E.getCell("A1");Tt.value="ESTADÍSTICAS Y CONFIGURACIÓN",Tt.font=p,Tt.alignment=y,E.getRow(1).height=22;let S=3;if(E.getCell(`A${S}`).value="Algoritmo",E.getCell(`A${S}`).font=u,E.getCell(`B${S}`).value=ge.value||"N/A",S++,E.getCell(`A${S}`).value="Fecha de Cálculo",E.getCell(`A${S}`).font=u,E.getCell(`B${S}`).value=xe.value||"N/A",S++,E.getCell(`A${S}`).value="Fardos por mezcla",E.getCell(`A${S}`).font=u,E.getCell(`B${S}`).value=O.fardos||"N/A",S++,Fe.value&&Fe.value.length>0&&(S++,E.getCell(`A${S}`).value="REGLAS APLICADAS",E.getCell(`A${S}`).font=u,S++,Fe.value.forEach(d=>{E.getCell(`A${S}`).value=d.variable,E.getCell(`B${S}`).value=d.target!==void 0?d.target:"N/A",S++})),e.mezclasBloque&&(S++,E.getCell(`A${S}`).value="ESTADÍSTICAS POR BLOQUE",E.getCell(`A${S}`).font=u,S++,Object.entries(e.mezclasBloque).forEach(([d,c])=>{E.getCell(`A${S}`).value=d,E.getCell(`A${S}`).font={bold:!0},S++,c.media!==void 0&&(E.getCell(`B${S}`).value="Media",E.getCell(`C${S}`).value=c.media,S++),c.min!==void 0&&(E.getCell(`B${S}`).value="Mínimo",E.getCell(`C${S}`).value=c.min,S++),c.max!==void 0&&(E.getCell(`B${S}`).value="Máximo",E.getCell(`C${S}`).value=c.max,S++),c.n!==void 0&&(E.getCell(`B${S}`).value="Cantidad",E.getCell(`C${S}`).value=c.n,S++)})),E.columns=[{width:25},{width:20},{width:20}],M(E),s.length>0){const d=t.addWorksheet("Resumen Stock");d.mergeCells("A1:G1");const c=d.getCell("A1");c.value="RESUMEN DE STOCK",c.font=p,c.alignment=y,d.getRow(1).height=22;const g=["Productor","Lote","Destino","Stock","Usados","Sobrante","Estado"],b=d.addRow(g);b.font=l,b.fill={type:"pattern",pattern:"solid",fgColor:{argb:r}},b.alignment=y,s.forEach(h=>{const G=d.addRow([h.PRODUTOR||"",h.LOTE||"",h.DESTINO||"",h.Stock!==void 0?h.Stock:"",h.Usados!==void 0?h.Usados:"",h.Sobrante!==void 0?h.Sobrante:"",h.Estado||""]);G.alignment={horizontal:"center"}}),d.columns=[{width:15},{width:12},{width:15},{width:10},{width:10},{width:10},{width:15}],M(d)}const $=t.addWorksheet("Compra Sugerida");$.mergeCells("A1:H1");const Ft=$.getCell("A1");Ft.value="PROYECCIÓN DE COMPRA POR CALIDAD",Ft.font=p,Ft.alignment=y,$.getRow(1).height=22;const Gs=[["Fuente disponible",T.source==="remanente"?"Sobrante no usado":"Stock actual"],["Mezclas objetivo",Number(T.targetMixes)||0],["Mínimo recomendado de bloque",Number(T.minMixesForBlock)||20],["Fardos por mezcla",Number(O.fardos)||0],["Mezclas base generadas",Number(st.value)||0],["Stock total fuente (fardos)",Number((Kt=at.value)==null?void 0:Kt.stockFardos)||0],["Peso total fuente (kg)",Number((Zt=at.value)==null?void 0:Zt.stockPeso)||0]];let ie=3;Gs.forEach(([d,c])=>{$.getCell(`A${ie}`).value=d,$.getCell(`A${ie}`).font=u,$.getCell(`B${ie}`).value=c,$.getCell(`B${ie}`).alignment={horizontal:"left",vertical:"middle"},ie+=1}),ie+=1;const qs=["Calidad","Receta x mezcla","Requerido","Disponible","Faltante","Compra sugerida (fardos)","Peso estimado compra","Orientación HVI compra (según selección)"],Qt=$.getRow(ie);qs.forEach((d,c)=>{const g=Qt.getCell(c+1);g.value=d,g.font=l,g.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2E7D32"}},g.alignment=y}),Qt.height=20;const Ne=ie+1,Et=jt.value||[];if(Et.length===0){$.mergeCells(`A${Ne}:H${Ne}`);const d=$.getCell(`A${Ne}`);d.value=qe.value||"No hay datos suficientes para proyectar compra por calidad.",d.alignment={horizontal:"center",vertical:"middle",wrapText:!0},d.font={color:{argb:"FF6B7280"},italic:!0}}else{Et.forEach((g,b)=>{const h=$.getRow(Ne+b);h.getCell(1).value=g.calidad,h.getCell(2).value=Number(g.recetaPorMezcla)||0,h.getCell(3).value=Number(g.requerido)||0,h.getCell(4).value=Number(g.disponible)||0,h.getCell(5).value=Number(g.faltante)||0,h.getCell(6).value=Number(g.compraSugeridaFardos)||0,h.getCell(7).value=Number(g.compraSugeridaPeso)||0;const G=Array.isArray(g.hviGuidance)?g.hviGuidance.map(_=>`${_.label} (Disp ${U(_.avgAvailable,2)}): ${As(_,g.compraSugeridaFardos)}`).join(`
`):"";h.getCell(8).value=G,h.getCell(2).numFmt="0.00",h.getCell(3).numFmt="0.00",h.getCell(4).numFmt="0.00",h.getCell(5).numFmt="0.00",h.getCell(6).numFmt="#,##0",h.getCell(7).numFmt="#,##0";for(let _=1;_<=8;_+=1){const z=h.getCell(_);z.alignment={horizontal:_===1||_===8?"left":"right",vertical:"middle"}}if(h.getCell(8).alignment={horizontal:"left",vertical:"middle",wrapText:!0},(Number(g.faltante)||0)>0){const _=h.getCell(5);_.font={..._.font||{},bold:!0,color:{argb:"FFB91C1C"}}}});const d=Ne+Et.length,c=$.getRow(d);c.getCell(1).value="TOTALES",c.getCell(1).font={bold:!0,color:{argb:"FF14532D"}},c.getCell(3).value=Number(re.value.requerido)||0,c.getCell(4).value=Number(re.value.disponible)||0,c.getCell(5).value=Number(re.value.faltante)||0,c.getCell(6).value=Number(re.value.compraSugeridaFardos)||0,c.getCell(7).value=Number(re.value.compraSugeridaPeso)||0,c.getCell(3).numFmt="0.00",c.getCell(4).numFmt="0.00",c.getCell(5).numFmt="0.00",c.getCell(6).numFmt="#,##0",c.getCell(7).numFmt="#,##0";for(let g=1;g<=8;g+=1){const b=c.getCell(g);b.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFD1FAE5"}},b.font={...b.font||{},bold:!0,color:{argb:"FF14532D"}},b.alignment={horizontal:g===1||g===8?"left":"right",vertical:"middle"},b.border={top:{style:"medium",color:{argb:"FF065F46"}},left:{style:"thin",color:{argb:"FFA7F3D0"}},bottom:{style:"thin",color:{argb:"FFA7F3D0"}},right:{style:"thin",color:{argb:"FFA7F3D0"}}}}}if(rt.value.length>0){const d=(((Yt=$.lastRow)==null?void 0:Yt.number)||Ne)+2;$.mergeCells(`A${d}:H${d}`);const c=$.getCell(`A${d}`);c.value="COMPRA GLOBAL POR VARIABLE HVI (SEGÚN REGLAS ACTIVAS)",c.font={...u,bold:!0},c.alignment={horizontal:"left",vertical:"middle"};const g=d+1;["Variable","Promedio actual","Objetivo de compra según regla","Kg compra global"].forEach((h,G)=>{const _=$.getRow(g).getCell(G+1);_.value=h,_.font=l,_.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF2E7D32"}},_.alignment=y,_.border={top:{style:"medium",color:{argb:"FF065F46"}},left:{style:"thin",color:{argb:"FFA7F3D0"}},bottom:{style:"thin",color:{argb:"FFA7F3D0"}},right:{style:"thin",color:{argb:"FFA7F3D0"}}}}),rt.value.forEach((h,G)=>{const _=g+1+G,z=$.getRow(_);z.getCell(1).value=h.label,z.getCell(2).value=Number(h.sourceAverage)||0,z.getCell(3).value=h.recomendacion,z.getCell(4).value=Number(h.totalKgToBuy)||0,z.getCell(2).numFmt="0.00",z.getCell(4).numFmt="#,##0",z.getCell(1).alignment={horizontal:"left",vertical:"middle"},z.getCell(2).alignment={horizontal:"right",vertical:"middle"},z.getCell(3).alignment={horizontal:"left",vertical:"middle",wrapText:!0},z.getCell(4).alignment={horizontal:"right",vertical:"middle"};for(let de=1;de<=4;de+=1){const dt=z.getCell(de);dt.border={top:{style:"thin",color:{argb:"FFD1D5DB"}},left:{style:"thin",color:{argb:"FFD1D5DB"}},bottom:{style:"thin",color:{argb:"FFD1D5DB"}},right:{style:"thin",color:{argb:"FFD1D5DB"}}}}})}$.columns=[{width:20},{width:16},{width:12},{width:12},{width:12},{width:22},{width:20},{width:60}];const Hs=((Jt=$.lastRow)==null?void 0:Jt.number)||Ne;for(let d=ie;d<=Hs;d+=1){const c=$.getRow(d);for(let g=1;g<=8;g+=1){const b=c.getCell(g);if(d===ie){b.border={top:{style:"medium",color:{argb:"FF065F46"}},left:{style:"thin",color:{argb:"FFA7F3D0"}},bottom:{style:"thin",color:{argb:"FFA7F3D0"}},right:{style:"thin",color:{argb:"FFA7F3D0"}}};continue}((es=(Xt=b.border)==null?void 0:Xt.top)==null?void 0:es.style)!=="medium"&&(b.border={top:{style:"thin",color:{argb:"FFD1D5DB"}},left:{style:"thin",color:{argb:"FFD1D5DB"}},bottom:{style:"thin",color:{argb:"FFD1D5DB"}},right:{style:"thin",color:{argb:"FFD1D5DB"}}})}}M($);const it=new Date,Qs=it.toISOString().split("T")[0],Ws=[String(it.getHours()).padStart(2,"0"),String(it.getMinutes()).padStart(2,"0"),String(it.getSeconds()).padStart(2,"0")].join("_"),Ks=`${Qs}_${Ws}`,Zs=await t.xlsx.writeBuffer(),Ys=new Blob([Zs],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),Wt=URL.createObjectURL(Ys),Ke=document.createElement("a");Ke.href=Wt,Ke.download=`Plan_Mezclas_${Ks}.xlsx`,document.body.appendChild(Ke),Ke.click(),document.body.removeChild(Ke),URL.revokeObjectURL(Wt)};return(s,e)=>{var o;return n(),i("div",oa,[a("div",la,[e[30]||(e[30]=a("h1",{class:"text-2xl font-bold text-gray-800"},"Gestión de Inventario (Materia Prima)",-1)),Q.value?(n(),i("div",na,[a("span",ia,[e[29]||(e[29]=a("svg",{class:"w-3.5 h-3.5 mr-1.5 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),he(" Versión Activa: "+m(Q.value),1)])])):R("",!0)]),a("div",da,[a("div",ua,[a("div",ca,[a("div",ma,[e[32]||(e[32]=a("label",{class:"hidden lg:block text-sm font-semibold text-gray-700 whitespace-nowrap"}," Buscar: ",-1)),a("div",pa,[_e(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>O.searchText=t),type:"text",placeholder:"Productor, Lote, Destino...",class:"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm p-2 pr-10 border"},null,512),[[Rt,O.searchText]]),O.searchText?(n(),i("button",{key:0,onClick:e[1]||(e[1]=t=>O.searchText=""),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"},[...e[31]||(e[31]=[a("svg",{class:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)])])):R("",!0)])]),a("div",ga,[e[33]||(e[33]=a("label",{class:"text-sm font-semibold text-gray-700 whitespace-nowrap"},"Fardos:",-1)),_e(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>O.fardos=t),type:"number",min:"1",max:"99",class:"w-12 border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm p-2 border text-center",placeholder:"0"},null,512),[[Rt,O.fardos,void 0,{number:!0}]])]),a("div",xa,[a("div",ba,[e[35]||(e[35]=a("span",{class:"text-sm font-semibold text-gray-600 text-center"},"Algoritmo de armado de Mezclas",-1)),a("div",ya,[a("button",{onClick:e[3]||(e[3]=t=>{Z.value="standard",ce("standard")}),onMouseenter:e[4]||(e[4]=t=>ce("standard")),onMouseleave:Re,onFocus:e[5]||(e[5]=t=>ce("standard")),onBlur:Re,class:k(["px-3 py-1 rounded-md text-xs font-semibold transition-all duration-150 whitespace-nowrap",Z.value==="standard"?"bg-slate-700 text-white shadow-sm":"text-gray-500 hover:text-gray-700"])},"Estándar",34),a("button",{onClick:e[6]||(e[6]=t=>{Z.value="stability",ce("stability")}),onMouseenter:e[7]||(e[7]=t=>ce("stability")),onMouseleave:Re,onFocus:e[8]||(e[8]=t=>ce("stability")),onBlur:Re,class:k(["px-3 py-1 rounded-md text-xs font-semibold transition-all duration-150 whitespace-nowrap",Z.value==="stability"?"bg-blue-600 text-white shadow-sm":"text-gray-500 hover:text-gray-700"])},"Golden Batch",34),a("button",{onClick:e[9]||(e[9]=t=>{Z.value="stability-strict",ce("stability-strict")}),onMouseenter:e[10]||(e[10]=t=>ce("stability-strict")),onMouseleave:Re,onFocus:e[11]||(e[11]=t=>ce("stability-strict")),onBlur:Re,class:k(["px-3 py-1 rounded-md text-xs font-semibold transition-all duration-150 whitespace-nowrap",Z.value==="stability-strict"?"bg-indigo-600 text-white shadow-sm":"text-gray-500 hover:text-gray-700"])},"GB + Norma",34)]),ut.value&&Ee.value?(n(),i("div",fa,[a("div",va,[a("h5",ha,m(Ee.value.title),1),a("span",{class:k([Ee.value.badgeClass,"rounded-full px-2 py-0.5 text-[10px] font-semibold"])},m(Ee.value.badge),3)]),a("p",ka,m(Ee.value.description),1),a("div",Ma,[e[34]||(e[34]=a("p",{class:"text-[11px] font-semibold text-slate-700"},"Ejemplo práctico",-1)),a("p",Ca,m(Ee.value.example),1)])])):R("",!0)]),a("div",{class:"relative",onMouseenter:e[13]||(e[13]=t=>je.value=!0),onMouseleave:e[14]||(e[14]=t=>je.value=!1)},[a("button",{type:"button",class:"inline-flex h-5 w-5 items-center justify-center rounded-full border border-teal-200 bg-teal-50 text-teal-700 hover:bg-teal-100 transition-colors","aria-label":"Información de algoritmos",onClick:e[12]||(e[12]=ta(t=>je.value=!je.value,["stop"]))},[...e[36]||(e[36]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])]),je.value?(n(),i("div",Sa,[...e[37]||(e[37]=[ts('<div class="mb-3 border-b border-teal-400/60 pb-2" data-v-f1c48e98><h4 class="text-sm font-bold text-teal-700" data-v-f1c48e98>Algoritmos de Mezcla</h4><p class="mt-1 text-xs text-slate-600" data-v-f1c48e98>Define cómo se arma cada receta de fardos.</p></div><div class="space-y-2.5 text-xs" data-v-f1c48e98><div class="rounded-md border-l-4 border-slate-400 bg-slate-50 p-2.5" data-v-f1c48e98><p class="font-semibold text-slate-800" data-v-f1c48e98>Estándar (Round Robin)</p><p class="mt-1 text-slate-600" data-v-f1c48e98>Consumo secuencial y balanceado por turnos. Prioriza completar la mezcla respetando límites activos.</p></div><div class="rounded-md border-l-4 border-blue-500 bg-blue-50 p-2.5" data-v-f1c48e98><p class="font-semibold text-blue-900" data-v-f1c48e98>Golden Batch</p><p class="mt-1 text-blue-800" data-v-f1c48e98>Maximiza bloques idénticos (N alto) con distribución proporcional del stock. La tolerancia se muestra como referencia.</p></div><div class="rounded-md border-l-4 border-indigo-500 bg-indigo-50 p-2.5" data-v-f1c48e98><p class="font-semibold text-indigo-900" data-v-f1c48e98>GB + Norma</p><p class="mt-1 text-indigo-800" data-v-f1c48e98>Aplica Golden Batch y además hace cumplir el cupo de tolerancia. Puede reducir N para cumplir norma.</p></div></div>',2)])])):R("",!0)],32)])]),a("div",Na,[a("button",{onClick:e[15]||(e[15]=t=>K.value=!K.value),class:"flex items-center space-x-2 text-indigo-600 text-sm font-semibold hover:text-indigo-800 transition-colors focus:outline-none"},[...e[38]||(e[38]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})],-1),a("span",null,"Reglas de Mezclas",-1)])]),a("button",{onClick:e[16]||(e[16]=t=>w.value=!w.value),class:"flex items-center space-x-2 text-blue-600 text-sm font-semibold hover:text-blue-800 transition-colors focus:outline-none"},[...e[39]||(e[39]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),a("span",null,"Ver Columnas",-1)])]),a("button",{onClick:qt,class:"flex items-center space-x-2 text-green-600 text-sm font-bold hover:text-green-800 transition-colors focus:outline-none bg-green-50 px-3 py-1.5 rounded-md border border-green-200 shadow-sm"},[...e[40]||(e[40]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1),a("span",null,"Mezclas",-1)])])])]),K.value?(n(),i("div",_a,[e[44]||(e[44]=a("p",{class:"text-xs text-gray-500 mb-2 italic"},"Selecciona los parámetros que deseas visualizar en la tabla.",-1)),a("div",Ta,[(n(),i(C,null,N(be,t=>a("div",{key:t.key,class:"bg-white p-2 rounded shadow-sm border border-gray-200"},[a("div",Fa,[a("div",Ea,[a("input",{type:"checkbox",checked:ds(t.key),onChange:r=>us(t.key,r.target.checked),class:"rounded text-indigo-600 focus:ring-indigo-500 h-4 w-4"},null,40,Ra),a("span",null,m(t.label),1)]),Y(t.key)?(n(),i("span",La," ✓ ")):(n(),i("span",wa," - "))]),a("div",Ba,[a("label",Aa,[a("div",Pa,[_e(a("input",{type:"checkbox","onUpdate:modelValue":r=>A[t.key].target=r,class:"text-green-600 rounded focus:ring-green-500"},null,8,Oa),[[Lt,A[t.key].target]]),e[41]||(e[41]=a("span",{class:"text-gray-600 ml-2"},[he("Promedio Objetivo "),a("span",{class:"w-2 h-2 rounded-full bg-green-200 inline-block ml-1 border border-green-300"})],-1))]),Y(t.key)?(n(),i("span",Ia,m(ye(Y(t.key),"target")),1)):R("",!0)]),a("label",$a,[a("div",za,[_e(a("input",{type:"checkbox","onUpdate:modelValue":r=>A[t.key].hardCap=r,class:"text-red-600 rounded focus:ring-red-500"},null,8,Da),[[Lt,A[t.key].hardCap]]),e[42]||(e[42]=a("span",{class:"text-gray-600 ml-2"},[he("Límites Absolutos "),a("span",{class:"w-2 h-2 rounded-full bg-red-200 inline-block ml-1 border border-red-300"})],-1))]),Y(t.key)?(n(),i("span",Ua,m(ye(Y(t.key),"hardCap")),1)):R("",!0)]),a("label",ja,[a("div",Va,[_e(a("input",{type:"checkbox","onUpdate:modelValue":r=>A[t.key].tolerance=r,class:"text-yellow-500 rounded focus:ring-yellow-400"},null,8,Ga),[[Lt,A[t.key].tolerance]]),e[43]||(e[43]=a("span",{class:"text-gray-600 ml-2"},[he("Rango Tolerancia "),a("span",{class:"w-2 h-2 rounded-full bg-yellow-100 inline-block ml-1 border border-yellow-300"})],-1))]),Y(t.key)?(n(),i("span",qa,m(ye(Y(t.key),"tolerance")),1)):R("",!0)])])])),64))])])):R("",!0),w.value?(n(),i("div",Ha,[(n(),i(C,null,N(ue,t=>a("label",{key:t.key,class:k(["flex items-center space-x-2 text-sm text-gray-700 cursor-pointer hover:bg-gray-100 p-1 rounded",{"opacity-75 cursor-not-allowed":t.locked}])},[a("input",{type:"checkbox",value:t.key,checked:ms(t.key),disabled:t.locked,onChange:r=>ps(t.key),class:"rounded text-blue-600 focus:ring-blue-500"},null,40,Qa),a("span",{class:k({"font-bold":t.locked})},m(t.label),3)],2)),64))])):R("",!0)]),a("div",Wa,[Te.value?(n(),i("div",Ka,[a("div",Za,[e[46]||(e[46]=a("h2",{class:"text-xl font-bold text-gray-800"},"Plan de Mezclas Generado",-1)),a("div",Ya,[a("button",{onClick:zs,class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 font-semibold text-sm transition-colors flex items-center gap-2"},[...e[45]||(e[45]=[a("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2m0 0v-8m0 8H3m15-8h3"})],-1),he(" Exportar a Excel ",-1)])]),a("button",{onClick:e[17]||(e[17]=t=>Te.value=!1),class:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-semibold text-sm transition-colors"}," Volver al Inventario ")])]),te.value?(n(),i("div",{key:0,class:k(["mb-4 rounded-lg px-4 py-3 text-sm",te.value.kind==="error"?"border border-red-300 bg-red-50 text-red-900":"border border-slate-300 bg-slate-50 text-slate-800"])},[a("p",Ja,m(te.value.title),1),a("p",Xa,m(te.value.message),1),(o=te.value.details)!=null&&o.length?(n(),i("ul",er,[(n(!0),i(C,null,N(te.value.details,(t,r)=>(n(),i("li",{key:`blend-msg-${r}`},m(t),1))),128))])):R("",!0)],2)):R("",!0),Fe.value.length||ge.value||xe.value?(n(),i("div",tr,[a("div",sr,[e[49]||(e[49]=a("h3",{class:"text-sm font-bold text-blue-800"},"Reglas aplicadas en este cálculo",-1)),a("div",ar,[ge.value||xe.value?(n(),i("div",rr,[ge.value?(n(),i("span",or,[e[47]||(e[47]=a("span",{class:"font-semibold"},"Algoritmo usado:",-1)),a("span",lr,m(ge.value),1)])):R("",!0),ge.value&&xe.value?(n(),i("span",nr,"|")):R("",!0),xe.value?(n(),i("span",ir,[e[48]||(e[48]=a("span",{class:"font-semibold"},"Ejecutado:",-1)),a("span",dr,m(xe.value),1)])):R("",!0)])):R("",!0)])]),a("div",ur,[(n(!0),i(C,null,N(Fe.value,(t,r)=>(n(),i("div",{key:`${t.parametro}-${r}`,class:"bg-white border border-blue-100 rounded px-2 py-1.5 text-xs"},[a("div",cr,[a("span",mr,m(t.parametro)+":",1),a("span",pr,m(t.detalle),1)])]))),128))])])):R("",!0),De.value?(n(),i("div",gr," Calculando optimización... ")):x.value?(n(),i("div",xr,[a("div",br,[e[96]||(e[96]=ts('<div class="flex flex-wrap items-center gap-3 px-4 py-2 bg-slate-50 border-b border-slate-200 text-xs" data-v-f1c48e98><span class="font-semibold text-slate-700" data-v-f1c48e98>Leyenda:</span><span class="inline-flex items-center gap-1.5 text-slate-700" data-v-f1c48e98><span class="w-3 h-3 rounded bg-green-100 border border-green-300" data-v-f1c48e98></span> Objetivo </span><span class="inline-flex items-center gap-1.5 text-slate-700" data-v-f1c48e98><span class="w-3 h-3 rounded bg-yellow-50 border border-yellow-300" data-v-f1c48e98></span> Tolerancia </span><span class="inline-flex items-center gap-1.5 text-slate-700" data-v-f1c48e98><span class="w-3 h-3 rounded bg-red-100 border border-red-300" data-v-f1c48e98></span> Fuera de regla </span><span class="inline-flex items-center gap-1.5 text-slate-700" data-v-f1c48e98><span class="w-3 h-3 rounded bg-emerald-100 border border-emerald-300" data-v-f1c48e98></span> Motivo: Sobrante 0 = se usó todo en el plan </span></div>',1)),a("table",yr,[a("thead",fr,[a("tr",null,[a("th",vr,[a("button",{type:"button",class:"inline-flex items-center gap-1",onClick:e[18]||(e[18]=t=>ae("PRODUTOR"))},[e[50]||(e[50]=a("span",null,"Productor",-1)),(n(),i("svg",{class:k(["w-3 h-3",F("PRODUTOR")?"text-blue-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[F("PRODUTOR")==="asc"?(n(),i("path",hr)):F("PRODUTOR")==="desc"?(n(),i("path",kr)):(n(),i("path",Mr))],2))])]),a("th",Cr,[a("button",{type:"button",class:"inline-flex items-center gap-1",onClick:e[19]||(e[19]=t=>ae("LOTE"))},[e[51]||(e[51]=a("span",null,"Lote",-1)),(n(),i("svg",{class:k(["w-3 h-3",F("LOTE")?"text-blue-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[F("LOTE")==="asc"?(n(),i("path",Sr)):F("LOTE")==="desc"?(n(),i("path",Nr)):(n(),i("path",_r))],2))])]),e[60]||(e[60]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado",-1)),a("th",Tr,[a("button",{type:"button",class:"inline-flex items-center gap-1",onClick:e[20]||(e[20]=t=>ae("Stock"))},[e[52]||(e[52]=a("span",null,"Stock",-1)),(n(),i("svg",{class:k(["w-3 h-3",F("Stock")?"text-blue-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[F("Stock")==="asc"?(n(),i("path",Fr)):F("Stock")==="desc"?(n(),i("path",Er)):(n(),i("path",Rr))],2))])]),a("th",Lr,[a("button",{type:"button",class:"inline-flex items-center gap-1",onClick:e[21]||(e[21]=t=>ae("Usados"))},[e[53]||(e[53]=a("span",null,"Usados",-1)),(n(),i("svg",{class:k(["w-3 h-3",F("Usados")?"text-blue-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[F("Usados")==="asc"?(n(),i("path",wr)):F("Usados")==="desc"?(n(),i("path",Br)):(n(),i("path",Ar))],2))])]),a("th",Pr,[a("button",{type:"button",class:"inline-flex items-center gap-1",onClick:e[22]||(e[22]=t=>ae("Sobrante"))},[e[54]||(e[54]=a("span",null,"Sobrante",-1)),(n(),i("svg",{class:k(["w-3 h-3",F("Sobrante")?"text-blue-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[F("Sobrante")==="asc"?(n(),i("path",Or)):F("Sobrante")==="desc"?(n(),i("path",Ir)):(n(),i("path",$r))],2))])]),a("th",zr,[a("button",{type:"button",class:"inline-flex items-center gap-1",onClick:e[23]||(e[23]=t=>ae("MotivoLogistico"))},[e[55]||(e[55]=a("span",null,"Motivo Sobrante",-1)),(n(),i("svg",{class:k(["w-3 h-3",F("MotivoLogistico")?"text-blue-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[F("MotivoLogistico")==="asc"?(n(),i("path",Dr)):F("MotivoLogistico")==="desc"?(n(),i("path",Ur)):(n(),i("path",jr))],2))])]),a("th",Vr,[a("button",{type:"button",class:"inline-flex items-center gap-1",onClick:e[24]||(e[24]=t=>ae("MIC"))},[e[56]||(e[56]=a("span",null,"MIC",-1)),(n(),i("svg",{class:k(["w-3 h-3",F("MIC")?"text-blue-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[F("MIC")==="asc"?(n(),i("path",Gr)):F("MIC")==="desc"?(n(),i("path",qr)):(n(),i("path",Hr))],2))])]),a("th",Qr,[a("button",{type:"button",class:"inline-flex items-center gap-1",onClick:e[25]||(e[25]=t=>ae("STR"))},[e[57]||(e[57]=a("span",null,"STR",-1)),(n(),i("svg",{class:k(["w-3 h-3",F("STR")?"text-blue-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[F("STR")==="asc"?(n(),i("path",Wr)):F("STR")==="desc"?(n(),i("path",Kr)):(n(),i("path",Zr))],2))])]),a("th",Yr,[a("button",{type:"button",class:"inline-flex items-center gap-1",onClick:e[26]||(e[26]=t=>ae("LEN"))},[e[58]||(e[58]=a("span",null,"LEN",-1)),(n(),i("svg",{class:k(["w-3 h-3",F("LEN")?"text-blue-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[F("LEN")==="asc"?(n(),i("path",Jr)):F("LEN")==="desc"?(n(),i("path",Xr)):(n(),i("path",eo))],2))])]),(n(!0),i(C,null,N(x.value.columnasMezcla,(t,r)=>(n(),i(C,{key:`mix-head-${t}`},[a("th",to,[a("button",{type:"button",class:"inline-flex items-center gap-1",onClick:l=>ae(`MEZCLA::${t}`)},[a("span",null,m(t),1),(n(),i("svg",{class:k(["w-3 h-3",F(`MEZCLA::${t}`)?"text-blue-600":"text-indigo-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[F(`MEZCLA::${t}`)==="asc"?(n(),i("path",ao)):F(`MEZCLA::${t}`)==="desc"?(n(),i("path",ro)):(n(),i("path",oo))],2))],8,so)]),e[59]||(e[59]=a("th",{class:"px-4 py-3 text-center text-xs font-bold text-teal-700 uppercase tracking-wider border-l border-gray-300 bg-teal-50"}," Saldo ",-1))],64))),128))])]),a("tbody",lo,[(n(!0),i(C,null,N(It.value,(t,r)=>(n(),i("tr",{key:r,class:"hover:bg-gray-50"},[a("td",no,m(t.PRODUTOR),1),a("td",io,m(t.LOTE),1),a("td",uo,[a("span",{class:k([t.Estado==="USO"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800","px-2 py-1 rounded text-xs font-bold"])},m(t.Estado),3)]),a("td",co,m(t.Stock??"-"),1),a("td",mo,m(t.Usados??"-"),1),a("td",po,m(t.Sobrante??"-"),1),a("td",go,[Number(t.Sobrante)===0?(n(),i("span",xo,m(Be(t)),1)):t.Estado==="TOLER."?(n(),i("span",bo,m(Be(t)),1)):(n(),i("span",yo,m(Be(t)),1))]),a("td",{class:k(["px-4 py-2 text-sm",se(t,"MIC")])},m(I(t.MIC,"MIC")),3),a("td",{class:k(["px-4 py-2 text-sm",se(t,"STR")])},m(I(t.STR,"STR")),3),a("td",{class:k(["px-4 py-2 text-sm",se(t,"UHML")])},m(I(t.LEN,"UHML")),3),(n(!0),i(C,null,N(x.value.columnasMezcla,(l,p)=>(n(),i(C,{key:`mix-row-${r}-${l}`},[a("td",{class:k(["px-4 py-2 text-sm text-center font-bold border-l border-gray-200",t.mezclas[l]?"text-indigo-600 bg-indigo-50/30":"text-gray-300"])},m(t.mezclas[l]||"-"),3),a("td",fo,m(bt(t,p)),1)],64))),128))]))),128))]),a("tfoot",vo,[a("tr",ho,[e[61]||(e[61]=a("td",{colspan:"3",class:"px-4 py-2 text-sm font-bold text-right text-gray-700 border-b border-gray-300"},"TOTALES LOTES",-1)),a("td",ko,m(W(yt.value.stock)),1),a("td",Mo,m(W(yt.value.usados)),1),a("td",Co,m(W(yt.value.sobrante)),1),e[62]||(e[62]=a("td",{class:"px-4 py-2 text-sm text-center text-gray-400 border-b border-gray-300"},"—",-1)),e[63]||(e[63]=a("td",{rowspan:"4",class:"summary-matrix-cell px-4 py-2 text-sm font-bold text-center text-gray-800"},"Mezcla",-1)),e[64]||(e[64]=a("td",{rowspan:"2",class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Cantidad",-1)),e[65]||(e[65]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Fardos",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>(n(),i("td",{key:"mix-fardos-"+t,class:"summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center font-bold text-gray-900",colspan:2},m(x.value.estadisticas[t].totalFardos),1))),128))]),a("tr",So,[a("td",No,[Ot.value.length?(n(),i("div",_o,[e[67]||(e[67]=a("div",{class:"px-3 py-2 bg-slate-50 border-b border-slate-300"},[a("h3",{class:"text-sm font-bold text-slate-800"},"Resumen de lotes (promedios de variables activas)")],-1)),a("table",To,[a("thead",Fo,[a("tr",Eo,[e[66]||(e[66]=a("th",{class:"px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wide"},"Variable",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>(n(),i("th",{key:`res-inline-${t}`,class:"px-3 py-2 text-center text-xs font-semibold text-indigo-700 uppercase tracking-wide border-l border-gray-200"},m(t),1))),128))])]),a("tbody",Ro,[(n(!0),i(C,null,N(Ot.value,t=>(n(),i("tr",{key:`res-inline-row-${t.uiKey}`},[a("td",Lo,m(t.label),1),(n(!0),i(C,null,N(x.value.columnasMezcla,r=>{var l,p,u,y;return n(),i("td",{key:`res-inline-${t.uiKey}-${r}`,class:k(["px-3 py-2 text-sm text-center border-l border-gray-200",q((p=(l=x.value.estadisticas[r].variables)==null?void 0:l[t.ruleParam])==null?void 0:p.promedioGeneral,t.uiKey)])},m(I((y=(u=x.value.estadisticas[r].variables)==null?void 0:u[t.ruleParam])==null?void 0:y.promedioGeneral,t.formatKey)),3)}),128))]))),128))])])])):R("",!0)]),e[68]||(e[68]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Bloques",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>(n(),i("td",{key:"mix-bloques-"+t,class:"summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center font-bold text-gray-900",colspan:2},m(Ge(t)),1))),128))]),a("tr",wo,[e[69]||(e[69]=a("td",{rowspan:"2",class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Peso",-1)),e[70]||(e[70]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Por Mezcla",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>(n(),i("td",{key:"mix-pmezcla-"+t,class:"summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center font-bold text-gray-900",colspan:2},m(I(xt(t),"PESO")),1))),128))]),a("tr",Bo,[e[71]||(e[71]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Por Bloque",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>(n(),i("td",{key:"mix-pbloque-"+t,class:"summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center font-bold text-gray-900",colspan:2},m(I(Pt(t),"PESO")),1))),128))]),a("tr",Ao,[e[72]||(e[72]=a("td",{rowspan:"5",class:"summary-matrix-cell px-4 py-2 text-sm font-bold text-center text-gray-800"},"MIC",-1)),e[73]||(e[73]=a("td",{rowspan:"3",class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Promedio",-1)),e[74]||(e[74]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Bloque",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"mic-bloque-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.MIC)==null?void 0:r.promedioGeneral,"MIC")]),colspan:2},m(I((l=x.value.estadisticas[t].variables.MIC)==null?void 0:l.promedioGeneral,"MIC")),3)}),128))]),a("tr",Po,[e[75]||(e[75]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"90%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"mic-90-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.MIC)==null?void 0:r.promedioIdeal,"MIC")]),colspan:2},m(I((l=x.value.estadisticas[t].variables.MIC)==null?void 0:l.promedioIdeal,"MIC")),3)}),128))]),a("tr",Oo,[e[76]||(e[76]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"10%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"mic-10-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.MIC)==null?void 0:r.promedioTolerancia,"MIC")]),colspan:2},m(I((l=x.value.estadisticas[t].variables.MIC)==null?void 0:l.promedioTolerancia,"MIC")),3)}),128))]),a("tr",Io,[e[77]||(e[77]=a("td",{rowspan:"2",class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Porcentual",-1)),e[78]||(e[78]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"90%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"mic-pct-90-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.MIC)==null?void 0:r.pctIdeal,"MIC","pctIdeal")]),colspan:2},m(((l=x.value.estadisticas[t].variables.MIC)==null?void 0:l.pctIdeal)!==void 0?`${x.value.estadisticas[t].variables.MIC.pctIdeal.toFixed(1)}%`:"-"),3)}),128))]),a("tr",$o,[e[79]||(e[79]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"10%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"mic-pct-10-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.MIC)==null?void 0:r.pctTolerancia,"MIC","pctTolerancia")]),colspan:2},m(((l=x.value.estadisticas[t].variables.MIC)==null?void 0:l.pctTolerancia)!==void 0?`${x.value.estadisticas[t].variables.MIC.pctTolerancia.toFixed(1)}%`:"-"),3)}),128))]),a("tr",zo,[e[80]||(e[80]=a("td",{rowspan:"5",class:"summary-matrix-cell px-4 py-2 text-sm font-bold text-center text-gray-800"},"STR",-1)),e[81]||(e[81]=a("td",{rowspan:"3",class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Promedio",-1)),e[82]||(e[82]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Bloque",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"str-bloque-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.STR)==null?void 0:r.promedioGeneral,"STR")]),colspan:2},m(I((l=x.value.estadisticas[t].variables.STR)==null?void 0:l.promedioGeneral,"STR")),3)}),128))]),a("tr",Do,[e[83]||(e[83]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"80%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"str-80-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.STR)==null?void 0:r.promedioIdeal,"STR")]),colspan:2},m(I((l=x.value.estadisticas[t].variables.STR)==null?void 0:l.promedioIdeal,"STR")),3)}),128))]),a("tr",Uo,[e[84]||(e[84]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"20%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"str-20-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.STR)==null?void 0:r.promedioTolerancia,"STR")]),colspan:2},m(I((l=x.value.estadisticas[t].variables.STR)==null?void 0:l.promedioTolerancia,"STR")),3)}),128))]),a("tr",jo,[e[85]||(e[85]=a("td",{rowspan:"2",class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Porcentual",-1)),e[86]||(e[86]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"80%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"str-pct-80-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.STR)==null?void 0:r.pctIdeal,"STR","pctIdeal")]),colspan:2},m(((l=x.value.estadisticas[t].variables.STR)==null?void 0:l.pctIdeal)!==void 0?`${x.value.estadisticas[t].variables.STR.pctIdeal.toFixed(1)}%`:"-"),3)}),128))]),a("tr",Vo,[e[87]||(e[87]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"20%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"str-pct-20-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.STR)==null?void 0:r.pctTolerancia,"STR","pctTolerancia")]),colspan:2},m(((l=x.value.estadisticas[t].variables.STR)==null?void 0:l.pctTolerancia)!==void 0?`${x.value.estadisticas[t].variables.STR.pctTolerancia.toFixed(1)}%`:"-"),3)}),128))]),a("tr",Go,[e[88]||(e[88]=a("td",{rowspan:"5",class:"summary-matrix-cell px-4 py-2 text-sm font-bold text-center text-gray-800"},"LEN",-1)),e[89]||(e[89]=a("td",{rowspan:"3",class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Promedio",-1)),e[90]||(e[90]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Bloque",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"len-bloque-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.LEN)==null?void 0:r.promedioGeneral,"UHML")]),colspan:2},m(I((l=x.value.estadisticas[t].variables.LEN)==null?void 0:l.promedioGeneral,"UHML")),3)}),128))]),a("tr",qo,[e[91]||(e[91]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"80%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"len-80-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.LEN)==null?void 0:r.promedioIdeal,"UHML")]),colspan:2},m(I((l=x.value.estadisticas[t].variables.LEN)==null?void 0:l.promedioIdeal,"UHML")),3)}),128))]),a("tr",Ho,[e[92]||(e[92]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"20%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"len-20-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.LEN)==null?void 0:r.promedioTolerancia,"UHML")]),colspan:2},m(I((l=x.value.estadisticas[t].variables.LEN)==null?void 0:l.promedioTolerancia,"UHML")),3)}),128))]),a("tr",Qo,[e[93]||(e[93]=a("td",{rowspan:"2",class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"Porcentual",-1)),e[94]||(e[94]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"80%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"len-pct-80-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.LEN)==null?void 0:r.pctIdeal,"UHML","pctIdeal")]),colspan:2},m(((l=x.value.estadisticas[t].variables.LEN)==null?void 0:l.pctIdeal)!==void 0?`${x.value.estadisticas[t].variables.LEN.pctIdeal.toFixed(1)}%`:"-"),3)}),128))]),a("tr",Wo,[e[95]||(e[95]=a("td",{class:"summary-matrix-cell px-4 py-2 text-sm font-semibold text-center text-gray-700"},"20%",-1)),(n(!0),i(C,null,N(x.value.columnasMezcla,t=>{var r,l;return n(),i("td",{key:"len-pct-20-"+t,class:k(["summary-matrix-cell summary-matrix-value px-4 py-2 text-sm text-center",q((r=x.value.estadisticas[t].variables.LEN)==null?void 0:r.pctTolerancia,"UHML","pctTolerancia")]),colspan:2},m(((l=x.value.estadisticas[t].variables.LEN)==null?void 0:l.pctTolerancia)!==void 0?`${x.value.estadisticas[t].variables.LEN.pctTolerancia.toFixed(1)}%`:"-"),3)}),128))])])])]),a("h3",Ko,m(Ss.value),1),a("div",Zo,[a("table",Yo,[a("thead",Jo,[a("tr",null,[e[97]||(e[97]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-red-800 uppercase tracking-wider"},"Productor",-1)),e[98]||(e[98]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-red-800 uppercase tracking-wider"},"Lote",-1)),e[99]||(e[99]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-red-800 uppercase tracking-wider"},"Fardos",-1)),Me.value?(n(),i("th",Xo,"Kilogramos")):R("",!0),Me.value?(n(),i("th",el,"Peso Medio")):R("",!0),e[100]||(e[100]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-red-800 uppercase tracking-wider"},"MIC",-1)),e[101]||(e[101]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-red-800 uppercase tracking-wider"},"STR",-1)),e[102]||(e[102]=a("th",{class:"px-4 py-3 text-left text-xs font-medium text-red-800 uppercase tracking-wider"},"LEN",-1)),a("th",tl,m(Ns.value),1)])]),a("tbody",sl,[et.value.length===0?(n(),i("tr",al,[a("td",{colspan:Cs.value,class:"px-4 py-4 text-center text-gray-500 italic"},m(_s.value),9,rl)])):(n(!0),i(C,{key:1},N(et.value,(t,r)=>(n(),i("tr",{key:`projection-source-${r}`,class:"hover:bg-red-50/50"},[a("td",ol,m(t.PRODUTOR),1),a("td",ll,m(t.LOTE),1),a("td",nl,m(t.Fardos),1),Me.value?(n(),i("td",il,m(W(t.Kilogramos)),1)):R("",!0),Me.value?(n(),i("td",dl,m(U(t.PesoMedio,2)),1)):R("",!0),a("td",{class:k(["px-4 py-2 text-sm",se(t,"MIC")])},m(I(t.MIC,"MIC")),3),a("td",{class:k(["px-4 py-2 text-sm",se(t,"STR")])},m(I(t.STR,"STR")),3),a("td",{class:k(["px-4 py-2 text-sm",se(t,"UHML")])},m(I(t.LEN,"UHML")),3),a("td",ul,m(t.Motivo),1)]))),128))]),et.value.length>0?(n(),i("tfoot",cl,[a("tr",null,[e[103]||(e[103]=a("td",{colspan:"2",class:"px-4 py-2 text-sm font-bold text-gray-800"},"Totales",-1)),a("td",ml,m(W(Ae.value.fardos)),1),Me.value?(n(),i("td",pl,m(W(Ae.value.kilogramos)),1)):R("",!0),Me.value?(n(),i("td",gl,m(U(Ae.value.pesoMedio,2)),1)):R("",!0),a("td",xl,m(U(Ae.value.mic,2)),1),a("td",bl,m(U(Ae.value.str,2)),1),a("td",yl,m(U(Ae.value.len,2)),1),e[104]||(e[104]=a("td",{class:"px-4 py-2 text-sm text-gray-400"},"—",-1))])])):R("",!0)])]),e[115]||(e[115]=a("h3",{class:"text-lg font-bold text-gray-800 mb-3 mt-8 border-t pt-6"},"Proyección de Compra por Calidad",-1)),a("div",fl,[a("div",vl,[a("div",null,[e[105]||(e[105]=a("label",{class:"block text-xs font-semibold text-gray-700 mb-1"},"Mezclas objetivo",-1)),_e(a("input",{"onUpdate:modelValue":e[27]||(e[27]=t=>T.targetMixes=t),type:"number",min:"1",class:"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm p-2 border"},null,512),[[Rt,T.targetMixes,void 0,{number:!0}]]),T.targetMixes<T.minMixesForBlock?(n(),i("p",hl," Recomendado para bloque: mínimo "+m(T.minMixesForBlock)+" mezclas. ",1)):R("",!0)]),a("div",null,[e[107]||(e[107]=a("label",{class:"block text-xs font-semibold text-gray-700 mb-1"},"Fuente disponible",-1)),_e(a("select",{"onUpdate:modelValue":e[28]||(e[28]=t=>T.source=t),class:"w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-sm p-2 border"},[...e[106]||(e[106]=[a("option",{value:"stock"},"Stock actual",-1),a("option",{value:"remanente"},"Sobrante no usado",-1)])],512),[[sa,T.source]])]),a("div",kl,[e[108]||(e[108]=a("p",{class:"text-[11px] text-gray-500 uppercase tracking-wide"},"Fardos por mezcla",-1)),a("p",Ml,m(W(O.fardos||0)),1)]),T.source!=="stock"?(n(),i("div",Cl,[e[109]||(e[109]=a("p",{class:"text-[11px] text-gray-500 uppercase tracking-wide"},"Mezclas base generadas",-1)),a("p",Sl,m(W(st.value)),1)])):R("",!0),a("div",Nl,[e[110]||(e[110]=a("p",{class:"text-[11px] text-gray-500 uppercase tracking-wide"},"Stock total fuente",-1)),a("p",_l,m(W(at.value.stockFardos)),1)]),a("div",Tl,[e[111]||(e[111]=a("p",{class:"text-[11px] text-gray-500 uppercase tracking-wide"},"Peso total fuente (kg)",-1)),a("p",Fl,m(W(at.value.stockPeso)),1)])]),qe.value?(n(),i("div",El,m(qe.value),1)):R("",!0),rt.value.length?(n(),i("div",Rl,[a("table",Ll,[e[112]||(e[112]=a("thead",{class:"bg-emerald-100/60"},[a("tr",null,[a("th",{class:"px-3 py-2 text-left text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Variable"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Disponible"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Faltante"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Total Fardos"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Peso Medio Fardo"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Peso Total"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Fardos x Mezcla"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Tamaño Bloque"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Promedio actual"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Objetivo"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"A Comprar"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Promedio Final"),a("th",{class:"px-3 py-2 text-right text-xs font-semibold text-emerald-900 uppercase tracking-wide"},"Kg compra global")])],-1)),a("tbody",wl,[(n(!0),i(C,null,N(rt.value,t=>(n(),i("tr",{key:`var-buy-${t.uiKey}`,class:"hover:bg-emerald-50/30"},[a("td",Bl,m(t.label),1),a("td",Al,m(U(t.disponibleFardos,0)),1),a("td",Pl,m(U(t.faltanteFardos,0)),1),a("td",Ol,m(U(t.totalFardos,0)),1),a("td",Il,m(U(t.pesoMedioFardo,0)),1),a("td",$l,m(W(t.pesoTotalKg)),1),a("td",zl,m(U(t.fardosPorMezcla,0)),1),a("td",Dl,m(U(t.tamanoBloque,0)),1),a("td",Ul,m(U(t.promedioActual,2)),1),a("td",jl,[t.objetivoComparador&&t.objetivoValor!==null?(n(),i("span",Vl,m(t.objetivoComparador)+" "+m(U(t.objetivoValor,2)),1)):(n(),i("span",Gl,"-"))]),a("td",ql,[t.comprarComparador&&t.comprarValor!==null?(n(),i("span",Hl,m(t.comprarComparador)+" "+m(U(t.comprarValor,2)),1)):(n(),i("span",Ql,"-"))]),a("td",Wl,m(t.promedioFinal!==null?U(t.promedioFinal,2):"-"),1),a("td",Kl,m(W(t.totalKgToBuy)),1)]))),128))])])])):qe.value?R("",!0):(n(),i("div",Zl," No hay datos suficientes para mostrar el resumen global por variable. ")),a("div",Yl,[e[113]||(e[113]=a("span",{class:"font-semibold"},"Guía de calidad:",-1)),e[114]||(e[114]=he(" La recomendación HVI se calcula en función de las variables activadas en “Reglas de Mezclas” y de la fuente seleccionada (stock o remanente). ",-1)),Ct.value.length?(n(),i("div",Jl,[(n(!0),i(C,null,N(Ct.value,t=>(n(),i("p",{key:`global-hvi-${t.uiKey}`},[a("span",Xl,m(t.label)+":",1),he(" base "+m(U(t.sourceAverage,2))+" · "+m(Gt(t))+" · Kg compra global: "+m(W(t.totalKgToBuy)),1)]))),128))])):(n(),i(C,{key:1},[he(" Selecciona al menos una variable (Target/Tolerancia/Límites) para generar orientación de calidad. ")],64))])])])):R("",!0)])):(n(),i("div",en,[a("table",tn,[a("thead",sn,[a("tr",null,[(n(!0),i(C,null,N(Ve.value,t=>(n(),i("th",{key:t.key,class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider whitespace-nowrap"},[At(t.key)?(n(),i("button",{key:0,type:"button",class:"inline-flex items-center gap-1",onClick:r=>hs(t.key)},[a("span",null,m(t.label),1),(n(),i("svg",{class:k(["w-3 h-3",pt(t.key)?"text-blue-600":"text-gray-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[pt(t.key)==="asc"?(n(),i("path",rn)):pt(t.key)==="desc"?(n(),i("path",on)):(n(),i("path",ln))],2))],8,an)):(n(),i("span",nn,m(t.label),1))]))),128))])]),a("tbody",dn,[mt.value?(n(),i("tr",un,[a("td",{colspan:Ve.value.length,class:"px-6 py-4 text-center text-blue-500 font-medium"}," Cargando inventario... ",8,cn)])):ot.value.length===0?(n(),i("tr",mn,[a("td",{colspan:Ve.value.length,class:"px-6 py-4 text-center text-gray-500 italic"}," No se encontraron resultados ("+m(Ye.value.length>0?"ajusta los filtros":"Base de datos vacía o sin conexión")+"). ",9,pn)])):(n(!0),i(C,{key:2},N(ot.value,(t,r)=>(n(),i("tr",{key:r,class:"hover:bg-gray-50 transition-colors"},[(n(!0),i(C,null,N(Ve.value,l=>(n(),i("td",{key:l.key,class:k(["px-4 py-2 text-sm text-gray-700 whitespace-nowrap",se(t,l.key)])},m(I(t[l.key],l.key)),3))),128))]))),128))]),Oe.value?(n(),i("tfoot",gn,[a("tr",null,[(n(!0),i(C,null,N(Ve.value,t=>(n(),i("td",{key:"sum-"+t.key,class:"px-4 py-3 text-sm text-gray-800 whitespace-nowrap"},[t.key==="PRODUTOR"?(n(),i("span",xn,"Totales / Promedios")):t.key==="PESO"||t.key==="QTDE_ESTOQUE"?(n(),i("span",bn,m(I(Oe.value[t.key],t.key)),1)):Oe.value[t.key]!==void 0?(n(),i("span",yn,m(I(Oe.value[t.key],t.key)),1)):(n(),i("span",fn,"-"))]))),128))])])):R("",!0)])]))]),a("div",vn," Mostrando "+m(ot.value.length)+" registros ",1)])}}},Sn=Js(hn,[["__scopeId","data-v-f1c48e98"]]);export{Sn as default};
