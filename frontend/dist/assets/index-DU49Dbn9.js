function he(e,t){return e[13]=1,e[14]=t>>8,e[15]=t&255,e[16]=t>>8,e[17]=t&255,e}const J=112,Q=72,Z=89,ee=115;let L;function we(){const e=new Int32Array(256);for(let t=0;t<256;t++){let r=t;for(let n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e}function pe(e){let t=-1;L||(L=we());for(let r=0;r<e.length;r++)t=L[(t^e[r])&255]^t>>>8;return t^-1}function ye(e){const t=e.length-1;for(let r=t;r>=4;r--)if(e[r-4]===9&&e[r-3]===J&&e[r-2]===Q&&e[r-1]===Z&&e[r]===ee)return r-3;return 0}function be(e,t,r=!1){const n=new Uint8Array(13);t*=39.3701,n[0]=J,n[1]=Q,n[2]=Z,n[3]=ee,n[4]=t>>>24,n[5]=t>>>16,n[6]=t>>>8,n[7]=t&255,n[8]=n[4],n[9]=n[5],n[10]=n[6],n[11]=n[7],n[12]=1;const i=pe(n),o=new Uint8Array(4);if(o[0]=i>>>24,o[1]=i>>>16,o[2]=i>>>8,o[3]=i&255,r){const a=ye(e);return e.set(n,a),e.set(o,a+13),e}else{const a=new Uint8Array(4);a[0]=0,a[1]=0,a[2]=0,a[3]=9;const s=new Uint8Array(54);return s.set(e,0),s.set(a,33),s.set(n,37),s.set(o,50),s}}const Se="AAlwSFlz",Ee="AAAJcEhZ",Ce="AAAACXBI";function ve(e){let t=e.indexOf(Se);return t===-1&&(t=e.indexOf(Ee)),t===-1&&(t=e.indexOf(Ce)),t}const te="[modern-screenshot]",A=typeof window<"u",Ae=A&&"Worker"in window,Te=A&&"atob"in window,Ne=A&&"btoa"in window;var K;const O=A?(K=window.navigator)==null?void 0:K.userAgent:"",re=O.includes("Chrome"),D=O.includes("AppleWebKit")&&!re,q=O.includes("Firefox"),Re=e=>e&&"__CONTEXT__"in e,Ie=e=>e.constructor.name==="CSSFontFaceRule",ke=e=>e.constructor.name==="CSSImportRule",Pe=e=>e.constructor.name==="CSSLayerBlockRule",v=e=>e.nodeType===1,P=e=>typeof e.className=="object",ne=e=>e.tagName==="image",_e=e=>e.tagName==="use",R=e=>v(e)&&typeof e.style<"u"&&!P(e),De=e=>e.nodeType===8,Fe=e=>e.nodeType===3,N=e=>e.tagName==="IMG",F=e=>e.tagName==="VIDEO",Ue=e=>e.tagName==="CANVAS",$e=e=>e.tagName==="TEXTAREA",xe=e=>e.tagName==="INPUT",Le=e=>e.tagName==="STYLE",Be=e=>e.tagName==="SCRIPT",Me=e=>e.tagName==="SELECT",Oe=e=>e.tagName==="SLOT",qe=e=>e.tagName==="IFRAME",We=(...e)=>console.warn(te,...e);function je(e){var r;const t=(r=e==null?void 0:e.createElement)==null?void 0:r.call(e,"canvas");return t&&(t.height=t.width=1),!!t&&"toDataURL"in t&&!!t.toDataURL("image/webp").includes("image/webp")}const B=e=>e.startsWith("data:");function se(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(A&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!A)return e;const r=U().implementation.createHTMLDocument(),n=r.createElement("base"),i=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(i),t&&(n.href=t),i.href=e,i.href}function U(e){return(e&&v(e)?e==null?void 0:e.ownerDocument:e)??window.document}const $="http://www.w3.org/2000/svg";function Ve(e,t,r){const n=U(r).createElementNS($,"svg");return n.setAttributeNS(null,"width",e.toString()),n.setAttributeNS(null,"height",t.toString()),n.setAttributeNS(null,"viewBox",`0 0 ${e} ${t}`),n}function He(e,t){let r=new XMLSerializer().serializeToString(e);return t&&(r=r.replace(/[\u0000-\u0008\v\f\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/gu,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(r)}`}function ze(e,t){return new Promise((r,n)=>{const i=new FileReader;i.onload=()=>r(i.result),i.onerror=()=>n(i.error),i.onabort=()=>n(new Error(`Failed read blob to ${t}`)),i.readAsDataURL(e)})}const Xe=e=>ze(e,"dataUrl");function T(e,t){const r=U(t).createElement("img");return r.decoding="sync",r.loading="eager",r.src=e,r}function I(e,t){return new Promise(r=>{const{timeout:n,ownerDocument:i,onError:o,onWarn:a}=t??{},s=typeof e=="string"?T(e,U(i)):e;let c=null,u=null;function l(){r(s),c&&clearTimeout(c),u==null||u()}if(n&&(c=setTimeout(l,n)),F(s)){const f=s.currentSrc||s.src;if(!f)return s.poster?I(s.poster,t).then(r):l();if(s.readyState>=2)return l();const g=l,d=y=>{a==null||a("Failed video load",f,y),o==null||o(y),l()};u=()=>{s.removeEventListener("loadeddata",g),s.removeEventListener("error",d)},s.addEventListener("loadeddata",g,{once:!0}),s.addEventListener("error",d,{once:!0})}else{const f=ne(s)?s.href.baseVal:s.currentSrc||s.src;if(!f)return l();const g=async()=>{if(N(s)&&"decode"in s)try{await s.decode()}catch(y){a==null||a("Failed to decode image, trying to render anyway",s.dataset.originalSrc||f,y)}l()},d=y=>{a==null||a("Failed image load",s.dataset.originalSrc||f,y),l()};if(N(s)&&s.complete)return g();u=()=>{s.removeEventListener("load",g),s.removeEventListener("error",d)},s.addEventListener("load",g,{once:!0}),s.addEventListener("error",d,{once:!0})}})}async function Ge(e,t){R(e)&&(N(e)||F(e)?await I(e,t):await Promise.all(["img","video"].flatMap(r=>Array.from(e.querySelectorAll(r)).map(n=>I(n,t)))))}const oe=function(){let t=0;const r=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${r()}${t}`)}();function ae(e){return e==null?void 0:e.split(",").map(t=>t.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}let V=0;function Ye(e){const t=`${te}[#${V}]`;return V++,{time:r=>e&&console.time(`${t} ${r}`),timeEnd:r=>e&&console.timeEnd(`${t} ${r}`),warn:(...r)=>e&&We(...r)}}function Ke(e){return{cache:e?"no-cache":"force-cache"}}async function x(e,t){return Re(e)?e:Je(e,{...t,autoDestruct:!0})}async function Je(e,t){var d,y;const{scale:r=1,workerUrl:n,workerNumber:i=1}=t||{},o=!!(t!=null&&t.debug),a=(t==null?void 0:t.features)??!0,s=e.ownerDocument??(A?window.document:void 0),c=((d=e.ownerDocument)==null?void 0:d.defaultView)??(A?window:void 0),u=new Map,l={width:0,height:0,quality:1,type:"image/png",scale:r,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:o,fetch:{requestInit:Ke((y=t==null?void 0:t.fetch)==null?void 0:y.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1,...t==null?void 0:t.fetch},fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:i,onCloneEachNode:null,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1,...t,__CONTEXT__:!0,log:Ye(o),node:e,ownerDocument:s,ownerWindow:c,dpi:r===1?null:96*r,svgStyleElement:ie(s),svgDefsElement:s==null?void 0:s.createElementNS($,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...Array.from({length:Ae&&n&&i?i:0})].map(()=>{try{const m=new Worker(n);return m.onmessage=async w=>{var h,E,S,C;const{url:p,result:b}=w.data;b?(E=(h=u.get(p))==null?void 0:h.resolve)==null||E.call(h,b):(C=(S=u.get(p))==null?void 0:S.reject)==null||C.call(S,new Error(`Error receiving message from worker: ${p}`))},m.onmessageerror=w=>{var b,h;const{url:p}=w.data;(h=(b=u.get(p))==null?void 0:b.reject)==null||h.call(b,new Error(`Error receiving message from worker: ${p}`))},m}catch(m){return l.log.warn("Failed to new Worker",m),null}}).filter(Boolean),fontFamilies:new Map,fontCssTexts:new Map,acceptOfImage:`${[je(s)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:u,drawImageCount:0,tasks:[],features:a,isEnable:m=>m==="restoreScrollPosition"?typeof a=="boolean"?!1:a[m]??!1:typeof a=="boolean"?a:a[m]??!0,shadowRoots:[]};l.log.time("wait until load"),await Ge(e,{timeout:l.timeout,onWarn:l.log.warn}),l.log.timeEnd("wait until load");const{width:f,height:g}=Qe(e,l);return l.width=f,l.height=g,l}function ie(e){if(!e)return;const t=e.createElement("style"),r=t.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return t.appendChild(r),t}function Qe(e,t){let{width:r,height:n}=t;if(v(e)&&(!r||!n)){const i=e.getBoundingClientRect();r=r||i.width||Number(e.getAttribute("width"))||0,n=n||i.height||Number(e.getAttribute("height"))||0}return{width:r,height:n}}async function Ze(e,t){const{log:r,timeout:n,drawImageCount:i,drawImageInterval:o}=t;r.time("image to canvas");const a=await I(e,{timeout:n,onWarn:t.log.warn}),{canvas:s,context2d:c}=et(e.ownerDocument,t),u=()=>{try{c==null||c.drawImage(a,0,0,s.width,s.height)}catch(l){t.log.warn("Failed to drawImage",l)}};if(u(),t.isEnable("fixSvgXmlDecode"))for(let l=0;l<i;l++)await new Promise(f=>{setTimeout(()=>{c==null||c.clearRect(0,0,s.width,s.height),u(),f()},l+o)});return t.drawImageCount=0,r.timeEnd("image to canvas"),s}function et(e,t){const{width:r,height:n,scale:i,backgroundColor:o,maximumCanvasSize:a}=t,s=e.createElement("canvas");s.width=Math.floor(r*i),s.height=Math.floor(n*i),s.style.width=`${r}px`,s.style.height=`${n}px`,a&&(s.width>a||s.height>a)&&(s.width>a&&s.height>a?s.width>s.height?(s.height*=a/s.width,s.width=a):(s.width*=a/s.height,s.height=a):s.width>a?(s.height*=a/s.width,s.width=a):(s.width*=a/s.height,s.height=a));const c=s.getContext("2d");return c&&o&&(c.fillStyle=o,c.fillRect(0,0,s.width,s.height)),{canvas:s,context2d:c}}function le(e,t){if(e.ownerDocument)try{const o=e.toDataURL();if(o!=="data:,")return T(o,e.ownerDocument)}catch(o){t.log.warn("Failed to clone canvas",o)}const r=e.cloneNode(!1),n=e.getContext("2d"),i=r.getContext("2d");try{return n&&i&&i.putImageData(n.getImageData(0,0,e.width,e.height),0,0),r}catch(o){t.log.warn("Failed to clone canvas",o)}return r}function tt(e,t){var r;try{if((r=e==null?void 0:e.contentDocument)!=null&&r.body)return W(e.contentDocument.body,t)}catch(n){t.log.warn("Failed to clone iframe",n)}return e.cloneNode(!1)}function rt(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager"),t}async function nt(e,t){if(e.ownerDocument&&!e.currentSrc&&e.poster)return T(e.poster,e.ownerDocument);const r=e.cloneNode(!1);r.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(r.src=e.currentSrc);const n=r.ownerDocument;if(n){let i=!0;if(await I(r,{onError:()=>i=!1,onWarn:t.log.warn}),!i)return e.poster?T(e.poster,e.ownerDocument):r;r.currentTime=e.currentTime,await new Promise(a=>{r.addEventListener("seeked",a,{once:!0})});const o=n.createElement("canvas");o.width=e.offsetWidth,o.height=e.offsetHeight;try{const a=o.getContext("2d");a&&a.drawImage(r,0,0,o.width,o.height)}catch(a){return t.log.warn("Failed to clone video",a),e.poster?T(e.poster,e.ownerDocument):r}return le(o,t)}return r}function st(e,t){return Ue(e)?le(e,t):qe(e)?tt(e,t):N(e)?rt(e):F(e)?nt(e,t):e.cloneNode(!1)}function ot(e){let t=e.sandbox;if(!t){const{ownerDocument:r}=e;try{r&&(t=r.createElement("iframe"),t.id=`__SANDBOX__${oe()}`,t.width="0",t.height="0",t.style.visibility="hidden",t.style.position="fixed",r.body.appendChild(t),t.srcdoc='<!DOCTYPE html><meta charset="UTF-8"><title></title><body>',e.sandbox=t)}catch(n){e.log.warn("Failed to getSandBox",n)}}return t}const at=["width","height","-webkit-text-fill-color"],it=["stroke","fill"];function ce(e,t,r){const{defaultComputedStyles:n}=r,i=e.nodeName.toLowerCase(),o=P(e)&&i!=="svg",a=o?it.map(m=>[m,e.getAttribute(m)]).filter(([,m])=>m!==null):[],s=[o&&"svg",i,a.map((m,w)=>`${m}=${w}`).join(","),t].filter(Boolean).join(":");if(n.has(s))return n.get(s);const c=ot(r),u=c==null?void 0:c.contentWindow;if(!u)return new Map;const l=u==null?void 0:u.document;let f,g;o?(f=l.createElementNS($,"svg"),g=f.ownerDocument.createElementNS(f.namespaceURI,i),a.forEach(([m,w])=>{g.setAttributeNS(null,m,w)}),f.appendChild(g)):f=g=l.createElement(i),g.textContent=" ",l.body.appendChild(f);const d=u.getComputedStyle(g,t),y=new Map;for(let m=d.length,w=0;w<m;w++){const p=d.item(w);at.includes(p)||y.set(p,d.getPropertyValue(p))}return l.body.removeChild(f),n.set(s,y),y}function ue(e,t,r){var s;const n=new Map,i=[],o=new Map;if(r)for(const c of r)a(c);else for(let c=e.length,u=0;u<c;u++){const l=e.item(u);a(l)}for(let c=i.length,u=0;u<c;u++)(s=o.get(i[u]))==null||s.forEach((l,f)=>n.set(f,l));function a(c){const u=e.getPropertyValue(c),l=e.getPropertyPriority(c),f=c.lastIndexOf("-"),g=f>-1?c.substring(0,f):void 0;if(g){let d=o.get(g);d||(d=new Map,o.set(g,d)),d.set(c,[u,l])}t.get(c)===u&&!l||(g?i.push(g):n.set(c,[u,l]))}return n}function lt(e,t,r,n){var f,g,d,y;const{ownerWindow:i,includeStyleProperties:o,currentParentNodeStyle:a}=n,s=t.style,c=i.getComputedStyle(e),u=ce(e,null,n);a==null||a.forEach((m,w)=>{u.delete(w)});const l=ue(c,u,o);l.delete("transition-property"),l.delete("all"),l.delete("d"),l.delete("content"),r&&(l.delete("margin-top"),l.delete("margin-right"),l.delete("margin-bottom"),l.delete("margin-left"),l.delete("margin-block-start"),l.delete("margin-block-end"),l.delete("margin-inline-start"),l.delete("margin-inline-end"),l.set("box-sizing",["border-box",""])),((f=l.get("background-clip"))==null?void 0:f[0])==="text"&&t.classList.add("______background-clip--text"),re&&(l.has("font-kerning")||l.set("font-kerning",["normal",""]),(((g=l.get("overflow-x"))==null?void 0:g[0])==="hidden"||((d=l.get("overflow-y"))==null?void 0:d[0])==="hidden")&&((y=l.get("text-overflow"))==null?void 0:y[0])==="ellipsis"&&e.scrollWidth===e.clientWidth&&l.set("text-overflow",["clip",""]));for(let m=s.length,w=0;w<m;w++)s.removeProperty(s.item(w));return l.forEach(([m,w],p)=>{s.setProperty(p,m,w)}),l}function ct(e,t){($e(e)||xe(e)||Me(e))&&t.setAttribute("value",e.value)}const ut=["::before","::after"],ft=["::-webkit-scrollbar","::-webkit-scrollbar-button","::-webkit-scrollbar-thumb","::-webkit-scrollbar-track","::-webkit-scrollbar-track-piece","::-webkit-scrollbar-corner","::-webkit-resizer"];function gt(e,t,r,n,i){const{ownerWindow:o,svgStyleElement:a,svgStyles:s,currentNodeStyle:c}=n;if(!a||!o)return;function u(l){var h;const f=o.getComputedStyle(e,l);let g=f.getPropertyValue("content");if(!g||g==="none")return;i==null||i(g),g=g.replace(/(')|(")|(counter\(.+\))/g,"");const d=[oe()],y=ce(e,l,n);c==null||c.forEach((E,S)=>{y.delete(S)});const m=ue(f,y,n.includeStyleProperties);m.delete("content"),m.delete("-webkit-locale"),((h=m.get("background-clip"))==null?void 0:h[0])==="text"&&t.classList.add("______background-clip--text");const w=[`content: '${g}';`];if(m.forEach(([E,S],C)=>{w.push(`${C}: ${E}${S?" !important":""};`)}),w.length===1)return;try{t.className=[t.className,...d].join(" ")}catch(E){n.log.warn("Failed to copyPseudoClass",E);return}const p=w.join(`
  `);let b=s.get(p);b||(b=[],s.set(p,b)),b.push(`.${d[0]}${l}`)}ut.forEach(u),r&&ft.forEach(u)}const H=new Set(["symbol"]);async function z(e,t,r,n,i){if(v(r)&&(Le(r)||Be(r))||n.filter&&!n.filter(r))return;H.has(t.nodeName)||H.has(r.nodeName)?n.currentParentNodeStyle=void 0:n.currentParentNodeStyle=n.currentNodeStyle;const o=await W(r,n,!1,i);n.isEnable("restoreScrollPosition")&&dt(e,o),t.appendChild(o)}async function X(e,t,r,n){var o;let i=e.firstChild;v(e)&&e.shadowRoot&&(i=(o=e.shadowRoot)==null?void 0:o.firstChild,r.shadowRoots.push(e.shadowRoot));for(let a=i;a;a=a.nextSibling)if(!De(a))if(v(a)&&Oe(a)&&typeof a.assignedNodes=="function"){const s=a.assignedNodes();for(let c=0;c<s.length;c++)await z(e,t,s[c],r,n)}else await z(e,t,a,r,n)}function dt(e,t){if(!R(e)||!R(t))return;const{scrollTop:r,scrollLeft:n}=e;if(!r&&!n)return;const{transform:i}=t.style,o=new DOMMatrix(i),{a,b:s,c,d:u}=o;o.a=1,o.b=0,o.c=0,o.d=1,o.translateSelf(-n,-r),o.a=a,o.b=s,o.c=c,o.d=u,t.style.transform=o.toString()}function mt(e,t){const{backgroundColor:r,width:n,height:i,style:o}=t,a=e.style;if(r&&a.setProperty("background-color",r,"important"),n&&a.setProperty("width",`${n}px`,"important"),i&&a.setProperty("height",`${i}px`,"important"),o)for(const s in o)a[s]=o[s]}const ht=/^[\w-:]+$/;async function W(e,t,r=!1,n){var u,l,f,g;const{ownerDocument:i,ownerWindow:o,fontFamilies:a,onCloneEachNode:s}=t;if(i&&Fe(e))return n&&/\S/.test(e.data)&&n(e.data),i.createTextNode(e.data);if(i&&o&&v(e)&&(R(e)||P(e))){const d=await st(e,t);if(t.isEnable("removeAbnormalAttributes")){const h=d.getAttributeNames();for(let E=h.length,S=0;S<E;S++){const C=h[S];ht.test(C)||d.removeAttribute(C)}}const y=t.currentNodeStyle=lt(e,d,r,t);r&&mt(d,t);let m=!1;if(t.isEnable("copyScrollbar")){const h=[(u=y.get("overflow-x"))==null?void 0:u[0],(l=y.get("overflow-y"))==null?void 0:l[0]];m=h.includes("scroll")||(h.includes("auto")||h.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}const w=(f=y.get("text-transform"))==null?void 0:f[0],p=ae((g=y.get("font-family"))==null?void 0:g[0]),b=p?h=>{w==="uppercase"?h=h.toUpperCase():w==="lowercase"?h=h.toLowerCase():w==="capitalize"&&(h=h[0].toUpperCase()+h.substring(1)),p.forEach(E=>{let S=a.get(E);S||a.set(E,S=new Set),h.split("").forEach(C=>S.add(C))})}:void 0;return gt(e,d,m,t,b),ct(e,d),F(e)||await X(e,d,t,b),await(s==null?void 0:s(d)),d}const c=e.cloneNode(!1);return await X(e,c,t),await(s==null?void 0:s(c)),c}function wt(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(t){e.log.warn("Failed to destroyContext",t)}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[],e.shadowRoots=[]}function pt(e){const{url:t,timeout:r,responseType:n,...i}=e,o=new AbortController,a=r?setTimeout(()=>o.abort(),r):void 0;return fetch(t,{signal:o.signal,...i}).then(s=>{if(!s.ok)throw new Error("Failed fetch, not 2xx response",{cause:s});switch(n){case"arrayBuffer":return s.arrayBuffer();case"dataUrl":return s.blob().then(Xe);case"text":default:return s.text()}}).finally(()=>clearTimeout(a))}function k(e,t){const{url:r,requestType:n="text",responseType:i="text",imageDom:o}=t;let a=r;const{timeout:s,acceptOfImage:c,requests:u,fetchFn:l,fetch:{requestInit:f,bypassingCache:g,placeholderImage:d},font:y,workers:m,fontFamilies:w}=e;n==="image"&&(D||q)&&e.drawImageCount++;let p=u.get(r);if(!p){g&&g instanceof RegExp&&g.test(a)&&(a+=(/\?/.test(a)?"&":"?")+new Date().getTime());const b=n.startsWith("font")&&y&&y.minify,h=new Set;b&&n.split(";")[1].split(",").forEach(_=>{w.has(_)&&w.get(_).forEach(j=>h.add(j))});const E=b&&h.size,S={url:a,timeout:s,responseType:E?"arrayBuffer":i,headers:n==="image"?{accept:c}:void 0,...f};p={type:n,resolve:void 0,reject:void 0,response:null},p.response=(async()=>{if(l&&n==="image"){const C=await l(r);if(C)return C}return!D&&r.startsWith("http")&&m.length?new Promise((C,_)=>{m[u.size&m.length-1].postMessage({rawUrl:r,...S}),p.resolve=C,p.reject=_}):pt(S)})().catch(C=>{if(u.delete(r),n==="image"&&d)return e.log.warn("Failed to fetch image base64, trying to use placeholder image",a),typeof d=="string"?d:d(o);throw C}),u.set(r,p)}return p.response}async function fe(e,t,r,n){if(!ge(e))return e;for(const[i,o]of yt(e,t))try{const a=await k(r,{url:o,requestType:n?"image":"text",responseType:"dataUrl"});e=e.replace(bt(i),`$1${a}$3`)}catch(a){r.log.warn("Failed to fetch css data url",i,a)}return e}function ge(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const de=/url\((['"]?)([^'"]+?)\1\)/g;function yt(e,t){const r=[];return e.replace(de,(n,i,o)=>(r.push([o,se(o,t)]),n)),r.filter(([n])=>!B(n))}function bt(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}const St=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function Et(e,t){return St.map(r=>{const n=e.getPropertyValue(r);return!n||n==="none"?null:((D||q)&&t.drawImageCount++,fe(n,null,t,!0).then(i=>{!i||n===i||e.setProperty(r,i,e.getPropertyPriority(r))}))}).filter(Boolean)}function Ct(e,t){if(N(e)){const r=e.currentSrc||e.src;if(!B(r))return[k(t,{url:r,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(n=>{n&&(e.srcset="",e.dataset.originalSrc=r,e.src=n||"")})];(D||q)&&t.drawImageCount++}else if(P(e)&&!B(e.href.baseVal)){const r=e.href.baseVal;return[k(t,{url:r,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(n=>{n&&(e.dataset.originalSrc=r,e.href.baseVal=n||"")})]}return[]}function vt(e,t){const{ownerDocument:r,svgDefsElement:n}=t,i=e.getAttribute("href")??e.getAttribute("xlink:href");if(!i)return[];const[o,a]=i.split("#");if(a){const s=`#${a}`,c=t.shadowRoots.reduce((u,l)=>u??l.querySelector(`svg ${s}`),r==null?void 0:r.querySelector(`svg ${s}`));if(o&&e.setAttribute("href",s),n!=null&&n.querySelector(s))return[];if(c)return n==null||n.appendChild(c.cloneNode(!0)),[];if(o)return[k(t,{url:o,responseType:"text"}).then(u=>{n==null||n.insertAdjacentHTML("beforeend",u)})]}return[]}function me(e,t){const{tasks:r}=t;v(e)&&((N(e)||ne(e))&&r.push(...Ct(e,t)),_e(e)&&r.push(...vt(e,t))),R(e)&&r.push(...Et(e.style,t)),e.childNodes.forEach(n=>{me(n,t)})}async function At(e,t){const{ownerDocument:r,svgStyleElement:n,fontFamilies:i,fontCssTexts:o,tasks:a,font:s}=t;if(!(!r||!n||!i.size))if(s&&s.cssText){const c=Y(s.cssText,t);n.appendChild(r.createTextNode(`${c}
`))}else{const c=Array.from(r.styleSheets).filter(l=>{try{return"cssRules"in l&&!!l.cssRules.length}catch(f){return t.log.warn(`Error while reading CSS rules from ${l.href}`,f),!1}});await Promise.all(c.flatMap(l=>Array.from(l.cssRules).map(async(f,g)=>{if(ke(f)){let d=g+1;const y=f.href;let m="";try{m=await k(t,{url:y,requestType:"text",responseType:"text"})}catch(p){t.log.warn(`Error fetch remote css import from ${y}`,p)}const w=m.replace(de,(p,b,h)=>p.replace(h,se(h,y)));for(const p of Nt(w))try{l.insertRule(p,p.startsWith("@import")?d+=1:l.cssRules.length)}catch(b){t.log.warn("Error inserting rule from remote css import",{rule:p,error:b})}}})));const u=[];c.forEach(l=>{M(l.cssRules,u)}),u.filter(l=>{var f;return Ie(l)&&ge(l.style.getPropertyValue("src"))&&((f=ae(l.style.getPropertyValue("font-family")))==null?void 0:f.some(g=>i.has(g)))}).forEach(l=>{const f=l,g=o.get(f.cssText);g?n.appendChild(r.createTextNode(`${g}
`)):a.push(fe(f.cssText,f.parentStyleSheet?f.parentStyleSheet.href:null,t).then(d=>{d=Y(d,t),o.set(f.cssText,d),n.appendChild(r.createTextNode(`${d}
`))}))})}}const Tt=/(\/\*[\s\S]*?\*\/)/g,G=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function Nt(e){if(e==null)return[];const t=[];let r=e.replace(Tt,"");for(;;){const o=G.exec(r);if(!o)break;t.push(o[0])}r=r.replace(G,"");const n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let o=n.exec(r);if(o)i.lastIndex=n.lastIndex;else if(o=i.exec(r),o)n.lastIndex=i.lastIndex;else break;t.push(o[0])}return t}const Rt=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,It=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Y(e,t){const{font:r}=t,n=r?r==null?void 0:r.preferredFormat:void 0;return n?e.replace(It,i=>{for(;;){const[o,,a]=Rt.exec(i)||[];if(!a)return"";if(a===n)return`src: ${o};`}}):e}function M(e,t=[]){for(const r of Array.from(e))Pe(r)?t.push(...M(r.cssRules)):"cssRules"in r?M(r.cssRules,t):t.push(r);return t}async function kt(e,t){const r=await x(e,t);if(v(r.node)&&P(r.node))return r.node;const{ownerDocument:n,log:i,tasks:o,svgStyleElement:a,svgDefsElement:s,svgStyles:c,font:u,progress:l,autoDestruct:f,onCloneNode:g,onEmbedNode:d,onCreateForeignObjectSvg:y}=r;i.time("clone node");const m=await W(r.node,r,!0);if(a&&n){let E="";c.forEach((S,C)=>{E+=`${S.join(`,
`)} {
  ${C}
}
`}),a.appendChild(n.createTextNode(E))}i.timeEnd("clone node"),await(g==null?void 0:g(m)),u!==!1&&v(m)&&(i.time("embed web font"),await At(m,r),i.timeEnd("embed web font")),i.time("embed node"),me(m,r);const w=o.length;let p=0;const b=async()=>{for(;;){const E=o.pop();if(!E)break;try{await E}catch(S){r.log.warn("Failed to run task",S)}l==null||l(++p,w)}};l==null||l(p,w),await Promise.all([...Array.from({length:4})].map(b)),i.timeEnd("embed node"),await(d==null?void 0:d(m));const h=Pt(m,r);return s&&h.insertBefore(s,h.children[0]),a&&h.insertBefore(a,h.children[0]),f&&wt(r),await(y==null?void 0:y(h)),h}function Pt(e,t){const{width:r,height:n}=t,i=Ve(r,n,e.ownerDocument),o=i.ownerDocument.createElementNS(i.namespaceURI,"foreignObject");return o.setAttributeNS(null,"x","0%"),o.setAttributeNS(null,"y","0%"),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.append(e),i.appendChild(o),i}async function _t(e,t){var a;const r=await x(e,t),n=await kt(r),i=He(n,r.isEnable("removeControlCharacter"));r.autoDestruct||(r.svgStyleElement=ie(r.ownerDocument),r.svgDefsElement=(a=r.ownerDocument)==null?void 0:a.createElementNS($,"defs"),r.svgStyles.clear());const o=T(i,n.ownerDocument);return await Ze(o,r)}async function Dt(e,t){const r=await x(e,t),{log:n,quality:i,type:o,dpi:a}=r,s=await _t(r);n.time("canvas to data url");let c=s.toDataURL(o,i);if(["image/png","image/jpeg"].includes(o)&&a&&Te&&Ne){const[u,l]=c.split(",");let f=0,g=!1;if(o==="image/png"){const h=ve(l);h>=0?(f=Math.ceil((h+28)/3)*4,g=!0):f=33/3*4}else o==="image/jpeg"&&(f=18/3*4);const d=l.substring(0,f),y=l.substring(f),m=window.atob(d),w=new Uint8Array(m.length);for(let h=0;h<w.length;h++)w[h]=m.charCodeAt(h);const p=o==="image/png"?be(w,a,g):he(w,a),b=window.btoa(String.fromCharCode(...p));c=[u,",",b,y].join("")}return n.timeEnd("canvas to data url"),c}async function Ft(e,t){return Dt(await x(e,{...t,type:"image/png"}))}export{Ft as d};
