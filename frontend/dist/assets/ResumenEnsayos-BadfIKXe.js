import{_ as tt,w as ye,o as st,y as ot,z as lt,a as u,c as p,b as e,f as P,d as A,e as te,t as l,v as ht,n as de,m as G,p as X,l as ke,g as Xe,q as Ve,F as V,r as Ie,A as ze,h as gt,i as Ze,u as yt}from"./index-TiZQyHOj.js";import{S as ee}from"./sweetalert2.esm.all-AlKuj1Cq.js";import{toPng as nt}from"./index-6sdqbm2o.js";import{E as Qe}from"./exceljs.min-DtXTVuKQ.js";import{f as _t,g as Et}from"./dataService-CkzvrtSC.js";import{i as Ye}from"./index-C3W-oE5n.js";const wt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true"},Nt={class:"flex items-center justify-between mb-3 pb-2 border-b border-slate-200 flex-shrink-0"},St={class:"flex flex-col gap-1"},Tt={class:"text-xl font-bold text-slate-800"},Mt={class:"flex items-center gap-4 text-sm text-slate-600"},Ct={class:"font-semibold text-slate-900"},kt={key:0},Dt={class:"font-semibold text-slate-900"},Rt={key:1},Ot={class:"font-semibold text-slate-900"},At={key:2},It={class:"font-semibold text-slate-900"},Lt={class:"flex items-center gap-3"},Ft={class:"flex items-center gap-2 cursor-pointer select-none"},Ut={class:"grid grid-cols-7 gap-2 mb-3 flex-shrink-0"},Pt={class:"bg-white rounded-lg px-3 py-2 border border-slate-200 hover:border-blue-300 transition-colors"},Bt={class:"flex items-center justify-between gap-2"},Gt={class:"text-sm font-bold text-slate-900"},jt={class:"flex items-center justify-between gap-2"},$t={class:"bg-white rounded-lg px-3 py-2 border border-slate-200 hover:border-green-300 transition-colors"},Kt={class:"flex items-center justify-between gap-2"},Vt={class:"text-sm font-bold text-slate-900"},zt={class:"bg-white rounded-lg px-3 py-2 border border-slate-200 hover:border-purple-300 transition-colors"},Ht={class:"flex items-center justify-between gap-2"},qt={class:"text-sm font-bold text-slate-900"},Jt={class:"bg-white rounded-lg px-3 py-2 border border-slate-200 hover:border-orange-300 transition-colors"},Wt={class:"flex items-center justify-between gap-2"},Xt={class:"text-sm font-bold text-slate-900"},Zt={class:"bg-white rounded-lg px-3 py-2 border border-slate-200 hover:border-cyan-300 transition-colors"},Qt={class:"flex items-center justify-between gap-2"},Yt={class:"text-sm font-bold text-slate-900"},es={class:"bg-white rounded-lg px-3 py-2 border border-slate-200 hover:border-amber-300 transition-colors"},ts={class:"flex items-center justify-between gap-2"},ss={class:"text-sm font-bold text-slate-900"},os={class:"flex-1 min-h-0 border border-slate-200 rounded-xl p-3 bg-slate-50 overflow-hidden"},ls={__name:"HusoDetailModal",props:{visible:{type:Boolean,default:!1},values:{type:Array,default:()=>[]},husoNumbers:{type:Array,default:()=>[]},testnr:{type:String,default:""},timestamp:{type:String,default:""},oe:{type:String,default:""},variableLabel:{type:String,default:""},standardNe:{type:[String,Number],default:""},canNavigatePrevious:{type:Boolean,default:!1},canNavigateNext:{type:Boolean,default:!1}},emits:["close","navigate-previous","navigate-next"],setup(oe,{emit:De}){const T=oe,re=De,le=G(null),Ne=G(null);let S=null,be=!0;const _e=G(!0),Z=G({mean:0,sd:0,cv:0,lcl:0,ucl:0,min:0,max:0,range:0,neMin:null,neMax:null}),ve=X(()=>{const g=T.standardNe?parseFloat(T.standardNe):null;if(!g||!Z.value.mean)return null;const i=T.variableLabel&&T.variableLabel.toLowerCase().includes("titulo");let D;i?D=g-Z.value.mean:D=Z.value.mean-g;const B=D/g*100,I=B.toFixed(2);return B>=0?`+${I}`:I}),Pe=X(()=>{if(ve.value===null)return"";const g=parseFloat(ve.value);return Math.abs(g)<=1.5?"text-green-600":"text-red-600"});function pe(){if(!T.values||T.values.length===0){Z.value={mean:0,sd:0,cv:0,lcl:0,ucl:0,min:0,max:0,range:0,neMin:null,neMax:null};return}const g=T.values.length,i=T.values.reduce((Me,M)=>Me+M,0)/g,D=T.values.reduce((Me,M)=>Me+Math.pow(M-i,2),0)/g,B=Math.sqrt(D),I=i!==0?B/i*100:0,q=Math.min(...T.values),fe=Math.max(...T.values),ce=fe-q,ne=T.standardNe?parseFloat(T.standardNe):null,Fe=ne?ne*.985:null,Te=ne?ne*1.015:null;Z.value={mean:i,sd:B,cv:I,lcl:i-3*B,ucl:i+3*B,min:q,max:fe,range:ce,neMin:Fe,neMax:Te}}function Ee(g){return g==null||isNaN(g)?"—":g.toFixed(2)}function Le(g){return g==null||isNaN(g)?"—":g.toFixed(2)}const ie=G({});function Se(g=null){const i=T.husoNumbers.length>0?T.husoNumbers.map(M=>String(M)):T.values.map((M,j)=>String(j+1)),D=T.values,B=T.variableLabel&&T.variableLabel.toLowerCase().includes("titulo"),I=T.standardNe?parseFloat(T.standardNe):null,q=["Valor","Promedio","LCL (-3σ)","UCL (+3σ)"];B&&I&&q.push("Ne Estándar","Ne Min (+1.5%)","Ne Max (-1.5%)");const fe=[{name:"Valor",type:"line",data:D.map((M,j)=>{if(I&&B){const Q=I*.985,$=I*1.015,ae=M<Q||M>$;return{value:M,itemStyle:ae?{color:"#ef4444",borderColor:"#fff",borderWidth:2,shadowBlur:6,shadowColor:"rgba(239, 68, 68, 0.4)"}:{color:"#3b82f6"},symbolSize:ae?8:6}}return M}),smooth:!1,showSymbol:!0,symbolSize:6,itemStyle:{color:"#3b82f6"},lineStyle:{width:1.5},label:{show:_e.value,position:"top",formatter:M=>(typeof M.value=="object"?M.value.value:M.value).toFixed(2),fontSize:10,color:"#475569",fontWeight:500}},{name:"Promedio",type:"line",data:Array(i.length).fill(Z.value.mean),lineStyle:{type:"solid",color:"#10b981",width:1.5},showSymbol:!1},{name:"LCL (-3σ)",type:"line",data:Array(i.length).fill(Z.value.lcl),lineStyle:{type:"dashed",color:"#ef4444",width:1.5},showSymbol:!1},{name:"UCL (+3σ)",type:"line",data:Array(i.length).fill(Z.value.ucl),lineStyle:{type:"dashed",color:"#ef4444",width:1.5},showSymbol:!1}];B&&I&&fe.push({name:"Ne Estándar",type:"line",data:Array(i.length).fill(I),lineStyle:{type:"solid",color:"#8b5cf6",width:1.5},showSymbol:!1,z:3},{name:"Ne Min (+1.5%)",type:"line",data:Array(i.length).fill(I*.985),lineStyle:{type:"dashed",color:"#f59e0b",width:1.5},showSymbol:!1,z:2},{name:"Ne Max (-1.5%)",type:"line",data:Array(i.length).fill(I*1.015),lineStyle:{type:"dashed",color:"#f59e0b",width:1.5},showSymbol:!1,z:2});let ce=1/0,ne=-1/0;fe.forEach(M=>{if(!(g?g[M.name]!==!1:!0))return;M.data.forEach($=>{const ae=typeof $=="object"&&$!==null&&$.value!==void 0?$.value:$;typeof ae=="number"&&!isNaN(ae)&&(ae<ce&&(ce=ae),ae>ne&&(ne=ae))})});const Te=(ne-ce)*.05;return ce=ce-Te,ne=ne+Te,{tooltip:{trigger:"axis",backgroundColor:"#fff",borderColor:"#e2e8f0",textStyle:{color:"#1e293b",fontSize:12},extraCssText:"box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); border-radius: 8px;",formatter:M=>{if(!M||M.length===0)return"";let Q=`<div style="font-weight: 600; margin-bottom: 6px; color: #0f172a; border-bottom: 1px solid #f1f5f9; padding-bottom: 4px;">Huso ${M[0].axisValue} | ${T.variableLabel}</div>`;return M.forEach($=>{if($.value===void 0||$.value===null)return;const ae=typeof $.value=="number"?$.value.toFixed(2):$.value;Q+=`<div style="display: flex; align-items: center; justify-content: space-between; margin: 3px 0; gap: 12px;">
                        <div style="display: flex; align-items: center;">
                            ${$.marker} 
                            <span style="margin-left: 4px; color: #475569;">${$.seriesName}</span>
                        </div>
                        <span style="font-weight: 500; color: #1e293b;">${ae}</span>
                    </div>`}),Q}},legend:{data:q,bottom:0,left:"center"},grid:{left:"8%",right:"4%",top:"8%",bottom:60,containLabel:!1},xAxis:{type:"category",data:i,axisLabel:{rotate:0,interval:0}},yAxis:{type:"value",min:ce,max:ne,axisLabel:{formatter:M=>M.toFixed(2)}},series:fe}}function H(){if(!(!S||S.isDisposed()||!T.values||T.values.length===0))if(be){const g={"LCL (-3σ)":!1,"UCL (+3σ)":!1};ie.value=g;const i=Se(g);i.legend.selected=g,be=!1,S.setOption(i,{notMerge:!0})}else{const g=Se(ie.value);S.setOption(g,{notMerge:!1})}}async function x(){try{if(!Ne.value)return;const g=['[aria-label="Copiar como imagen"]','[aria-label="Cerrar"]','[aria-label="Ensayo anterior"]','[aria-label="Ensayo siguiente"]','label:has(input[type="checkbox"])'],i=[];g.forEach(I=>{const q=Ne.value.querySelector(I);q&&(i.push({el:q,originalDisplay:q.style.display}),q.style.display="none")}),await new Promise(I=>setTimeout(I,80));const D=await nt(Ne.value,{quality:1,pixelRatio:2,backgroundColor:"#ffffff",skipFonts:!0});i.forEach(({el:I,originalDisplay:q})=>{I.style.display=q||""});const B=await(await fetch(D)).blob();await navigator.clipboard.write([new ClipboardItem({"image/png":B})]),ee.fire({icon:"success",title:"¡Copiado!",text:"La imagen se copió al portapapeles. Puedes pegarla en WhatsApp.",timer:2e3,showConfirmButton:!1})}catch(g){console.error("Error copying image:",g),ee.fire({icon:"error",title:"Error",text:"No se pudo copiar la imagen."})}}return ye(()=>T.visible,async g=>{g?(be=!0,ie.value={},pe(),await ke(),(async(D=10)=>{for(let B=0;B<D;B++){if(await ke(),le.value&&le.value.clientWidth>0&&le.value.clientHeight>0){S&&S.dispose(),S=Ye(le.value),S.on("legendselectchanged",I=>{ie.value={...I.selected};const q=Se(ie.value);q.legend.selected=ie.value,S.setOption({yAxis:q.yAxis},!1)}),H(),setTimeout(()=>{S&&!S.isDisposed()&&S.resize()},100);return}await new Promise(I=>setTimeout(I,100))}})()):S&&(S.dispose(),S=null)}),ye(()=>T.testnr,async(g,i)=>{T.visible&&g!==i&&S&&!S.isDisposed()&&(pe(),be=!0,ie.value={},await ke(),H(),setTimeout(()=>{S&&!S.isDisposed()&&S.resize()},100))}),ye([()=>T.values,()=>T.husoNumbers],async()=>{var g;T.visible&&((g=T.values)==null?void 0:g.length)>0&&(!S||S.isDisposed()?(await ke(),(async(D=10)=>{for(let B=0;B<D;B++){if(await ke(),le.value&&le.value.clientWidth>0&&le.value.clientHeight>0){if(S&&!S.isDisposed()){pe(),H();return}S=Ye(le.value),S.on("legendselectchanged",I=>{ie.value={...I.selected};const q=Se(ie.value);q.legend.selected=ie.value,S.setOption({yAxis:q.yAxis},!1)}),pe(),H(),setTimeout(()=>{S&&!S.isDisposed()&&S.resize()},100);return}await new Promise(I=>setTimeout(I,100))}console.warn("[HusoDetailModal] Could not initialize chart after retries")})()):(pe(),await ke(),H(),setTimeout(()=>{S&&!S.isDisposed()&&S.resize()},100)))},{deep:!0}),st(()=>{const g=i=>{if(!T.visible)return;const D=i.target&&i.target.tagName?String(i.target.tagName).toLowerCase():"";if(!(D==="input"||D==="textarea"||D==="select"||i.isComposing)){if(i.key==="Escape"){re("close");return}if((i.key==="ArrowLeft"||i.key==="Left")&&T.canNavigatePrevious){i.preventDefault(),re("navigate-previous");return}if((i.key==="ArrowRight"||i.key==="Right")&&T.canNavigateNext){i.preventDefault(),re("navigate-next");return}}};window.addEventListener("keydown",g),ot(()=>{window.removeEventListener("keydown",g),S&&!S.isDisposed()&&(S.dispose(),S=null)})}),(g,i)=>{const D=lt("tippy");return oe.visible?(u(),p("div",wt,[e("div",{class:"fixed inset-0 bg-gradient-to-br from-slate-900/50 to-slate-800/50 backdrop-blur-sm z-40",onClick:i[0]||(i[0]=B=>g.$emit("close")),"aria-hidden":"true"}),e("div",{class:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full flex flex-col p-4 z-50 relative",style:{height:"600px"},role:"document",ref_key:"modalRef",ref:Ne},[oe.canNavigatePrevious?P((u(),p("button",{key:0,onClick:i[1]||(i[1]=B=>g.$emit("navigate-previous")),class:"absolute left-0 top-1/2 -translate-y-1/2 -ml-6 w-10 h-10 rounded-full bg-white border border-slate-200 shadow-sm flex items-center justify-center text-2xl text-slate-700 hover:bg-slate-50 z-50","aria-label":"Ensayo anterior"},[...i[5]||(i[5]=[A("‹",-1)])])),[[D,{content:"Anterior ensayo",placement:"left",theme:"custom"}]]):te("",!0),oe.canNavigateNext?P((u(),p("button",{key:1,onClick:i[2]||(i[2]=B=>g.$emit("navigate-next")),class:"absolute right-0 top-1/2 -translate-y-1/2 -mr-6 w-10 h-10 rounded-full bg-white border border-slate-200 shadow-sm flex items-center justify-center text-2xl text-slate-700 hover:bg-slate-50 z-50","aria-label":"Ensayo siguiente"},[...i[6]||(i[6]=[A("›",-1)])])),[[D,{content:"Siguiente ensayo",placement:"right",theme:"custom"}]]):te("",!0),e("header",Nt,[e("div",St,[e("h3",Tt,"Detalle por Huso - "+l(oe.variableLabel),1),e("div",Mt,[e("span",null,[i[7]||(i[7]=A("Ensayo: ",-1)),e("span",Ct,l(oe.testnr),1)]),oe.timestamp?(u(),p("span",kt,[i[8]||(i[8]=A("Fecha: ",-1)),e("span",Dt,l(oe.timestamp),1)])):te("",!0),oe.oe?(u(),p("span",Rt,[i[9]||(i[9]=A("OE: ",-1)),e("span",Ot,l(oe.oe),1)])):te("",!0),oe.standardNe?(u(),p("span",At,[i[10]||(i[10]=A("Ne Estándar: ",-1)),e("span",It,l(oe.standardNe),1)])):te("",!0)])]),e("div",Lt,[e("label",Ft,[P(e("input",{type:"checkbox","onUpdate:modelValue":i[3]||(i[3]=B=>_e.value=B),onChange:H,class:"w-4 h-4 text-blue-600 bg-white border-slate-300 rounded focus:ring-blue-500 focus:ring-2 cursor-pointer"},null,544),[[ht,_e.value]]),i[11]||(i[11]=e("span",{class:"text-sm font-normal text-slate-700"},"Mostrar Valores",-1))]),P((u(),p("button",{onClick:x,type:"button",class:"w-9 h-9 rounded-lg bg-white border border-slate-200 hover:border-blue-400 hover:bg-blue-50 flex items-center justify-center text-slate-600 hover:text-blue-600 transition-all duration-200 group shadow-sm hover:shadow-md","aria-label":"Copiar como imagen"},[...i[12]||(i[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])])),[[D,{content:"Copiar como imagen para WhatsApp",placement:"bottom",theme:"custom"}]]),e("button",{onClick:i[4]||(i[4]=B=>g.$emit("close")),type:"button",class:"w-9 h-9 rounded-lg bg-white border border-slate-200 hover:border-red-400 hover:bg-red-50 flex items-center justify-center text-slate-600 hover:text-red-600 transition-all duration-200 shadow-sm hover:shadow-md","aria-label":"Cerrar"},[...i[13]||(i[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])])]),e("div",Ut,[e("div",Pt,[e("div",Bt,[i[14]||(i[14]=e("span",{class:"text-xs font-medium text-slate-500"},"Promedio",-1)),e("span",Gt,l(Ee(Z.value.mean)),1)])]),ve.value!==null?(u(),p("div",{key:0,class:de(["bg-white rounded-lg px-3 py-2 border border-slate-200 transition-colors",ve.value!==null&&Math.abs(parseFloat(ve.value))<=1.5?"hover:border-green-300":"hover:border-red-300"])},[e("div",jt,[i[15]||(i[15]=e("span",{class:"text-xs font-medium text-slate-500"},"Desvío %",-1)),e("span",{class:de(["text-sm font-bold",Pe.value])},l(ve.value),3)])],2)):te("",!0),e("div",$t,[e("div",Kt,[i[16]||(i[16]=e("span",{class:"text-xs font-medium text-slate-500"},"Desv. Est. (σ)",-1)),e("span",Vt,l(Ee(Z.value.sd)),1)])]),e("div",zt,[e("div",Ht,[i[17]||(i[17]=e("span",{class:"text-xs font-medium text-slate-500"},"CV %",-1)),e("span",qt,l(Ee(Z.value.cv)),1)])]),e("div",Jt,[e("div",Wt,[i[18]||(i[18]=e("span",{class:"text-xs font-medium text-slate-500"},"Rango",-1)),e("span",Xt,l(Ee(Z.value.range)),1)])]),e("div",Zt,[e("div",Qt,[i[19]||(i[19]=e("span",{class:"text-xs font-medium text-slate-500"},"Ne Min (+1.5%)",-1)),e("span",Yt,l(Le(Z.value.neMin)),1)])]),e("div",es,[e("div",ts,[i[20]||(i[20]=e("span",{class:"text-xs font-medium text-slate-500"},"Ne Max (-1.5%)",-1)),e("span",ss,l(Le(Z.value.neMax)),1)])])]),e("div",os,[e("div",{ref_key:"chartRef",ref:le,class:"w-full h-full"},null,512)])],512)])):te("",!0)}}},ns=tt(ls,[["__scopeId","data-v-b8830bdc"]]),as={class:"w-full h-screen flex flex-col p-1"},rs={class:"w-full flex-1 min-h-0 bg-white rounded-2xl shadow-xl px-4 py-3 border border-slate-200 flex flex-col"},is={class:"flex flex-col gap-2 mb-3 flex-shrink-0"},ds={class:"@container flex items-center gap-1.5"},cs={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor"},us={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},ps={class:"ml-2 flex items-center gap-2"},xs={class:"flex-1 flex items-center justify-end gap-2"},ms={class:"flex items-center gap-2 flex-wrap"},bs={class:"flex items-center gap-2"},vs=["value"],fs=["value"],hs={class:"flex items-center gap-2 ml-1"},gs={class:"flex items-center gap-1"},ys={key:0,class:"text-sm text-slate-600 py-8 text-center flex-1"},_s={key:1,class:"flex-1 min-h-0 flex flex-col"},Es={key:0,class:"text-sm text-slate-600 py-8 text-center"},ws={key:1,class:"flex-1 min-h-0 flex flex-col"},Ns={key:0,class:"text-sm text-slate-600 mb-4 py-4 text-center bg-slate-50 rounded-lg flex-shrink-0"},Ss={class:"overflow-auto _minimal-scroll w-full flex-1 min-h-0 rounded-xl border border-slate-200 pb-0"},Ts={class:"min-w-full w-full table-auto divide-y divide-slate-200 text-xs"},Ms={class:"px-2 py-[0.3rem] text-center text-slate-700"},Cs={class:"px-2 py-[0.3rem] text-center text-slate-700 whitespace-nowrap"},ks={class:"px-2 py-[0.3rem] text-center text-slate-700"},Ds={class:"px-2 py-[0.3rem] text-center text-slate-700"},Rs={class:"px-2 py-[0.3rem] text-center text-slate-700"},Os={class:"px-2 py-[0.3rem] text-center text-slate-700"},As={class:"px-2 py-[0.3rem] text-center text-slate-700"},Is={class:"px-2 py-[0.3rem] text-center text-slate-700"},Ls={class:"px-2 py-[0.3rem] text-center text-slate-700"},Fs={class:"px-2 py-[0.3rem] text-center text-slate-700"},Us={class:"px-2 py-[0.3rem] text-center text-slate-700"},Ps={class:"px-2 py-[0.3rem] text-center text-slate-700"},Bs={class:"px-2 py-[0.3rem] text-center text-slate-700"},Gs={class:"px-2 py-[0.3rem] text-center text-slate-700"},js={class:"px-2 py-[0.3rem] text-center text-slate-700"},$s={class:"px-2 py-[0.3rem] text-center text-slate-700"},Ks={class:"px-2 py-[0.3rem] text-center text-slate-700"},Vs={class:"px-2 py-[0.3rem] text-center text-slate-700"},zs={class:"px-2 py-[0.3rem] text-center text-slate-700"},Hs={class:"px-2 py-[0.3rem] text-center text-slate-700"},qs={class:"px-2 py-[0.3rem] text-center"},Js={class:"flex items-center justify-center gap-1.5"},Ws=["onClick"],Xs=["onClick"],Zs={class:"flex items-center justify-between mt-3 px-1 flex-shrink-0"},Qs={class:"text-sm text-slate-600"},Ys={class:"flex items-center gap-2"},eo=["value"],to=["disabled"],so=["disabled"],oo={class:"flex items-center gap-1"},lo=["max"],no={class:"text-sm text-slate-600"},ao=["disabled"],ro=["disabled"],io={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"modalTitle"},co={class:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[95vh] flex flex-col p-3 z-50 relative",role:"document"},uo=["disabled"],po=["disabled"],xo={class:"flex items-start sm:items-center justify-between mb-2 pb-1 gap-3"},mo={id:"modalTitle",class:"flex flex-col sm:flex-row sm:items-center gap-2 mx-8"},bo={class:"text-slate-600 text-sm"},vo={class:"text-slate-900 text-lg font-semibold ml-1"},fo={class:"text-slate-600 text-sm"},ho={class:"text-slate-900 text-lg font-semibold ml-1"},go={class:"text-slate-600 text-sm"},yo={class:"text-slate-900 text-lg font-semibold ml-1"},_o={class:"text-slate-600 text-sm"},Eo={class:"text-slate-900 text-lg font-semibold ml-1"},wo={class:"text-slate-900 text-lg font-semibold ml-1"},No={class:"flex items-center gap-2"},So={key:0,class:"mx-8 flex items-center gap-4 text-slate-600 text-sm mb-2"},To={key:0},Mo={class:"text-slate-900 text-sm font-normal ml-1"},Co={key:1},ko={class:"text-slate-900 text-sm font-normal ml-1"},Do={key:2},Ro={class:"text-slate-900 text-sm font-normal ml-1"},Oo={class:"flex-1 relative"},Ao={key:0,class:"text-sm text-slate-600 py-8 text-center"},Io={key:1,class:"rounded-xl border border-slate-200 overflow-auto modal-scroll max-h-[calc(95vh-6rem)]"},Lo={class:"min-w-full text-xs"},Fo={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},Uo={key:0,class:"mx-auto w-10 h-4 bg-slate-200/70 rounded animate-pulse"},Po={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},Bo={key:0,class:"mx-auto w-32 h-4 bg-slate-200/70 rounded animate-pulse"},Go={key:0,class:"mx-auto w-16 h-4 bg-slate-200/70 rounded animate-pulse"},jo={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},$o={key:0,class:"mx-auto w-14 h-4 bg-slate-200/70 rounded animate-pulse"},Ko={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},Vo={key:0,class:"mx-auto w-16 h-4 bg-slate-200/70 rounded animate-pulse"},zo={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},Ho={key:0,class:"mx-auto w-16 h-4 bg-slate-200/70 rounded animate-pulse"},qo={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},Jo={key:0,class:"mx-auto w-16 h-4 bg-slate-200/70 rounded animate-pulse"},Wo={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},Xo={key:0,class:"mx-auto w-16 h-4 bg-slate-200/70 rounded animate-pulse"},Zo={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},Qo={key:0,class:"mx-auto w-16 h-4 bg-slate-200/70 rounded animate-pulse"},Yo={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},el={key:0,class:"mx-auto w-16 h-4 bg-slate-200/70 rounded animate-pulse"},tl={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},sl={key:0,class:"mx-auto w-16 h-4 bg-slate-200/70 rounded animate-pulse"},ol={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},ll={key:0,class:"mx-auto w-16 h-4 bg-slate-200/70 rounded animate-pulse"},nl={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},al={key:0,class:"mx-auto w-14 h-4 bg-slate-200/70 rounded animate-pulse"},rl={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},il={key:0,class:"mx-auto w-14 h-4 bg-slate-200/70 rounded animate-pulse"},dl={class:"px-3 py-1 text-center border-b border-slate-100 text-slate-700"},cl={key:0,class:"mx-auto w-14 h-4 bg-slate-200/70 rounded animate-pulse"},ul={class:"bg-gradient-to-r from-blue-50 to-indigo-50 font-semibold border-t-2 border-blue-200"},pl={class:"px-3 py-1 text-slate-700"},xl={class:"flex items-center justify-center gap-1"},ml={"aria-label":"Info Promedio",class:"inline-flex items-center text-slate-400 hover:text-slate-600"},bl={class:"px-3 py-1 text-center text-slate-700"},vl={class:"px-3 py-1 text-center text-slate-700"},fl={class:"px-3 py-1 text-center text-slate-700"},hl={class:"px-3 py-1 text-center text-slate-700"},gl={class:"px-3 py-1 text-center text-slate-700"},yl={class:"px-3 py-1 text-center text-slate-700"},_l={class:"px-3 py-1 text-center text-slate-700"},El={class:"px-3 py-1 text-center text-slate-700"},wl={class:"px-3 py-1 text-center text-slate-700"},Nl={class:"px-3 py-1 text-center text-slate-700"},Sl={class:"px-3 py-1 text-center text-slate-700"},Tl={class:"px-3 py-1 text-center text-slate-700"},Ml={class:"px-3 py-1 text-center text-slate-700"},Cl={class:"bg-blue-50/50 font-medium"},kl={class:"px-3 py-1 text-slate-700"},Dl={class:"flex items-center justify-center gap-1"},Rl={"aria-label":"Info CV",class:"inline-flex items-center text-slate-400 hover:text-slate-600"},Ol={class:"px-3 py-1 text-center text-slate-700"},Al={class:"px-3 py-1 text-center text-slate-700"},Il={class:"px-3 py-1 text-center text-slate-700"},Ll={class:"px-3 py-1 text-center text-slate-700"},Fl={class:"px-3 py-1 text-center text-slate-700"},Ul={class:"px-3 py-1 text-center text-slate-700"},Pl={class:"px-3 py-1 text-center text-slate-700"},Bl={class:"px-3 py-1 text-center text-slate-700"},Gl={class:"px-3 py-1 text-center text-slate-700"},jl={class:"px-3 py-1 text-center text-slate-700"},$l={class:"px-3 py-1 text-center text-slate-700"},Kl={class:"px-3 py-1 text-center text-slate-700"},Vl={class:"px-3 py-1 text-center text-slate-700"},zl={class:"bg-indigo-50/50 font-medium"},Hl={class:"px-3 py-1 text-slate-700"},ql={class:"flex items-center justify-center gap-1"},Jl={"aria-label":"Info desviación estándar",class:"inline-flex items-center text-slate-400 hover:text-slate-600"},Wl={class:"px-3 py-1 text-center text-slate-700"},Xl={class:"px-3 py-1 text-center text-slate-700"},Zl={class:"px-3 py-1 text-center text-slate-700"},Ql={class:"px-3 py-1 text-center text-slate-700"},Yl={class:"px-3 py-1 text-center text-slate-700"},en={class:"px-3 py-1 text-center text-slate-700"},tn={class:"px-3 py-1 text-center text-slate-700"},sn={class:"px-3 py-1 text-center text-slate-700"},on={class:"px-3 py-1 text-center text-slate-700"},ln={class:"px-3 py-1 text-center text-slate-700"},nn={class:"px-3 py-1 text-center text-slate-700"},an={class:"px-3 py-1 text-center text-slate-700"},rn={class:"px-3 py-1 text-center text-slate-700"},dn={class:"bg-blue-50/50 font-medium"},cn={class:"px-3 py-1 text-slate-700"},un={class:"flex items-center justify-center gap-1"},pn={"aria-label":"Info Q95",class:"inline-flex items-center text-slate-400 hover:text-slate-600"},xn={class:"px-3 py-1 text-center text-slate-700"},mn={class:"px-3 py-1 text-center text-slate-700"},bn={class:"px-3 py-1 text-center text-slate-700"},vn={class:"px-3 py-1 text-center text-slate-700"},fn={class:"px-3 py-1 text-center text-slate-700"},hn={class:"px-3 py-1 text-center text-slate-700"},gn={class:"px-3 py-1 text-center text-slate-700"},yn={class:"px-3 py-1 text-center text-slate-700"},_n={class:"px-3 py-1 text-center text-slate-700"},En={class:"px-3 py-1 text-center text-slate-700"},wn={class:"px-3 py-1 text-center text-slate-700"},Nn={class:"px-3 py-1 text-center text-slate-700"},Sn={class:"px-3 py-1 text-center text-slate-700"},Tn={class:"bg-indigo-50/50 font-medium"},Mn={class:"px-3 py-1 text-slate-700"},Cn={class:"flex items-center justify-center gap-1"},kn={"aria-label":"Info Max",class:"inline-flex items-center text-slate-400 hover:text-slate-600"},Dn={class:"px-3 py-1 text-center text-slate-700"},Rn={class:"px-3 py-1 text-center text-slate-700"},On={class:"px-3 py-1 text-center text-slate-700"},An={class:"px-3 py-1 text-center text-slate-700"},In={class:"px-3 py-1 text-center text-slate-700"},Ln={class:"px-3 py-1 text-center text-slate-700"},Fn={class:"px-3 py-1 text-center text-slate-700"},Un={class:"px-3 py-1 text-center text-slate-700"},Pn={class:"px-3 py-1 text-center text-slate-700"},Bn={class:"px-3 py-1 text-center text-slate-700"},Gn={class:"px-3 py-1 text-center text-slate-700"},jn={class:"px-3 py-1 text-center text-slate-700"},$n={class:"px-3 py-1 text-center text-slate-700"},Kn={class:"bg-blue-50/50 font-medium"},Vn={class:"px-3 py-1 text-slate-700"},zn={class:"flex items-center justify-center gap-1"},Hn={"aria-label":"Info Min",class:"inline-flex items-center text-slate-400 hover:text-slate-600"},qn={class:"px-3 py-1 text-center text-slate-700"},Jn={class:"px-3 py-1 text-center text-slate-700"},Wn={class:"px-3 py-1 text-center text-slate-700"},Xn={class:"px-3 py-1 text-center text-slate-700"},Zn={class:"px-3 py-1 text-center text-slate-700"},Qn={class:"px-3 py-1 text-center text-slate-700"},Yn={class:"px-3 py-1 text-center text-slate-700"},ea={class:"px-3 py-1 text-center text-slate-700"},ta={class:"px-3 py-1 text-center text-slate-700"},sa={class:"px-3 py-1 text-center text-slate-700"},oa={class:"px-3 py-1 text-center text-slate-700"},la={class:"px-3 py-1 text-center text-slate-700"},na={class:"px-3 py-1 text-center text-slate-700"},aa={key:0,class:"absolute inset-0 bg-white/95 z-50 flex flex-col items-center justify-center pointer-events-auto"},et=500,ra={__name:"ResumenEnsayos",setup(oe){const De=G(!1),T=G([]),re=G(null),le=X(()=>Et()),Ne=X(()=>le.value==="firebase"?"Datos desde Firebase (Producción)":"Datos desde Oracle (Localhost)"),S=G(""),be=G(""),_e=G([]),Z=G(null),ve=G(et);function Pe(n){if(!n)return"";let t=String(n).trim().replace(/[-.]/g,"/").replace(/\s.*/,"");const s=t.match(/^(\d{4})[/-](\d{1,2})[/-](\d{1,2})/);if(s){const _=String(s[3]).padStart(2,"0"),L=String(s[2]).padStart(2,"0"),E=String(s[1]).slice(-2);return`${_}/${L}/${E}`}const m=t.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);if(m){const _=String(parseInt(m[1],10)).padStart(2,"0"),L=String(parseInt(m[2],10)).padStart(2,"0"),E=m[3].length===4?m[3].slice(-2):m[3].padStart(2,"0");return`${_}/${L}/${E}`}const h=new Date(t);if(!isNaN(h.getTime())){const _=String(h.getDate()).padStart(2,"0"),L=String(h.getMonth()+1).padStart(2,"0"),E=String(h.getFullYear()).slice(-2);return`${_}/${L}/${E}`}return t}function pe(n){if(!n&&n!==0)return"";if(n instanceof Date){const t=String(n.getDate()).padStart(2,"0"),s=String(n.getMonth()+1).padStart(2,"0"),m=String(n.getFullYear()).slice(-2);return`${t}/${s}/${m}`}if(typeof n=="number"){const t=Number(n);if(!Number.isFinite(t))return"";const s=t>1e12?new Date(t):t>1e9?new Date(t*1e3):new Date(t);if(!isNaN(s.getTime())){const m=String(s.getDate()).padStart(2,"0"),h=String(s.getMonth()+1).padStart(2,"0"),_=String(s.getFullYear()).slice(-2);return`${m}/${h}/${_}`}return""}try{const t=String(n).trim();return/^(?:mon|tue|wed|thu|fri|sat|sun)$/i.test(t)||/^(?:monday|tuesday|wednesday|thursday|friday|saturday|sunday)$/i.test(t)?"":Pe(t)}catch{return String(n)}}function Ee(n){if(!n||typeof n!="object")return"";const t=["TIME_STAMP","TIME","TIMESTAMP","Fecha","FECHA","fecha","date"];for(const s of t){const m=n[s];if(!(m==null||m==="")){if(m instanceof Date||typeof m=="number"&&Number.isFinite(m))return m;if(typeof m=="object"&&typeof m.toDate=="function")return m.toDate();if(typeof m=="string"){const h=m.trim();if(/^(?:mon|tue|wed|thu|fri|sat|sun)$/i.test(h)||/^(?:monday|tuesday|wednesday|thursday|friday|saturday|sunday)$/i.test(h))continue;return m}}}return""}function Le(n,t){if(n==null||n==="")return"";let s=String(n).trim();const m=parseFloat(s);return isNaN(m)||(s=String(parseFloat(s))),t&&String(t).toLowerCase()==="hilo de fantasia"?s+"Flame":s}function ie(n){if(n==null||n==="")return null;const t=String(n).trim(),s=parseFloat(t);return isNaN(s)?t:String(parseFloat(t))}function Se(n){if(!n||n==="")return"";const t=String(n).trim(),s=t.match(/[\s-](\d+)[\s-]/);return s&&s[1]?s[1]:t}function H(n){if(n==null||n==="")return"—";const t=String(n).trim();if(t==="")return"—";const s=Number(t);return isNaN(s)?t:Number(s.toFixed(2)).toString()}function x(n){if(n==null)return"—";const t=Number(n);return isNaN(t)?"—":Number(t.toFixed(2)).toString()}const g=G(""),i=G(""),D=G("all"),B=X(()=>{const n=new Set;for(const t of T.value||[]){if(g.value&&String(t.OE)!==g.value)continue;const s=t.Ne;s!=null&&s!==""&&n.add(String(s))}return Array.from(n).sort((t,s)=>{const m=parseFloat(t),h=parseFloat(s);return!isNaN(m)&&!isNaN(h)?m-h:t.localeCompare(s)})}),I=X(()=>{const n=new Set;for(const t of T.value||[]){if(i.value&&String(t.Ne)!==i.value)continue;const s=t.OE;s!=null&&s!==""&&n.add(String(s))}return Array.from(n).sort((t,s)=>{const m=parseInt(t)||0,h=parseInt(s)||0;return m!==h?m-h:t.localeCompare(s)})});ye(i,()=>{g.value&&i.value&&(I.value.includes(g.value)||(g.value=""))}),ye(g,()=>{i.value&&g.value&&(B.value.includes(i.value)||(i.value=""))});const q=["Ensayo","Fecha","OE","Ne","CVm %","Delg -30%","Delg -40%","Delg -50%","Grue +35%","Grue +50%","Neps +140%","Neps +280%","Fuerza B","Elong. %","Tenac.","Trabajo B","Titulo"],fe=X(()=>q);function ce(){try{_e.value.push(Date.now()),_e.value.length>6&&_e.value.shift()}catch{}Z.value&&clearTimeout(Z.value);const n=Number(ve.value||et);Z.value=setTimeout(()=>{be.value=S.value},n)}function ne(){S.value="",g.value="",i.value="",be.value=""}function Fe(){D.value="all"}function Te(){D.value=D.value==="ok"?"all":"ok"}function Me(){D.value=D.value==="out-of-range"?"all":"out-of-range"}const M=X(()=>{const n=(be.value||"").toString().trim().toLowerCase(),t=(g.value||"").toString().trim().toLowerCase(),s=(i.value||"").toString().trim().toLowerCase(),m=T.value||[],h=n?n.split(/\s+/).filter(Boolean):[];return m.filter(_=>{const L=!n||h.every(F=>fe.value.some(c=>{const y=_[c];return y==null?!1:String(y).toLowerCase().includes(F)})),E=!t||(_.OE==null?"":String(_.OE).toLowerCase())===t,C=!s||(_.Ne==null?"":String(_.Ne).toLowerCase())===s;let a=!0;if(D.value!=="all"){const F=_["Desvío %"],c=F!=null?parseFloat(String(F).replace("%","").replace(",",".").replace("+","")):null;c!=null&&!isNaN(c)?D.value==="ok"?a=c>=-1.5&&c<=1.5:D.value==="out-of-range"&&(a=c<-1.5||c>1.5):a=!1}return L&&E&&C&&a})}),j=G(1),Q=G(25),$=X(()=>!M.value||Q.value===0?1:Math.max(1,Math.ceil(M.value.length/Q.value))),ae=X(()=>{const n=M.value||[];if(Q.value===0)return n;const t=(j.value-1)*Q.value;return n.slice(t,t+Q.value)}),at=X(()=>(M.value.length||0)===0?0:Q.value===0?1:(j.value-1)*Q.value+1),rt=X(()=>{const n=M.value.length||0;return n===0?0:Q.value===0?n:Math.min(n,j.value*Q.value)});ye([M,Q],()=>{j.value=1});const Re=G(1);function He(){const n=Number(Re.value)||1;n<1?j.value=1:n>$.value?j.value=$.value:j.value=Math.floor(n),Re.value=j.value}ye(j,n=>{Re.value=n});const Ue=G(!1),W=G(!1),he=G(null),Ce=G([]),ge=G([]),d=G({}),Oe=G([]),Be=G(!1),it=X(()=>(Ce.value||[]).map(t=>String(t.NO??t.NO_??t.HUSO??t.huso??"")).map(t=>({v:t,n:parseInt(t)||0})).sort((t,s)=>t.n-s.n).map(t=>t.v)),dt=X(()=>(Ce.value||[]).map(t=>({no:String(t.NO??t.NO_??t.HUSO??t.huso??""),titulo:t.TITULO??t.titulo??""})).map(t=>({...t,n:parseInt(t.no)||0})).sort((t,s)=>t.n-s.n).map(t=>Number(t.titulo)).filter(t=>Number.isFinite(t))),ct=X(()=>{var s;const n=(s=O.value)!=null&&s.ne?String(O.value.ne):"",t=parseFloat(n.replace("Flame","").replace(",","."));return Number.isFinite(t)?t:""});function ut(n){he.value=n,Be.value=!0}ye(he,async n=>{if(!n){ge.value=[],Ce.value=[],Oe.value=[],d.value={};return}W.value=!0;try{const{usterTbl:t,tensorapidTbl:s,tensorapidPar:m}=re.value||{};let h=(t||[]).filter(o=>String(o.TESTNR||o.testnr||"")===String(n));const _=(o,r)=>{const b=new Set,f=[];for(const w of o){let K;try{K=r(w)}catch{K=void 0}if(!K){f.push(w);continue}b.has(K)||(b.add(K),f.push(w))}return f};h=_(h,o=>{const r=String(o.TESTNR||o.testnr||""),b=String(o.NO??o.NO_??o.HUSO??o.huso??"");return r&&b?`${r}#${b}`:void 0}),Ce.value=h;const L=(m||[]).filter(o=>String(o.USTER_TESTNR||o.uster_testnr||o.usterTestnr||o.USTERTESTNR||"")===String(n)),E=[...new Set(L.map(o=>String(o.TESTNR||o.testnr||"")).filter(Boolean))];Oe.value=E;let C=(s||[]).filter(o=>{const r=String(o.TESTNR||o.testnr||"");return E.includes(r)});C=_(C,o=>{const r=String(o.TESTNR||o.testnr||""),b=String(o.HUSO_NUMBER??o.NO??o.no??"");return r&&b?`${r}#${b}`:void 0});const a=new Map;h.forEach(o=>{const r=String(o.NO??o.NO_??o.HUSO??o.huso??"");r&&a.set(r,o)});const F=new Map;C.forEach(o=>{const r=String(o.HUSO_NUMBER??o.NO??o.no??o.huso??"");r&&F.set(r,o)});const y=Array.from(a.keys()).sort((o,r)=>{const b=parseInt(o)||0,f=parseInt(r)||0;return b-f}),k=[],U=(T.value||[]).find(o=>String(o.Ensayo)===String(n)),v=U?parseFloat(String(U.Ne||"").replace(",",".")):0;y.forEach(o=>{const r=a.get(o)||{},b=F.get(o)||{},f=r.TITULO??r.titulo??"";let w="";if(v>0&&f!==""&&!isNaN(parseFloat(f))){const K=parseFloat(f),J=(v-K)/v*100,z=parseFloat(J.toFixed(2));w=(J>0?"+":"")+z}k.push({NO:o,TITULO:f,DESVIO_PERCENT:w,CVM_PERCENT:r["CVM_%"]??r.CVM_PERCENT??"",DELG_MINUS30_KM:r["DELG_-30%"]??r.DELG_MINUS30_KM??"",DELG_MINUS40_KM:r["DELG_-40%"]??r.DELG_MINUS40_KM??"",DELG_MINUS50_KM:r["DELG_-50%"]??r.DELG_MINUS50_KM??"",GRUE_35_KM:r["GRUE_+35%"]??r.GRUE_35_KM??"",GRUE_50_KM:r["GRUE_+50%"]??r.GRUE_50_KM??"",NEPS_140_KM:r["NEPS_+140%"]??r.NEPS_140_KM??"",NEPS_280_KM:r["NEPS_+280%"]??r.NEPS_280_KM??"",FUERZA_B:b.FUERZA_B??b.fuerza_b??"",ELONGACION:b.ELONGACION??b.elongacion??"",TENACIDAD:b.TENACIDAD??b.tenacidad??"",TRABAJO:b.TRABAJO??b.trabajo??""})}),ge.value=k;const N={};if(["TITULO","CVM_PERCENT","DELG_MINUS30_KM","DELG_MINUS40_KM","DELG_MINUS50_KM","GRUE_35_KM","GRUE_50_KM","NEPS_140_KM","NEPS_280_KM","FUERZA_B","ELONGACION","TENACIDAD","TRABAJO"].forEach(o=>{const r=k.map(b=>b[o]).filter(b=>b!=null&&b!=="").map(b=>Number(b)).filter(b=>!isNaN(b));if(r.length>0){const f=r.reduce((ue,we)=>ue+we,0)/r.length,w=r.reduce((ue,we)=>ue+Math.pow(we-f,2),0)/r.length,K=Math.sqrt(w),J=f!==0?K/f*100:null,z=Math.max(...r),me=Math.min(...r),R=[...r].sort((ue,we)=>ue-we),se=Math.ceil(R.length*.95)-1,Ae=R[Math.max(0,se)];N[o]={avg:f,sd:K,cv:J,q95:Ae,max:z,min:me,count:r.length}}else N[o]={avg:null,sd:null,cv:null,q95:null,max:null,min:null,count:0}}),N.TITULO&&N.TITULO.avg!=null&&v>0){const o=N.TITULO.avg,r=(v-o)/v*100;N.DESVIO_PERCENT={avg:r}}else N.DESVIO_PERCENT={avg:null};d.value=N}catch(t){console.error("Error loading modal data:",t),ge.value=[]}finally{W.value=!1}});const O=X(()=>{var U;const n=he.value||"—",t=Array.isArray(Oe.value)&&Oe.value.length>0?Oe.value[0]:"—";let s=(T.value||[]).find(v=>String(v==null?void 0:v.Ensayo)===String(n))||null;s||(s=Ce.value&&Ce.value[0]||ge.value&&ge.value[0]||{});const m=(s==null?void 0:s.TIME_STAMP)??(s==null?void 0:s.TIME)??(s==null?void 0:s.TIMESTAMP)??null;let h="—";if(m instanceof Date&&!isNaN(m.getTime())){const v=String(m.getDate()).padStart(2,"0"),N=String(m.getMonth()+1).padStart(2,"0"),Y=String(m.getFullYear()).slice(-2);h=`${v}/${N}/${Y}`}else m&&(h=pe(m)||"—");const _=(s==null?void 0:s.OE)??(s==null?void 0:s.Oe)??(s==null?void 0:s.oe)??"—",L=(s==null?void 0:s.Ne)??(s==null?void 0:s.NE)??(s==null?void 0:s.ne)??"—";let E=(s==null?void 0:s.OBS)??(s==null?void 0:s.Obs)??(s==null?void 0:s.obs)??(s==null?void 0:s.observaciones)??(s==null?void 0:s.OBSERVACIONES)??(s==null?void 0:s.Observacion)??(s==null?void 0:s.observacion)??null;(n==="05496"||n==="05497")&&console.log("DEBUG modalMeta para",n,":",{meta:s,obsRaw:E,hasOBS:"OBS"in(s||{})}),E&&typeof E=="object"&&(E._readableState||E._writableState||E._parentObj||E.offset!==void 0?E=null:E=E.value??E.text??E.obs??null);const C=E==null||String(E).trim()===""?null:String(E).trim();let a=(s==null?void 0:s.LABORANT)??(s==null?void 0:s.Laborant)??(s==null?void 0:s.laborant)??null;const F=a==null||String(a).trim()===""?null:String(a).trim();let c=null;if((U=re.value)!=null&&U.tensorapidPar){const v=re.value.tensorapidPar.find(N=>String(N.USTER_TESTNR||N.uster_testnr||N.usterTestnr||N.USTERTESTNR||"")===String(n));if(v){const N=v.LABORANT??v.Laborant??v.laborant??null;c=N==null||String(N).trim()===""?null:String(N).trim()}}let y=(s==null?void 0:s.ESTIRAJE)??(s==null?void 0:s.Estiraje)??(s==null?void 0:s.estiraje)??null;const k=y==null||String(y).trim()===""?null:String(y).trim();return{fechaStr:h,oe:_,ne:L,u:n,t,obs:C,laborant:F,tensorLaborant:c,estiraje:k}}),xe=X(()=>{const n=he.value;if(n==null)return-1;const t=M.value||[],s=t.findIndex(m=>String(m==null?void 0:m.Ensayo)===String(n));return console.log("modalIndex computed - selectedTestnr:",n,"found at index:",s,"list length:",t.length),s}),Ge=X(()=>xe.value<=0),je=X(()=>{const n=M.value||[];return xe.value===-1||xe.value>=n.length-1});function qe(){if(Ge.value)return;const t=(M.value||[])[xe.value-1],s=(t==null?void 0:t.Ensayo)||(t==null?void 0:t.TESTNR)||(t==null?void 0:t.testnr)||(t==null?void 0:t.Testnr);if(console.log("modalPrev - Current index:",xe.value,"Prev testnr:",s,"Prev item:",t),s!=null){if(!re.value||!re.value.usterTbl){console.warn("Datos aún no cargados, esperando...");return}$e(s)}else console.warn("No se pudo obtener testnr del item anterior:",t)}function Je(){if(je.value)return;const t=(M.value||[])[xe.value+1],s=(t==null?void 0:t.Ensayo)||(t==null?void 0:t.TESTNR)||(t==null?void 0:t.testnr)||(t==null?void 0:t.Testnr);if(console.log("modalNext - Current index:",xe.value,"Next testnr:",s,"Next item:",t),s!=null){if(!re.value||!re.value.usterTbl){console.warn("Datos aún no cargados, esperando...");return}$e(s)}else console.warn("No se pudo obtener testnr del item siguiente:",t)}function $e(n){console.log("openDetail called with testnr:",n),console.log("modalIndex before:",xe.value),he.value=n,Ue.value=!0,console.log("modalIndex after:",xe.value)}function Ke(){Ue.value=!1,he.value=null}async function pt(){try{const n=document.querySelector('[role="document"]');if(!n){ee.fire({icon:"error",title:"Error",text:"No se pudo encontrar el modal."});return}const t=document.querySelector('[aria-label="Anterior ensayo"]'),s=document.querySelector('[aria-label="Siguiente ensayo"]'),m=document.querySelector('[aria-label="Exportar detalle a Excel"]'),h=document.querySelector('[aria-label="Copiar como imagen"]'),_=document.querySelector('[aria-label="Cerrar detalle"]'),L=t==null?void 0:t.style.display,E=s==null?void 0:s.style.display,C=m==null?void 0:m.style.display,a=h==null?void 0:h.style.display,F=_==null?void 0:_.style.display;t&&(t.style.display="none"),s&&(s.style.display="none"),m&&(m.style.display="none"),h&&(h.style.display="none"),_&&(_.style.display="none"),ee.fire({title:"Capturando...",allowOutsideClick:!1,showConfirmButton:!1,timer:100,didOpen:()=>{ee.showLoading()}});const c=console.error;console.error=(...y)=>{var U;const k=((U=y[0])==null?void 0:U.toString())||"";k.includes("CSS rules")||k.includes("cssRules")||k.includes("SecurityError")||c.apply(console,y)};try{const y=await nt(n,{quality:.95,pixelRatio:2,backgroundColor:"#ffffff",skipFonts:!0,cacheBust:!0});console.error=c,t&&(t.style.display=L||""),s&&(s.style.display=E||""),m&&(m.style.display=C||""),h&&(h.style.display=a||""),_&&(_.style.display=F||"");const U=await(await fetch(y)).blob();try{await navigator.clipboard.write([new ClipboardItem({"image/png":U})]),ee.fire({icon:"success",title:"¡Copiado!",text:"Pega en WhatsApp: Ctrl+V",timer:1500,showConfirmButton:!1})}catch(v){console.warn("Clipboard not available, downloading instead:",v);const N=document.createElement("a");N.download=`ensayo-${he.value||"detalle"}.png`,N.href=y,N.click(),ee.fire({icon:"success",title:"Descargado",text:"Imagen lista para WhatsApp",timer:1500,showConfirmButton:!1})}}catch(y){throw console.error=c,t&&(t.style.display=L||""),s&&(s.style.display=E||""),m&&(m.style.display=C||""),h&&(h.style.display=a||""),_&&(_.style.display=F||""),y}}catch(n){console.error("Error capturing modal:",n),ee.fire({icon:"error",title:"Error",text:`No se pudo capturar la imagen: ${n.message}`})}}async function xt(){try{const n=ge.value||[];if(!n.length){ee.fire({icon:"info",title:"Nada para exportar",text:"No hay filas en el detalle del ensayo."});return}const t=["Huso","Fecha","Ne","OE Nro.","Titulo","Estiraje","CVm %","Delg -30%","Delg -40%","Delg -50%","Grue +35%","Grue +50%","Neps +140%","Neps +280%","Fuerza B","Elongación %","Tenacidad","Trabajo","Observaciones","Uster","TensoRapid"],s=o=>{if(o==null||o==="")return"";if(typeof o=="number")return o;const r=String(o).trim(),b=Number(r.replace(/,/g,".").replace(/[^0-9.+\-eE]/g,""));return Number.isFinite(b)?b:r},m=n.map(o=>{const r=[];return r.push(s(o.NO)),r.push(O.value.fechaStr||""),r.push(O.value.ne||""),r.push(O.value.oe||""),r.push(s(o.TITULO)),r.push(O.value.estiraje||""),r.push(s(o.CVM_PERCENT)),r.push(s(o.DELG_MINUS30_KM)),r.push(s(o.DELG_MINUS40_KM)),r.push(s(o.DELG_MINUS50_KM)),r.push(s(o.GRUE_35_KM)),r.push(s(o.GRUE_50_KM)),r.push(s(o.NEPS_140_KM)),r.push(s(o.NEPS_280_KM)),r.push(s(o.FUERZA_B)),r.push(s(o.ELONGACION)),r.push(s(o.TENACIDAD)),r.push(s(o.TRABAJO)),r.push((o.OBS??O.value.obs)||""),r.push(O.value.u||""),r.push(O.value.t||""),r}),h=new Qe.Workbook;h.creator="carga-datos-vue",h.created=new Date;const _=h.addWorksheet("Detalle");try{_.views=[{state:"frozen",xSplit:2,ySplit:1,topLeftCell:"C2",activeCell:"C2"}]}catch{}_.addRow(t),m.forEach(o=>_.addRow(o));const L={Huso:10,Fecha:11,Ne:7.29,"OE Nro.":8.29,Titulo:8.14,"CVm %":7.5,"Delg -30%":7.5,"Delg -40%":7.5,"Delg -50%":7.5,"Grue +35%":7.5,"Grue +50%":7.5,"Neps +140%":7.5,"Neps +280%":7.5,"Fuerza B":7.5,"Elongación %":7.5,Tenacidad:7.5,Trabajo:7.5,Observaciones:68.5,Uster:10,TensoRapid:11};_.columns=t.map(o=>({header:o,width:L[o]||Math.max(8,String(o).length+4)}));const E=_.getRow(1);E.font={bold:!0,color:{argb:"FFFFFFFF"}},E.alignment={horizontal:"center",vertical:"middle",wrapText:!0},E.eachCell(o=>{o.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF6366F1"}},o.border={bottom:{style:"thin",color:{argb:"FFCCCCCC"}}}});const C=m.length+1,a=t.length;try{_.autoFilter={from:{row:1,column:1},to:{row:C,column:a}}}catch{}try{["Delg -30%","Delg -40%","Delg -50%","Grue +35%","Grue +50%","Fuerza B"].forEach(b=>{const f=t.indexOf(b);if(f!==-1){const w=_.getColumn(f+1);w.numFmt="0"}}),["Titulo","CVm %","Elongación %","Tenacidad","Trabajo"].forEach(b=>{const f=t.indexOf(b);if(f!==-1){const w=_.getColumn(f+1);w.numFmt="0.00"}}),["Neps +140%","Neps +280%"].forEach(b=>{const f=t.indexOf(b);if(f!==-1){const w=_.getColumn(f+1);w.numFmt="0"}})}catch{}for(let o=2;o<=C;o++){const r=_.getRow(o),b=o%2===0;r.height=18,r.eachCell(f=>{f.alignment={horizontal:"center",vertical:"middle"},b&&(f.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8FAFF"}})})}const F=t.findIndex(o=>String(o).toLowerCase().includes("fecha"));if(F!==-1){const o=_.getColumn(F+1);o.numFmt="dd/mm/yyyy",_.eachRow((r,b)=>{if(b===1)return;const f=r.getCell(F+1),w=f.value;if(w==null||w===""||w instanceof Date)return;const K=String(w).trim(),J=K.match(/^([0-9]{1,2})[-/.]([0-9]{1,2})[-/.]([0-9]{2,4})$/);if(J){let z=parseInt(J[1],10),me=parseInt(J[2],10),R=parseInt(J[3],10);R<100&&(R+=R>=70?1900:2e3);const se=new Date(R,me-1,z);isNaN(se.getTime())||(f.value=se)}else{const z=new Date(K);isNaN(z.getTime())||(f.value=z)}})}try{const o=d.value||{},r=["TITULO","CVM_PERCENT","DELG_MINUS30_KM","DELG_MINUS40_KM","DELG_MINUS50_KM","GRUE_35_KM","GRUE_50_KM","NEPS_140_KM","NEPS_280_KM","FUERZA_B","ELONGACION","TENACIDAD","TRABAJO"];[{key:"avg",label:"Promedio"},{key:"cv",label:"CV"},{key:"sd",label:"s"},{key:"q95",label:"Q95"},{key:"max",label:"Máx"},{key:"min",label:"Mín"}].forEach(f=>{const w=[];w.push(f.label);const K=m.length?m[0][1]:null;w.push(K||O.value.fechaStr||""),w.push(O.value.ne||""),w.push(O.value.oe||""),r.forEach(z=>{const R=(o[z]||{})[f.key];R==null?w.push(""):typeof R=="number"?w.push(Number(R.toFixed(2))):w.push(R)}),w.push(O.value.obs||""),w.push(O.value.u||""),w.push(O.value.t||"");const J=_.addRow(w);J.height=18,J.eachCell(z=>{z.alignment={horizontal:"center",vertical:"middle"}})})}catch{}const c=await h.xlsx.writeBuffer(),y=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),k=URL.createObjectURL(y),U=document.createElement("a"),v=new Date,N=o=>String(o).padStart(2,"0"),Y=`${v.getFullYear()}-${N(v.getMonth()+1)}-${N(v.getDate())}_${N(v.getHours())}${N(v.getMinutes())}${N(v.getSeconds())}`;U.href=k,U.setAttribute("download",`detalle-ensayo-${O.value.u||"ensayo"}-${Y}.xlsx`),document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(k),ee.fire({icon:"success",title:"Exportado",text:"Detalle exportado a XLSX.",timer:1200,showConfirmButton:!1})}catch(n){console.error("Error exportando detalle a XLSX",n),ee.fire({icon:"error",title:"Error",text:"No se pudo exportar el detalle."})}}function mt(n){if(!n)return"";const t=String(n).trim();if(!t)return t;const s=t.match(/^(\d+)\s*([A-Za-z]+)?/);if(!s)return t;const m=parseInt(s[1],10),h=s[2]?s[2].substring(0,2).toUpperCase():"";return h?`${m} ${h}`:String(m)}async function We(){De.value=!0;try{const n=await _t();re.value=n;const t=Array.isArray(n.usterPar)?n.usterPar:[],s=Array.isArray(n.usterTbl)?n.usterTbl:[],m=Array.isArray(n.tensorapidTbl)?n.tensorapidTbl:[],h=Array.isArray(n.tensorapidPar)?n.tensorapidPar:[],_=new Map;s.forEach(c=>{const y=String(c.TESTNR??c.testnr??c.Testnr??"");y&&(_.has(y)||_.set(y,[]),_.get(y).push(c))});const L=new Map;m.forEach(c=>{const y=String(c.TESTNR??c.testnr??c.Testnr??"");y&&(L.has(y)||L.set(y,[]),L.get(y).push(c))});const E=new Map;h.forEach(c=>{const y=String(c.USTER_TESTNR??c.uster_testnr??c.usterTestnr??"");y&&(E.has(y)||E.set(y,[]),E.get(y).push(c))});const C=(c,y)=>{const k=c.map(v=>v[y]).filter(v=>v!=null&&v!=="").map(v=>Number(v)).filter(v=>!isNaN(v));if(k.length===0)return"";const U=k.reduce((v,N)=>v+N,0)/k.length;return Number(U.toFixed(2)).toString()};let a=t.map(c=>{const y=String(c.TESTNR??c.testnr??c.Testnr??""),k=_.get(y)||[];let U=[];E.has(y)&&(U=E.get(y));let v=null;U.length>0&&(v=U.slice().sort((R,se)=>{const Ae=new Date(R.TIME_STAMP||R.time_stamp||0);return new Date(se.TIME_STAMP||se.time_stamp||0)-Ae})[0]);let N=[];v&&v.TESTNR&&(N=L.get(String(v.TESTNR))||[]);const Y=c.TIME_STAMP||c.TIME||c.TIMESTAMP||c.CREATED_AT||c.created_at||null;let o=null;if(Y)if(Y instanceof Date)o=Y;else if(typeof Y=="string"){const R=Y.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})(?:\s+(\d{1,2}):(\d{2})(?::(\d{2}))?)?/);if(R){const se=parseInt(R[1],10),Ae=parseInt(R[2],10)-1;let ue=parseInt(R[3],10);ue<100&&(ue+=2e3);const we=R[4]?parseInt(R[4],10):0,vt=R[5]?parseInt(R[5],10):0,ft=R[6]?parseInt(R[6],10):0;o=new Date(ue,Ae,se,we,vt,ft)}else o=new Date(Y)}else o=new Date(Y);const r=v&&(v.TESTNR??v.testnr??v.Testnr)?String(v.TESTNR??v.testnr??v.Testnr):"",b=c.OBS??c.OBSERVACION??c.OBSERVACAO??c.obs??"",f=c.LABORANT??c.Laborant??c.laborant??"",w=v?v.LABORANT??v.Laborant??v.laborant??"":"",K=parseFloat(c.NOMCOUNT??c.Ne??c.NE??0),J=C(k,"TITULO"),z=J?parseFloat(J):null;let me="—";if(K>0&&z!==null&&!isNaN(z)){const R=(K-z)/K*100,se=parseFloat(R.toFixed(2));me=(R>0?"+":"")+se}return{Ensayo:y,TIME_STAMP:o,Fecha:c.Fecha||c.fecha||c.FECHA||"",Lote:Se(c.LOTE||c.Lote||c.lote||""),OE:mt(c.MASCHNR??c.OE??c.OE_NRO??c.OE_NRO_1??c.oe??c.OE_NRO_PAR??""),Ne:Le(c.NOMCOUNT??c.Ne??c.NE??c.titulo??c.TITULO??"",c.MATCLASS),"Desvío %":me,Titulo:C(k,"TITULO"),Estiraje:ie(c.ESTIRAJE),Pasador:c.PASADOR||null,"CVm %":C(k,"CVM_PERCENT")||C(k,"CVM_%"),"Delg -30%":C(k,"DELG_MINUS30_KM")||C(k,"DELG_-30%"),"Delg -40%":C(k,"DELG_MINUS40_KM")||C(k,"DELG_-40%"),"Delg -50%":C(k,"DELG_MINUS50_KM")||C(k,"DELG_-50%"),"Grue +35%":C(k,"GRUE_35_KM")||C(k,"GRUE_+35%"),"Grue +50%":C(k,"GRUE_50_KM")||C(k,"GRUE_+50%"),"Neps +140%":C(k,"NEPS_140_KM")||C(k,"NEPS_+140%"),"Neps +280%":C(k,"NEPS_280_KM")||C(k,"NEPS_+280%"),"Fuerza B":C(N,"FUERZA_B"),"Elong. %":C(N,"ELONGACION"),"Tenac.":C(N,"TENACIDAD"),"Trabajo B":C(N,"TRABAJO"),OBS:b,LABORANT:f,"Op. Uster":f,"Op. TensoRapid":w,TensoRapid:r}});a=a.map(c=>{let y=String(c.MATCLASS).toLowerCase()==="hilo de fantasia";return{...c,_isFlame:y}}),a.sort((c,y)=>{const k=c.TIME_STAMP&&c.TIME_STAMP instanceof Date&&!isNaN(c.TIME_STAMP)?c.TIME_STAMP:new Date(0),v=(y.TIME_STAMP&&y.TIME_STAMP instanceof Date&&!isNaN(y.TIME_STAMP)?y.TIME_STAMP:new Date(0)).getTime()-k.getTime();if(v!==0)return v;const N=String(c.Ensayo||"").trim();return String(y.Ensayo||"").trim().localeCompare(N,void 0,{numeric:!0})});const F=new Set;a=a.filter(c=>{const y=String(c.Ensayo||"").trim();return F.has(y)?(console.warn("Ensayo duplicado encontrado y eliminado:",y),!1):(F.add(y),!0)}),T.value=a}catch(n){console.error("Failed to load rows",n),ee.fire({icon:"error",title:"Error",text:"No se pudo cargar el informe completo."})}finally{De.value=!1}}async function bt(){try{if(!M.value||M.value.length===0){ee.fire({icon:"warning",title:"Sin datos",text:"No hay registros para exportar."});return}const n=["Fecha","Lote","OE","Ne","Desvío %","Titulo","Estiraje","Pasador","CVm %","Delg -30%","Delg -40%","Delg -50%","Grue +35%","Grue +50%","Neps +140%","Neps +280%","Fuerza B","Elong. %","Tenac.","Trabajo B","OBS","Op. Uster","Op. TensoRapid","Uster","TensoRapid"],t=o=>{if(o==null||o==="")return"";if(typeof o=="number")return o;const r=String(o).trim(),b=Number(r.replace(/,/g,".").replace(/[^0-9.+\-eE]/g,""));return Number.isFinite(b)?b:r},s=M.value.map(o=>[pe(Ee(o)),o.Lote||"",o.OE||"",o.Ne||"",o["Desvío %"]==null?"":String(o["Desvío %"]).replace(/\./g,","),t(o.Titulo),t(o.Estiraje),o.Pasador||"-",t(o["CVm %"]),t(o["Delg -30%"]),t(o["Delg -40%"]),t(o["Delg -50%"]),t(o["Grue +35%"]),t(o["Grue +50%"]),t(o["Neps +140%"]),t(o["Neps +280%"]),t(o["Fuerza B"]),t(o["Elong. %"]),t(o["Tenac."]),t(o["Trabajo B"]),o.OBS||"",o["Op. Uster"]||"",o["Op. TensoRapid"]||"",t(o.Ensayo),o.TensoRapid||""]),m=new Qe.Workbook;m.creator="carga-datos-vue",m.created=new Date;const h=m.addWorksheet("Resumen");try{h.views=[{state:"frozen",xSplit:2,ySplit:1,topLeftCell:"C2",activeCell:"C2"}]}catch{}h.addRow(n),s.forEach(o=>h.addRow(o));const _={Fecha:10.5,OE:7.29,Ne:8.29,"Desvío %":9,Titulo:8.14,"CVm %":7.5,"Delg -30%":7.5,"Delg -40%":7.5,"Delg -50%":7.5,"Grue +35%":7.5,"Grue +50%":7.5,"Neps +140%":7.5,"Neps +280%":7.5,"Fuerza B":7.5,"Elong. %":7.5,"Tenac.":7.5,"Trabajo B":7.5,OBS:68.5,Uster:10,TensoRapid:11};h.columns=n.map(o=>({header:o,width:_[o]||Math.max(10,String(o).length+2)}));const L=h.getRow(1);L.font={bold:!0,color:{argb:"FFFFFFFF"}},L.height=30,L.alignment={horizontal:"center",vertical:"middle",wrapText:!0},L.eachCell(o=>{o.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF6366F1"}},o.border={bottom:{style:"thin",color:{argb:"FFCCCCCC"}}}});const E=s.length+1,C=n.length;try{h.autoFilter={from:{row:1,column:1},to:{row:E,column:C}}}catch{}try{["Delg -30%","Delg -40%","Delg -50%","Grue +35%","Grue +50%","Fuerza B"].forEach(b=>{const f=n.indexOf(b);if(f!==-1){const w=h.getColumn(f+1);w.numFmt="0"}}),["Titulo","Estiraje","CVm %","Elong. %","Tenac.","Trabajo B"].forEach(b=>{const f=n.indexOf(b);if(f!==-1){const w=h.getColumn(f+1);w.numFmt="0.00"}}),["Neps +140%","Neps +280%"].forEach(b=>{const f=n.indexOf(b);if(f!==-1){const w=h.getColumn(f+1);w.numFmt="0"}})}catch{}for(let o=2;o<=E;o++){const r=h.getRow(o),b=o%2===0;r.height=18,r.eachCell(f=>{f.alignment={horizontal:"center",vertical:"middle"},b&&(f.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF8FAFF"}})})}const a=n.indexOf("Desvío %");if(a!==-1)for(let o=2;o<=E;o++){const b=h.getRow(o).getCell(a+1);let f=b.value;if(typeof f=="string"){const w=f.replace(",",".").replace(/\s+/g,"");f=parseFloat(w)}typeof f=="number"&&!isNaN(f)&&(b.value=f),typeof f=="number"&&!isNaN(f)&&(f>1.5?b.font={bold:!0,color:{argb:"FFDC2626"}}:f<-1.5?b.font={bold:!0,color:{argb:"FF2563EB"}}:b.font={bold:!0,color:{argb:"FF16A34A"}})}const F=n.findIndex(o=>String(o).toLowerCase().includes("fecha"));if(F!==-1){const o=h.getColumn(F+1);o.numFmt="dd/mm/yyyy",h.eachRow((r,b)=>{if(b===1)return;const f=r.getCell(F+1),w=f.value;if(w==null||w===""||w instanceof Date)return;const K=String(w).trim(),J=K.match(/^([0-9]{1,2})[-/.]([0-9]{1,2})[-/.]([0-9]{2,4})$/);if(J){let z=parseInt(J[1],10),me=parseInt(J[2],10),R=parseInt(J[3],10);R<100&&(R+=R>=70?1900:2e3);const se=new Date(R,me-1,z);isNaN(se.getTime())||(f.value=se)}else{const z=new Date(K);isNaN(z.getTime())||(f.value=z)}})}const c=await m.xlsx.writeBuffer(),y=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),k=URL.createObjectURL(y),U=document.createElement("a"),v=new Date,N=o=>String(o).padStart(2,"0"),Y=`${v.getFullYear()}-${N(v.getMonth()+1)}-${N(v.getDate())}_${N(v.getHours())}${N(v.getMinutes())}${N(v.getSeconds())}`;U.href=k,U.setAttribute("download",`resumen-ensayos-${Y}.xlsx`),document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(k),ee.fire({icon:"success",title:"Exportado",text:`${s.length} registros exportados a XLSX.`,timer:1500,showConfirmButton:!1})}catch(n){console.error("Error exporting XLSX (ExcelJS)",n),ee.fire({icon:"error",title:"Error",text:"No se pudo exportar a XLSX."})}}return st(()=>{We();const n=t=>{t.key==="Escape"&&Ue.value&&Ke()};window.addEventListener("keydown",n),window._resumenEnsayosEscHandler=n}),ot(()=>{try{window._resumenEnsayosEscHandler&&(window.removeEventListener("keydown",window._resumenEnsayosEscHandler),delete window._resumenEnsayosEscHandler)}catch{}}),(n,t)=>{var m,h,_,L,E,C;const s=lt("tippy");return u(),p("div",as,[e("main",rs,[e("div",is,[e("div",ds,[P((u(),p("div",{class:de(["flex items-center justify-center w-8 h-8 rounded-full ml-12 lg:ml-0 transition-all duration-300",le.value==="firebase"?"bg-orange-100 text-orange-600":"bg-blue-100 text-blue-600"])},[le.value==="firebase"?(u(),p("svg",cs,[...t[12]||(t[12]=[e("path",{d:"M3.89 15.672L6.255.461A.542.542 0 017.27.288l2.543 4.771zm16.794 3.692l-2.25-14a.54.54 0 00-.919-.295L3.316 19.365l7.856 4.427a1.621 1.621 0 001.588 0zM14.3 7.147l-1.82-3.482a.542.542 0 00-.96 0L3.53 17.984z"},null,-1)])])):(u(),p("svg",us,[...t[13]||(t[13]=[e("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"},null,-1),A(" import { ref } from 'vue'; import { useStore } from 'vuex'; import { useRoute } from 'vue-router'; ",-1),e("line",{x1:"8",y1:"21",x2:"16",y2:"21"},null,-1),e("line",{x1:"12",y1:"17",x2:"12",y2:"21"},null,-1)])]))],2)),[[s,{content:Ne.value,placement:"bottom",theme:"custom"}]]),t[25]||(t[25]=e("h3",{class:"text-lg font-semibold text-slate-800 whitespace-nowrap"},"Resumen de Ensayos",-1)),e("div",ps,[t[15]||(t[15]=e("label",{for:"searchInput",class:"sr-only"},"Buscar ensayos",-1)),P(e("input",{id:"searchInput","onUpdate:modelValue":t[0]||(t[0]=a=>S.value=a),onInput:ce,type:"search",placeholder:"Buscar...","aria-label":"Buscar ensayos",class:"px-3 py-1.5 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all w-24 @[1150px]:w-auto"},null,544),[[Xe,S.value]]),S.value||i.value||g.value?P((u(),p("button",{key:0,onClick:ne,class:"inline-flex items-center gap-1 px-1.5 @[1150px]:px-1.5 py-1.5 border border-slate-200 bg-white text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md"},[...t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1),e("span",{class:"hidden @[1150px]:inline"},"Limpiar",-1)])])),[[s,{content:"Limpiar filtros",placement:"bottom",theme:"custom"}]]):te("",!0)]),e("div",xs,[e("div",ms,[e("div",bs,[t[18]||(t[18]=e("label",{for:"neFilter",class:"text-sm text-slate-600"},"Ne:",-1)),P(e("select",{id:"neFilter","onUpdate:modelValue":t[1]||(t[1]=a=>i.value=a),"aria-label":"Filtrar por Ne",class:"px-2 py-1 border border-slate-200 rounded-lg text-sm text-slate-900",style:{width:"9.5ch","min-width":"9.5ch","max-width":"9.5ch"}},[t[16]||(t[16]=e("option",{value:""},"Todos",-1)),(u(!0),p(V,null,Ie(B.value,a=>(u(),p("option",{key:a,value:a},l(a),9,vs))),128))],512),[[Ve,i.value]]),t[19]||(t[19]=e("label",{for:"oeFilter",class:"text-sm text-slate-600"},"OE:",-1)),P(e("select",{id:"oeFilter","onUpdate:modelValue":t[2]||(t[2]=a=>g.value=a),"aria-label":"Filtrar por OE",class:"px-2 py-1 border border-slate-200 rounded-lg text-sm text-slate-900",style:{width:"9.5ch","min-width":"9.5ch","max-width":"9.5ch"}},[t[17]||(t[17]=e("option",{value:""},"Todos",-1)),(u(!0),p(V,null,Ie(I.value,a=>(u(),p("option",{key:a,value:a},l(a),9,fs))),128))],512),[[Ve,g.value]])]),e("div",hs,[P((u(),p("button",{onClick:Fe,class:de(["inline-flex items-center gap-1 px-2 @[1150px]:px-1.5 py-1 border border-slate-200 rounded-lg text-sm font-medium transition-colors duration-150 shadow-sm hover:shadow-md",D.value==="all"?"bg-blue-50 text-blue-700 border-blue-500":"bg-white text-slate-700 hover:bg-slate-50"])},[...t[20]||(t[20]=[ze('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" data-v-1b319586><rect x="3" y="3" width="7" height="7" stroke-linecap="round" stroke-linejoin="round" data-v-1b319586></rect><rect x="14" y="3" width="7" height="7" stroke-linecap="round" stroke-linejoin="round" data-v-1b319586></rect><rect x="14" y="14" width="7" height="7" stroke-linecap="round" stroke-linejoin="round" data-v-1b319586></rect><rect x="3" y="14" width="7" height="7" stroke-linecap="round" stroke-linejoin="round" data-v-1b319586></rect></svg><span class="hidden @[1150px]:inline" data-v-1b319586>Todos</span>',2)])],2)),[[s,{content:D.value==="all"?"Mostrando todos":"Mostrar todos los ensayos",placement:"bottom",theme:"custom"}]]),P((u(),p("button",{onClick:Te,class:de(["inline-flex items-center gap-1 px-2 @[1150px]:px-1.5 py-1 border border-slate-200 rounded-lg text-sm font-medium transition-colors duration-150 shadow-sm hover:shadow-md",D.value==="ok"?"bg-green-50 text-green-700 border-green-500":"bg-white text-slate-700 hover:bg-slate-50"])},[...t[21]||(t[21]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14","stroke-linecap":"round","stroke-linejoin":"round"}),e("polyline",{points:"22 4 12 14.01 9 11.01","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",{class:"hidden @[1150px]:inline"},"Dentro",-1)])],2)),[[s,{content:D.value==="ok"?"Clic para quitar filtro":"Solo ensayos dentro de ±1.5%",placement:"bottom",theme:"custom"}]]),P((u(),p("button",{onClick:Me,class:de(["inline-flex items-center gap-1 px-2 @[1150px]:px-1.5 py-1 border border-slate-200 rounded-lg text-sm font-medium transition-colors duration-150 shadow-sm hover:shadow-md",D.value==="out-of-range"?"bg-red-50 text-red-700 border-red-500":"bg-white text-slate-700 hover:bg-slate-50"])},[...t[22]||(t[22]=[ze('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" data-v-1b319586><circle cx="12" cy="12" r="10" stroke-linecap="round" stroke-linejoin="round" data-v-1b319586></circle><line x1="12" y1="8" x2="12" y2="12" stroke-linecap="round" stroke-linejoin="round" data-v-1b319586></line><line x1="12" y1="16" x2="12.01" y2="16" stroke-linecap="round" stroke-linejoin="round" data-v-1b319586></line></svg><span class="hidden @[1150px]:inline" data-v-1b319586>Fuera</span>',2)])],2)),[[s,{content:D.value==="out-of-range"?"Clic para quitar filtro":"Solo ensayos fuera de ±1.5%",placement:"bottom",theme:"custom"}]])])])]),e("div",gs,[P((u(),p("button",{onClick:We,class:"inline-flex items-center gap-1 px-2 @[1150px]:px-1.5 py-1 border border-slate-200 bg-white text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md"},[...t[23]||(t[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","aria-hidden":"true"},[e("path",{d:"M21 12a9 9 0 1 1-3-6.7","stroke-linecap":"round","stroke-linejoin":"round"}),e("polyline",{points:"21 3 21 9 15 9","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",{class:"hidden @[1150px]:inline"},"Refrescar",-1)])])),[[s,{content:"Refrescar datos",placement:"bottom",theme:"custom"}]]),P((u(),p("button",{onClick:bt,class:"inline-flex items-center gap-1 px-2 @[1150px]:px-1.5 py-1 border border-slate-200 bg-white text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md"},[...t[24]||(t[24]=[ze('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" data-v-1b319586><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke-linecap="round" stroke-linejoin="round" data-v-1b319586></path><polyline points="7 10 12 15 17 10" stroke-linecap="round" stroke-linejoin="round" data-v-1b319586></polyline><line x1="12" y1="15" x2="12" y2="3" stroke-linecap="round" stroke-linejoin="round" data-v-1b319586></line></svg><span class="hidden @[1150px]:inline" data-v-1b319586>Exportar</span>',2)])])),[[s,{content:"Exportar a Excel (XLSX)",placement:"bottom",theme:"custom"}]])])])]),De.value?(u(),p("div",ys,[...t[26]||(t[26]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-slate-300 border-t-blue-600"},null,-1),e("p",{class:"mt-2"},"Cargando...",-1)])])):(u(),p("div",_s,[T.value.length===0?(u(),p("div",Es,"No hay ensayos.")):(u(),p("div",ws,[M.value.length===0?(u(),p("div",Ns," No hay coincidencias para la búsqueda. ")):te("",!0),e("div",Ss,[e("table",Ts,[t[29]||(t[29]=e("colgroup",null,[e("col",{style:{width:"6%"}}),e("col",{style:{width:"6%"}}),e("col",{style:{width:"4%"}}),e("col",{style:{width:"11%"}}),e("col",{style:{width:"5%"}}),e("col",{style:{width:"6%"}}),e("col",{style:{width:"11%"}}),e("col",{style:{width:"5%"}}),e("col",{style:{width:"5%"}}),e("col",{style:{width:"3%"}}),e("col",{style:{width:"3%"}}),e("col",{style:{width:"3%"}}),e("col",{style:{width:"3%"}}),e("col",{style:{width:"3%"}}),e("col",{style:{width:"3%"}}),e("col",{style:{width:"3%"}}),e("col",{style:{width:"6%"}}),e("col",{style:{width:"6%"}}),e("col",{style:{width:"6%"}}),e("col",{style:{width:"6%"}}),e("col",{style:{width:"6%"}})],-1)),t[30]||(t[30]=e("thead",{class:"bg-gradient-to-r from-slate-50 to-slate-100 sticky top-0 z-20"},[e("tr",null,[e("th",{class:"px-2 py-[0.3rem] text-center font-semibold text-slate-700 border-b border-slate-200"},"Ensayo "),e("th",{class:"px-2 py-[0.3rem] text-center font-semibold text-slate-700 border-b border-slate-200"},"Fecha "),e("th",{class:"px-2 py-[0.3rem] text-center font-semibold text-slate-700 border-b border-slate-200"},"Lote "),e("th",{class:"px-2 py-[0.3rem] text-center font-semibold text-slate-700 border-b border-slate-200"},"OE "),e("th",{class:"px-2 py-[0.3rem] text-center font-semibold text-slate-700 border-b border-slate-200"},"Ne "),e("th",{class:"px-2 py-[0.3rem] text-center font-semibold text-slate-700 border-b border-slate-200"},"Desvío % "),e("th",{class:"px-2 py-[0.3rem] text-center font-semibold text-slate-700 border-b border-slate-200"},"Titulo "),e("th",{class:"px-2 py-[0.3rem] text-center font-semibold text-slate-700 border-b border-slate-200"},"Estiraje "),e("th",{class:"px-2 py-[0.3rem] text-center font-semibold text-slate-700 border-b border-slate-200"},"Pasador "),e("th",{class:"px-2 py-[0.3rem] text-center font-semibold text-slate-700 border-b border-slate-200"},"CVm % "),e("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200"},"Delg -30% "),e("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200"},"Delg -40% "),e("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200"},"Delg -50% "),e("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200"},"Grue +35% "),e("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200"},"Grue +50% "),e("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200"},"Neps +140% "),e("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200"},"Neps +280% "),e("th",{class:"px-2 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Fuerza B"),e("th",{class:"px-2 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Elong. %"),e("th",{class:"px-2 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Tenac."),e("th",{class:"px-2 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Trabajo B "),e("th",{class:"px-2 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Acciones")])],-1)),e("tbody",null,[(u(!0),p(V,null,Ie(ae.value,(a,F)=>(u(),p("tr",{key:F,class:de(["border-t border-slate-100 hover:bg-blue-50/30 transition-colors duration-150",a._isFlame?"font-bold":""])},[e("td",Ms,l(a.Ensayo),1),e("td",Cs,l(pe(Ee(a))),1),e("td",ks,l(a.Lote),1),e("td",Ds,l(a.OE),1),e("td",Rs,l(a.Ne),1),e("td",{class:de(["px-2 py-[0.3rem] text-center font-semibold",{"text-red-600":a["Desvío %"]&&parseFloat(a["Desvío %"])>1.5,"text-blue-600":a["Desvío %"]&&parseFloat(a["Desvío %"])<-1.5,"text-green-600":a["Desvío %"]&&parseFloat(a["Desvío %"])>=-1.5&&parseFloat(a["Desvío %"])<=1.5,"text-slate-700":!a["Desvío %"]||a["Desvío %"]==="—"}])},[a["Desvío %"]&&a["Desvío %"]!=="—"?(u(),p(V,{key:0},[A(l(a["Desvío %"])+"% ",1)],64)):(u(),p(V,{key:1},[A(l(a["Desvío %"]),1)],64))],2),e("td",Os,l(a.Titulo),1),e("td",As,l(a.Estiraje||"-"),1),e("td",Is,l(a.Pasador||"-"),1),e("td",Ls,l(a["CVm %"]),1),e("td",Fs,l(a["Delg -30%"]),1),e("td",Us,l(a["Delg -40%"]),1),e("td",Ps,l(a["Delg -50%"]),1),e("td",Bs,l(a["Grue +35%"]),1),e("td",Gs,l(a["Grue +50%"]),1),e("td",js,l(a["Neps +140%"]),1),e("td",$s,l(a["Neps +280%"]),1),e("td",Ks,l(a["Fuerza B"]),1),e("td",Vs,l(a["Elong. %"]),1),e("td",zs,l(a["Tenac."]),1),e("td",Hs,l(a["Trabajo B"]),1),e("td",qs,[e("div",Js,[P((u(),p("button",{onClick:c=>$e(a.Ensayo),class:"inline-flex items-center gap-1 px-1 py-1 border border-slate-200 bg-white text-slate-700 rounded-lg text-xs font-medium hover:bg-slate-50 transition-colors duration-150 shadow-sm"},[...t[27]||(t[27]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-slate-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M2.5 12s3.5-7 9.5-7 9.5 7 9.5 7-3.5 7-9.5 7-9.5-7-9.5-7z","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",{class:"whitespace-nowrap"},"Ver",-1)])],8,Ws)),[[s,{content:"Ver el detalle de los ensayos USTER y TENSORAPID",placement:"bottom",theme:"custom"}]]),P((u(),p("button",{onClick:Ze(c=>ut(a.Ensayo),["stop"]),class:"inline-flex items-center justify-center px-2 py-1 bg-white hover:bg-slate-50 border border-slate-200 text-slate-700 rounded-lg text-xs font-medium transition-colors duration-150 shadow-sm"},[...t[28]||(t[28]=[A(" 📈 ",-1)])],8,Xs)),[[s,{content:"Ver gráfico por huso (Titulo Ne)",placement:"bottom",theme:"custom"}]])])])],2))),128))])])]),e("div",Zs,[e("div",Qs,"Mostrando "+l(at.value)+"–"+l(rt.value)+" de "+l(M.value.length),1),e("div",Ys,[t[32]||(t[32]=e("label",{class:"text-sm text-slate-700"},"Registros por página:",-1)),P(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>Q.value=a),class:"text-sm px-2 py-1 border border-slate-200 rounded-lg text-slate-700 focus:border-blue-400"},[(u(),p(V,null,Ie([10,25,50,100,0],a=>e("option",{key:a,value:a},l(a===0?"Todos":a),9,eo)),64))],512),[[Ve,Q.value,void 0,{number:!0}]]),e("button",{onClick:t[4]||(t[4]=a=>j.value=1),disabled:j.value<=1,class:"inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors duration-150 disabled:opacity-50 shadow-sm hover:shadow-md",title:"Primera"},"« Primera",8,to),e("button",{onClick:t[5]||(t[5]=a=>j.value=Math.max(1,j.value-1)),disabled:j.value<=1,class:"inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors duration-150 disabled:opacity-50 shadow-sm hover:shadow-md",title:"Anterior"},"‹ Anterior",8,so),e("div",oo,[t[31]||(t[31]=e("label",{class:"sr-only",for:"gotoPage"},"Ir a página",-1)),P(e("input",{id:"gotoPage",type:"number",min:"1",max:$.value,"onUpdate:modelValue":t[6]||(t[6]=a=>Re.value=a),onKeydown:t[7]||(t[7]=gt(Ze(a=>He(),["prevent"]),["enter"])),class:"w-20 text-sm px-2 py-1 border border-slate-200 rounded-lg text-slate-700 placeholder-slate-400 focus:border-blue-400",placeholder:"Página"},null,40,lo),[[Xe,Re.value,void 0,{number:!0,lazy:!0}]]),e("button",{onClick:t[8]||(t[8]=a=>He()),class:"inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md"},"Ir")]),e("span",no,"Página "+l(j.value)+" / "+l($.value),1),e("button",{onClick:t[9]||(t[9]=a=>j.value=Math.min($.value,j.value+1)),disabled:j.value>=$.value,class:"inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors duration-150 disabled:opacity-50 shadow-sm hover:shadow-md",title:"Siguiente"},"Siguiente ›",8,ao),e("button",{onClick:t[10]||(t[10]=a=>j.value=$.value),disabled:j.value>=$.value,class:"inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors duration-150 disabled:opacity-50 shadow-sm hover:shadow-md",title:"Última"},"Última »",8,ro)])])]))]))]),Ue.value?(u(),p("div",io,[e("div",{class:"fixed inset-0 bg-gradient-to-br from-slate-900/50 to-slate-800/50 backdrop-blur-sm z-40",onClick:Ke,"aria-hidden":"true"}),e("div",co,[P((u(),p("button",{onClick:qe,disabled:Ge.value,type:"button",class:"absolute left-0 top-1/2 -translate-y-1/2 -ml-5 w-10 h-10 rounded-full bg-white border border-slate-200 shadow-sm flex items-center justify-center text-2xl text-slate-700 hover:bg-slate-50 disabled:opacity-40 disabled:cursor-not-allowed z-50","aria-label":"Anterior ensayo"},[...t[33]||(t[33]=[A("‹",-1)])],8,uo)),[[s,{content:"Anterior — Atajo: ← (ArrowLeft). Esc: Cerrar modal",placement:"left",theme:"custom"}]]),P((u(),p("button",{onClick:Je,disabled:je.value,type:"button",class:"absolute right-0 top-1/2 -translate-y-1/2 -mr-5 w-10 h-10 rounded-full bg-white border border-slate-200 shadow-sm flex items-center justify-center text-2xl text-slate-700 hover:bg-slate-50 disabled:opacity-40 disabled:cursor-not-allowed z-50","aria-label":"Siguiente ensayo"},[...t[34]||(t[34]=[A("›",-1)])],8,po)),[[s,{content:"Siguiente — Atajo: → (ArrowRight). Esc: Cerrar modal",placement:"right",theme:"custom"}]]),e("header",xo,[e("div",mo,[e("div",bo,[t[35]||(t[35]=A("Fecha: ",-1)),e("span",vo,l(O.value.fechaStr),1)]),e("div",fo,[t[36]||(t[36]=A("Ne: ",-1)),e("span",ho,l(O.value.ne),1)]),e("div",go,[t[37]||(t[37]=A("OE Nro.: ",-1)),e("span",yo,l(O.value.oe),1)]),e("div",_o,[t[38]||(t[38]=A("Ensayo Uster ",-1)),e("span",Eo,l(O.value.u),1),t[39]||(t[39]=A(" y TensoRapid ",-1)),e("span",wo,l(O.value.t),1)])]),e("div",No,[P((u(),p("button",{onClick:xt,type:"button",class:"w-9 h-9 rounded-lg bg-white border border-slate-200 hover:border-slate-300 hover:bg-slate-50 flex items-center justify-center text-slate-600 hover:text-slate-700 transition-all duration-200 shadow-sm hover:shadow-md","aria-label":"Exportar detalle a Excel"},[...t[40]||(t[40]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])])),[[s,{content:"Exportar este detalle a Excel (XLSX)",placement:"bottom",theme:"custom"}]]),P((u(),p("button",{onClick:pt,type:"button",class:"w-9 h-9 rounded-lg bg-white border border-slate-200 hover:border-blue-400 hover:bg-blue-50 flex items-center justify-center text-slate-600 hover:text-blue-600 transition-all duration-200 group shadow-sm hover:shadow-md","aria-label":"Copiar como imagen"},[...t[41]||(t[41]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])])),[[s,{content:"Copiar como imagen para WhatsApp",placement:"bottom",theme:"custom"}]]),P((u(),p("button",{onClick:Ke,type:"button",class:"w-9 h-9 rounded-lg bg-white border border-slate-200 hover:border-red-400 hover:bg-red-50 flex items-center justify-center text-slate-600 hover:text-red-600 transition-all duration-200 shadow-sm hover:shadow-md","aria-label":"Cerrar detalle"},[...t[42]||(t[42]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])),[[s,{content:"Cerrar (Esc)",placement:"bottom",theme:"custom"}]])])]),O.value.obs||O.value.laborant||O.value.tensorLaborant?(u(),p("div",So,[O.value.obs?(u(),p("div",To,[t[43]||(t[43]=e("span",null,"Obs.:",-1)),e("span",Mo,l(O.value.obs),1)])):te("",!0),O.value.laborant?(u(),p("div",Co,[t[44]||(t[44]=e("span",null,"Op. Uster:",-1)),e("span",ko,l(O.value.laborant),1)])):te("",!0),O.value.tensorLaborant?(u(),p("div",Do,[t[45]||(t[45]=e("span",null,"Op. TensoRapid:",-1)),e("span",Ro,l(O.value.tensorLaborant),1)])):te("",!0)])):te("",!0),e("section",Oo,[e("div",null,[ge.value.length===0?(u(),p("div",Ao,"No hay datos para este ensayo.")):(u(),p("div",Io,[e("table",Lo,[t[63]||(t[63]=e("thead",{class:"bg-gradient-to-r from-slate-50 to-slate-100 sticky top-0 z-30"},[e("tr",null,[e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Huso"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Titulo"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Desvío %"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"CVm %"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Delg -30% "),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Delg -40% "),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Delg -50% "),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Grue +35% "),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Grue +50% "),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Neps +140% "),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Neps +280% "),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Fuerza B "),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Elongación %"),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Tenacidad "),e("th",{class:"px-3 py-2 text-center font-semibold text-slate-700 border-b border-slate-200"},"Trabajo ")])],-1)),e("tbody",null,[(u(!0),p(V,null,Ie(ge.value,(a,F)=>(u(),p("tr",{key:F,class:de(["transition-colors duration-150",W.value?"bg-slate-50/50":"hover:bg-slate-50"])},[e("td",Fo,[W.value?(u(),p("div",Uo)):(u(),p(V,{key:1},[A(l(a.NO),1)],64))]),e("td",Po,[W.value?(u(),p("div",Bo)):(u(),p(V,{key:1},[A(l(H(a.TITULO)),1)],64))]),e("td",{class:de(["px-3 py-1 text-center border-b border-slate-100 font-semibold",{"text-red-600":a.DESVIO_PERCENT&&parseFloat(a.DESVIO_PERCENT)>1.5,"text-blue-600":a.DESVIO_PERCENT&&parseFloat(a.DESVIO_PERCENT)<-1.5,"text-green-600":a.DESVIO_PERCENT&&parseFloat(a.DESVIO_PERCENT)>=-1.5&&parseFloat(a.DESVIO_PERCENT)<=1.5,"text-slate-700":!a.DESVIO_PERCENT}])},[W.value?(u(),p("div",Go)):(u(),p(V,{key:1},[A(l(a.DESVIO_PERCENT?a.DESVIO_PERCENT+"%":""),1)],64))],2),e("td",jo,[W.value?(u(),p("div",$o)):(u(),p(V,{key:1},[A(l(H(a.CVM_PERCENT)),1)],64))]),e("td",Ko,[W.value?(u(),p("div",Vo)):(u(),p(V,{key:1},[A(l(H(a.DELG_MINUS30_KM)),1)],64))]),e("td",zo,[W.value?(u(),p("div",Ho)):(u(),p(V,{key:1},[A(l(H(a.DELG_MINUS40_KM)),1)],64))]),e("td",qo,[W.value?(u(),p("div",Jo)):(u(),p(V,{key:1},[A(l(H(a.DELG_MINUS50_KM)),1)],64))]),e("td",Wo,[W.value?(u(),p("div",Xo)):(u(),p(V,{key:1},[A(l(H(a.GRUE_35_KM)),1)],64))]),e("td",Zo,[W.value?(u(),p("div",Qo)):(u(),p(V,{key:1},[A(l(H(a.GRUE_50_KM)),1)],64))]),e("td",Yo,[W.value?(u(),p("div",el)):(u(),p(V,{key:1},[A(l(H(a.NEPS_140_KM)),1)],64))]),e("td",tl,[W.value?(u(),p("div",sl)):(u(),p(V,{key:1},[A(l(H(a.NEPS_280_KM)),1)],64))]),e("td",ol,[W.value?(u(),p("div",ll)):(u(),p(V,{key:1},[A(l(H(a.FUERZA_B)),1)],64))]),e("td",nl,[W.value?(u(),p("div",al)):(u(),p(V,{key:1},[A(l(H(a.ELONGACION)),1)],64))]),e("td",rl,[W.value?(u(),p("div",il)):(u(),p(V,{key:1},[A(l(H(a.TENACIDAD)),1)],64))]),e("td",dl,[W.value?(u(),p("div",cl)):(u(),p(V,{key:1},[A(l(H(a.TRABAJO)),1)],64))])],2))),128)),e("tr",ul,[e("td",pl,[e("div",xl,[t[47]||(t[47]=e("span",null,"Promedio",-1)),P((u(),p("button",ml,[...t[46]||(t[46]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 8h.01","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])),[[s,{content:"La suma de todos los valores dividida por la cantidad de datos. Representa el valor típico o central de un conjunto de datos.",placement:"top",theme:"custom"}]])])]),e("td",bl,l(x(d.value.TITULO.avg)),1),e("td",{class:de(["px-3 py-1 text-center font-semibold",{"text-red-600":((m=d.value.DESVIO_PERCENT)==null?void 0:m.avg)>1.5,"text-blue-600":((h=d.value.DESVIO_PERCENT)==null?void 0:h.avg)<-1.5,"text-green-600":((_=d.value.DESVIO_PERCENT)==null?void 0:_.avg)>=-1.5&&((L=d.value.DESVIO_PERCENT)==null?void 0:L.avg)<=1.5,"text-slate-700":((E=d.value.DESVIO_PERCENT)==null?void 0:E.avg)==null}])},l(((C=d.value.DESVIO_PERCENT)==null?void 0:C.avg)!=null?(d.value.DESVIO_PERCENT.avg>0?"+":"")+x(d.value.DESVIO_PERCENT.avg)+"%":""),3),e("td",vl,l(x(d.value.CVM_PERCENT.avg)),1),e("td",fl,l(x(d.value.DELG_MINUS30_KM.avg)),1),e("td",hl,l(x(d.value.DELG_MINUS40_KM.avg)),1),e("td",gl,l(x(d.value.DELG_MINUS50_KM.avg)),1),e("td",yl,l(x(d.value.GRUE_35_KM.avg)),1),e("td",_l,l(x(d.value.GRUE_50_KM.avg)),1),e("td",El,l(x(d.value.NEPS_140_KM.avg)),1),e("td",wl,l(x(d.value.NEPS_280_KM.avg)),1),e("td",Nl,l(x(d.value.FUERZA_B.avg)),1),e("td",Sl,l(x(d.value.ELONGACION.avg)),1),e("td",Tl,l(x(d.value.TENACIDAD.avg)),1),e("td",Ml,l(x(d.value.TRABAJO.avg)),1)]),e("tr",Cl,[e("td",kl,[e("div",Dl,[t[49]||(t[49]=e("span",null,"CV",-1)),P((u(),p("button",Rl,[...t[48]||(t[48]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 8h.01","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])),[[s,{content:"Una medida de dispersión relativa. Un CV del 5% indica baja variabilidad; uno del 50% indica alta dispersión.",placement:"top",theme:"custom"}]])])]),e("td",Ol,l(x(d.value.TITULO.cv)),1),t[50]||(t[50]=e("td",{class:"px-3 py-1 text-center text-slate-700"},null,-1)),e("td",Al,l(x(d.value.CVM_PERCENT.cv)),1),e("td",Il,l(x(d.value.DELG_MINUS30_KM.cv)),1),e("td",Ll,l(x(d.value.DELG_MINUS40_KM.cv)),1),e("td",Fl,l(x(d.value.DELG_MINUS50_KM.cv)),1),e("td",Ul,l(x(d.value.GRUE_35_KM.cv)),1),e("td",Pl,l(x(d.value.GRUE_50_KM.cv)),1),e("td",Bl,l(x(d.value.NEPS_140_KM.cv)),1),e("td",Gl,l(x(d.value.NEPS_280_KM.cv)),1),e("td",jl,l(x(d.value.FUERZA_B.cv)),1),e("td",$l,l(x(d.value.ELONGACION.cv)),1),e("td",Kl,l(x(d.value.TENACIDAD.cv)),1),e("td",Vl,l(x(d.value.TRABAJO.cv)),1)]),e("tr",zl,[e("td",Hl,[e("div",ql,[t[52]||(t[52]=e("span",null,"s",-1)),P((u(),p("button",Jl,[...t[51]||(t[51]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 8h.01","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])),[[s,{content:"Desviación estándar. Mide cuánto se alejan los datos del promedio.",placement:"top",theme:"custom"}]])])]),e("td",Wl,l(x(d.value.TITULO.sd)),1),t[53]||(t[53]=e("td",{class:"px-3 py-1 text-center text-slate-700"},null,-1)),e("td",Xl,l(x(d.value.CVM_PERCENT.sd)),1),e("td",Zl,l(x(d.value.DELG_MINUS30_KM.sd)),1),e("td",Ql,l(x(d.value.DELG_MINUS40_KM.sd)),1),e("td",Yl,l(x(d.value.DELG_MINUS50_KM.sd)),1),e("td",en,l(x(d.value.GRUE_35_KM.sd)),1),e("td",tn,l(x(d.value.GRUE_50_KM.sd)),1),e("td",sn,l(x(d.value.NEPS_140_KM.sd)),1),e("td",on,l(x(d.value.NEPS_280_KM.sd)),1),e("td",ln,l(x(d.value.FUERZA_B.sd)),1),e("td",nn,l(x(d.value.ELONGACION.sd)),1),e("td",an,l(x(d.value.TENACIDAD.sd)),1),e("td",rn,l(x(d.value.TRABAJO.sd)),1)]),e("tr",dn,[e("td",cn,[e("div",un,[t[55]||(t[55]=e("span",null,"Q95",-1)),P((u(),p("button",pn,[...t[54]||(t[54]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 8h.01","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])),[[s,{content:"Cuantil 95. El valor por debajo del cual se encuentra el 95% de los datos.",placement:"top",theme:"custom"}]])])]),e("td",xn,l(x(d.value.TITULO.q95)),1),t[56]||(t[56]=e("td",{class:"px-3 py-1 text-center text-slate-700"},null,-1)),e("td",mn,l(x(d.value.CVM_PERCENT.q95)),1),e("td",bn,l(x(d.value.DELG_MINUS30_KM.q95)),1),e("td",vn,l(x(d.value.DELG_MINUS40_KM.q95)),1),e("td",fn,l(x(d.value.DELG_MINUS50_KM.q95)),1),e("td",hn,l(x(d.value.GRUE_35_KM.q95)),1),e("td",gn,l(x(d.value.GRUE_50_KM.q95)),1),e("td",yn,l(x(d.value.NEPS_140_KM.q95)),1),e("td",_n,l(x(d.value.NEPS_280_KM.q95)),1),e("td",En,l(x(d.value.FUERZA_B.q95)),1),e("td",wn,l(x(d.value.ELONGACION.q95)),1),e("td",Nn,l(x(d.value.TENACIDAD.q95)),1),e("td",Sn,l(x(d.value.TRABAJO.q95)),1)]),e("tr",Tn,[e("td",Mn,[e("div",Cn,[t[58]||(t[58]=e("span",null,"Máx",-1)),P((u(),p("button",kn,[...t[57]||(t[57]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 8h.01","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])),[[s,{content:"Máximo. El valor más alto del conjunto de datos.",placement:"top",theme:"custom"}]])])]),e("td",Dn,l(x(d.value.TITULO.max)),1),t[59]||(t[59]=e("td",{class:"px-3 py-1 text-center text-slate-700"},null,-1)),e("td",Rn,l(x(d.value.CVM_PERCENT.max)),1),e("td",On,l(x(d.value.DELG_MINUS30_KM.max)),1),e("td",An,l(x(d.value.DELG_MINUS40_KM.max)),1),e("td",In,l(x(d.value.DELG_MINUS50_KM.max)),1),e("td",Ln,l(x(d.value.GRUE_35_KM.max)),1),e("td",Fn,l(x(d.value.GRUE_50_KM.max)),1),e("td",Un,l(x(d.value.NEPS_140_KM.max)),1),e("td",Pn,l(x(d.value.NEPS_280_KM.max)),1),e("td",Bn,l(x(d.value.FUERZA_B.max)),1),e("td",Gn,l(x(d.value.ELONGACION.max)),1),e("td",jn,l(x(d.value.TENACIDAD.max)),1),e("td",$n,l(x(d.value.TRABAJO.max)),1)]),e("tr",Kn,[e("td",Vn,[e("div",zn,[t[61]||(t[61]=e("span",null,"Mín",-1)),P((u(),p("button",Hn,[...t[60]||(t[60]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12 8h.01","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])),[[s,{content:"Mínimo. El valor más bajo del conjunto de datos.",placement:"top",theme:"custom"}]])])]),e("td",qn,l(x(d.value.TITULO.min)),1),t[62]||(t[62]=e("td",{class:"px-3 py-1 text-center text-slate-700"},null,-1)),e("td",Jn,l(x(d.value.CVM_PERCENT.min)),1),e("td",Wn,l(x(d.value.DELG_MINUS30_KM.min)),1),e("td",Xn,l(x(d.value.DELG_MINUS40_KM.min)),1),e("td",Zn,l(x(d.value.DELG_MINUS50_KM.min)),1),e("td",Qn,l(x(d.value.GRUE_35_KM.min)),1),e("td",Yn,l(x(d.value.GRUE_50_KM.min)),1),e("td",ea,l(x(d.value.NEPS_140_KM.min)),1),e("td",ta,l(x(d.value.NEPS_280_KM.min)),1),e("td",sa,l(x(d.value.FUERZA_B.min)),1),e("td",oa,l(x(d.value.ELONGACION.min)),1),e("td",la,l(x(d.value.TENACIDAD.min)),1),e("td",na,l(x(d.value.TRABAJO.min)),1)])])])]))]),W.value?(u(),p("div",aa,[...t[64]||(t[64]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-4 border-slate-300 border-t-blue-600"},null,-1),e("p",{class:"mt-3 text-base text-slate-700 font-medium"},"Cargando ensayo...",-1)])])):te("",!0)])])])):te("",!0),yt(ns,{visible:Be.value,values:dt.value,"huso-numbers":it.value,testnr:String(he.value||""),timestamp:O.value.fechaStr,oe:O.value.oe,"variable-label":"Titulo Ne","standard-ne":ct.value,"can-navigate-previous":!Ge.value,"can-navigate-next":!je.value,onClose:t[11]||(t[11]=a=>Be.value=!1),onNavigatePrevious:qe,onNavigateNext:Je},null,8,["visible","values","huso-numbers","testnr","timestamp","oe","standard-ne","can-navigate-previous","can-navigate-next"])])}}},ma=tt(ra,[["__scopeId","data-v-1b319586"]]);export{ma as default};
