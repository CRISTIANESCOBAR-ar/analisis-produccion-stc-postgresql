import{w as He,o as mt,a as p,c as v,b as n,d as be,t as M,e as C,F as R,r as G,f as U,v as xe,g as Pe,n as L,h as q,i as J,j as Ae,k as we,l as x,m as f,p as V,q as ht}from"./index-Bb3aArA6.js";import{S as T}from"./sweetalert2.esm.all-AlKuj1Cq.js";import{_ as bt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xt={class:"hidden md:flex w-full h-screen flex-col p-1"},wt={class:"w-full flex-1 min-h-0 bg-white rounded-2xl shadow-xl px-4 py-3 border border-slate-200 flex flex-col overflow-y-auto uster-component"},gt={class:"flex-shrink-0 mb-3"},_t={class:"flex items-center gap-3"},yt={class:"flex-1 min-w-0"},Tt=["title"],St={key:0,class:"text-xs text-slate-500 ml-2"},Mt={class:"flex items-center gap-2"},Et={class:"grid uster-grid",style:{"grid-template-columns":"440px 160px 270px"}},kt={class:"flex flex-col gap-3"},Nt={class:"scan-container rounded-xl border border-slate-200 overflow-hidden bg-white"},Ct={class:"min-w-full w-full table-auto divide-y divide-slate-200 text-xs scan-table"},Lt=["onClick"],It={class:"px-3 py-2 border-b border-slate-200 text-xs text-center text-slate-700 col-ensayo"},Ot={class:"px-3 py-2 border-b border-slate-200 text-center text-xs col-par"},Rt={class:"px-3 py-2 border-b border-slate-200 text-center text-xs col-tbl"},Ut={class:"px-3 py-2 border-b border-slate-200 text-center text-xs col-imp"},Ht={key:0,title:"Guardado en la base de datos"},Pt={class:"px-3 py-2 border-b border-slate-200 text-center font-mono text-xs text-slate-700 col-ne"},At={class:"px-3 py-2 border-b border-slate-200 text-center font-mono text-xs text-slate-700 col-maq"},Bt={class:"text-sm text-slate-600 font-medium"},Kt={class:"mt-2 bg-slate-50 rounded-lg p-3 border border-slate-200"},Dt={class:"flex items-center gap-4 text-xs"},Ft={class:"flex items-center gap-2 cursor-pointer hover:bg-slate-100 px-2 py-1.5 rounded-lg transition-colors duration-150"},Gt={class:"flex items-center gap-2 cursor-pointer hover:bg-slate-100 px-2 py-1.5 rounded-lg transition-colors duration-150"},Vt={class:"flex items-center gap-2 cursor-pointer hover:bg-slate-100 px-2 py-1.5 rounded-lg transition-colors duration-150"},jt={style:{width:"160px"}},$t={class:"mb-2 rounded-xl border border-slate-200 bg-white p-2"},Wt={class:"flex items-center justify-between gap-2"},zt=["disabled","onKeydown"],qt={class:"mb-2 rounded-xl border border-slate-200 bg-white p-2"},Jt={class:"flex items-center justify-between gap-2"},Qt={class:"flex items-center gap-3"},Yt={class:"flex items-center gap-1 cursor-pointer"},Xt=["disabled"],Zt={class:"flex items-center gap-1 cursor-pointer"},eo=["disabled"],to={class:"titulo-container rounded-xl border border-slate-200 overflow-hidden bg-white"},oo={class:"min-w-full w-full table-auto divide-y divide-slate-200 text-xs titulo-table"},lo={class:"px-3 py-2 border-b border-slate-200 text-xs text-center text-slate-700 font-mono",style:{width:"70px"}},no={key:0},ro={key:1,class:"text-xs text-slate-400"},so={class:"px-1 py-0 border-b border-slate-200 text-xs text-center",style:{width:"90px"}},ao={key:0},io=["id","onUpdate:modelValue","onFocus","onBlur","onInput","onKeydown"],co={key:1,class:"text-xs text-slate-400"},uo={class:"rounded-xl border border-slate-200 overflow-hidden bg-white"},fo={class:"min-w-full w-full table-auto divide-y divide-slate-200 text-xs compact-table"},po={class:"px-3 py-2 border-b border-slate-200 font-medium text-xs text-slate-700 col-dato"},vo={class:"px-3 py-2 border-b border-slate-200 font-mono text-xs text-slate-700 col-valor"},mo={key:1},ho={class:"mt-3 flex gap-2"},bo=["disabled","onKeydown"],xo={key:0},wo={key:1},go=["disabled"],_o={key:0},yo={key:1},To={key:0,class:"mt-4 rounded-xl border border-slate-200"},So={class:"_minimal-scroll",style:{"overflow-x":"auto"}},Mo={class:"bg-gradient-to-r from-slate-50 to-slate-100 sticky top-0"},Eo={class:"px-3 py-2 border-b border-slate-200 text-xs text-center"},Be=25,S=80,ko={__name:"Uster",setup(No){const Q=f(null),I=f(null),E=f(null),H=f(null),Y=f(null),X=f(""),m=f([]),d=f(""),O=f(""),P=f(""),ue=f(""),Z=f(!1),ee=f(""),oe=f(!1),_=f(""),de=f(!1),g=f(""),y=f("");He(y,o=>{if(d.value&&o){const t=m.value.find(e=>e.testnr===d.value);t&&(t.matclass=o)}});const A=f(!1),k=f(!0),N=f(!1);He(()=>{let o=m.value||[];return k.value?o=o.filter(t=>t.testnr&&t.imp!==!0):N.value&&(o=o.filter(t=>t.testnr&&t.imp===!0)),o.length},o=>{console.log("üîç Watcher ejecutado: count =",o,"selectedTestnr =",d.value),o===0&&d.value&&(console.log("‚úÖ Limpiando interfaz porque no hay ensayos en la lista filtrada"),j())});function ge(o){if(!o)return null;const t=String(o);let e=t.match(/STC\d{2}[_-]?(\d{5})/i);return e&&e[1]||(e=t.match(/_(\d{5})(?:[_.]|$)/),e&&e[1])?e[1]:(e=t.match(/(\d{5})/),e?e[1]:null)}function Ke(o,t){try{let e=String(t&&t.target&&t.target.value||"");e=e.replace(",","."),e=e.replace(/[^0-9.]/g,"");const l=t&&t.inputType?String(t.inputType):"",r=l.startsWith("delete")||l.startsWith("history"),s=e.split(".");if(s.length===1)!r&&s[0].length===2?e=s[0]+".":e=s[0].slice(0,2);else{const i=s[0].slice(0,2),a=(s[1]||"").slice(0,2);e=i+"."+a}if(u.value&&u.value[o]&&(u.value[o].TITULO=e),e.length===5&&e.includes(".")){const i=e.indexOf(".");i===2&&e.length-i-1===2&&setTimeout(()=>Ie(o),0)}}catch(e){console.warn("onTituloInput error",e)}}async function le(){try{if(typeof window<"u"&&"showDirectoryPicker"in window){const o=await window.showDirectoryPicker();try{await De(o),Z.value=!0}catch(t){console.warn("saveDirHandleToIDB failed",t)}X.value=o.name||"Carpeta seleccionada",ee.value=o.name||"",oe.value=!1;try{await fe(o)}catch(t){console.warn("scanDirectory error",t)}return}}catch(o){console.warn("selectFolder error",o)}try{if(Q.value)Q.value.click();else{console.warn("No se pudo abrir el selector de carpeta: input no disponible");try{T.fire({icon:"error",title:"No se pudo abrir el selector",text:"El selector de carpetas no est√° disponible en este contexto."})}catch{O.value="No se pudo abrir el selector de carpetas."}}}catch(o){console.warn("No se pudo abrir el selector de carpeta",o);try{T.fire({icon:"error",title:"Error",text:String(o)})}catch{O.value=String(o)}}}function _e(){return new Promise((o,t)=>{let e;try{e=window.indexedDB.open("carga-uster")}catch(l){return t(l)}e.onupgradeneeded=()=>{const l=e.result;try{l.objectStoreNames.contains("handles")||l.createObjectStore("handles")}catch(r){console.warn("openDb onupgradeneeded error",r)}},e.onsuccess=()=>o(e.result),e.onerror=()=>t(e.error)})}async function De(o){const t=await _e();return new Promise((e,l)=>{const i=t.transaction("handles","readwrite").objectStore("handles").put(o,"dir");i.onsuccess=()=>e(!0),i.onerror=()=>l(i.error)})}async function ye(){const o=await _e();return new Promise((t,e)=>{const s=o.transaction("handles","readonly").objectStore("handles").get("dir");s.onsuccess=()=>t(s.result),s.onerror=()=>e(s.error)})}async function Te(o,t="read"){if(!o)return!1;try{const e={mode:t};if(await o.queryPermission(e)==="granted"||await o.requestPermission(e)==="granted")return!0}catch(e){console.warn("verifyPermission error",e)}return!1}async function Se(){try{const o=await ye();if(!o)return;if(!await Te(o,"read")){try{(await T.fire({icon:"warning",title:"Permisos insuficientes",text:"No se concedieron permisos de lectura para la carpeta almacenada. Debes seleccionar la carpeta de nuevo para otorgar permisos.",confirmButtonText:"Seleccionar carpeta",showCancelButton:!0,cancelButtonText:"Cancelar"})).isConfirmed&&await le()}catch(e){console.warn("Swal error",e)}return}await fe(o)}catch(o){console.warn("refreshFolder error",o)}}async function fe(o){console.log("Iniciando scanDirectory con handle:",o.name);const t={};let e=0;try{for await(const[s,i]of o.entries()){if(e++,!i||i.kind!=="file")continue;const a=String(s||"").toLowerCase();if(!(a.endsWith(".par")||a.endsWith(".tbl")))continue;const c=ge(s);if(c){if(t[c]||(t[c]={testnr:c,hasPar:!1,hasTbl:!1,parHandle:null,tblHandle:null,imp:!1,nomcount:null,maschnr:null}),a.endsWith(".par")){t[c].hasPar=!0,t[c].parHandle=i;try{const h=await(await i.getFile()).text();t[c].nomcount=K(h,15,5)||"",t[c].maschnr=K(h,13,5)||"",t[c].matclass=K(h,14,8)||""}catch(b){console.warn("Error leyendo .PAR durante el escaneo",s,b)}}a.endsWith(".tbl")&&(t[c].hasTbl=!0,t[c].tblHandle=i)}}}catch(s){console.error("Error durante el bucle de escaneo de directorio:",s),O.value=`Error al escanear: ${s.message}`}console.log(`Escaneo finalizado. Total de archivos en el directorio: ${e}. Ensayos mapeados: ${Object.keys(t).length}`);let l=Object.values(t).sort((s,i)=>s.testnr.localeCompare(i.testnr));if(l.length>0){console.log("Llamando a checkExistingTests...");try{const s=await Me(l.map(a=>a.testnr));console.log("existingTests recibido:",s),console.log("Tipo de existingTests:",typeof s,Array.isArray(s));const i=new Set(s);console.log("existingSet creado:",i),l=l.map(a=>{const c=i.has(a.testnr);return console.log(`Verificando ${a.testnr}: existingSet.has() = ${c}`),{...a,imp:c}}),console.log("checkExistingTests completado. Lista para actualizar el DOM:",l)}catch(s){console.error("Fallo en la llamada a checkExistingTests desde scanDirectory",s)}}m.value=l,await x(),console.log("scanList.value ha sido asignado y el DOM actualizado.",m.value),console.log("Verificaci√≥n de valores imp:",m.value.map(s=>({testnr:s.testnr,imp:s.imp}))),X.value=o.name||"Carpeta seleccionada";const r=m.value.length;O.value=r?`Encontrados ${r} ensayos`:"No se encontraron archivos .PAR/.TBL v√°lidos en la carpeta seleccionada"}async function Me(o){if(!o||o.length===0)return console.log("checkExistingTests: No hay testnrs para verificar."),[];console.log("checkExistingTests: Verificando los siguientes testnrs:",o);try{const e=await fetch("/api/uster/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testnrs:o}),credentials:"include"});if(!e.ok){console.error("checkExistingTests: La respuesta del servidor no fue OK.",e.status,e.statusText);const r=await e.text();return console.error("checkExistingTests: Respuesta de error del servidor:",r),[]}const l=await e.json();return console.log("checkExistingTests: Datos recibidos del servidor:",l),l&&Array.isArray(l.existing)?l.existing:[]}catch(t){return console.error("Error en checkExistingTests:",t),[]}}async function Fe(o){try{const t=o&&o.target&&o.target.files||[],e={};for(let l=0;l<t.length;l++){const r=t[l],s=r.name||"",i=s.toLowerCase();if(!(i.endsWith(".par")||i.endsWith(".tbl")))continue;const a=ge(s);if(a){if(e[a]||(e[a]={testnr:a,hasPar:!1,hasTbl:!1,parHandle:null,tblHandle:null,imp:null,nomcount:null,maschnr:null}),i.endsWith(".par")){e[a].hasPar=!0,e[a].parHandle=r;try{const c=await r.text();e[a].nomcount=K(c,15,5)||"",e[a].maschnr=K(c,13,5)||"",e[a].matclass=K(c,14,8)||""}catch(c){console.warn("reading .PAR fallback",s,c)}}i.endsWith(".tbl")&&(e[a].hasTbl=!0,e[a].tblHandle=r)}}if(m.value=Object.values(e).sort((l,r)=>l.testnr.localeCompare(r.testnr)),X.value="Carpeta seleccionada (local)",O.value=m.value.length?`Encontrados ${m.value.length} ensayos (fallback)`:"No se encontraron archivos .PAR/.TBL en la selecci√≥n local",m.value.length>0&&await Me(m.value.map(l=>l.testnr)),t.length>0&&t[0].webkitRelativePath){const r=t[0].webkitRelativePath.split("/");r.length>1&&(ue.value=r.slice(0,r.length-1).join("/"))}Z.value=!1,ee.value=ue.value||"",oe.value=!1}catch(t){console.warn("onFolderInputChange error",t)}}mt(()=>{typeof window<"u"&&typeof window.document<"u"&&(window.document.title="Uster"),(async()=>{try{let o=null;try{o=await ye()}catch{}if(o){if(await Te(o,"read")){try{await fe(o)}catch(e){console.warn("scanDirectory onMounted error",e)}Z.value=!0,ee.value=o.name||"",oe.value=!1;return}X.value=o.name||"Carpeta (sin permisos)";try{(await T.fire({icon:"warning",title:"Permisos requeridos",text:"La carpeta guardada no tiene permisos de lectura. Selecciona la carpeta nuevamente para reautorizar el acceso.",confirmButtonText:"Seleccionar carpeta",showCancelButton:!0,cancelButtonText:"Cancelar"})).isConfirmed&&await le()}catch(e){console.warn("Swal error",e)}return}}catch(o){console.warn("onMounted load snapshot error",o)}})()});function j(){d.value="",P.value="",pe.value="",ve.value=null,me.value="",re.value=null,se.value="",u.value=[],$.value="",_.value="",g.value="",y.value="Hilo",W.value=null}async function Ee(o){d.value=o;const t=m.value.find(e=>e.testnr===o);t&&t.estiraje?_.value=t.estiraje:_.value="",t&&t.pasador?g.value=t.pasador:g.value="";try{await Ye();const e=t&&t.matclass;e&&e==="Hilo de fantasia"&&(y.value=e)}catch(e){console.warn("selectRow loadSelectedFiles failed",e)}try{if(await x(),E.value)try{E.value.focus(),typeof E.value.select=="function"&&E.value.select();return}catch(l){console.warn("Could not focus estiraje input",l)}let e=[];if(typeof globalThis<"u"&&globalThis.document&&globalThis.document.querySelectorAll&&(e=Array.from(globalThis.document.querySelectorAll('input[id^="titulo-input-"]')).filter(l=>!l.disabled&&l.offsetParent!==null)),e.length>0){const l=e[0];try{const r=String(l.id||"").match(/titulo-input-(\d+)/);if(r){const s=Number(r[1]);W.value=s}typeof l.scrollIntoView=="function"&&l.scrollIntoView({block:"nearest",inline:"nearest"}),l.focus(),typeof l.select=="function"&&l.select()}catch{}return}if(I&&I.value)try{I.value.focus()}catch{}}catch(e){console.warn("selectRow focus error",e)}}const u=f([]),$=f(""),Ge=/^\d{1,2}(?:\.\d{1,2})?$/,Ve=/^\d{1,2}$/,W=f(null),je=V(()=>{let t=[];if(Array.isArray(m.value)&&(t=m.value.map(l=>({...l}))),A.value||(k.value?t=t.filter(l=>l.testnr&&l.imp!==!0):N.value&&(t=t.filter(l=>l.testnr&&l.imp===!0))),t.length>=10)return t;const e={testnr:"",hasPar:!1,hasTbl:!1,imp:null,nomcount:"",maschnr:""};for(;t.length<10;)t.push(e);return t}),$e=V(()=>{if(!O.value)return"";if(!m.value.length)return O.value;const o=m.value.length;if(A.value)return`Encontrados ${o} ensayos (mostrando todos)`;if(k.value){const t=m.value.filter(e=>e.testnr&&e.imp!==!0).length;return`Encontrados ${o} ensayos (${t} no guardados)`}else if(N.value){const t=m.value.filter(e=>e.testnr&&e.imp===!0).length;return`Encontrados ${o} ensayos (${t} guardados)`}return O.value}),ne=["TESTNR","NO","U%_%","CVM_%","INDICE_%","CVM_1M_%","CVM_3M_%","CVM_10M_%","TITULO","TITULO_REL_¬±_%","H","SH","SH_1M","SH_3M","SH_10M","DELG_-30%_KM","DELG_-40%_KM","DELG_-50%_KM","DELG_-60%_KM","GRUE_35%_KM","GRUE_50%_KM","GRUE_70%_KM","GRUE_100%_KM","NEPS_140%_KM","NEPS_200%_KM","NEPS_280%_KM","NEPS_400%_KM"],We=[{name:"TESTNR",col:null,note:"Extraer del nombre de archivo: caracteres 7..11"},{name:"NO",col:1},{name:"U%_%",col:2},{name:"CVM_%",col:3},{name:"INDICE_%",col:4},{name:"CVM_1M_%",col:5},{name:"CVM_3M_%",col:6},{name:"CVM_10M_%",col:7},{name:"TITULO",col:9},{name:"TITULO_REL_¬±_%",col:10},{name:"H",col:11},{name:"SH",col:12},{name:"SH_1M",col:13},{name:"SH_3M",col:14},{name:"SH_10M",col:15},{name:"DELG_-30%_KM",col:17},{name:"DELG_-40%_KM",col:18},{name:"DELG_-50%_KM",col:19},{name:"DELG_-60%_KM",col:20},{name:"GRUE_35%_KM",col:21},{name:"GRUE_50%_KM",col:22},{name:"GRUE_70%_KM",col:23},{name:"GRUE_100%_KM",col:24},{name:"NEPS_140%_KM",col:25},{name:"NEPS_200%_KM",col:26},{name:"NEPS_280%_KM",col:27},{name:"NEPS_400%_KM",col:28}],pe=f(""),ve=f(null),me=f(""),re=f(null),se=f("");async function ke(o){if(!o)return"";try{return typeof o.text=="function"?await o.text():typeof o.getFile=="function"?await(await o.getFile()).text():""}catch(t){return console.warn("readFileFromHandle error",t),""}}async function ze(o,t){try{ve.value=o,pe.value=t||o&&o.name||"";const e=await ke(o);P.value=e||"",await qe()}catch(e){console.warn("setFile error",e)}}async function qe(){try{await x();const o=ce("MATCLASS");y.value=o||"Hilo";const t=ce("OBS");t&&String(t).toLowerCase().includes("flame")?(y.value="Hilo de fantasia",console.log('üî• Flame detectado en OBS, cambiando a "Hilo de fantasia"')):console.log("üìù OBS:",t,"- MATCLASS:",y.value)}catch(o){console.warn("detectFlameInObs error",o)}}async function Je(o,t){try{re.value=o,me.value=t||o&&o.name||"",se.value=await ke(o),await Qe(se.value)}catch(e){console.warn("setTblFile error",e)}}async function Qe(o){try{if(!o){u.value=[],$.value="";return}const t=o.split(/\r?\n/),e=[];for(let l=5;l<t.length;l++){const r=t[l];if(r==null||String(r).trim()==="")break;const s=String(r).split("	"),i={};i.TESTNR=d.value?String(d.value):"";for(const a of We){if(a.col===null)continue;const c=a.col-1;i[a.name]=s[c]!=null?String(s[c]).trim():""}i.SEQNO=e.length+1,e.push(i)}u.value=e,e.length>0?$.value=d.value||"":$.value=""}catch(t){console.warn("parseTblText error",t),u.value=[],$.value=""}}async function Ye(){try{if(!d.value)return;const o=m.value.find(t=>String(t.testnr)===String(d.value));if(!o)return;o.parHandle?await ze(o.parHandle,o.parHandle.name||"PAR_"+o.testnr):(P.value="",pe.value="",ve.value=null),o.tblHandle?await Je(o.tblHandle,o.tblHandle.name||"TBL_"+o.testnr):(u.value=[],$.value="",me.value="",re.value=null)}catch(o){console.warn("loadSelectedFiles error",o)}}async function Xe(){try{const o=m.value.find(a=>String(a.testnr)===String(d.value)),t=o&&o.tblHandle||re.value||null;if(!t)return console.warn("No se encontr√≥ ning√∫n handle para el archivo .TBL (ni en scanList ni en tblFile)"),!1;if(typeof t.createWritable!="function"){console.warn("El archivo .TBL no soporta escritura (modo fallback). handle:",t);try{await T.fire({icon:"info",title:"No es posible guardar aqu√≠",text:'El archivo fue abierto mediante selecci√≥n de archivos y no permite escribir de vuelta. Selecciona la carpeta usando "Seleccionar carpeta" para habilitar guardado.',confirmButtonText:"Seleccionar carpeta"})}catch{}return!1}const e=se.value;if(!e)return console.warn("No hay contenido del archivo .TBL para actualizar"),!1;const l=e.split(/\r?\n/),r=e.includes(`\r
`)?`\r
`:`
`;for(let a=0;a<u.value.length;a++){const c=u.value[a],b=5+a;if(b>=l.length)break;const h=c.TITULO||"";if(h==="")continue;let w=String(h).padStart(6," ");w.length>6&&(w=w.slice(0,6));const F=l[b].split("	");F.length>8&&(F[8]=w,l[b]=F.join("	"))}const s=l.join(r),i=await t.createWritable();return await i.write(s),await i.close(),console.log("Archivo .TBL actualizado exitosamente con los valores de Titulo"),!0}catch(o){return console.error("Error al actualizar el archivo .TBL:",o),!1}}const z=V(()=>{const o=[];if(!u.value||!Array.isArray(u.value)||!d.value){for(let l=0;l<10;l++)o.push({nro:"",titulo:"",srcIndex:null});return o}const e=[];for(let l=0;l<u.value.length;l++){const r=u.value[l];(r&&(r.TESTNR||""))===String(d.value)&&e.push({nro:r.NO||"",titulo:r.TITULO||"",srcIndex:l})}if(e.length>10)return e;for(let l=0;l<e.length;l++)o.push(e[l]);for(;o.length<10;)o.push({nro:"",titulo:"",srcIndex:null});return o}),Ze={TESTNR:Math.round(S*.8),NO:Math.round(S*.5),"U%_%":Math.round(S*.6),"CVM_%":Math.round(S*.6),TITULO:Math.round(S*.7),"INDICE_%":Math.round(S*.7),H:Math.round(S*.5),SH:Math.round(S*.5),SH_1M:Math.round(S*.5),SH_3M:Math.round(S*.5),SH_10M:Math.round(S*.5)},Ne=o=>Ze[o]||S,et=V(()=>Be+ne.reduce((o,t)=>o+Ne(t),0)),Ce=V(()=>!d.value||!Array.isArray(u.value)?[]:u.value.filter(o=>String(o.TESTNR||"")===String(d.value))),ae=V(()=>d.value&&(Ce.value.length>0||P.value)),B=f(!1),te=f(!1),Le=V(()=>{if(!d.value)return!1;const o=m.value.find(t=>t.testnr===d.value);return o&&o.imp===!0});function tt(){const o={};for(const t of Ue){const e=t.field,l=ce(e);l!==""&&(o[e]=l)}return o.TESTNR||(o.TESTNR=d.value||""),_.value&&(o.ESTIRAJE=_.value),g.value&&(o.PASADOR=g.value),y.value&&(o.MATCLASS=y.value),o}async function ot(){if(!ae.value)return;const o=tt(),t=Ce.value.map((e,l)=>({SEQNO:e.SEQNO!=null?Number(e.SEQNO):l+1,NO:e.NO!=null?isNaN(Number(e.NO))?null:Number(e.NO):null,"U%_%":e["U%_%"]!=null?e["U%_%"]:"","CVM_%":e["CVM_%"]!=null?e["CVM_%"]:"","INDICE_%":e["INDICE_%"]!=null?e["INDICE_%"]:"","CVM_1M_%":e["CVM_1M_%"]!=null?e["CVM_1M_%"]:"","CVM_3M_%":e["CVM_3M_%"]!=null?e["CVM_3M_%"]:"","CVM_10M_%":e["CVM_10M_%"]!=null?e["CVM_10M_%"]:"",TITULO:e.TITULO!=null?e.TITULO:"","TITULO_REL_¬±_%":e["TITULO_REL_¬±_%"]!=null?e["TITULO_REL_¬±_%"]:"",H:e.H!=null?e.H:"",SH:e.SH!=null?e.SH:"",SH_1M:e.SH_1M!=null?e.SH_1M:"",SH_3M:e.SH_3M!=null?e.SH_3M:"",SH_10M:e.SH_10M!=null?e.SH_10M:"","DELG_-30%_KM":e["DELG_-30%_KM"]!=null?e["DELG_-30%_KM"]:"","DELG_-40%_KM":e["DELG_-40%_KM"]!=null?e["DELG_-40%_KM"]:"","DELG_-50%_KM":e["DELG_-50%_KM"]!=null?e["DELG_-50%_KM"]:"","DELG_-60%_KM":e["DELG_-60%_KM"]!=null?e["DELG_-60%_KM"]:"","GRUE_35%_KM":e["GRUE_35%_KM"]!=null?e["GRUE_35%_KM"]:"","GRUE_50%_KM":e["GRUE_50%_KM"]!=null?e["GRUE_50%_KM"]:"","GRUE_70%_KM":e["GRUE_70%_KM"]!=null?e["GRUE_70%_KM"]:"","GRUE_100%_KM":e["GRUE_100%_KM"]!=null?e["GRUE_100%_KM"]:"","NEPS_140%_KM":e["NEPS_140%_KM"]!=null?e["NEPS_140%_KM"]:"","NEPS_200%_KM":e["NEPS_200%_KM"]!=null?e["NEPS_200%_KM"]:"","NEPS_280%_KM":e["NEPS_280%_KM"]!=null?e["NEPS_280%_KM"]:"","NEPS_400%_KM":e["NEPS_400%_KM"]!=null?e["NEPS_400%_KM"]:""}));if(!B.value){B.value=!0;try{T.fire({toast:!0,position:"top-end",icon:"info",title:"Guardando...",showConfirmButton:!1,timer:3e4,timerProgressBar:!0});const r=await((a,c={},b=3e4)=>new Promise((h,w)=>{const D=setTimeout(()=>w(new Error("Timeout contacting server")),b);fetch(a,c).then(F=>{clearTimeout(D),h(F)}).catch(F=>{clearTimeout(D),w(F)})}))("/api/uster/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({par:o,tbl:t}),credentials:"include"},3e4);let s=null;try{s=await r.json()}catch{s=null}if(!r.ok)throw new Error(s&&s.error?s.error:s&&s.message||`HTTP ${r.status}`);try{await Xe()&&console.log("Archivo .TBL actualizado con √©xito")}catch(a){console.warn("No se pudo actualizar el archivo .TBL (esto es normal en modo fallback):",a)}const i=m.value.find(a=>a.testnr===o.TESTNR);i&&(i.imp=!0,_.value&&(i.estiraje=_.value),g.value&&(i.pasador=g.value),y.value&&(i.matclass=y.value),await x());try{for(let a=0;a<u.value.length;a++){const c=u.value[a];c&&String(c.TESTNR)===String(o.TESTNR)&&(c.TITULO="")}}catch{}try{let a=null;const c=Array.isArray(m.value)?m.value:[],b=c.findIndex(h=>String(h.testnr)===String(o.TESTNR));if(b!==-1)for(let h=b+1;h<c.length;h++){const w=c[h];if(!(!w||!w.testnr))if(k.value){if(w.imp!==!0){a=w.testnr;break}}else if(N.value){if(w.imp===!0){a=w.testnr;break}}else{a=w.testnr;break}}if(a){if(Array.isArray(u.value))for(const h of u.value)h&&(h.TITULO="");j(),await x(),await Ee(a)}else j(),await x(),await x(),Q.value&&(Q.value.value="")}catch(a){console.warn("auto-advance after save failed",a)}T.fire({toast:!0,position:"top-end",icon:"success",title:`Ensayo ${o.TESTNR} guardado`,text:`${s.inserted||t.length} filas`,showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}catch(e){console.error("saveCurrentTest error",e);try{await T.fire({icon:"error",title:"Error al guardar",text:String(e&&e.message?e.message:e),confirmButtonText:"Cerrar"})}catch{}}finally{B.value=!1}}}async function lt(){if(!(!d.value||!Le.value||!(await T.fire({title:"¬øEliminar ensayo?",text:`¬øEst√°s seguro de eliminar el ensayo ${d.value} de la base de datos?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"S√≠, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)&&!te.value){te.value=!0;try{T.fire({toast:!0,position:"top-end",icon:"info",title:"Eliminando...",showConfirmButton:!1,timer:3e4,timerProgressBar:!0});const l=await((i,a={},c=3e4)=>new Promise((b,h)=>{const w=setTimeout(()=>h(new Error("Timeout contacting server")),c);fetch(i,a).then(D=>{clearTimeout(w),b(D)}).catch(D=>{clearTimeout(w),h(D)})}))("/api/uster/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({testnr:d.value}),credentials:"include"},3e4);let r=null;try{r=await l.json()}catch{r=null}if(!l.ok)throw new Error(r&&r.error?r.error:r&&r.message||`HTTP ${l.status}`);const s=m.value.find(i=>i.testnr===d.value);s&&(s.imp=!1,await x()),T.fire({toast:!0,position:"top-end",icon:"success",title:`Ensayo ${d.value} eliminado`,text:r.message||"Eliminado correctamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}catch(t){console.error("deleteCurrentTest error",t),await T.fire({icon:"error",title:"Error al eliminar",text:String(t&&t.message?t.message:t),confirmButtonText:"Cerrar"})}finally{te.value=!1}}}function nt(o){W.value=o}function ie(o){const t=u.value&&u.value[o]&&String(u.value[o].TITULO||"").trim()||"";if(t==="")return!0;function e(a){if(Number.isNaN(a))return"";a<.01&&(a=.01),a>99.99&&(a=99.99);const c=Number(a).toFixed(2),b=String(c).split(".");return b[0]=b[0].padStart(2,"0"),b.join(".")}if(Ve.test(t)){const a=e(Number(t));if(a!=="")return u.value&&u.value[o]&&(u.value[o].TITULO=a),!0}if(Ge.test(t)){const a=parseFloat(t),c=e(a);if(c!=="")return u.value&&u.value[o]&&(u.value[o].TITULO=c),!0}let l=t.replace(/[^0-9.]/g,"");const r=l.split(".");if(r.length===1?l=r[0].slice(0,2):l=r[0].slice(0,2)+"."+(r[1]||"").slice(0,2),l==="")return u.value&&u.value[o]&&(u.value[o].TITULO=""),!0;const s=parseFloat(l),i=e(s);return i!==""?(u.value&&u.value[o]&&(u.value[o].TITULO=i),!0):(u.value&&u.value[o]&&(u.value[o].TITULO=""),!0)}function rt(o){ie(o),W.value===o&&(W.value=null)}function st(o){const t=z.value||[],e=t.findIndex(s=>s.srcIndex===o);if(e===-1||!ie(o))return;let r=-1;for(let s=e+1;s<t.length;s++)if(t[s].srcIndex!==null){r=s;break}if(r!==-1){const s=t[r];x(()=>{if(typeof window<"u"&&window.document){const i=window.document.getElementById("titulo-input-"+s.srcIndex);if(i){i.focus();try{i.select&&i.select()}catch(a){console.warn("select error",a)}}}})}else x(()=>{I.value&&ae.value&&!B.value&&I.value.focus()})}function Ie(o){const t=z.value||[],e=t.findIndex(s=>s.srcIndex===o);if(e===-1||t.length===0||!ie(o))return;let r=-1;for(let s=e+1;s<t.length;s++)if(t[s].srcIndex!==null){r=s;break}if(r!==-1){const s=t[r];x(()=>{if(typeof window<"u"&&window.document){const i=window.document.getElementById("titulo-input-"+s.srcIndex);if(i){i.focus();try{i.select&&i.select()}catch(a){console.warn("select error",a)}}}})}else x(()=>{I.value&&ae.value&&!B.value&&I.value.focus()})}function at(o){const t=z.value||[],e=t.findIndex(s=>s.srcIndex===o);if(e===-1||t.length===0||!ie(o))return;if(e===0){x(()=>{g.value==="No"&&Y.value?Y.value.focus():H.value&&H.value.focus()});return}const r=t[e-1];r&&x(()=>{if(typeof window<"u"&&window.document){const s=window.document.getElementById("titulo-input-"+r.srcIndex);if(s){s.focus();try{s.select&&s.select()}catch(i){console.warn("select error",i)}}}})}function it(){const o=z.value||[];let t=-1;for(let e=o.length-1;e>=0;e--)if(o[e].srcIndex!==null){t=e;break}if(t!==-1){const e=o[t];x(()=>{if(typeof window<"u"&&window.document){const l=window.document.getElementById("titulo-input-"+e.srcIndex);if(l){l.focus();try{l.select&&l.select()}catch(r){console.warn("select error",r)}}}})}}function Oe(){const t=(z.value||[]).find(e=>e.srcIndex!==null);t&&x(()=>{if(typeof window<"u"&&window.document){const e=window.document.getElementById("titulo-input-"+t.srcIndex);if(e){e.focus();try{e.select&&e.select()}catch(l){console.warn("select error",l)}}}})}function ct(o){let e=o.target.value;e=e.replace(/[^0-9.]/g,"");const l=e.split(".");if(l.length>2&&(e=l[0]+"."+l.slice(1).join("")),e.includes(".")){const[r,s]=e.split(".");e=r.slice(0,3)+"."+(s||"").slice(0,1)}else e=e.slice(0,3);!de.value&&e.length===3&&!e.includes(".")&&(e=e+"."),_.value=e,/^\d{1,3}\.\d$/.test(e)&&he(),de.value=!1}function ut(){/^\d{3}\.$/.test(_.value)&&(_.value=_.value+"0"),he()}function dt(o){de.value=o.key==="Backspace"||o.key==="Delete",o.key==="."&&_.value.includes(".")&&o.preventDefault()}function he(){d.value&&(g.value="Si",x(()=>{H.value&&H.value.focus()}))}function Re(o){const t=o.key;if(t==="Enter"){o.preventDefault(),Oe();return}if(t==="ArrowDown"){o.preventDefault(),Oe();return}if(t==="ArrowUp"){if(o.preventDefault(),E.value){E.value.focus();try{E.value.select&&E.value.select()}catch{}}return}if(t==="ArrowLeft"){o.preventDefault(),g.value="Si",x(()=>{H.value&&H.value.focus()});return}if(t==="ArrowRight"){o.preventDefault(),g.value="No",x(()=>{Y.value&&Y.value.focus()});return}}function K(o,t,e){if(o==null)return null;const l=o.split(/\r?\n/);if(l.length<t)return null;let r=l[t-1];r&&r.charCodeAt(0)===65279&&(r=r.slice(1));const s=r.split("	");return e-1>=s.length?null:s[e-1]}function ft(o,t){if(!P.value)return"";const e=K(P.value,o,t);return e??""}const Ue=[{field:"CATALOG",row:3,col:1},{field:"TESTNR",row:8,col:5},{field:"TIME",row:9,col:5},{field:"LOTE",row:10,col:5},{field:"SORTIMENT",row:11,col:5},{field:"ARTICLE",row:12,col:5},{field:"MASCHNR",row:13,col:5},{field:"MATCLASS",row:14,col:8},{field:"NOMCOUNT",row:15,col:5},{field:"NOMTWIST",row:16,col:5},{field:"USCODE",row:17,col:8},{field:"FB_MIC",row:18,col:5},{field:"FB_TIPO",row:18,col:8},{field:"FB_LONG",row:18,col:9},{field:"FB_PORC",row:18,col:12},{field:"LABORANT",row:21,col:5},{field:"OBS",row:22,col:5},{field:"TUNAME",row:27,col:5},{field:"GROUPS",row:28,col:5},{field:"WITHIN",row:29,col:5},{field:"TOTAL",row:30,col:5},{field:"SPEED",row:31,col:5},{field:"TESTTIME",row:32,col:5},{field:"SLOT",row:33,col:5},{field:"ABSORBERPRESSURE",row:34,col:5}],pt=[{label:"Nro Test",code:"TESTNR"},{label:"Hilo",code:"NOMCOUNT"},{label:"Tipo Material",code:"MATCLASS"},{label:"Maquina",code:"MASCHNR"},{label:"Lote",code:"LOTE"},{label:"Total Test",code:"TOTAL"},{label:"Fecha y Hora",code:"TIME"},{label:"Laboratorista",code:"LABORANT"},{label:"Observaciones",code:"OBS"}];function ce(o){const t=Ue.find(l=>l.field===o);if(t&&P.value){const l=ft(t.row,t.col);if(l)return o==="TIME"?vt(l):l}const e=m.value.find(l=>l.testnr===d.value);if(e){if(o==="NOMCOUNT")return e.nomcount||"";if(o==="MASCHNR")return e.maschnr||"";if(o==="TESTNR")return e.testnr||"";if(o==="MATCLASS")return e.matclass||""}return""}function vt(o){if(o==null)return"";const t=String(o).trim();if(t==="")return"";const e=Number(t);if(!Number.isFinite(e))return t;let l=e;Math.abs(e)<1e12&&(l=e*1e3);const r=new Date(l);if(isNaN(r.getTime()))return t;const s=String(r.getDate()).padStart(2,"0"),i=String(r.getMonth()+1).padStart(2,"0"),a=r.getFullYear(),c=String(r.getHours()).padStart(2,"0"),b=String(r.getMinutes()).padStart(2,"0");return`${s}/${i}/${a} ${c}:${b}`}return(o,t)=>(p(),v(R,null,[t[30]||(t[30]=n("div",{class:"md:hidden p-4"},[n("div",{class:"bg-slate-50 border border-slate-200 rounded-xl p-4 text-slate-700 text-sm"}," Esta p√°gina de carga (Uster) est√° disponible solo en escritorio (pantallas medianas o mayores). ")],-1)),n("div",xt,[n("main",wt,[n("div",gt,[n("div",_t,[t[14]||(t[14]=n("label",{class:"text-sm font-semibold text-slate-700 mr-2 shrink-0"},"Carpeta de archivos Uster:",-1)),n("div",yt,[n("div",{class:"px-3 py-2 border border-slate-300 rounded-lg bg-white text-sm text-slate-800 truncate shadow-sm focus-within:ring-2 focus-within:ring-blue-500",title:ee.value},[be(M(ee.value||ue.value||X.value||"Ninguna carpeta seleccionada")+" ",1),oe.value?C("",!0):(p(),v("span",St,"(ruta no absoluta disponible por seguridad)"))],8,Tt)]),n("div",Mt,[n("button",{onClick:le,title:"Seleccionar carpeta con archivos de Uster",class:"hidden md:inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-md text-sm font-medium hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md"},[...t[10]||(t[10]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7a2 2 0 012-2h3l2 3h6a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"})],-1),be(" Seleccionar ",-1)])]),n("button",{onClick:le,title:"Seleccionar carpeta con archivos de Uster",class:"inline-flex md:hidden items-center p-2 border border-slate-200 bg-white text-slate-700 rounded-md hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md","aria-label":"Seleccionar carpeta"},[...t[11]||(t[11]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7a2 2 0 012-2h3l2 3h6a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"})],-1)])]),Z.value?(p(),v("button",{key:0,onClick:Se,title:"Actualizar archivos de Uster",class:"hidden md:inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-md text-sm font-medium hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md"},[...t[12]||(t[12]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),be(" Actualizar ",-1)])])):C("",!0),Z.value?(p(),v("button",{key:1,onClick:Se,title:"Actualizar archivos de Uster",class:"inline-flex md:hidden items-center p-2 border border-slate-200 bg-white text-slate-700 rounded-md hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md","aria-label":"Actualizar carpeta"},[...t[13]||(t[13]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])):C("",!0),n("input",{ref_key:"folderInput",ref:Q,type:"file",webkitdirectory:"",directory:"",multiple:"",class:"hidden",onChange:Fe},null,544)])])]),n("div",Et,[n("div",kt,[n("div",Nt,[n("table",Ct,[t[18]||(t[18]=n("colgroup",null,[n("col",{class:"col-ensayo"}),n("col",{class:"col-par"}),n("col",{class:"col-tbl"}),n("col",{class:"col-imp"}),n("col",{class:"col-ne"}),n("col",{class:"col-maq"})],-1)),t[19]||(t[19]=n("thead",null,[n("tr",{class:"bg-gradient-to-r from-slate-50 to-slate-100"},[n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-ensayo"}," Ensayo"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-par"}," .PAR"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-tbl"}," .TBL"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-imp"}," Estado"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-ne"}," Ne"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-maq"}," Maq.")])],-1)),n("tbody",null,[(p(!0),v(R,null,G(je.value,(e,l)=>(p(),v("tr",{key:l,class:L(["hover:bg-blue-50/30 cursor-pointer transition-colors duration-150",{"bg-blue-50":d.value===e.testnr}]),onClick:r=>e.testnr&&Ee(e.testnr)},[n("td",It,M(e.testnr||""),1),n("td",Ot,[e.hasPar?(p(),v("svg",{key:0,xmlns:"http://www.w3.org/2000/svg",class:L(["h-4 w-4 mx-auto",e.imp===!0?"text-green-600":"text-slate-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[...t[15]||(t[15]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1)])],2)):C("",!0)]),n("td",Rt,[e.hasTbl?(p(),v("svg",{key:0,xmlns:"http://www.w3.org/2000/svg",class:L(["h-4 w-4 mx-auto",e.imp===!0?"text-green-600":"text-slate-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[...t[16]||(t[16]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1)])],2)):C("",!0)]),n("td",Ut,[e.imp===!0?(p(),v("span",Ht,[...t[17]||(t[17]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-green-600 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1)])])):C("",!0)]),n("td",Pt,M(e.nomcount||""),1),n("td",At,M(e.maschnr||""),1)],10,Lt))),128))])])]),n("div",Bt,M($e.value),1),n("div",Kt,[n("div",Dt,[n("label",Ft,[U(n("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>A.value=e),onChange:t[1]||(t[1]=()=>{A.value&&(k.value=!1,N.value=!1,j())}),class:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-400"},null,544),[[xe,A.value]]),t[20]||(t[20]=n("span",{class:"text-slate-700 font-medium"},"Mostrar todos",-1))]),n("label",Gt,[U(n("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>k.value=e),onChange:t[3]||(t[3]=()=>{k.value&&(A.value=!1,N.value=!1,j())}),class:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-400"},null,544),[[xe,k.value]]),t[21]||(t[21]=n("span",{class:"text-slate-700 font-medium"},"No guardados",-1))]),n("label",Vt,[U(n("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>N.value=e),onChange:t[5]||(t[5]=()=>{N.value&&(A.value=!1,k.value=!1,j())}),class:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-400"},null,544),[[xe,N.value]]),t[22]||(t[22]=n("span",{class:"text-slate-700 font-medium"},"Guardados",-1))])])])]),n("div",jt,[n("div",$t,[n("div",Wt,[t[23]||(t[23]=n("label",{class:"text-xs font-semibold text-slate-700"},"Estiraje",-1)),U(n("input",{ref_key:"estirajeInput",ref:E,"onUpdate:modelValue":t[6]||(t[6]=e=>_.value=e),type:"text",maxlength:"5",disabled:!d.value,onInput:ct,onKeydown:[q(J(ut,["prevent"]),["enter"]),dt,q(J(he,["prevent"]),["down"])],class:L(["w-16 px-2 py-0.5 text-sm text-center border border-slate-300 rounded focus:outline-none transition-all",d.value?"bg-white text-slate-900 hover:bg-slate-50 focus:ring-2 focus:ring-yellow-300 focus:border-yellow-300 focus:bg-yellow-50":"bg-slate-100 text-slate-400 cursor-not-allowed"])},null,42,zt),[[Pe,_.value]])])]),n("div",qt,[n("div",Jt,[t[24]||(t[24]=n("label",{class:"text-xs font-semibold text-slate-700"},"Pasador",-1)),n("div",Qt,[n("label",Yt,[U(n("input",{ref_key:"pasadorSiInput",ref:H,"onUpdate:modelValue":t[7]||(t[7]=e=>g.value=e),type:"radio",value:"Si",disabled:!d.value,onKeydown:Re,class:L(["w-3.5 h-3.5 text-blue-600 border-slate-300 focus:ring-2 focus:ring-blue-500",d.value?"cursor-pointer":"cursor-not-allowed opacity-50"])},null,42,Xt),[[Ae,g.value]]),n("span",{class:L(["text-xs",d.value?"text-slate-700":"text-slate-400"])},"Si",2)]),n("label",Zt,[U(n("input",{ref_key:"pasadorNoInput",ref:Y,"onUpdate:modelValue":t[8]||(t[8]=e=>g.value=e),type:"radio",value:"No",disabled:!d.value,onKeydown:Re,class:L(["w-3.5 h-3.5 text-blue-600 border-slate-300 focus:ring-2 focus:ring-blue-500",d.value?"cursor-pointer":"cursor-not-allowed opacity-50"])},null,42,eo),[[Ae,g.value]]),n("span",{class:L(["text-xs",d.value?"text-slate-700":"text-slate-400"])},"No",2)])])])]),n("div",to,[n("table",oo,[t[25]||(t[25]=n("thead",null,[n("tr",{class:"bg-gradient-to-r from-slate-50 to-slate-100"},[n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs",style:{width:"70px"}},"Huso"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs",style:{width:"90px"}},"Titulo")])],-1)),n("tbody",null,[(p(!0),v(R,null,G(z.value,(e,l)=>(p(),v("tr",{key:l,class:"hover:bg-blue-50/30 transition-colors duration-150"},[n("td",lo,[e.srcIndex!==null?(p(),v("div",no,M(e.nro),1)):(p(),v("div",ro,"‚Äî"))]),n("td",so,[e.srcIndex!==null?(p(),v("div",ao,[U(n("input",{id:"titulo-input-"+e.srcIndex,"onUpdate:modelValue":r=>u.value[e.srcIndex].TITULO=r,inputmode:"decimal",maxlength:"5",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",onFocus:r=>nt(e.srcIndex),onBlur:r=>rt(e.srcIndex),onInput:r=>Ke(e.srcIndex,r),onKeydown:[q(J(r=>st(e.srcIndex),["prevent"]),["enter"]),q(J(r=>at(e.srcIndex),["prevent"]),["up"]),q(J(r=>Ie(e.srcIndex),["prevent"]),["down"])],class:L(["w-full box-border px-1 py-0.5 text-sm text-center border border-slate-300 text-slate-900 focus:outline-none focus:ring-2 focus:border-blue-500 transition-all",W.value===e.srcIndex?"bg-yellow-50 ring-2 ring-yellow-400":"bg-white hover:bg-slate-50"]),style:{"box-sizing":"border-box",margin:"0","border-radius":"0"}},null,42,io),[[Pe,u.value[e.srcIndex].TITULO]])])):(p(),v("div",co,"‚Äî"))])]))),128))])])])]),n("div",null,[n("div",uo,[n("table",fo,[t[27]||(t[27]=n("colgroup",null,[n("col",{class:"col-dato"}),n("col",{class:"col-valor"})],-1)),t[28]||(t[28]=n("thead",null,[n("tr",{class:"bg-gradient-to-r from-slate-50 to-slate-100"},[n("th",{class:"px-3 py-3 text-left font-semibold text-slate-700 border-b border-slate-200 text-xs col-dato"}," Dato"),n("th",{class:"px-3 py-3 text-left font-semibold text-slate-700 border-b border-slate-200 text-xs col-valor"}," Valor")])],-1)),n("tbody",null,[(p(),v(R,null,G(pt,e=>n("tr",{key:e.code,class:"hover:bg-blue-50/30 transition-colors duration-150"},[n("td",po,M(e.label),1),n("td",vo,[e.code==="MATCLASS"?U((p(),v("select",{key:0,"onUpdate:modelValue":t[9]||(t[9]=l=>y.value=l),class:"w-[calc(100%-5px)] px-2 py-1 border border-slate-300 rounded text-xs focus:outline-none focus:ring-2 focus:ring-blue-400"},[...t[26]||(t[26]=[n("option",{value:"Hilo"},"Hilo",-1),n("option",{value:"Hilo de fantasia"},"Hilo de fantasia",-1)])],512)),[[ht,y.value]]):(p(),v("span",mo,M(ce(e.code)),1))])])),64))])])]),n("div",ho,[ae.value?(p(),v("button",{key:0,ref_key:"saveButton",ref:I,onClick:ot,disabled:B.value,onKeydown:q(J(it,["prevent"]),["up"]),class:"inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-md text-sm font-medium hover:bg-slate-50 transition-colors duration-150 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 shadow-sm hover:shadow-md"},[B.value?(p(),v("span",wo,"Guardando...")):(p(),v("span",xo,"Guardar"))],40,bo)):C("",!0),d.value&&Le.value?(p(),v("button",{key:1,onClick:lt,disabled:te.value,class:"inline-flex items-center gap-2 px-3 py-1 border border-red-300 bg-white text-red-700 rounded-md text-sm font-medium hover:bg-red-50 transition-colors duration-150 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2 shadow-sm hover:shadow-md"},[te.value?(p(),v("span",yo,"Eliminando...")):(p(),v("span",_o,"Eliminar"))],8,go)):C("",!0)])])]),u.value.length?(p(),v("div",To,[n("div",So,[n("table",{class:"w-full text-sm border-collapse tbl-import-table compact-table",style:we({minWidth:et.value+"px",tableLayout:"fixed"})},[n("colgroup",null,[n("col",{style:we({width:Be+"px"})},null,4),(p(),v(R,null,G(ne,(e,l)=>n("col",{key:l,style:we({width:Ne(e)+"px"})},null,4)),64))]),n("thead",null,[n("tr",Mo,[t[29]||(t[29]=n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs"},"#",-1)),(p(),v(R,null,G(ne,e=>n("th",{key:e,class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs"},M(e),1)),64))])]),n("tbody",null,[(p(!0),v(R,null,G(u.value,(e,l)=>(p(),v("tr",{key:l,class:"hover:bg-blue-50/30 transition-colors duration-150"},[n("td",Eo,M(l+1),1),(p(),v(R,null,G(ne,r=>n("td",{key:r,class:"px-3 py-2 border-b border-slate-200 font-mono text-xs text-center text-slate-700"},M(e[r]),1)),64))]))),128))])],4)])])):C("",!0)])])],64))}},Oo=bt(ko,[["__scopeId","data-v-66400b0a"]]);export{Oo as default};
