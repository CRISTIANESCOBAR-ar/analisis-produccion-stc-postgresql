import{_ as Be}from"./LogoSantana-C2JneU89.js";import{C as Ne}from"./CustomDatepicker-0U2xKFTQ.js";import{C as xe,B as Ke,p as Fe,a as Ve,b as We,c as He,d as Ue,L as qe}from"./chart-zkXOqXAa.js";import{H as De,I as ye,J as Ce,K as Ye,o as _e,E as Ge,w as Ze,m as F,L as we,M as Ie,l as Xe,a as D,c as z,b as y,f as be,A as ke,u as Je,e as te,G as ie,C as re,p as P,z as Qe}from"./index-DYTbJAB1.js";import{p as et}from"./chartjs-plugin-datalabels.esm-C5Rd3EbC.js";import{S as ae}from"./sweetalert2.esm.all-AlKuj1Cq.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},at={ariaLabel:{type:String},ariaDescribedby:{type:String}},ot={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...Ee,...at},st=Ye[0]==="2"?(c,h)=>Object.assign(c,{attrs:h}):(c,h)=>Object.assign(c,h);function le(c){return Ie(c)?we(c):c}function nt(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:c;return Ie(h)?new Proxy(c,{}):c}function it(c,h){const m=c.options;m&&h&&Object.assign(m,h)}function Ae(c,h){c.labels=h}function Te(c,h,m){const $=[];c.datasets=h.map(g=>{const p=c.datasets.find(R=>R[m]===g[m]);return!p||!g.data||$.includes(p)?{...g}:($.push(p),Object.assign(p,g),p)})}function rt(c,h){const m={labels:[],datasets:[]};return Ae(m,c.labels),Te(m,c.datasets,h),m}const lt=De({props:ot,setup(c,h){let{expose:m,slots:$}=h;const g=F(null),p=Ce(null);m({chart:p});const R=()=>{if(!g.value)return;const{type:w,data:M,options:de,plugins:E,datasetIdKey:oe}=c,X=rt(M,oe),V=nt(X,M);p.value=new xe(g.value,{type:w,data:V,options:{...de},plugins:E})},S=()=>{const w=we(p.value);w&&(c.destroyDelay>0?setTimeout(()=>{w.destroy(),p.value=null},c.destroyDelay):(w.destroy(),p.value=null))},T=w=>{w.update(c.updateMode)};return _e(R),Ge(S),Ze([()=>c.options,()=>c.data],(w,M)=>{let[de,E]=w,[oe,X]=M;const V=we(p.value);if(!V)return;let J=!1;if(de){const H=le(de),se=le(oe);H&&H!==se&&(it(V,H),J=!0)}if(E){const H=le(E.labels),se=le(X.labels),ue=le(E.datasets),fe=le(X.datasets);H!==se&&(Ae(V.config.data,H),J=!0),ue&&ue!==fe&&(Te(V.config.data,ue,c.datasetIdKey),J=!0)}J&&Xe(()=>{T(V)})},{deep:!0}),()=>ye("canvas",{role:"img","aria-label":c.ariaLabel,"aria-describedby":c.ariaDescribedby,ref:g},[ye("p",{},[$.default?$.default():""])])}});function ct(c,h){return xe.register(h),De({props:Ee,setup(m,$){let{expose:g}=$;const p=Ce(null),R=S=>{p.value=S==null?void 0:S.chart};return g({chart:p}),()=>ye(lt,st({ref:R},{type:c,...m}))}})}const ce=ct("bar",Ke),dt={class:"w-full h-screen flex flex-col p-1"},ut={class:"w-full flex-1 min-h-0 bg-white rounded-2xl shadow-xl px-4 py-3 border border-slate-200 flex flex-col relative"},pt={class:"flex items-center justify-between gap-4 flex-shrink-0 mb-4"},ft={class:"flex items-center gap-2"},gt={key:0,class:"absolute inset-0 bg-white/50 backdrop-blur-sm flex items-center justify-center z-10"},ht={class:"flex-1 flex gap-4 min-w-0"},mt={class:"flex-[3] h-full p-4 border border-slate-200 rounded-lg min-w-0 overflow-hidden"},vt={key:1,class:"h-full flex items-center justify-center text-slate-400"},bt={class:"flex-[1] h-full p-4 border border-slate-200 rounded-lg min-w-0 overflow-hidden"},yt={key:1,class:"h-full flex items-center justify-center text-slate-400"},wt={class:"flex-[1.3] h-full px-2 py-4 border border-slate-200 rounded-lg min-w-0 overflow-hidden"},xt={key:1,class:"h-full flex items-center justify-center text-slate-400"},$t={class:"flex-1 flex gap-4 min-w-0"},Rt={class:"flex-[3] h-full p-4 border border-slate-200 rounded-lg min-w-0 overflow-hidden"},St={key:1,class:"h-full flex items-center justify-center text-slate-400"},kt={class:"flex-[1] h-full p-4 border border-slate-200 rounded-lg min-w-0 overflow-hidden"},Dt={key:1,class:"h-full flex items-center justify-center text-slate-400"},Ct={class:"flex-[1.3] h-full px-2 py-4 border border-slate-200 rounded-lg min-w-0 overflow-hidden"},_t={key:1,class:"h-full flex items-center justify-center text-slate-400"},It={__name:"AnalisisResiduosIndigo",setup(c){xe.register(Fe,Ve,We,He,Ue,qe,et);const h="".replace(/\/$/,""),m=h?`${h}/api`:"/api",$=F(!1),g=F([]),p=F([]),R=F([]),S=F([]),T=F([]),w=F([]),M=F(null),E=F((()=>{const e=new Date;e.setDate(e.getDate()-1);const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${l}`})()),oe=async()=>{$.value=!0;try{const[e,t,a]=E.value.split("-"),l=`01/${t}/${e}`,f=`${a}/${t}/${e}`,r=`${a}/${t}/${e}`,[s,o,n,v,A,O]=await Promise.all([fetch(`${m}/residuos-indigo-analisis?fecha_inicio=${l}&fecha_fin=${f}`),fetch(`${m}/produccion-indigo-resumen?fecha_inicio=${l}&fecha_fin=${f}`),fetch(`${m}/residuos-indigo-analisis?fecha_inicio=${r}&fecha_fin=${r}`),fetch(`${m}/produccion-indigo-resumen?fecha_inicio=${r}&fecha_fin=${r}`),fetch(`${m}/residuos-indigo-estopa-por-mes`),fetch(`${m}/residuos-indigo-estopa-por-dia?fecha_inicio=${l}&fecha_fin=${f}`)]);if(!s.ok||!o.ok||!n.ok||!v.ok||!A.ok||!O.ok)throw new Error("Error al cargar datos");g.value=await s.json();const U=await o.json();p.value=U.s_valores||[],R.value=await n.json();const Q=await v.json();S.value=Q.s_valores||[],T.value=await A.json(),w.value=await O.json()}catch(e){console.error("Error:",e),g.value=[],p.value=[],R.value=[],S.value=[],T.value=[],w.value=[]}finally{$.value=!1}},X=P(()=>{if(g.value.length===0)return null;const e=(a,l=10)=>{const f=a.split(" "),r=[];let s="";return f.forEach(o=>{(s+" "+o).trim().length<=l?s=s?s+" "+o:o:(s&&r.push(s),s=o)}),s&&r.push(s),r},t=Math.max(...g.value.map(a=>a.TotalKg));return{labels:g.value.map(a=>e(a.DESC_MOTIVO)),datasets:[{label:"Kg Residuos",data:g.value.map(a=>a.TotalKg),backgroundColor:g.value.map((a,l)=>a.TotalKg===t?"#dc2626":l%2===0?"#0f172a":"#3b82f6"),borderRadius:4}]}}),V=P(()=>{const[e,t,a]=E.value.split("-"),l=g.value.reduce((o,n)=>o+n.TotalKg,0),f=(o,n,v)=>`${o}-${["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"][parseInt(n)-1]}-${v.slice(2)}`,r=f("01",t,e),s=f(a,t,e);return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`Residuos por Motivo del Periodo ${r} a ${s}`,font:{size:24,weight:"bold"},padding:{bottom:30},color:"#000"},datalabels:{anchor:"end",align:"top",formatter:o=>{const n=l>0?(o/l*100).toFixed(1):"0.0";return`${Math.round(o).toLocaleString()}
(${n}%)`},font:{weight:"bold",size:11},color:"#000"}},scales:{y:{beginAtZero:!0,grid:{display:!1},ticks:{display:!1},border:{display:!1}},x:{grid:{display:!1},ticks:{font:{weight:"bold",size:10},color:"#000",maxRotation:0,minRotation:0,autoSkip:!1,padding:5,callback:function(o,n){const v=this.getLabelForValue(o);return Array.isArray(v)?v:[v]}}}}}}),J=P(()=>{if(p.value.length===0)return null;const e=Math.max(...p.value.map(a=>a.count)),t=["#10b981","#3b82f6","#f59e0b","#ef4444","#8b5cf6"];return{labels:p.value.map(a=>a.S),datasets:[{label:"Cantidad de Registros",data:p.value.map(a=>a.count),backgroundColor:p.value.map((a,l)=>a.count===e?"#dc2626":t[l%t.length]),borderRadius:4}]}}),H=P(()=>{const e=p.value.reduce((t,a)=>t+a.count,0);return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Producci√≥n √çNDIGO por Tipo",font:{size:16,weight:"bold"},padding:{top:10,bottom:30},color:"#000"},datalabels:{anchor:"end",align:"end",offset:4,formatter:t=>{const a=e>0?(t/e*100).toFixed(1):"0.0";return`${t.toLocaleString()}
(${a}%)`},font:{weight:"bold",size:11},color:"#000"}},scales:{y:{beginAtZero:!0,grid:{display:!1},ticks:{display:!1},border:{display:!1}},x:{grid:{display:!1},ticks:{font:{weight:"bold",size:10},color:"#000"}}}}}),se=P(()=>{if(R.value.length===0)return null;const e=(a,l=10)=>{const f=a.split(" "),r=[];let s="";return f.forEach(o=>{(s+" "+o).trim().length<=l?s=s?s+" "+o:o:(s&&r.push(s),s=o)}),s&&r.push(s),r},t=Math.max(...R.value.map(a=>a.TotalKg));return{labels:R.value.map(a=>e(a.DESC_MOTIVO)),datasets:[{label:"Kg Residuos",data:R.value.map(a=>a.TotalKg),backgroundColor:R.value.map((a,l)=>a.TotalKg===t?"#dc2626":l%2===0?"#0f172a":"#3b82f6"),borderRadius:4}]}}),ue=P(()=>{const[e,t,a]=E.value.split("-"),l=R.value.reduce((s,o)=>s+o.TotalKg,0),r=((s,o,n)=>`${s}-${["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"][parseInt(o)-1]}-${n.slice(2)}`)(a,t,e);return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`Residuos por Motivo del D√≠a ${r}`,font:{size:24,weight:"bold"},padding:{bottom:30},color:"#000"},datalabels:{anchor:"end",align:"top",formatter:s=>{const o=l>0?(s/l*100).toFixed(1):"0.0";return`${Math.round(s).toLocaleString()}
(${o}%)`},font:{weight:"bold",size:11},color:"#000"}},scales:{y:{beginAtZero:!0,grid:{display:!1},ticks:{display:!1},border:{display:!1}},x:{grid:{display:!1},ticks:{font:{weight:"bold",size:10},color:"#000",maxRotation:0,minRotation:0,autoSkip:!1,padding:5,callback:function(s,o){const n=this.getLabelForValue(s);return Array.isArray(n)?n:[n]}}}}}}),fe=P(()=>{if(S.value.length===0)return null;const e=Math.max(...S.value.map(a=>a.count)),t=["#10b981","#3b82f6","#f59e0b","#ef4444","#8b5cf6"];return{labels:S.value.map(a=>a.S),datasets:[{label:"Cantidad de Registros",data:S.value.map(a=>a.count),backgroundColor:S.value.map((a,l)=>a.count===e?"#dc2626":t[l%t.length]),borderRadius:4}]}}),Me=P(()=>{const e=S.value.reduce((t,a)=>t+a.count,0);return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Producci√≥n √çNDIGO por Tipo",font:{size:16,weight:"bold"},padding:{top:10,bottom:30},color:"#000"},datalabels:{anchor:"end",align:"end",offset:4,formatter:t=>{const a=e>0?(t/e*100).toFixed(1):"0.0";return`${t.toLocaleString()}
(${a}%)`},font:{weight:"bold",size:11},color:"#000"}},scales:{y:{beginAtZero:!0,grid:{display:!1},ticks:{display:!1},border:{display:!1}},x:{grid:{display:!1},ticks:{font:{weight:"bold",size:10},color:"#000"}}}}}),$e=P(()=>{if(T.value.length===0)return null;const e=Math.max(...T.value.map(t=>t.KgResiduo));return{labels:T.value.map(t=>{const[a,l]=t.Mes.split("-");return`${["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"][parseInt(l)-1]}-${a.slice(2)}`}),datasets:[{label:"Kg de Estopa Azul",data:T.value.map(t=>t.KgResiduo),backgroundColor:T.value.map(t=>t.KgResiduo===e?"#dc2626":"#3b82f6"),borderRadius:4}]}}),Le=P(()=>{const e=T.value.reduce((t,a)=>t+a.KgResiduo,0);return T.value.length>0&&(e/T.value.length).toFixed(0),{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:"Estopa Azul por Mes (√öltimos 12 Meses)",font:{size:14,weight:"bold"},padding:{top:5,bottom:20},color:"#000"},datalabels:{display:!1},tooltip:{callbacks:{afterLabel:t=>{const a=t.raw;return`${e>0?(a/e*100).toFixed(1):"0.0"}% del total`}}}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"#e5e7eb"},ticks:{callback:function(t){return Math.round(t).toLocaleString()+" kg"},font:{size:9},color:"#666"},border:{display:!1}},x:{grid:{display:!1},ticks:{font:{weight:"bold",size:9},color:"#000",maxRotation:90,minRotation:90,autoSkip:!1,padding:5}}}}}),Re=P(()=>{if(w.value.length===0)return null;const e=Math.max(...w.value.map(t=>t.KgResiduo));return{labels:w.value.map(t=>{const[a]=t.Fecha.split("/");return a}),datasets:[{label:"Kg de Estopa Azul",data:w.value.map(t=>t.KgResiduo),backgroundColor:w.value.map(t=>t.KgResiduo===e?"#dc2626":"#10b981"),borderRadius:4}]}}),Pe=P(()=>{const e=w.value.reduce((o,n)=>o+n.KgResiduo,0),[t,a,l]=E.value.split("-"),f=(o,n,v)=>`${o}-${["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"][parseInt(n)-1]}-${v.slice(2)}`,r=f("01",a,t),s=f(l,a,t);return{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`Estopa Azul por D√≠a del Periodo ${r} a ${s}`,font:{size:14,weight:"bold"},padding:{top:5,bottom:20},color:"#000"},datalabels:{display:!1},tooltip:{callbacks:{afterLabel:o=>{const n=o.raw;return`${e>0?(n/e*100).toFixed(1):"0.0"}% del total del mes`}}}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"#e5e7eb"},ticks:{callback:function(o){return Math.round(o).toLocaleString()+" kg"},font:{size:9},color:"#666"},border:{display:!1}},x:{grid:{display:!1},ticks:{font:{weight:"bold",size:9},color:"#000",maxRotation:90,minRotation:90,autoSkip:!1,padding:5}}}}}),Oe=async()=>{try{const[e,t,a]=E.value.split("-"),f=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][parseInt(t)-1];let r=`üìä *AN√ÅLISIS RESIDUOS DE √çNDIGO*
`;if(r+=`üìÖ Per√≠odo: 01/${t}/${e} - ${a}/${t}/${e}
`,r+=`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

`,g.value.length>0){const s=g.value.reduce((o,n)=>o+n.TotalKg,0);r+=`üì¶ *RESIDUOS DEL PERIODO (${f})*
`,r+=`Total: *${Math.round(s).toLocaleString()} kg*

`,g.value.forEach(o=>{const n=(o.TotalKg/s*100).toFixed(1);r+=`‚Ä¢ ${o.DESC_MOTIVO}: ${Math.round(o.TotalKg).toLocaleString()} kg (${n}%)
`}),r+=`
`}if(p.value.length>0){const s=p.value.reduce((o,n)=>o+n.count,0);r+=`üè≠ *PRODUCCI√ìN √çNDIGO DEL PERIODO*
`,r+=`Total registros: *${s.toLocaleString()}*

`,p.value.forEach(o=>{const n=(o.count/s*100).toFixed(1);r+=`‚Ä¢ ${o.S}: ${o.count.toLocaleString()} (${n}%)
`}),r+=`
`}if(R.value.length>0){const s=R.value.reduce((o,n)=>o+n.TotalKg,0);r+=`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
`,r+=`üì¶ *RESIDUOS DEL D√çA ${a}/${t}/${e}*
`,r+=`Total: *${Math.round(s).toLocaleString()} kg*

`,R.value.forEach(o=>{const n=(o.TotalKg/s*100).toFixed(1);r+=`‚Ä¢ ${o.DESC_MOTIVO}: ${Math.round(o.TotalKg).toLocaleString()} kg (${n}%)
`}),r+=`
`}if(S.value.length>0){const s=S.value.reduce((o,n)=>o+n.count,0);r+=`üè≠ *PRODUCCI√ìN √çNDIGO DEL D√çA*
`,r+=`Total registros: *${s.toLocaleString()}*

`,S.value.forEach(o=>{const n=(o.count/s*100).toFixed(1);r+=`‚Ä¢ ${o.S}: ${o.count.toLocaleString()} (${n}%)
`})}r+=`
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
`,r+=`üìä Reporte generado: ${new Date().toLocaleString("es-ES")}`,await navigator.clipboard.writeText(r),ae.fire({toast:!0,position:"top-end",icon:"success",title:"Copiado al portapapeles",text:"Presiona Ctrl+V para pegar en WhatsApp",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}catch(e){console.error("Error al copiar:",e),ae.fire({toast:!0,position:"top-end",icon:"error",title:"Error al copiar",text:"No se pudo copiar el mensaje",showConfirmButton:!1,timer:3e3})}},je=async()=>{if(M.value)try{const e=Math.max(1,window.devicePixelRatio||1)*2,t=30,a=40,l=t,r=l+a+t,s=M.value.getBoundingClientRect(),o=Array.from(M.value.querySelectorAll("canvas"));if(o.length===0)throw new Error("No hay canvases para copiar");let n=1/0,v=1/0,A=-1/0,O=-1/0;const U=o.map(i=>i.getBoundingClientRect());U.forEach(i=>{const _=i.left-s.left,k=i.top-s.top;n=Math.min(n,_),v=Math.min(v,k),A=Math.max(A,_+i.width),O=Math.max(O,k+i.height)});const Q=Math.ceil(A-n),q=Math.ceil(O-v),ge=Math.round((Q+t*2)*e),he=Math.round((r+q+t)*e),B=document.createElement("canvas");B.width=ge,B.height=he;const j=B.getContext("2d");j.fillStyle="#ffffff",j.fillRect(0,0,B.width,B.height);const L=document.querySelector('main img[alt="Santana Textiles"]');let u=t;const N=40;if(L)try{if(L.complete){const i=L.getBoundingClientRect(),_=i.width&&i.height?i.width/i.height:1,k=N*_;j.drawImage(L,u*e,l*e,k*e,N*e),u+=k+16}else{const i=new Image;i.src=L.src,await new Promise(I=>{i.onload=I,i.onerror=I});const _=i.width&&i.height?i.width/i.height:1,k=N*_;j.drawImage(i,u*e,l*e,k*e,N*e),u+=k+16}}catch{}j.fillStyle="#0f172a",j.font=`${16*e}px sans-serif`,j.fillText("An√°lisis Residuos de √çndigo",u*e,(l+26)*e),o.forEach((i,_)=>{const k=U[_],I=k.left-s.left,me=k.top-s.top,ne=(t+(I-n))*e,d=(r+(me-v))*e,W=k.width*e,x=k.height*e;try{const K=i.width||k.width*(window.devicePixelRatio||1),ee=i.height||k.height*(window.devicePixelRatio||1);j.drawImage(i,0,0,K,ee,ne,d,W,x)}catch{try{const ee=i.toDataURL("image/png"),b=new Image;b.src=ee,b.onload=()=>{j.drawImage(b,ne,d,W,x)}}catch(ee){console.warn("No se pudo dibujar canvas:",ee)}}}),await new Promise(i=>setTimeout(i,50));const Y=await new Promise(i=>B.toBlob(i,"image/png",1));if(!Y)throw new Error("No se pudo generar la imagen");try{await navigator.clipboard.write([new ClipboardItem({"image/png":Y})]),ae.fire({toast:!0,position:"top-end",icon:"success",title:"Imagen copiada al portapapeles",text:"Presiona Ctrl+V para pegar",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});return}catch(i){console.warn("Escritura de imagen en portapapeles fall√≥, intentando fallback:",i)}try{const i=B.toDataURL("image/png");await navigator.clipboard.writeText(i),ae.fire({toast:!0,position:"top-end",icon:"success",title:"DataURL copiado al portapapeles",text:"Algunos destinos no pegar√°n esta entrada como imagen; guarda la imagen manualmente si es necesario.",showConfirmButton:!1,timer:3500,timerProgressBar:!0});return}catch(i){console.warn("Fallback writeText fall√≥:",i)}try{const i=B.toDataURL("image/png"),_=window.open("","_blank");if(_){_.document.write(`<html><head><title>Imagen</title></head><body style="margin:0"><img src="${i}" style="max-width:100%;height:auto;display:block;margin:0 auto;"/></body></html>`),_.document.close(),ae.fire({toast:!0,position:"top-end",icon:"info",title:"Imagen abierta en nueva pesta√±a",text:"Gu√°rdala o c√≥piala manualmente.",showConfirmButton:!1,timer:3500,timerProgressBar:!0});return}}catch(i){console.warn("Abrir nueva pesta√±a fall√≥:",i)}throw new Error("No se pudo copiar la imagen ni realizar fallbacks")}catch(e){console.error("Error al copiar imagen:",e),ae.fire({toast:!0,position:"top-end",icon:"error",title:"Error al generar imagen",text:e.message||"No se pudo crear la imagen",showConfirmButton:!1,timer:3e3})}};async function ze(){if(!M.value){window.print();return}try{const e=Math.max(1,window.devicePixelRatio||1)*2,t=20,a=16,l=35,f=t,s=f+l+t,o=M.value.getBoundingClientRect(),n=Array.from(M.value.querySelectorAll("canvas"));if(n.length===0)throw new Error("No hay canvases para imprimir");const v=n.map(d=>d.getBoundingClientRect());let A=1/0,O=1/0,U=-1/0,Q=-1/0;v.forEach((d,W)=>{const x=d.left-o.left,K=d.top-o.top;A=Math.min(A,x),O=Math.min(O,K),U=Math.max(U,x+d.width),Q=Math.max(Q,K+d.height)});const q=1.2,ge=Math.ceil((U-A)*q),he=Math.ceil((Q-O)*q),B=Math.round((ge+t*2)*e),j=Math.round((s+he+t)*e),L=document.createElement("canvas");L.width=B,L.height=j;const u=L.getContext("2d");u.fillStyle="#ffffff",u.fillRect(0,0,L.width,L.height);const N=document.querySelector('main img[alt="Santana Textiles"]');let Y=t;const i=35;if(N)try{if(N.complete){const d=N.getBoundingClientRect(),W=d.width&&d.height?d.width/d.height:1,x=i*W;u.drawImage(N,Y*e,f*e,x*e,i*e),Y+=x+16}else{const d=new Image;d.src=N.src,await new Promise(K=>{d.onload=K,d.onerror=K});const W=d.width&&d.height?d.width/d.height:1,x=i*W;u.drawImage(d,Y*e,f*e,x*e,i*e),Y+=x+16}}catch{}u.fillStyle="#0f172a",u.font=`bold ${16*e}px sans-serif`,u.fillText("An√°lisis Residuos de √çndigo",Y*e,(f+24)*e);const _="rgb(226, 232, 240)",k=1*e,I=4*e;n.forEach((d,W)=>{const x=v[W],K=x.left-o.left,ee=x.top-o.top,b=(t+(K-A)*q)*e,C=(s+(ee-O)*q)*e,G=x.width*q*e,Z=x.height*q*e;try{const Se=d.width||x.width*(window.devicePixelRatio||1),pe=d.height||x.height*(window.devicePixelRatio||1);u.drawImage(d,0,0,Se,pe,b,C,G,Z)}catch{try{const pe=d.toDataURL("image/png"),ve=new Image;ve.src=pe,ve.onload=()=>{u.drawImage(ve,b,C,G,Z)}}catch(pe){console.warn("No se pudo dibujar canvas:",pe)}}u.strokeStyle=_,u.lineWidth=k,u.beginPath(),u.moveTo(b+I,C),u.lineTo(b+G-I,C),u.quadraticCurveTo(b+G,C,b+G,C+I),u.lineTo(b+G,C+Z-I),u.quadraticCurveTo(b+G,C+Z,b+G-I,C+Z),u.lineTo(b+I,C+Z),u.quadraticCurveTo(b,C+Z,b,C+Z-I),u.lineTo(b,C+I),u.quadraticCurveTo(b,C,b+I,C),u.closePath(),u.stroke()}),await new Promise(d=>setTimeout(d,50));const me=L.toDataURL("image/png",1),ne=window.open("","_blank","width=1200,height=800");if(!ne)throw new Error("No se pudo abrir la ventana de impresi√≥n. Verifica que los pop-ups est√©n permitidos.");ne.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>An√°lisis Residuos √çndigo - Impresi√≥n</title>
        <style>
          @page {
            size: landscape;
            margin: 5mm 5mm 10mm 5mm;
          }
          body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
          }
          img {
            max-width: 100%;
            max-height: 100vh;
            object-fit: contain;
          }
          @media print {
            body {
              -webkit-print-color-adjust: exact;
              print-color-adjust: exact;
            }
          }
        </style>
      </head>
      <body>
        <img src="${me}" onload="setTimeout(function() { window.print(); window.close(); }, 200);" />
      </body>
      </html>
    `),ne.document.close()}catch(e){console.error("Error al imprimir:",e),ae.fire({toast:!0,position:"top-end",icon:"error",title:"Error al preparar impresi√≥n",text:e.message||"No se pudo generar la imagen para imprimir",showConfirmButton:!1,timer:3e3})}}return _e(()=>{oe()}),(e,t)=>{const a=Qe("tippy");return D(),z("div",dt,[y("main",ut,[y("div",pt,[t[4]||(t[4]=y("div",{class:"flex items-center gap-6"},[y("img",{src:Be,alt:"Santana Textiles",class:"h-10 w-auto object-contain"}),y("h3",{class:"text-lg font-semibold text-slate-800"},"An√°lisis Residuos de √çndigo")],-1)),y("div",ft,[be((D(),z("button",{onClick:ze,class:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-md transition-colors shadow-sm"},[...t[1]||(t[1]=[ke('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-69f4fbf7><polyline points="6 9 6 2 18 2 18 9" data-v-69f4fbf7></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" data-v-69f4fbf7></path><rect x="6" y="14" width="12" height="8" data-v-69f4fbf7></rect></svg><span class="text-sm" data-v-69f4fbf7>Imprimir</span>',2)])])),[[a,{content:"Imprimir p√°gina en orientaci√≥n apaisada",placement:"bottom"}]]),be((D(),z("button",{onClick:je,class:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md transition-colors shadow-sm"},[...t[2]||(t[2]=[ke('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-69f4fbf7><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-69f4fbf7></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-69f4fbf7></circle><polyline points="21 15 16 10 5 21" data-v-69f4fbf7></polyline></svg><span class="text-sm" data-v-69f4fbf7>Imagen</span>',2)])])),[[a,{content:"Copiar gr√°ficos como imagen",placement:"bottom"}]]),be((D(),z("button",{onClick:Oe,class:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white font-medium rounded-md transition-colors shadow-sm"},[...t[3]||(t[3]=[y("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor"},[y("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"})],-1),y("span",{class:"text-sm"},"WhatsApp",-1)])])),[[a,{content:"Copiar resumen de an√°lisis para WhatsApp",placement:"bottom"}]]),Je(Ne,{modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=l=>E.value=l),label:"Hasta:","show-buttons":!0,onChange:oe},null,8,["modelValue"])])]),y("div",{ref_key:"chartsContainer",ref:M,class:"flex-1 min-h-0 relative flex flex-col gap-4"},[$.value?(D(),z("div",gt,[...t[5]||(t[5]=[y("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent"},null,-1)])])):te("",!0),y("div",ht,[y("div",mt,[X.value?(D(),ie(re(ce),{key:0,data:X.value,options:V.value},null,8,["data","options"])):$.value?te("",!0):(D(),z("div",vt," No hay datos para el per√≠odo seleccionado "))]),y("div",bt,[J.value?(D(),ie(re(ce),{key:0,data:J.value,options:H.value},null,8,["data","options"])):$.value?te("",!0):(D(),z("div",yt," No hay datos disponibles "))]),y("div",wt,[$e.value?(D(),ie(re(ce),{key:0,data:$e.value,options:Le.value},null,8,["data","options"])):$.value?te("",!0):(D(),z("div",xt," No hay datos disponibles "))])]),y("div",$t,[y("div",Rt,[se.value?(D(),ie(re(ce),{key:0,data:se.value,options:ue.value},null,8,["data","options"])):$.value?te("",!0):(D(),z("div",St," No hay datos para el d√≠a seleccionado "))]),y("div",kt,[fe.value?(D(),ie(re(ce),{key:0,data:fe.value,options:Me.value},null,8,["data","options"])):$.value?te("",!0):(D(),z("div",Dt," No hay datos disponibles "))]),y("div",Ct,[Re.value?(D(),ie(re(ce),{key:0,data:Re.value,options:Pe.value},null,8,["data","options"])):$.value?te("",!0):(D(),z("div",_t," No hay datos disponibles "))])])],512)])])}}},jt=tt(It,[["__scopeId","data-v-69f4fbf7"]]);export{jt as default};
