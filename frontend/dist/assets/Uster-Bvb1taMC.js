import{_ as ht,w as Be,o as bt,a as p,c as v,b as n,d as we,t as M,e as L,F as U,r as K,f as A,v as ge,g as He,n as R,h as q,i as J,j as De,k as ye,l as x,m as f,p as V,q as xt}from"./index-DOrYTJc_.js";import{S}from"./sweetalert2.esm.all-AlKuj1Cq.js";const wt={class:"hidden md:flex w-full h-screen flex-col p-1"},gt={class:"w-full flex-1 min-h-0 bg-white rounded-2xl shadow-xl px-4 py-3 border border-slate-200 flex flex-col overflow-y-auto uster-component"},yt={class:"flex-shrink-0 mb-3"},_t={class:"flex items-center gap-3"},Tt={class:"flex-1 min-w-0"},St=["title"],Et={key:0,class:"text-xs text-slate-500 ml-2"},Mt={class:"flex items-center gap-2"},kt={class:"grid uster-grid",style:{"grid-template-columns":"440px 160px 270px"}},Nt={class:"flex flex-col gap-3"},Ct={class:"scan-container rounded-xl border border-slate-200 overflow-hidden bg-white"},It={class:"min-w-full w-full table-auto divide-y divide-slate-200 text-xs scan-table"},Lt=["onClick"],Rt={class:"px-3 py-2 border-b border-slate-200 text-xs text-center text-slate-700 col-ensayo"},Pt={class:"px-3 py-2 border-b border-slate-200 text-center text-xs col-par"},Ot={class:"px-3 py-2 border-b border-slate-200 text-center text-xs col-tbl"},Ut={class:"px-3 py-2 border-b border-slate-200 text-center text-xs col-imp"},At={key:0,title:"Guardado en la base de datos"},Bt={class:"px-3 py-2 border-b border-slate-200 text-center font-mono text-xs text-slate-700 col-ne"},Ht={class:"px-3 py-2 border-b border-slate-200 text-center font-mono text-xs text-slate-700 col-maq"},Dt={class:"text-sm text-slate-600 font-medium"},Ft={class:"mt-2 bg-slate-50 rounded-lg p-3 border border-slate-200"},Kt={class:"flex items-center gap-4 text-xs"},Vt={class:"flex items-center gap-2 cursor-pointer hover:bg-slate-100 px-2 py-1.5 rounded-lg transition-colors duration-150"},jt={class:"flex items-center gap-2 cursor-pointer hover:bg-slate-100 px-2 py-1.5 rounded-lg transition-colors duration-150"},Gt={class:"flex items-center gap-2 cursor-pointer hover:bg-slate-100 px-2 py-1.5 rounded-lg transition-colors duration-150"},$t={style:{width:"160px"}},Wt={class:"mb-2 rounded-xl border border-slate-200 bg-white p-2"},zt={class:"flex items-center justify-between gap-2"},qt=["disabled","onKeydown"],Jt={class:"mb-2 rounded-xl border border-slate-200 bg-white p-2"},Qt={class:"flex items-center justify-between gap-2"},Yt={class:"flex items-center gap-3"},Xt={class:"flex items-center gap-1 cursor-pointer"},Zt=["disabled"],eo={class:"flex items-center gap-1 cursor-pointer"},to=["disabled"],oo={class:"titulo-container rounded-xl border border-slate-200 overflow-hidden bg-white"},lo={class:"min-w-full w-full table-auto divide-y divide-slate-200 text-xs titulo-table"},no={class:"px-3 py-2 border-b border-slate-200 text-xs text-center text-slate-700 font-mono",style:{width:"70px"}},ro={key:0},so={key:1,class:"text-xs text-slate-400"},ao={class:"px-1 py-0 border-b border-slate-200 text-xs text-center",style:{width:"90px"}},io={key:0},co=["id","onUpdate:modelValue","onFocus","onBlur","onInput","onKeydown"],uo={key:1,class:"text-xs text-slate-400"},fo={class:"rounded-xl border border-slate-200 overflow-hidden bg-white"},po={class:"min-w-full w-full table-auto divide-y divide-slate-200 text-xs compact-table"},vo={class:"px-3 py-2 border-b border-slate-200 font-medium text-xs text-slate-700 col-dato"},mo={class:"px-3 py-2 border-b border-slate-200 font-mono text-xs text-slate-700 col-valor"},ho={key:1},bo={class:"mt-3 flex gap-2"},xo=["disabled","onKeydown"],wo={key:0},go={key:1},yo=["disabled"],_o={key:0},To={key:1},So={key:0,class:"mt-4 rounded-xl border border-slate-200"},Eo={class:"_minimal-scroll",style:{"overflow-x":"auto"}},Mo={class:"bg-gradient-to-r from-slate-50 to-slate-100 sticky top-0"},ko={class:"px-3 py-2 border-b border-slate-200 text-xs text-center"},Fe=25,E=80,No={__name:"Uster",setup(Co){const Q=f(null),P=f(null),k=f(null),B=f(null),Y=f(null),X=f(""),h=f([]),d=f(""),O=f(""),H=f(""),ue=f(""),Z=f(!1),ee=f(""),oe=f(!1),_=f(""),de=f(!1),w=f(""),T=f("");Be(T,o=>{if(d.value&&o){const e=h.value.find(t=>t.testnr===d.value);e&&(e.matclass=o)}});const D=f(!1),N=f(!0),C=f(!1);Be(()=>{let o=h.value||[];return N.value?o=o.filter(e=>e.testnr&&e.imp!==!0):C.value&&(o=o.filter(e=>e.testnr&&e.imp===!0)),o.length},o=>{console.log("üîç Watcher ejecutado: count =",o,"selectedTestnr =",d.value),o===0&&d.value&&(console.log("‚úÖ Limpiando interfaz porque no hay ensayos en la lista filtrada"),j())});function _e(o){if(!o)return null;const e=String(o);let t=e.match(/STC\d{2}[_-]?(\d{5})/i);return t&&t[1]||(t=e.match(/_(\d{5})(?:[_.]|$)/),t&&t[1])?t[1]:(t=e.match(/(\d{5})/),t?t[1]:null)}function Ke(o,e){try{let t=String(e&&e.target&&e.target.value||"");t=t.replace(",","."),t=t.replace(/[^0-9.]/g,"");const l=e&&e.inputType?String(e.inputType):"",r=l.startsWith("delete")||l.startsWith("history"),s=t.split(".");if(s.length===1)!r&&s[0].length===2?t=s[0]+".":t=s[0].slice(0,2);else{const a=s[0].slice(0,2),i=(s[1]||"").slice(0,2);t=a+"."+i}if(u.value&&u.value[o]&&(u.value[o].TITULO=t),t.length===5&&t.includes(".")){const a=t.indexOf(".");a===2&&t.length-a-1===2&&setTimeout(()=>Pe(o),0)}}catch(t){console.warn("onTituloInput error",t)}}async function le(){try{if(typeof window<"u"&&"showDirectoryPicker"in window){const o=await window.showDirectoryPicker();try{await Ve(o),Z.value=!0}catch(e){console.warn("saveDirHandleToIDB failed",e)}X.value=o.name||"Carpeta seleccionada",ee.value=o.name||"",oe.value=!1;try{await fe(o)}catch(e){console.warn("scanDirectory error",e)}return}}catch(o){console.warn("selectFolder error",o)}try{if(Q.value)Q.value.click();else{console.warn("No se pudo abrir el selector de carpeta: input no disponible");try{S.fire({icon:"error",title:"No se pudo abrir el selector",text:"El selector de carpetas no est√° disponible en este contexto."})}catch{O.value="No se pudo abrir el selector de carpetas."}}}catch(o){console.warn("No se pudo abrir el selector de carpeta",o);try{S.fire({icon:"error",title:"Error",text:String(o)})}catch{O.value=String(o)}}}function Te(){return new Promise((o,e)=>{let t;try{t=window.indexedDB.open("carga-uster")}catch(l){return e(l)}t.onupgradeneeded=()=>{const l=t.result;try{l.objectStoreNames.contains("handles")||l.createObjectStore("handles")}catch(r){console.warn("openDb onupgradeneeded error",r)}},t.onsuccess=()=>o(t.result),t.onerror=()=>e(t.error)})}async function Ve(o){const e=await Te();return new Promise((t,l)=>{const a=e.transaction("handles","readwrite").objectStore("handles").put(o,"dir");a.onsuccess=()=>t(!0),a.onerror=()=>l(a.error)})}async function Se(){const o=await Te();return new Promise((e,t)=>{const s=o.transaction("handles","readonly").objectStore("handles").get("dir");s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}async function Ee(o,e="read"){if(!o)return!1;try{const t={mode:e};if(await o.queryPermission(t)==="granted"||await o.requestPermission(t)==="granted")return!0}catch(t){console.warn("verifyPermission error",t)}return!1}async function Me(){try{const o=await Se();if(!o)return;if(!await Ee(o,"read")){try{(await S.fire({icon:"warning",title:"Permisos insuficientes",text:"No se concedieron permisos de lectura para la carpeta almacenada. Debes seleccionar la carpeta de nuevo para otorgar permisos.",confirmButtonText:"Seleccionar carpeta",showCancelButton:!0,cancelButtonText:"Cancelar"})).isConfirmed&&await le()}catch(t){console.warn("Swal error",t)}return}await fe(o)}catch(o){console.warn("refreshFolder error",o)}}async function fe(o){console.log("Iniciando scanDirectory con handle:",o.name);const e={};let t=0;try{for await(const[s,a]of o.entries()){if(t++,!a||a.kind!=="file")continue;const i=String(s||"").toLowerCase();if(!(i.endsWith(".par")||i.endsWith(".tbl")))continue;const c=_e(s);if(c){if(e[c]||(e[c]={testnr:c,hasPar:!1,hasTbl:!1,parHandle:null,tblHandle:null,imp:!1,nomcount:null,maschnr:null,timeStamp:null}),i.endsWith(".par")){e[c].hasPar=!0,e[c].parHandle=a;try{const g=await(await a.getFile()).text();e[c].nomcount=I(g,15,5)||"",e[c].maschnr=I(g,13,5)||"",e[c].matclass=I(g,14,8)||"";const b=I(g,9,5);b&&(e[c].timeStamp=be(b))}catch(m){console.warn("Error leyendo .PAR durante el escaneo",s,m)}}i.endsWith(".tbl")&&(e[c].hasTbl=!0,e[c].tblHandle=a)}}}catch(s){console.error("Error durante el bucle de escaneo de directorio:",s),O.value=`Error al escanear: ${s.message}`}console.log(`Escaneo finalizado. Total de archivos en el directorio: ${t}. Ensayos mapeados: ${Object.keys(e).length}`);let l=Object.values(e).sort((s,a)=>s.testnr.localeCompare(a.testnr));if(l.length>0){console.log("Llamando a checkExistingTests...");try{const s=await ke(l.map(i=>i.testnr));console.log("existingTests recibido:",s),console.log("Tipo de existingTests:",typeof s,Array.isArray(s));const a=new Set(s);console.log("existingSet creado:",a),l=l.map(i=>{const c=a.has(i.testnr);return console.log(`Verificando ${i.testnr}: existingSet.has() = ${c}`),{...i,imp:c}}),console.log("checkExistingTests completado. Lista para actualizar el DOM:",l)}catch(s){console.error("Fallo en la llamada a checkExistingTests desde scanDirectory",s)}}h.value=l,await x(),console.log("scanList.value ha sido asignado y el DOM actualizado.",h.value),console.log("Verificaci√≥n de valores imp:",h.value.map(s=>({testnr:s.testnr,imp:s.imp}))),X.value=o.name||"Carpeta seleccionada";const r=h.value.length;O.value=r?`Encontrados ${r} ensayos`:"No se encontraron archivos .PAR/.TBL v√°lidos en la carpeta seleccionada"}async function ke(o){if(!o||o.length===0)return console.log("checkExistingTests: No hay testnrs para verificar."),[];console.log("checkExistingTests: Verificando los siguientes testnrs:",o);try{const t=await fetch("/api/uster/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testnrs:o}),credentials:"include"});if(!t.ok){console.error("checkExistingTests: La respuesta del servidor no fue OK.",t.status,t.statusText);const r=await t.text();return console.error("checkExistingTests: Respuesta de error del servidor:",r),[]}const l=await t.json();return console.log("checkExistingTests: Datos recibidos del servidor:",l),l&&Array.isArray(l.existing)?l.existing:[]}catch(e){return console.error("Error en checkExistingTests:",e),[]}}async function je(o){try{const e=o&&o.target&&o.target.files||[],t={};for(let l=0;l<e.length;l++){const r=e[l],s=r.name||"",a=s.toLowerCase();if(!(a.endsWith(".par")||a.endsWith(".tbl")))continue;const i=_e(s);if(i){if(t[i]||(t[i]={testnr:i,hasPar:!1,hasTbl:!1,parHandle:null,tblHandle:null,imp:null,nomcount:null,maschnr:null,timeStamp:null}),a.endsWith(".par")){t[i].hasPar=!0,t[i].parHandle=r;try{const c=await r.text();t[i].nomcount=I(c,15,5)||"",t[i].maschnr=I(c,13,5)||"",t[i].matclass=I(c,14,8)||"";const m=I(c,9,5);m&&(t[i].timeStamp=be(m))}catch(c){console.warn("reading .PAR fallback",s,c)}}a.endsWith(".tbl")&&(t[i].hasTbl=!0,t[i].tblHandle=r)}}if(h.value=Object.values(t).sort((l,r)=>l.testnr.localeCompare(r.testnr)),X.value="Carpeta seleccionada (local)",O.value=h.value.length?`Encontrados ${h.value.length} ensayos (fallback)`:"No se encontraron archivos .PAR/.TBL en la selecci√≥n local",h.value.length>0&&await ke(h.value.map(l=>l.testnr)),e.length>0&&e[0].webkitRelativePath){const r=e[0].webkitRelativePath.split("/");r.length>1&&(ue.value=r.slice(0,r.length-1).join("/"))}Z.value=!1,ee.value=ue.value||"",oe.value=!1}catch(e){console.warn("onFolderInputChange error",e)}}bt(()=>{typeof window<"u"&&typeof window.document<"u"&&(window.document.title="Uster"),(async()=>{try{let o=null;try{o=await Se()}catch{}if(o){if(await Ee(o,"read")){try{await fe(o)}catch(t){console.warn("scanDirectory onMounted error",t)}Z.value=!0,ee.value=o.name||"",oe.value=!1;return}X.value=o.name||"Carpeta (sin permisos)";try{(await S.fire({icon:"warning",title:"Permisos requeridos",text:"La carpeta guardada no tiene permisos de lectura. Selecciona la carpeta nuevamente para reautorizar el acceso.",confirmButtonText:"Seleccionar carpeta",showCancelButton:!0,cancelButtonText:"Cancelar"})).isConfirmed&&await le()}catch(t){console.warn("Swal error",t)}return}}catch(o){console.warn("onMounted load snapshot error",o)}})()});function j(){d.value="",H.value="",pe.value="",ve.value=null,me.value="",re.value=null,se.value="",u.value=[],G.value="",_.value="",w.value="",T.value="Hilo",$.value=null}async function Ne(o){d.value=o;const e=h.value.find(t=>t.testnr===o);e&&e.estiraje?_.value=e.estiraje:_.value="",e&&e.pasador?w.value=e.pasador:w.value="";try{await Ze();const t=e&&e.matclass;t&&t==="Hilo de fantasia"&&(T.value=t)}catch(t){console.warn("selectRow loadSelectedFiles failed",t)}try{if(await x(),k.value)try{k.value.focus(),typeof k.value.select=="function"&&k.value.select();return}catch(l){console.warn("Could not focus estiraje input",l)}let t=[];if(typeof globalThis<"u"&&globalThis.document&&globalThis.document.querySelectorAll&&(t=Array.from(globalThis.document.querySelectorAll('input[id^="titulo-input-"]')).filter(l=>!l.disabled&&l.offsetParent!==null)),t.length>0){const l=t[0];try{const r=String(l.id||"").match(/titulo-input-(\d+)/);if(r){const s=Number(r[1]);$.value=s}typeof l.scrollIntoView=="function"&&l.scrollIntoView({block:"nearest",inline:"nearest"}),l.focus(),typeof l.select=="function"&&l.select()}catch{}return}if(P&&P.value)try{P.value.focus()}catch{}}catch(t){console.warn("selectRow focus error",t)}}const u=f([]),G=f(""),Ge=/^\d{1,2}(?:\.\d{1,2})?$/,$e=/^\d{1,2}$/,$=f(null),We=V(()=>{let e=[];if(Array.isArray(h.value)&&(e=h.value.map(l=>({...l}))),D.value||(N.value?e=e.filter(l=>l.testnr&&l.imp!==!0):C.value&&(e=e.filter(l=>l.testnr&&l.imp===!0))),e.length>=10)return e;const t={testnr:"",hasPar:!1,hasTbl:!1,imp:null,nomcount:"",maschnr:""};for(;e.length<10;)e.push(t);return e}),ze=V(()=>{if(!O.value)return"";if(!h.value.length)return O.value;const o=h.value.length;if(D.value)return`Encontrados ${o} ensayos (mostrando todos)`;if(N.value){const e=h.value.filter(t=>t.testnr&&t.imp!==!0).length;return`Encontrados ${o} ensayos (${e} no guardados)`}else if(C.value){const e=h.value.filter(t=>t.testnr&&t.imp===!0).length;return`Encontrados ${o} ensayos (${e} guardados)`}return O.value}),ne=["TESTNR","NO","U%_%","CVM_%","INDICE_%","CVM_1M_%","CVM_3M_%","CVM_10M_%","TITULO","TITULO_REL_¬±_%","H","SH","SH_1M","SH_3M","SH_10M","DELG_-30%_KM","DELG_-40%_KM","DELG_-50%_KM","DELG_-60%_KM","GRUE_35%_KM","GRUE_50%_KM","GRUE_70%_KM","GRUE_100%_KM","NEPS_140%_KM","NEPS_200%_KM","NEPS_280%_KM","NEPS_400%_KM"],qe=[{name:"TESTNR",col:null,note:"Extraer del nombre de archivo: caracteres 7..11"},{name:"NO",col:1},{name:"U%_%",col:2},{name:"CVM_%",col:3},{name:"INDICE_%",col:4},{name:"CVM_1M_%",col:5},{name:"CVM_3M_%",col:6},{name:"CVM_10M_%",col:7},{name:"TITULO",col:9},{name:"TITULO_REL_¬±_%",col:10},{name:"H",col:11},{name:"SH",col:12},{name:"SH_1M",col:13},{name:"SH_3M",col:14},{name:"SH_10M",col:15},{name:"DELG_-30%_KM",col:17},{name:"DELG_-40%_KM",col:18},{name:"DELG_-50%_KM",col:19},{name:"DELG_-60%_KM",col:20},{name:"GRUE_35%_KM",col:21},{name:"GRUE_50%_KM",col:22},{name:"GRUE_70%_KM",col:23},{name:"GRUE_100%_KM",col:24},{name:"NEPS_140%_KM",col:25},{name:"NEPS_200%_KM",col:26},{name:"NEPS_280%_KM",col:27},{name:"NEPS_400%_KM",col:28}],pe=f(""),ve=f(null),me=f(""),re=f(null),se=f("");async function Ce(o){if(!o)return"";try{return typeof o.text=="function"?await o.text():typeof o.getFile=="function"?await(await o.getFile()).text():""}catch(e){return console.warn("readFileFromHandle error",e),""}}async function Je(o,e){try{ve.value=o,pe.value=e||o&&o.name||"";const t=await Ce(o);H.value=t||"",await Qe()}catch(t){console.warn("setFile error",t)}}async function Qe(){try{await x();const o=ce("MATCLASS");T.value=o||"Hilo";const e=ce("OBS");e&&String(e).toLowerCase().includes("flame")?(T.value="Hilo de fantasia",console.log('üî• Flame detectado en OBS, cambiando a "Hilo de fantasia"')):console.log("üìù OBS:",e,"- MATCLASS:",T.value)}catch(o){console.warn("detectFlameInObs error",o)}}async function Ye(o,e){try{re.value=o,me.value=e||o&&o.name||"",se.value=await Ce(o),await Xe(se.value)}catch(t){console.warn("setTblFile error",t)}}async function Xe(o){try{if(!o){u.value=[],G.value="";return}const e=o.split(/\r?\n/),t=[];for(let l=5;l<e.length;l++){const r=e[l];if(r==null||String(r).trim()==="")break;const s=String(r).split("	"),a={};a.TESTNR=d.value?String(d.value):"";for(const i of qe){if(i.col===null)continue;const c=i.col-1;a[i.name]=s[c]!=null?String(s[c]).trim():""}a.SEQNO=t.length+1,t.push(a)}u.value=t,t.length>0?G.value=d.value||"":G.value=""}catch(e){console.warn("parseTblText error",e),u.value=[],G.value=""}}async function Ze(){try{if(!d.value)return;const o=h.value.find(e=>String(e.testnr)===String(d.value));if(!o)return;o.parHandle?await Je(o.parHandle,o.parHandle.name||"PAR_"+o.testnr):(H.value="",pe.value="",ve.value=null),o.tblHandle?await Ye(o.tblHandle,o.tblHandle.name||"TBL_"+o.testnr):(u.value=[],G.value="",me.value="",re.value=null)}catch(o){console.warn("loadSelectedFiles error",o)}}async function et(){try{const o=h.value.find(i=>String(i.testnr)===String(d.value)),e=o&&o.tblHandle||re.value||null;if(!e)return console.warn("No se encontr√≥ ning√∫n handle para el archivo .TBL (ni en scanList ni en tblFile)"),!1;if(typeof e.createWritable!="function"){console.warn("El archivo .TBL no soporta escritura (modo fallback). handle:",e);try{await S.fire({icon:"info",title:"No es posible guardar aqu√≠",text:'El archivo fue abierto mediante selecci√≥n de archivos y no permite escribir de vuelta. Selecciona la carpeta usando "Seleccionar carpeta" para habilitar guardado.',confirmButtonText:"Seleccionar carpeta"})}catch{}return!1}const t=se.value;if(!t)return console.warn("No hay contenido del archivo .TBL para actualizar"),!1;const l=t.split(/\r?\n/),r=t.includes(`\r
`)?`\r
`:`
`;for(let i=0;i<u.value.length;i++){const c=u.value[i],m=5+i;if(m>=l.length)break;const g=c.TITULO||"";if(g==="")continue;let b=String(g).padStart(6," ");b.length>6&&(b=b.slice(0,6));const z=l[m].split("	");z.length>8&&(z[8]=b,l[m]=z.join("	"))}const s=l.join(r),a=await e.createWritable();return await a.write(s),await a.close(),console.log("Archivo .TBL actualizado exitosamente con los valores de Titulo"),!0}catch(o){return console.error("Error al actualizar el archivo .TBL:",o),!1}}const W=V(()=>{const o=[];if(!u.value||!Array.isArray(u.value)||!d.value){for(let l=0;l<10;l++)o.push({nro:"",titulo:"",srcIndex:null});return o}const t=[];for(let l=0;l<u.value.length;l++){const r=u.value[l];(r&&(r.TESTNR||""))===String(d.value)&&t.push({nro:r.NO||"",titulo:r.TITULO||"",srcIndex:l})}if(t.length>10)return t;for(let l=0;l<t.length;l++)o.push(t[l]);for(;o.length<10;)o.push({nro:"",titulo:"",srcIndex:null});return o}),tt={TESTNR:Math.round(E*.8),NO:Math.round(E*.5),"U%_%":Math.round(E*.6),"CVM_%":Math.round(E*.6),TITULO:Math.round(E*.7),"INDICE_%":Math.round(E*.7),H:Math.round(E*.5),SH:Math.round(E*.5),SH_1M:Math.round(E*.5),SH_3M:Math.round(E*.5),SH_10M:Math.round(E*.5)},Ie=o=>tt[o]||E,ot=V(()=>Fe+ne.reduce((o,e)=>o+Ie(e),0)),Le=V(()=>!d.value||!Array.isArray(u.value)?[]:u.value.filter(o=>String(o.TESTNR||"")===String(d.value))),ae=V(()=>d.value&&(Le.value.length>0||H.value)),F=f(!1),te=f(!1),Re=V(()=>{if(!d.value)return!1;const o=h.value.find(e=>e.testnr===d.value);return o&&o.imp===!0});function lt(){const o={};for(const e of Ae){const t=e.field,l=ce(t);l!==""&&(o[t]=l)}return o.TESTNR||(o.TESTNR=d.value||""),_.value&&(o.ESTIRAJE=_.value),w.value&&(o.PASADOR=w.value),T.value&&(o.MATCLASS=T.value),o.TIME&&(o.TIME_STAMP=o.TIME,delete o.TIME),o}async function nt(){if(!ae.value)return;const o=lt(),e=l=>{if(l==null||l==="")return null;const r=String(l).trim();if(r==="")return null;const s=parseFloat(r);return isNaN(s)?null:s},t=Le.value.map((l,r)=>({SEQNO:l.SEQNO!=null?Number(l.SEQNO):r+1,NO_:e(l.NO),U_PERCENT:e(l["U%_%"]),CVM_PERCENT:e(l["CVM_%"]),INDICE_PERCENT:e(l["INDICE_%"]),CVM_1M_PERCENT:e(l["CVM_1M_%"]),CVM_3M_PERCENT:e(l["CVM_3M_%"]),CVM_10M_PERCENT:e(l["CVM_10M_%"]),TITULO:e(l.TITULO),TITULO_REL_PERC:e(l["TITULO_REL_¬±_%"]),H:e(l.H),SH:e(l.SH),SH_1M:e(l.SH_1M),SH_3M:e(l.SH_3M),SH_10M:e(l.SH_10M),DELG_MINUS30_KM:e(l["DELG_-30%_KM"]),DELG_MINUS40_KM:e(l["DELG_-40%_KM"]),DELG_MINUS50_KM:e(l["DELG_-50%_KM"]),DELG_MINUS60_KM:e(l["DELG_-60%_KM"]),GRUE_35_KM:e(l["GRUE_35%_KM"]),GRUE_50_KM:e(l["GRUE_50%_KM"]),GRUE_70_KM:e(l["GRUE_70%_KM"]),GRUE_100_KM:e(l["GRUE_100%_KM"]),NEPS_140_KM:e(l["NEPS_140%_KM"]),NEPS_200_KM:e(l["NEPS_200%_KM"]),NEPS_280_KM:e(l["NEPS_280%_KM"]),NEPS_400_KM:e(l["NEPS_400%_KM"])}));if(!F.value){F.value=!0;try{S.fire({toast:!0,position:"top-end",icon:"info",title:"Guardando...",showConfirmButton:!1,timer:3e4,timerProgressBar:!0});const s=await((c,m={},g=3e4)=>new Promise((b,y)=>{const z=setTimeout(()=>y(new Error("Timeout contacting server")),g);fetch(c,m).then(xe=>{clearTimeout(z),b(xe)}).catch(xe=>{clearTimeout(z),y(xe)})}))("/api/uster/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({par:o,tbl:t}),credentials:"include"},3e4);let a=null;try{a=await s.json()}catch{a=null}if(!s.ok)throw new Error(a&&a.error?a.error:a&&a.message||`HTTP ${s.status}`);try{await et()&&console.log("Archivo .TBL actualizado con √©xito")}catch(c){console.warn("No se pudo actualizar el archivo .TBL (esto es normal en modo fallback):",c)}const i=h.value.find(c=>c.testnr===o.TESTNR);i&&(i.imp=!0,_.value&&(i.estiraje=_.value),w.value&&(i.pasador=w.value),T.value&&(i.matclass=T.value),await x());try{for(let c=0;c<u.value.length;c++){const m=u.value[c];m&&String(m.TESTNR)===String(o.TESTNR)&&(m.TITULO="")}}catch{}try{let c=null;const m=Array.isArray(h.value)?h.value:[],g=m.findIndex(b=>String(b.testnr)===String(o.TESTNR));if(g!==-1)for(let b=g+1;b<m.length;b++){const y=m[b];if(!(!y||!y.testnr))if(N.value){if(y.imp!==!0){c=y.testnr;break}}else if(C.value){if(y.imp===!0){c=y.testnr;break}}else{c=y.testnr;break}}if(c){if(Array.isArray(u.value))for(const b of u.value)b&&(b.TITULO="");j(),await x(),await Ne(c)}else j(),await x(),await x(),Q.value&&(Q.value.value="")}catch(c){console.warn("auto-advance after save failed",c)}S.fire({toast:!0,position:"top-end",icon:"success",title:`Ensayo ${o.TESTNR} guardado`,text:`${a.inserted||t.length} filas`,showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}catch(l){console.error("saveCurrentTest error",l);try{await S.fire({icon:"error",title:"Error al guardar",text:String(l&&l.message?l.message:l),confirmButtonText:"Cerrar"})}catch{}}finally{F.value=!1}}}async function rt(){if(!(!d.value||!Re.value||!(await S.fire({title:"¬øEliminar ensayo?",text:`¬øEst√°s seguro de eliminar el ensayo ${d.value} de la base de datos?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"S√≠, eliminar",cancelButtonText:"Cancelar"})).isConfirmed)&&!te.value){te.value=!0;try{S.fire({toast:!0,position:"top-end",icon:"info",title:"Eliminando...",showConfirmButton:!1,timer:3e4,timerProgressBar:!0});const l=await((a,i={},c=3e4)=>new Promise((m,g)=>{const b=setTimeout(()=>g(new Error("Timeout contacting server")),c);fetch(a,i).then(y=>{clearTimeout(b),m(y)}).catch(y=>{clearTimeout(b),g(y)})}))("/api/uster/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({testnr:d.value}),credentials:"include"},3e4);let r=null;try{r=await l.json()}catch{r=null}if(!l.ok)throw new Error(r&&r.error?r.error:r&&r.message||`HTTP ${l.status}`);const s=h.value.find(a=>a.testnr===d.value);s&&(s.imp=!1,await x()),S.fire({toast:!0,position:"top-end",icon:"success",title:`Ensayo ${d.value} eliminado`,text:r.message||"Eliminado correctamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}catch(e){console.error("deleteCurrentTest error",e),await S.fire({icon:"error",title:"Error al eliminar",text:String(e&&e.message?e.message:e),confirmButtonText:"Cerrar"})}finally{te.value=!1}}}function st(o){$.value=o}function ie(o){const e=u.value&&u.value[o]&&String(u.value[o].TITULO||"").trim()||"";if(e==="")return!0;function t(i){if(Number.isNaN(i))return"";i<.01&&(i=.01),i>99.99&&(i=99.99);const c=Number(i).toFixed(2),m=String(c).split(".");return m[0]=m[0].padStart(2,"0"),m.join(".")}if($e.test(e)){const i=t(Number(e));if(i!=="")return u.value&&u.value[o]&&(u.value[o].TITULO=i),!0}if(Ge.test(e)){const i=parseFloat(e),c=t(i);if(c!=="")return u.value&&u.value[o]&&(u.value[o].TITULO=c),!0}let l=e.replace(/[^0-9.]/g,"");const r=l.split(".");if(r.length===1?l=r[0].slice(0,2):l=r[0].slice(0,2)+"."+(r[1]||"").slice(0,2),l==="")return u.value&&u.value[o]&&(u.value[o].TITULO=""),!0;const s=parseFloat(l),a=t(s);return a!==""?(u.value&&u.value[o]&&(u.value[o].TITULO=a),!0):(u.value&&u.value[o]&&(u.value[o].TITULO=""),!0)}function at(o){ie(o),$.value===o&&($.value=null)}function it(o){const e=W.value||[],t=e.findIndex(s=>s.srcIndex===o);if(t===-1||!ie(o))return;let r=-1;for(let s=t+1;s<e.length;s++)if(e[s].srcIndex!==null){r=s;break}if(r!==-1){const s=e[r];x(()=>{if(typeof window<"u"&&window.document){const a=window.document.getElementById("titulo-input-"+s.srcIndex);if(a){a.focus();try{a.select&&a.select()}catch(i){console.warn("select error",i)}}}})}else x(()=>{P.value&&ae.value&&!F.value&&P.value.focus()})}function Pe(o){const e=W.value||[],t=e.findIndex(s=>s.srcIndex===o);if(t===-1||e.length===0||!ie(o))return;let r=-1;for(let s=t+1;s<e.length;s++)if(e[s].srcIndex!==null){r=s;break}if(r!==-1){const s=e[r];x(()=>{if(typeof window<"u"&&window.document){const a=window.document.getElementById("titulo-input-"+s.srcIndex);if(a){a.focus();try{a.select&&a.select()}catch(i){console.warn("select error",i)}}}})}else x(()=>{P.value&&ae.value&&!F.value&&P.value.focus()})}function ct(o){const e=W.value||[],t=e.findIndex(s=>s.srcIndex===o);if(t===-1||e.length===0||!ie(o))return;if(t===0){x(()=>{w.value==="No"&&Y.value?Y.value.focus():B.value&&B.value.focus()});return}const r=e[t-1];r&&x(()=>{if(typeof window<"u"&&window.document){const s=window.document.getElementById("titulo-input-"+r.srcIndex);if(s){s.focus();try{s.select&&s.select()}catch(a){console.warn("select error",a)}}}})}function ut(){const o=W.value||[];let e=-1;for(let t=o.length-1;t>=0;t--)if(o[t].srcIndex!==null){e=t;break}if(e!==-1){const t=o[e];x(()=>{if(typeof window<"u"&&window.document){const l=window.document.getElementById("titulo-input-"+t.srcIndex);if(l){l.focus();try{l.select&&l.select()}catch(r){console.warn("select error",r)}}}})}}function Oe(){const e=(W.value||[]).find(t=>t.srcIndex!==null);e&&x(()=>{if(typeof window<"u"&&window.document){const t=window.document.getElementById("titulo-input-"+e.srcIndex);if(t){t.focus();try{t.select&&t.select()}catch(l){console.warn("select error",l)}}}})}function dt(o){let t=o.target.value;t=t.replace(/[^0-9.]/g,"");const l=t.split(".");if(l.length>2&&(t=l[0]+"."+l.slice(1).join("")),t.includes(".")){const[r,s]=t.split(".");t=r.slice(0,3)+"."+(s||"").slice(0,1)}else t=t.slice(0,3);!de.value&&t.length===3&&!t.includes(".")&&(t=t+"."),_.value=t,/^\d{1,3}\.\d$/.test(t)&&he(),de.value=!1}function ft(){/^\d{3}\.$/.test(_.value)&&(_.value=_.value+"0"),he()}function pt(o){de.value=o.key==="Backspace"||o.key==="Delete",o.key==="."&&_.value.includes(".")&&o.preventDefault()}function he(){d.value&&(w.value="Si",x(()=>{B.value&&B.value.focus()}))}function Ue(o){const e=o.key;if(e==="Enter"){o.preventDefault(),Oe();return}if(e==="ArrowDown"){o.preventDefault(),Oe();return}if(e==="ArrowUp"){if(o.preventDefault(),k.value){k.value.focus();try{k.value.select&&k.value.select()}catch{}}return}if(e==="ArrowLeft"){o.preventDefault(),w.value="Si",x(()=>{B.value&&B.value.focus()});return}if(e==="ArrowRight"){o.preventDefault(),w.value="No",x(()=>{Y.value&&Y.value.focus()});return}}function I(o,e,t){if(o==null)return null;const l=o.split(/\r?\n/);if(l.length<e)return null;let r=l[e-1];r&&r.charCodeAt(0)===65279&&(r=r.slice(1));const s=r.split("	");return t-1>=s.length?null:s[t-1]}function be(o){if(o==null)return"";const e=String(o).trim();if(e==="")return"";const t=Number(e);if(!Number.isFinite(t))return e;let l=t;Math.abs(t)<1e12&&(l=t*1e3);const r=new Date(l);if(isNaN(r.getTime()))return e;const s=String(r.getDate()).padStart(2,"0"),a=String(r.getMonth()+1).padStart(2,"0"),i=r.getFullYear(),c=String(r.getHours()).padStart(2,"0"),m=String(r.getMinutes()).padStart(2,"0");return`${s}/${a}/${i} ${c}:${m}`}function vt(o,e){if(!H.value)return"";const t=I(H.value,o,e);return t??""}const Ae=[{field:"CATALOG",row:3,col:1},{field:"TESTNR",row:8,col:5},{field:"TIME",row:9,col:5},{field:"LOTE",row:10,col:5},{field:"SORTIMENT",row:11,col:5},{field:"ARTICLE",row:12,col:5},{field:"MASCHNR",row:13,col:5},{field:"MATCLASS",row:14,col:8},{field:"NOMCOUNT",row:15,col:5},{field:"NOMTWIST",row:16,col:5},{field:"USCODE",row:17,col:8},{field:"FB_MIC",row:18,col:5},{field:"FB_TIPO",row:18,col:8},{field:"FB_LONG",row:18,col:9},{field:"FB_PORC",row:18,col:12},{field:"LABORANT",row:21,col:5},{field:"OBS",row:22,col:5},{field:"TUNAME",row:27,col:5},{field:"GROUPS",row:28,col:5},{field:"WITHIN",row:29,col:5},{field:"TOTAL",row:30,col:5},{field:"SPEED",row:31,col:5},{field:"TESTTIME",row:32,col:5},{field:"SLOT",row:33,col:5},{field:"ABSORBERPRESSURE",row:34,col:5}],mt=[{label:"Nro Test",code:"TESTNR"},{label:"Hilo",code:"NOMCOUNT"},{label:"Tipo Material",code:"MATCLASS"},{label:"Maquina",code:"MASCHNR"},{label:"Lote",code:"LOTE"},{label:"Total Test",code:"TOTAL"},{label:"Fecha y Hora",code:"TIME"},{label:"Laboratorista",code:"LABORANT"},{label:"Observaciones",code:"OBS"}];function ce(o){const e=Ae.find(l=>l.field===o);if(e&&H.value){const l=vt(e.row,e.col);if(l)return o==="TIME"?be(l):l}const t=h.value.find(l=>l.testnr===d.value);if(t){if(o==="NOMCOUNT")return t.nomcount||"";if(o==="MASCHNR")return t.maschnr||"";if(o==="TESTNR")return t.testnr||"";if(o==="MATCLASS")return t.matclass||"";if(o==="TIME")return t.timeStamp||""}return""}return(o,e)=>(p(),v(U,null,[e[30]||(e[30]=n("div",{class:"md:hidden p-4"},[n("div",{class:"bg-slate-50 border border-slate-200 rounded-xl p-4 text-slate-700 text-sm"}," Esta p√°gina de carga (Uster) est√° disponible solo en escritorio (pantallas medianas o mayores). ")],-1)),n("div",wt,[n("main",gt,[n("div",yt,[n("div",_t,[e[14]||(e[14]=n("label",{class:"text-sm font-semibold text-slate-700 mr-2 shrink-0"},"Carpeta de archivos Uster:",-1)),n("div",Tt,[n("div",{class:"px-3 py-2 border border-slate-300 rounded-lg bg-white text-sm text-slate-800 truncate shadow-sm focus-within:ring-2 focus-within:ring-blue-500",title:ee.value},[we(M(ee.value||ue.value||X.value||"Ninguna carpeta seleccionada")+" ",1),oe.value?L("",!0):(p(),v("span",Et,"(ruta no absoluta disponible por seguridad)"))],8,St)]),n("div",Mt,[n("button",{onClick:le,title:"Seleccionar carpeta con archivos de Uster",class:"hidden md:inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-md text-sm font-medium hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md"},[...e[10]||(e[10]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7a2 2 0 012-2h3l2 3h6a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"})],-1),we(" Seleccionar ",-1)])]),n("button",{onClick:le,title:"Seleccionar carpeta con archivos de Uster",class:"inline-flex md:hidden items-center p-2 border border-slate-200 bg-white text-slate-700 rounded-md hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md","aria-label":"Seleccionar carpeta"},[...e[11]||(e[11]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7a2 2 0 012-2h3l2 3h6a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"})],-1)])]),Z.value?(p(),v("button",{key:0,onClick:Me,title:"Actualizar archivos de Uster",class:"hidden md:inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-md text-sm font-medium hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md"},[...e[12]||(e[12]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),we(" Actualizar ",-1)])])):L("",!0),Z.value?(p(),v("button",{key:1,onClick:Me,title:"Actualizar archivos de Uster",class:"inline-flex md:hidden items-center p-2 border border-slate-200 bg-white text-slate-700 rounded-md hover:bg-slate-50 transition-colors duration-150 shadow-sm hover:shadow-md","aria-label":"Actualizar carpeta"},[...e[13]||(e[13]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])):L("",!0),n("input",{ref_key:"folderInput",ref:Q,type:"file",webkitdirectory:"",directory:"",multiple:"",class:"hidden",onChange:je},null,544)])])]),n("div",kt,[n("div",Nt,[n("div",Ct,[n("table",It,[e[18]||(e[18]=n("colgroup",null,[n("col",{class:"col-ensayo"}),n("col",{class:"col-par"}),n("col",{class:"col-tbl"}),n("col",{class:"col-imp"}),n("col",{class:"col-ne"}),n("col",{class:"col-maq"})],-1)),e[19]||(e[19]=n("thead",null,[n("tr",{class:"bg-gradient-to-r from-slate-50 to-slate-100"},[n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-ensayo"}," Ensayo"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-par"}," .PAR"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-tbl"}," .TBL"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-imp"}," Estado"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-ne"}," Ne"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs col-maq"}," Maq.")])],-1)),n("tbody",null,[(p(!0),v(U,null,K(We.value,(t,l)=>(p(),v("tr",{key:l,class:R(["hover:bg-blue-50/30 cursor-pointer transition-colors duration-150",{"bg-blue-50":d.value===t.testnr}]),onClick:r=>t.testnr&&Ne(t.testnr)},[n("td",Rt,M(t.testnr||""),1),n("td",Pt,[t.hasPar?(p(),v("svg",{key:0,xmlns:"http://www.w3.org/2000/svg",class:R(["h-4 w-4 mx-auto",t.imp===!0?"text-green-600":"text-slate-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[...e[15]||(e[15]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1)])],2)):L("",!0)]),n("td",Ot,[t.hasTbl?(p(),v("svg",{key:0,xmlns:"http://www.w3.org/2000/svg",class:R(["h-4 w-4 mx-auto",t.imp===!0?"text-green-600":"text-slate-400"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[...e[16]||(e[16]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1)])],2)):L("",!0)]),n("td",Ut,[t.imp===!0?(p(),v("span",At,[...e[17]||(e[17]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-green-600 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1)])])):L("",!0)]),n("td",Bt,M(t.nomcount||""),1),n("td",Ht,M(t.maschnr||""),1)],10,Lt))),128))])])]),n("div",Dt,M(ze.value),1),n("div",Ft,[n("div",Kt,[n("label",Vt,[A(n("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=t=>D.value=t),onChange:e[1]||(e[1]=()=>{D.value&&(N.value=!1,C.value=!1,j())}),class:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-400"},null,544),[[ge,D.value]]),e[20]||(e[20]=n("span",{class:"text-slate-700 font-medium"},"Mostrar todos",-1))]),n("label",jt,[A(n("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=t=>N.value=t),onChange:e[3]||(e[3]=()=>{N.value&&(D.value=!1,C.value=!1,j())}),class:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-400"},null,544),[[ge,N.value]]),e[21]||(e[21]=n("span",{class:"text-slate-700 font-medium"},"No guardados",-1))]),n("label",Gt,[A(n("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>C.value=t),onChange:e[5]||(e[5]=()=>{C.value&&(D.value=!1,N.value=!1,j())}),class:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-400"},null,544),[[ge,C.value]]),e[22]||(e[22]=n("span",{class:"text-slate-700 font-medium"},"Guardados",-1))])])])]),n("div",$t,[n("div",Wt,[n("div",zt,[e[23]||(e[23]=n("label",{class:"text-xs font-semibold text-slate-700"},"Estiraje",-1)),A(n("input",{ref_key:"estirajeInput",ref:k,"onUpdate:modelValue":e[6]||(e[6]=t=>_.value=t),type:"text",maxlength:"5",disabled:!d.value,onInput:dt,onKeydown:[q(J(ft,["prevent"]),["enter"]),pt,q(J(he,["prevent"]),["down"])],class:R(["w-16 px-2 py-0.5 text-sm text-center border border-slate-300 rounded focus:outline-none transition-all",d.value?"bg-white text-slate-900 hover:bg-slate-50 focus:ring-2 focus:ring-yellow-300 focus:border-yellow-300 focus:bg-yellow-50":"bg-slate-100 text-slate-400 cursor-not-allowed"])},null,42,qt),[[He,_.value]])])]),n("div",Jt,[n("div",Qt,[e[24]||(e[24]=n("label",{class:"text-xs font-semibold text-slate-700"},"Pasador",-1)),n("div",Yt,[n("label",Xt,[A(n("input",{ref_key:"pasadorSiInput",ref:B,"onUpdate:modelValue":e[7]||(e[7]=t=>w.value=t),type:"radio",value:"Si",disabled:!d.value,onKeydown:Ue,class:R(["w-3.5 h-3.5 text-blue-600 border-slate-300 focus:ring-2 focus:ring-blue-500",d.value?"cursor-pointer":"cursor-not-allowed opacity-50"])},null,42,Zt),[[De,w.value]]),n("span",{class:R(["text-xs",d.value?"text-slate-700":"text-slate-400"])},"Si",2)]),n("label",eo,[A(n("input",{ref_key:"pasadorNoInput",ref:Y,"onUpdate:modelValue":e[8]||(e[8]=t=>w.value=t),type:"radio",value:"No",disabled:!d.value,onKeydown:Ue,class:R(["w-3.5 h-3.5 text-blue-600 border-slate-300 focus:ring-2 focus:ring-blue-500",d.value?"cursor-pointer":"cursor-not-allowed opacity-50"])},null,42,to),[[De,w.value]]),n("span",{class:R(["text-xs",d.value?"text-slate-700":"text-slate-400"])},"No",2)])])])]),n("div",oo,[n("table",lo,[e[25]||(e[25]=n("thead",null,[n("tr",{class:"bg-gradient-to-r from-slate-50 to-slate-100"},[n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs",style:{width:"70px"}},"Huso"),n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs",style:{width:"90px"}},"Titulo")])],-1)),n("tbody",null,[(p(!0),v(U,null,K(W.value,(t,l)=>(p(),v("tr",{key:l,class:"hover:bg-blue-50/30 transition-colors duration-150"},[n("td",no,[t.srcIndex!==null?(p(),v("div",ro,M(t.nro),1)):(p(),v("div",so,"‚Äî"))]),n("td",ao,[t.srcIndex!==null?(p(),v("div",io,[A(n("input",{id:"titulo-input-"+t.srcIndex,"onUpdate:modelValue":r=>u.value[t.srcIndex].TITULO=r,inputmode:"decimal",maxlength:"5",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",onFocus:r=>st(t.srcIndex),onBlur:r=>at(t.srcIndex),onInput:r=>Ke(t.srcIndex,r),onKeydown:[q(J(r=>it(t.srcIndex),["prevent"]),["enter"]),q(J(r=>ct(t.srcIndex),["prevent"]),["up"]),q(J(r=>Pe(t.srcIndex),["prevent"]),["down"])],class:R(["w-full box-border px-1 py-0.5 text-sm text-center border border-slate-300 text-slate-900 focus:outline-none focus:ring-2 focus:border-blue-500 transition-all",$.value===t.srcIndex?"bg-yellow-50 ring-2 ring-yellow-400":"bg-white hover:bg-slate-50"]),style:{"box-sizing":"border-box",margin:"0","border-radius":"0"}},null,42,co),[[He,u.value[t.srcIndex].TITULO]])])):(p(),v("div",uo,"‚Äî"))])]))),128))])])])]),n("div",null,[n("div",fo,[n("table",po,[e[27]||(e[27]=n("colgroup",null,[n("col",{class:"col-dato"}),n("col",{class:"col-valor"})],-1)),e[28]||(e[28]=n("thead",null,[n("tr",{class:"bg-gradient-to-r from-slate-50 to-slate-100"},[n("th",{class:"px-3 py-3 text-left font-semibold text-slate-700 border-b border-slate-200 text-xs col-dato"}," Dato"),n("th",{class:"px-3 py-3 text-left font-semibold text-slate-700 border-b border-slate-200 text-xs col-valor"}," Valor")])],-1)),n("tbody",null,[(p(),v(U,null,K(mt,t=>n("tr",{key:t.code,class:"hover:bg-blue-50/30 transition-colors duration-150"},[n("td",vo,M(t.label),1),n("td",mo,[t.code==="MATCLASS"?A((p(),v("select",{key:0,"onUpdate:modelValue":e[9]||(e[9]=l=>T.value=l),class:"w-[calc(100%-5px)] px-2 py-1 border border-slate-300 rounded text-xs focus:outline-none focus:ring-2 focus:ring-blue-400"},[...e[26]||(e[26]=[n("option",{value:"Hilo"},"Hilo",-1),n("option",{value:"Hilo de fantasia"},"Hilo de fantasia",-1)])],512)),[[xt,T.value]]):(p(),v("span",ho,M(ce(t.code)),1))])])),64))])])]),n("div",bo,[ae.value?(p(),v("button",{key:0,ref_key:"saveButton",ref:P,onClick:nt,disabled:F.value,onKeydown:q(J(ut,["prevent"]),["up"]),class:"inline-flex items-center gap-2 px-3 py-1 border border-slate-200 bg-white text-slate-700 rounded-md text-sm font-medium hover:bg-slate-50 transition-colors duration-150 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 shadow-sm hover:shadow-md"},[F.value?(p(),v("span",go,"Guardando...")):(p(),v("span",wo,"Guardar"))],40,xo)):L("",!0),d.value&&Re.value?(p(),v("button",{key:1,onClick:rt,disabled:te.value,class:"inline-flex items-center gap-2 px-3 py-1 border border-red-300 bg-white text-red-700 rounded-md text-sm font-medium hover:bg-red-50 transition-colors duration-150 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2 shadow-sm hover:shadow-md"},[te.value?(p(),v("span",To,"Eliminando...")):(p(),v("span",_o,"Eliminar"))],8,yo)):L("",!0)])])]),u.value.length?(p(),v("div",So,[n("div",Eo,[n("table",{class:"w-full text-sm border-collapse tbl-import-table compact-table",style:ye({minWidth:ot.value+"px",tableLayout:"fixed"})},[n("colgroup",null,[n("col",{style:ye({width:Fe+"px"})},null,4),(p(),v(U,null,K(ne,(t,l)=>n("col",{key:l,style:ye({width:Ie(t)+"px"})},null,4)),64))]),n("thead",null,[n("tr",Mo,[e[29]||(e[29]=n("th",{class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs"},"#",-1)),(p(),v(U,null,K(ne,t=>n("th",{key:t,class:"px-3 py-3 text-center font-semibold text-slate-700 border-b border-slate-200 text-xs"},M(t),1)),64))])]),n("tbody",null,[(p(!0),v(U,null,K(u.value,(t,l)=>(p(),v("tr",{key:l,class:"hover:bg-blue-50/30 transition-colors duration-150"},[n("td",ko,M(l+1),1),(p(),v(U,null,K(ne,r=>n("td",{key:r,class:"px-3 py-2 border-b border-slate-200 font-mono text-xs text-center text-slate-700"},M(t[r]),1)),64))]))),128))])],4)])])):L("",!0)])])],64))}},Ro=ht(No,[["__scopeId","data-v-a2b7ae8a"]]);export{Ro as default};
